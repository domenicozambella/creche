\documentclass[creche.tex]{subfiles}
\begin{document}
\chapter{Ultraproducts and compactness}
\label{ultraprodotti}

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}




\section{Filters and ultrafilters}\label{ultrafiltri}

The matter in this section will be reconsidered in a more general setting in Chapter~\ref{types}.

Let $I$ be any set. A \emph{filter on $I$\/} (or a \emph{filter of $\P(I)$}), is a non empty set $F\subseteq \P(I)$ such that for evry $a, b\in \P(I)$:

\ceq{\ssf{f1}\hfill a\in F\ \ \textrm{and}\ \ a\subseteq b}{\IMP}{b\in F}

\ceq{\ssf{f2}\hfill a\in F\ \ \textrm{and}\ \ b\in F}{\IMP}{a\cap b\in F}

A filter $F$ is \emph{proper\/} if $F\neq\P(I)$, equivalently if $\0\notin F$. Otherwise it is \emph{improper}. By \ssf{f1} above, $F$ is proper if and only if $\0\notin F$. A filter $F$ is \emph{principal\/} if $F=\{a\subseteq I\; :\; b\subseteq a\}$ for some set $b\subseteq I$. We say that $\{b\}$ \emph{generates\/} $F$. When $I$ is finite every filter $F$ is principal generated by $\{\cap F\}$. Non principal filters on $I$ exist as soon as $I$ is infinite. In fact, if $I$ is infinite it is easy to check that the following is filter

\ceq{\hfill F}{=}{\Big\{a\subseteq I\ :\ a \ \mathrm{\ is\ cofinite\ in\ }\ I\Big\}}

where \emph{cofinite (in $I$)} means that $I\sm a$ is finite. This is called the \emph{Fr\'echet's filter on $I$}. The Fr\'echet's filter is the minimal non principal filter.

\begin{exercise}
Let $I$ be infinite. Prove that the  Fr\'echet's filter on $I$ contains all non principal filters on $I$.\QED
\end{exercise}

A proper filter $F$ is \emph{maximal\/} if there is no proper filter $H$ such that $F\subset H$. A proper filter $F$ is an \emph{ultrafilter\/} if for every $a\subseteq I$:

\ceq{\hfill a\notin F}{\IMP}{\neg a\in F}\hfill where \emph{$\neg a$}$\ \ \deq\ \ I\sm a$


Below we prove that ultrafilters are exactly the maximal filters.

Let $B\subseteq\P(I)$ the \emph{filter generated by $B$\/} is the intersection of all filters containing $B$. It is easy to check that the intersection of a family of filters is a filter, so the notion is well-defined. The following easy proposition gives a workable characterization of the filter generated by a set.

\begin{proposition} The filter generated by $B$ is $\big\{a\subseteq I\ :\ \bigcap C\subseteq a\ \textrm{ for some finite }\ C\subseteq B\big\}$.\QED

\end{proposition}

We say that $B$ has the \emph{finite intersection property\/} if $\bigcap C\neq\emptyset$ for every finite $C\subseteq B$. The following proposition is immediate.

\begin{proposition} The following are equivalent
\begin{itemize}
\item[1.] the filter generated by $B$ is non principal;
\item[2.] $B$ has the finite intersection property.\QED
\end{itemize}
\end{proposition}




A proper filter $F$ is \emph{prime\/} if for every $a,b\subseteq I$.

\ceq{\hfill a\cup b\in F}{\IMP}{a\in F\ \ \textrm{ or }\ \ b\in F}

Prime filters coincide with maximal filter. (However, in Chapter~\ref{types} we introduce more a general context where primeness is distinct from maximality.)

\begin{proposition}
For every filter $F$ on $I$, the following are equivalent:
\begin{itemize}
\item[1.] $F$ is a maximal filter;
\item[2.] $F$ is a prime filter;
\item[3.] $F$ is an ultrafilter.
\end{itemize}
\end{proposition}
\begin{proof}
\ssf{1}$\IMP$\ssf{2}. Suppose $a,b\notin F$, where $F$ is maximal. We claim that $a\cup b\notin F$. By maximality, there is a $c\in F$ such that $a\cap c= b\cap c= \0$. Therefore $(a\cup b)\cap c= \0$. Hence  $a\cup b\notin F$. 

\ssf{2}$\IMP$\ssf{3}. It suffices to note that $I=a\cup \neg a\in F$. 

\ssf{3}$\IMP$\ssf{1}. If $a\notin F$, where $F$ is an ultrafilter, then $\neg a\in F$ and no proper filter contains $F\cup\{a\}$.
\end{proof}

\begin{proposition}\label{esistenzamassimale1}
Let $B\subseteq\P(I)$ have the finite intersection property, then $B$ is contained in a maximal filter.
\end{proposition}

\begin{proof}
First prove that the union of a chain of subsets of $\P(I)$ with the finite intersection property has the finite intersection property. Let $\B$ be such a chain and suppose for a contradiction that $\bigcup\B$ does not have the finite intersection property. Fix a finite $C\subseteq\bigcap\B$ such that $\bigcap  C=\0$. As $C$ is finite, $C\subseteq B$ for some $B\in\B$. Hence $B$ does not have the finite intersection property. A contradiction.


Now apply Zorn lemma to obtain a $B\subseteq\P(I)$ which is maximal among the sets with the finite intersection property. It is immediate that $B$ is a filter.
\end{proof}

\begin{exercise}
Prove that all principal ultrafilters are generated by a singleton.\QED
\end{exercise}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Direct products}
\label{prodottidiretti}

In this and the next section $\<M_i:i\in I\>$ is a sequence of $L$-structures. (We are abusing of the word sequence, $I$ is only a set.) The \emph{direct product\/} of this sequence is a structure denoted by

\ceq{\hfill }{}{\emph{$\displaystyle\prod_{i\in I}M_i$}}\hfill below this is abbreviated by  \emph{$N$\/}

and is defined by conditions \ssf{1}-\ssf{3} below. If $M_i=M$ for all $i\in I$ we say that $N$ is a \emph{direct power\/} of $M$ and denote it by \emph{$M^I$}.

The domain of $N$ is the set of the functions

\ceq{\ssf{1.}\hfill \hat a}{:}{I\ \to\ \bigcup_{i\in I}M_i}\smallskip

\ceq{\hfill \hat a}{:}{i\ \ \mapsto\ \ \hat ai\ \in\ M_i}

We confuse tuples of elements of $N$ with tuple-valued functions, for instance, the tuple $\hat a=\<\hat a_1\dots\hat a_n\>$ is confused with the function $\hat a:i\mapsto\hat ai=\<\hat a_1i,\dots,\hat a_ni\>$. But at a first reading it might be convenient to pretend that all functions and relations are unary.

The interpretation of $f\in L_{\rm fun}$ is defined as follows

\ceq{\ssf{2.}\hfill\big(f^N\hat a\big)i}{=}{f^{M_i}(\hat ai)}\hfill  for all $i\in I$,

The interpretation of $r\in L_{\rm fun}$ is the product of the relations $r^{M_i}$, that is, we define

\ceq{\ssf{3.}\hfill\hat a\in r^N}{\IFF}{\hat ai\in r^{M_i}}\hfill  for all $i\in I$.


The following proposition is immediate.

\begin{proposition}\label{proposizioneprodottidiretti}
If only the connectives $\wedge$, $\A$ and $\E$ occur in $\phi(x)\in L$ then for every $\hat a\in N^{|x|}$

\ceq{\sharp\hfill N\models \phi(\hat a)}
{\IFF}
{M_i\models\phi(\hat a i)}\hfill for all $i\in I$.

\end{proposition}

\begin{proof}
By induction on syntax. First note that we can extend \ssf{2} to all terms $t(x)$

\ceq{\ssf{2'.}\hfill\big(t^N\hat a\big)i}{=}{t^{M_i}(\hat ai)}\hfill  for all $i\in I$. 

Combining \ssf{3} and \ssf{2'} we obtain that for every $r\in L_{\rm rel}\cup\{=\}$ and every $L$-term $t(x)$

\ceq{\ssf{3'.}\hfill N\models rt\hat a}{\IFF}{M_i\models rt\hat a i}\hfill  for all $i\in I$

This shows that $\,\sharp\,$ holds for $\phi(x)$ atomic. Induction for the connectives $\wedge$, $\A$ ed $\E$ is immediate.
\end{proof}

A consequence of Proposition~\ref{proposizioneprodottidiretti} is that the direct product of groups, rings and vector spaces are structures of the same sort. Notably, the product of fields is not a field.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Quotient structures}\label{quotient}
\def\ceq#1#2#3{\parbox[b]{20ex}{$\displaystyle #1$}\parbox[b]{6ex}{\hfil$#2$}$\displaystyle #3$}


If $\mathrel{E}$ is an equivalence relation on $N$ we write \emph{$[c]_E$\/} for the equivalence class of $c\in N$. We use the same symnol for the equivalenc erelation on $M^n$ defined as follow: if $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$ are $n$-tuples of elements of $N$ then \emph{$a\mathrel{E} b$\/} means that  $a_i\mathrel{E} b_i$ holds for all $i$. By \emph{$[a]_E$\/} we mean both the equivalence class of $a\in M^n$ or the for the tuple of equivalence classes $[a_1]_E,\dots,[a_n]_E$. The context will disambiguate.

An equivalence relation $\mathrel{E}$ on a structure $N$ is a \emph{congruence\/} if for every $f\in L_{\rm fun}$

\ceq{\ssf{c1}.\hfill a\mathrel{E} b}{\IMP}{f^N a\mathrel{E} f^N b;}

When $\mathrel{E}$ is a congruence on $N$ we write \emph{$N/E$\/} for the a structure that has as domain the set of $E$-equivalence classes in $N$ and the following interpretation of $f\in L_{\rm fun}$ and $r\in L_{\rm rel}$:

\ceq{\ssf{c2.}\hfill f^{N/E}[a]_E}{=}{\big[f^N a\big]_E\,;}

\ceq{\ssf{c3.}\hfill [a]_E\ \in\ r^{N/E}}{\IFF}{[a]_E\cap r^{N}\neq\0.}

By \ssf{c1} this interpretation is well-defined. We call $N/E$ the \emph{quotient structure}. The reader will recognize it as a familiar notion by the following proposition (which is not required in the following and requires the notion of homomorphism, see Definition~\ref{def_homomorphism}. Recall that the \emph{kernel\/} of a total map $h:N\to M$ is the equivalence relation $\mathrel{E}$ such that

\ceq{\hfill a\mathrel{E} b}{\IFF}{ha=hb} 

for every $a,b\in N$.

\begin{proposition}
Let $h:N\to M$ be a surjective homomorphism and let $E$ be the kernel of $h$. Then there is an isomorphism $k$ that makes the following diagram commute


\hspace*{25ex}\begin{tikzcd}
 N \arrow{r}{h}\arrow{d}{\pi} & M \\[3ex]
 N/E \arrow{ur}{k}\\
\end{tikzcd}

where $\pi:a\mapsto [a]_E$ is the projection map.\QED
\end{proposition}


\noindent\llap{\textcolor{red}{\Large\danger}\kern1.5ex}Quotients clutter the notation with brackets. To avoid the mess, we prefer to reason in $N$ and tweak the satisfaction relation.  We replace equality with $\mathrel{E}$ and adapt the interpretation of relation symbols to \ssf{c3} above. The following definition makes this precise (an inductive definition is required for instance in the proof of \L o\'{s} Theorem). Warning: it is not standard. 

\begin{definition}\label{def_pseudostructure}
For $t_2$, $t_2$ closed terms of $L(N)$ define

\ceq{\ssf{1$^*$}\hfill N/E\ \pmodels\ t_1=t_2}{\IFF}{[t_1^N]_E=[t_2^N]_E}

For $t$ a tuple of closed terms of $L(N)$ and $r\in L_{\rm rel}$ a relation symbol

\ceq{\ssf{2$^*$}\hfill N/E\ \pmodels\ rt}{\IFF}{[t^N]_E\in r^{N/E}}

Finally the definition is extended to all sentences $\phi\in\ L(N)$ by induction in the usual way

\ceq{\ssf{3$^*$}\hfill N/E\ \pmodels\neg\phi}{\IFF}{\textrm{not }\ N/E\,\pmodels\phi}

\ceq{\ssf{4$^*$}\hfill N/E\ \pmodels\phi\wedge\psi}{\IFF}{N/E\ \pmodels\phi\ \textrm{ and }\ N/E\ \pmodels\psi}

\ceq{\ssf{5$^*$}\hfill N/E\ \pmodels\E x\,\phi(x)}{\IFF}{N/E\ \pmodels\phi(\hat a)}\ for some $a\in N$.\QED
\end{definition}

% Note that if we treat $=$ as a relation symbol  (i.e.\@ not as a logical symbol) and interpret it with $E$, clause \ssf{1$^*$} becomes an instance of \ssf{2$^*$} in fact
% 
% 
% \ceq{\hfill t_1^N\mathrel{E}t_2^N}{\IFF}{[t^N_1,t^N_2]_E\cap E\neq \0}
% 
% by transitivity of $E$. 

Now, by induction on the syntax of formulas one can prove $\pmodels$ does what required. In particular, $N/E\ \pmodels\ \phi(a)\iff\phi(b)$ for every $a\mathrel{E} b$.

\begin{proposition}\label{prop_pseudomodel}
Let $\mathrel{E}$ be a congruence relation of $N$. Then the following are equivalent for every $\phi(x)\in L$

\ceq{\ssf{1.}\hfill N/E}{\pmodels}{\phi(a);}

\ceq{\ssf{2.}\hfill N/E}{\models}{\phi\big([a]_E\big).}\QED
\end{proposition}



% \begin{proof}
% First note that \ssf{c1} and \ssf{c2} above generalize to terms
% 
% \ceq{\ssf{c1'}.\hfill a\mathrel{E} b}{\IMP}{t^N a\mathrel{E} t^N b;}
% 
% \ceq{\ssf{c2'.}\hfill t^{N/E}[a]_E}{=}{\big[t^N a\big]_E\,.}
% 
% So if $\phi(x)$ is atomic, say it is the formula $rt(x)$ for $r\in L_{\rm rel}\cup\{=\}$ and $t(x)$ is a tuple of terms, then the equivalence \ssf{1}$\IFF$\ssf{2} follows from Definition~\ref{def_pseudostructure}. For general $\phi(x)$ the equivalence is proved by straightforward induction on the syntax. 
% \end{proof}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ultraproducts}
Assume the notation of the previous sections. In particular, $\<M_i:i\in I\>$ is a sequence of structures and $N$ is the direct product of this sequence. 

Let $F$ be a filter on $I$. We define the following congruence relation on $N$

\ceq{\hfill \hat a\sim_F\hat c}{\IFF}{\big\{\, i\in I\ :\ \hat ai=\hat ci\,\big\}\in F\,.}

It is easy to verify that $\sim_F$ is indeed an equivalence relation: reflexivity and symmetry are evident, transitivity follows from \ssf{f2} in Section~\ref{ultrafiltri}. It is also clear that $\sim_F$ a congruence. 

We now introduce an ad hoc notion quotient structure \emph{$N/F$\/} by tweaking the definition in Section~\ref{quotient}.  Namely, we replace \ssf{c3}  by the following

\ceq{\ssf{c3'.}\hfill [\hat a]_{\sim_F}\ \in\ r^{N/F}}{\IFF}{\big\{\,i\; :\; \ \hat ai\in r^{M_i}\,\big\}\,\in\, F}

We will not elaborate on the difference between \ssf{c3} and \ssf{c3'}. We refer the interested reader to Exercise~\ref{ex_c3=c3'} and~\ref{ex_o}.

The structure $N/F$ is called the \emph{reduced product\/} of the structures $\<M_i:i\in I\>$ or, when $M_i=M$ for all $i\in I$, the \emph{reduced power\/} of $M$. When $F$ is an ultrafilter we say \emph{ultraproduct}, respectively \emph{ultrapower}. 


We the notation introduced in Definition~\ref{def_pseudostructure} (see also Proposition~\ref{prop_pseudomodel}) we are ready to state a fundamental theorem about ultraproducts.

\begin{void_thm}[\L o\'{s} Theorem]\label{thm_los}
Let $\phi(x)\in L$ and let $F$ be an ultrafilter on $I$. Then for every $\hat a\in N^{|x|}$, the following are equivalent
\begin{itemize}
\item[1.] $N/F\ \pmodels\ \phi(\hat a)$;
\item[2.] $\big\{\,i\ :\ M_i\models \phi(\hat a i)\,\big\}\ \in\ F$.
\end{itemize}
\end{void_thm}

\begin{proof}
We proceed by induction of the syntax of $\phi(x)$. Suppose $\phi(x)$ is of the form $rt(x)$ for some tuple of terms $t(x)$ and $r\in L_{\rm rel}\cup\{=\}$. Then \ssf{1}$\IFF$\ssf{2} follows easily from \ssf{c3'}.

We prove the inductive step for the connectives $\neg$, $\wedge$, and $\E$. We begin with $\neg$. This is the only place in the proof where the assumption that $F$ is an \textit{ultra\kern.2ex}filter is required. From the inductive hypothesis we obtain

\ceq{\hfill N/F\ \pmodels\ \neg\phi\big(\hat a\big)}%
{\IFF}%
{\big\{i\ :\ M_i\; \models\; \phi(\hat a i)\;\big\}\ \notin\ F}

So, as $F$ is an \textit{ultra\kern.2ex}filter

\ceq{}{\IFF}%
{\big\{i\ :\ M_i\; \models\; \neg\phi(\hat a i)\;\big\}\ \in\ F\,.}

Now consider $\wedge$. Assume as inductive hypothesis that the equivalence \ssf{1}$\IFF$\ssf{2} holds for $\phi(x)$ and $\psi(x)$, then

\ceq{\hfill N/F\ \pmodels\ \phi\big(\hat a\big)\wedge\psi\big(\hat a\big)}%
{\IFF}%
{\big\{i\,:\, M_i\models\phi(\hat a i)\big\}\,\in\, F\ \ {\rm and}\ \ \big\{i\, :\, M_i\models\psi(\hat a i)\big\}\, \in\, F}

As filters are closed under intersection we obtain

\ceq{}{\IFF}{\big\{i\ :\ M_i\; \models\; \phi(\hat a i)\wedge\psi(\hat a i)\;\big\}\ \in\ F\,.}

Finally consider $\E y$.  Assume as inductive hypothesis that the equivalence \ssf{1}$\IFF$\ssf{2} holds for $\phi(x,y)$, then

\ceq{\hfill N/F\ \pmodels\ \E y\,\phi\big(\hat a,y\big)}%
{\IFF}%
{N/F\ \pmodels\  \phi\big(\hat a,\hat b\big)}\hfill for some $\hat b\in N$\phantom{.}

\ceq{}{\IFF}%
{\big\{i\ :\ M_i\; \models\; \phi(\hat a i,\hat b i)\;\big\}\ \in\ F}\hfill for some $\hat b\in N$.

We claim this is equivalent to

\ceq{}{\IFF}%
{\big\{i\ :\ M_i\; \models\; \E y\,\phi(\hat a i,y)\;\big\}\ \in\ F.}

In fact, direction $\IMP$ is trivial and, as for $\PMI$, we choose as $\hat b$ a sequence that picks a witness of $M_i\models\E y\,\phi(\hat a i,y)$ if it exists, some arbitrary element of $M_i$ otherwise.
\end{proof}

Let \emph{$a^I$\/} denote the element of $M^I$ that has constant value $a$. The following is an immediate consequence of \L o\'{s} theorem.

\begin{corollary}\label{ultrapotenzeelementari}
For every $a\in M$

\ceq{\hfill M^I/F\ \pmodels\ \phi(a^I)}%
{\IFF}%
{M\ \models\ \phi(a)\,.}\QED
\end{corollary}


Often one identifies $M$ with its image under the map $h:a\mapsto [a^I]_F$ and say that $M^I/F$ is an elementary extension of $M$.

\begin{corollary}
Every infinite structure has a proper elementary extension.
\end{corollary}

\begin{proof}
Let $M$ be an infinite structure and let $F$ be an \textit{non principal\/} ultrafilter on $\omega$. By the above remark, it suffices to show that $h[M]$ is a \textit{proper\/} substructure of $M^\omega/F$.  As $M$ is infinite, there is an injective function  $\hat d\in M^\omega$. Then for every $a\in M$ the set $\big\{i:\hat di=a\big\}$ is either empty or a singleton and, as $F$ is non principal, it does not belong to $F$. So, by \L o\v{s} Theorem $M^\omega/F\ \pmodels\ \hat d\neq a^I$ for every $a\in M$, that is, $[\hat d]_F\notin h[M]$.
\end{proof}

\begin{exercise}\label{ex_c3=c3'}
Prove that \ssf{c3} differs from \ssf{3c'} only if $\{ i\ :\ r^{M_i}=\0\}\in F$. 
\end{exercise}




\begin{exercise}\label{ex_o}
Let \emph{$o$\/} be some fresh element. Let \emph{$M'_i$\/} is a superstructures of $M_i$ with domain $M_i\cup\{o\}$, relations $r^{M'_i}=r^{M_i}\cup\{o\}^{n_r}$, and functions $f^{M'_i}$ just any extension of $f^{M_i}$. Denote by $N'$ the direct product of the sequence $\<M'_i:i\in I\>$. The element of $N'$ that is identically $o$ is denoted by $o^I$.
 
It is easy to verify that the $\mathord{\sim_F}$-equivalence classes that do not contain $o^I$ form substructure of 

Let $N'/\mathord{\sim_F}$ be the quotient structure as defined in Section~\ref{quotient}. Prove that $N/F$ is isomorphic to the substructure of $N'/\mathord{\sim_F}$ that contains all equivalence classes but for the one of $o^I$.\QED
\end{exercise}



\begin{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Boolean-valued models}\label{Boolean_models}

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

Fix a language $L$. Fix also some set $I$ and write $\BB$ for the Boolean algebra $\P(I)$.  A \emph{$\BB$-valued model\/}\index{model!Boolean valued} consists of 
\begin{definition}\label{def_boolean_valued}
A \emph{$\BB$-valued model\/}\index{model!Boolean valued} consists of 
\begin{itemize}
\item[1.] a set $M$ that we call the domain;
\item[2.] a function that assign to every $f\in L_{\rm fun}$ a total map $f^M$ $: M^{n_f}\to M$;
\item[3.] a function that assign to every $r\in L_{\rm rel}$ total map \emph{$r^M : M^{n_r}\to\BB$};
\item[4.] a function \emph{$\sim^M : M^2\to\BB$}, which we use with the infix notation, such that for every $a,b,c,a_i,b_i\in M$, every $f\in L_{\rm fun}$, and every $r\in L_{\rm rel}$\bigskip

\ceq{\ssf{a.}\hfill a\;\sim^M a}{=}$1_\BB$\bigskip

\ceq{\ssf{b.}\hfill a\;\sim^M b}{=}$b\;\sim^M a$\bigskip

\ceq{\ssf{c.}\hfill  (a\sim^M b)\;\wedge\; (b  \sim^M c)}{\le}$a \;\sim^M c$\bigskip

\ceq{\ssf{d.}\hfill \bigwedge_{i=1,\dots,n_f}(a_i\sim^M b_i)}{\le}$f^M(a_1,\dots,a_{n_f})\;\sim^Mf^M(b_1,\dots,b_{n_f})$\smallskip

\ceq{\ssf{e.}\hfill \bigwedge_{i=1,\dots,n_r}(a_i\sim^M b_i)}{\le}$r^M(b_1,\dots,b_{n_r})\ \iff\ r^M(a_1,\dots,a_{n_r})$

\end{itemize}
\smallskip
Where $\iff$ above is an operator of $\BB$. We will say \emph{Boolean valued model\/} for $\BB$-valued model for some $\BB$.\QED
\end{definition}

Now we assign a Boolean truth value to all closed formulas of $L(M)$. 


\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox{20ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

\begin{definition}\label{def_boolean_model_truth}
The interpretation of terms in a Boolean valued model is defined as in the classical case. The interpretation of a closed formula $\phi\in L(M)$ is an element of $\BB$ we denote by $\phi^M$.

\ceq{\ssf{o.}\hfill \big(\,r\,t_1\dots t_{n_r}\,\big)^M}{\IFF} $r^M(t^M_1\dots t^M_{n_r})$\quad for every $r\in L_{\rm rel}\cup\{\sim\}$;

\ceq{\ssf{i1}\hfill \big(\,{\wedge}\,\xi\,\psi\,\big)^M}{\IFF} $\xi^M\wedge\psi^M$;

\ceq{\ssf{i2}\hfill \big(\,\neg\phi\,\big)^M}{\IFF} $\neg\phi^M$;

\ceq{\ssf{i3}\hfill \big(\,\E x\,\phi\,\big)^M} {\IFF} $\displaystyle\bigcup_{a\in M}\phi[x/a]^M$.\QED
\end{definition}

In Definition~\ref{def_boolean_valued} we could have allowed more general Boolean algebras. However for the correct generalisation of \ssf{i3} some conditions on $\BB$ are necessary to ensure the existence of the least upper bound of the set $\big\{\phi[x/a]^M\,:\, a\in M\big\}$. To keep this exposition short an simple, we only consider the simplest case.

Classical model can be read as a $\BB$-models in the obvious way. We identify relations with their indicator functions and take as $\sim^M$ the indicator function of the diagonal. Then the definition above coincide with classical definition of truth.

The converse is \textit{almost\/} true as the nxt proposition shows.

Let $F\subseteq\BB$ be an ultrafiler and let $M$ be a $\BB$-valued model. Let $M_F$ be the first order model with domain $M$ and interpretation

\ceq{\ssf{a.}\hfill f^{M_F}}{=}{f^M}

\ceq{\ssf{b.}\hfill r^{M_F}}{=}{\big\{a\ : r^M(a)\ \in\ F\big\}}

Now define 

\ceq{\ssf{c}\hfill a\mathrel{E}b}{\IFF}{a\sim^Mb\ \in\ F}

By axioms \ssf{4a}-\ssf{4c} in Definition~\ref{def_boolean_valued}, this defines an equivalence relation. By \ssf{4e} and\ssf{4f}, it is a congruence relation. We can then define the quotient $M_F/E$ as in Section~\ref{quotient} which we denote $M/F$ for short. 


\begin{theorem}
Let $F\subseteq\BB$ be an ultrafilter ad let $M$ be a $\BB$-valued model then for every $\phi(x)\in L$ and every $a\in M^{|x|}$

\ceq{\ssf{\#}\hfill M/F\pmodels\phi(a)}{\IFF}$\phi(a)^M\in F$.

\end{theorem}

\begin{proof}
We prove the equivalence by induction of the syntax of $\phi(x)$. Suppose $\phi(x)$ is of the form $rt(x)$ for some tuple of terms $t(x)$ and $r\in L_{\rm rel}\cup\{=\}$. Then equivalence \ssf{\#} follows easily from  Definition~\ref{def_boolean_model_truth}.\ssf{o} and \ssf{a}-\ssf{c} above.

We prove the inductive step for the connectives $\neg$, $\wedge$, and $\E$. We begin with $\neg$. This is the only place in the proof where the assumption that $F$ is an \textit{ultra\kern.2ex}filter is required. The inductive hypothesis we obtain

\ceq{\hfill N/F\ \pmodels\ \neg\phi(a)}%
{\IFF}%
{\phi(a)^M\ \notin\ F}

By Definition~\ref{def_boolean_model_truth}.\ssf{i2} and since $F$ is an \textit{ultra\kern.2ex}filter

\ceq{}{\IFF}%
{\big(\neg\phi(a)\big)^M\ \in\ F\,.}

Now assume as inductive hypothesis the equivalence \ssf{\#} holds for $\phi(x)$ and $\psi(x)$, then

\ceq{\hfill N/F\ \pmodels\ \phi(a)\,\wedge\,\psi(a)}%
{\IFF}%
{\phi(a)^M\ \in\ F\ \ \ {\rm and}\ \ \ \psi(a)^M\ \in\ F}

By Definition~\ref{def_boolean_model_truth}.\ssf{i1} and since filters are closed under intersection we obtain

\ceq{}{\IFF}{\big(\phi(a)\wedge\psi(a)\big)^M \in\ F\,.}

Finally assume as inductive hypothesis the equivalence \ssf{\#} holds for $\phi(x,y)$, then

\ceq{\hfill N/F\ \models\ \E y\,\phi\big(a,y\big)}%
{\IFF}%
{N/F\ \models\  \phi\big(a,b\big)}\hfill for some $b\in N$\phantom{.}

\ceq{}{\IFF}%
{\phi(a,b)\ \in\ F}\hfill for some $b\in N$.

We claim that, by Definition~\ref{def_boolean_model_truth}.\ssf{i3}, this is equivalent to

\ceq{}{\IFF}%
{\big(\E y\,\phi(a,y)\big)^M\ \in\ F.}

In fact, direction $\IMP$ is trivial and, as for $\PMI$, we choose as $\hat b$ a sequence that picks a witness of $M_i\models\E y\,\phi(\hat a i,y)$ if it exists, some arbitrary element of $M_i$ otherwise.



\ssf{2}$\IFF$\ssf{3} This is Proposition~\ref{prop_pseudomodel}.


\ssf{2}$\IMP$\ssf{1} By straightforward induction on the syntax of $\phi(x)$  
\end{proof}


\begin{proposition}
For every sentence $\phi\in L$ the following are equivalent
\begin{itemize}
\item[1.] $\phi$ is a tautology;
\item[2.] $\phi^M=1_\BB$ for every $\BB$-model $M$.
\end{itemize}
\end{proposition}
\begin{proof}
\ssf{1}$\IMP$\ssf{2} As observed above classical model are in particular Boolean models. 

\ssf{2}$\IMP$\ssf{1} By straightforward induction on the syntax of $\phi(x)$  
\end{proof}



\begin{proposition}
For every sentence $\phi\in L$ the following are equivalent
\begin{itemize}
\item[1.] $\phi$ is a tautology;
\item[2.] $\phi^M=1_\BB$ for every $\BB$-model $M$.
\end{itemize}
\end{proposition}
\begin{proof}
\ssf{1}$\IMP$\ssf{2} As observed above classical model are in particular Boolean models. 

\ssf{2}$\IMP$\ssf{1} By straightforward induction on the syntax of $\phi(x)$  
\end{proof}

\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The compactness theorem}\label{compactness}
\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}



A theory is \emph{finitely consistent\/} if all its finite subsets are consistent. The following theorem is the \textit{fiat lux\/} of model theory. 

\begin{void_thm}[Compactness Theorem]\label{thmcompattezza}
Every finitely consistent theory is consistent. 
\end{void_thm}

\begin{proof}
Let  $T$ be a finitely consistent theory. We claim that the structure $N/F$ which we define below is a model of $T$. Let $I$ be the set of consistent sentences $I$ in the language $L$. For every $\xi\in I$ pick some $M_\xi\models\xi$. For any sentence $\phi\in L$ we write $X_\phi$ for the following subset of $I$

\ceq{\hfill X_\phi}{=}{\Big\{\xi\in I\ :\ \xi\proves \phi\Big\}}

Clearly $\phi$ is consistent if and only if $X_\phi\neq\0$. Moreover $X_{\phi\wedge\psi}\ =\ X_\phi\cap X_\psi$. hence, as $T$ is finitely consistent, the set $B=\big\{X_\phi\,:\,\phi\in T\big\}$ has the finite intersection property. Therefore $B$ extends to an ultrafilter $F$ on $I$. Define

\ceq{\hfill N}{=}{\prod_{\xi\in I}M_\xi}.

We claim that $N/F\models T$. By \L o\v{s} Theorem, for every sentence $\phi\in L$

\ceq{\hfill N/F\models \phi}%
{\IFF}%
{\Big\{\xi\ :\ M_\xi\models\phi\Big\}\ \in\ F\,.}

By the definition of $F$, for every $\phi\in T$, the set $X_\phi\subseteq \big\{\xi\ :\ M_\xi\models \phi\big\}$ belongs to $F$. Therefore $N/F\models T$, \textit{et lux fuit}.
\end{proof}

The compactness theorem can be formulated in the following apparently stronger way.

\begin{corollary}\label{compattezza2}
If $T\proves\phi$ then there is some finite $S\subseteq T$ such that $S\proves\phi$.
\end{corollary}

\begin{proof}
Suppose $S\notproves\phi$ for every finite $S\subseteq T$. Then for every finite $S\subseteq T$ there is a model $M\models S\cup\{\neg\phi\}$. In other words, $T\cup\{\neg\phi\}$ is finitely consistent. By compactness $T\cup\{\neg\phi\}$ hence $T\notproves \phi$.
\end{proof}

\begin{exercise}
Let $\Phi\subseteq L$ be a set of sentences and suppose that $\proves\psi\iff\bigvee\Phi$ for some sentence $\psi$. Prove that there is a finite $\Phi_0\subseteq\Phi$ such that  $\proves\psi\iff\bigvee\Phi_0$.\QED
\end{exercise}

\section{Finite axiomatizability}

A theory $T$ is \emph{finitely axiomatizable\/} if $\ccl(S)=\ccl(T)$ for some finite $S$. The following theorem shows that we can restrict the search of $S$ to the subsets of $T$.

\begin{proposition}\label{finaxsub} For every theory $T$ the following are equivalent
\begin{itemize}
\item[1.] $T$ is finitely axiomatizable;
\item[2.] there a finite $S\subseteq T$ such that $S\proves T$.
\end{itemize}
\end{proposition}

\begin{proof}
Only \ssf{1}$\IMP$\ssf{2} requires a proof. If $T$ is finitely axiomatizable, there is a sentence $\phi$ such that $\ccl(\phi)=\ccl(T)$. Then $T\proves\phi\proves T$. By Proposition~\ref{compattezza2} there is a finite $S\subseteq T$ such that $S\proves\phi$. Then also $S\proves T$.
\end{proof}

If $L$ is empty, then every structure is a model. The \emph{theory of infinite sets\/} is the set of sentences that hold in every infinite structure.

\begin{example} 
The theory of infinite sets is not finitely axiomatizable. Define

\ceq{\hfill T_{\infty}}{=}{\big\{\E^{\ge n}x\;(x=x)\big\}\ :\ n\in\omega\big\}}

Every infinite set is a model of $T_{\infty}$ and, vice versa, every model of $T_{\infty}$ is is an infinite set. Then $\ccl(T_{\infty})$ is the theory of infinite sets. Suppose for a contradiction that $T_{\infty}$ is finitely axiomatizable. By Proposition~\ref{finaxsub}, $\E^{\ge n}x (x=x)\proves T_{\infty}$ for some $n$. Any set of cardinality $n+1$ proves that this is not the case.\QED
\end{example}

The following is a less trivial example. It proves a claim we made in Exercise~\ref{ex_grafo_bipartito}.

\begin{example}

\def\ceq#1#2#3{\parbox{5ex}{$\displaystyle #1$}\parbox{4ex}{\hfil$#2$}$\displaystyle #3$}

Write $T_{\rm gph}$ for the theory of graphs, see Example~\ref{expl_Tgraphs}. Let $\K$ be the following class of structures


\ceq{\hfill \K}{=}{\Big\{M\models T_{\rm gph}\ :\ r^M\ \subseteq\ (A\times \neg A)\;\cup\;(\neg A\times A)\textrm{ for some }A\subseteq M\Big\}}


We prove that $\K$ is axiomatizable but not finitely axiomatizable, i.e.\@ $\K=\Mod(T)$ for some theory $T$, but $T$ cannot be choosen finite.

A \emph{path of length $n$\/} in $M$ is a sequence $c_0,\dots,c_n\in M$ such that $M\models r(c_i,c_{i+1})$ for every $0\le i<n$. A path is \emph{closed\/} if $c_0=c_n$.  We claim that the following theory axiomatizes $\K$.


\ceq{\hfill T}{=}{\Bigg\{\neg\E x_0,\dots x_{2n+1} \Bigg[\bigwedge^{2n}_{i=0} r(x_i,x_{i+1})\ \wedge\ x_0=x_{2n+1} \Bigg]\ \ :\ \ n\in\omega\Bigg\}}

In words, $T$ says that all closed paths have even length. Inclusion $\K\subseteq\Mod(T)$ is clear, we prove $\Mod(T)\subseteq\K$. Let $M\models T$ and let $A_o\subseteq M$ contain exactly one point for every connected component of $M$. Define 

\ceq{\hfill A}{=}{\Bigg\{b\, :\, M\models\E x_0,\dots, x_{2n} \Bigg[\bigwedge^{2n-1}_{i=1} r(x_i,x_{i+1}) \wedge a{=}x_0\wedge x_{2n}{=}b\Bigg],\ a\in A_o,\ n\in\omega\Bigg\}}

We claim that $r^M\subseteq(A\times \neg A)\cup(\neg A\times A)$, hence $M\in\K$. We need to verify that if $r(b,c)$ then neither $b,c\in A$ nor $b,c\in\neg A$.  Suppose for a contradiction that $r(b,c)$ and $b,c\in A$ (the case $b,c\in\neg A$ is similar). As $b$ and $c$ belong to the same connected component, there are two paths $b_0,\dots,b_{2n}$ and $c_0,\dots,c_{2m}$ that connect $a=b_0=c_0\in A_o$ to $b=b_{2n}$ and $c=c_{2m}$. Then $a,b_1,\dots,b_{2n},c_{2m},\dots,c_1,a$ is a closed path of odd length. A contradiction.

We now prove that $\K$ is not finitely axiomatizable. By Proposition~\ref{finaxsub} it suffices to note that no finite $S\subseteq T$ axiomatizes $\K$.\QED
\end{example}




% 
% 
% \begin{exercise}
% Sia $\phi(x,y)$ una formula pura, $M$ un modello, $\<a_i:i\in\omega\>$ una sequenza di elementi di $M$ tali che $\phi(a_i,M)\subset\phi(a_{i+1},M)$ per tutti gli $i\in\omega$. Si dimostri, se $F$ \`e un ultrafiltro non principale su $\P(\omega)$, allora in $M^\omega/F$ esiste una sequenza $\<\hat b_i:i\in\omega\>$ tale che $\phi(\hat b_{i+1},M)\subset\phi(\hat b_i,M)$.
% \end{exercise}



\section{Realization of types and upword L\"owenheim-Skolem}

\def\ceq#1#2#3{\parbox{13ex}{$\displaystyle #1$}\parbox{4ex}{\hfil$#2$}$\displaystyle #3$}
 
Recall that a \emph{type\/} is a set of formulas. When we present types we usually declare the variables that may occur in it --~we write \emph{$p(x)$}, \emph{$q(x)$}, etc.\@ where $x$ is a tuple of variables. Clearly, when $x$ is the empty tuple, $p(x)$ is just a theory. We identify a finite types with the conjunction of the formulas contained in it.

We write \emph{$M\models p(a)$} if $M\models\phi(a)$ for every $\phi(x)\in p$.  We say that $a$ is a \emph{solution\/} or a \emph{realization\/} of $p(x)$. An equivalent notation is \emph{$M,a\models p(x)$} or, when $M$ is clear from the context, \emph{$a\models p(x)$}. We say that $p(x)$ is \emph{consistent in $M$\/} it has a solution in $M$. In this case we may write \emph{$M\models\E x\,p(x)$}.  We say that $p(x)$ is \emph{consistent\/} tout court if it is consistent in some model.

We say that a type $p(x)$ is \emph{finitely consistent\/} if all its finite subsets are consistent. If they are all consistent in the same model $M$, we say that $p(x)$ is \emph{finitely consistent in $M$}. The following theorem shows that the latter notion, which is trivial for theories, is very interesting for types.

\begin{void_thm}[Compactness Theorem for types]\label{thm_compattezzatipi}
Every finitely consistent type $p(x)\subseteq L$ is consistent. Moreover, if $p(x)\subseteq L(M)$ is finitely consistent in $M$ then it is realised in some elementary extension of $M$.
\end{void_thm}

\begin{proof}
 
Let $L'$ be an expansion of $L$ with a fresh constant symbols $c$, a tuple of constants of the same length as $x$. Then $p(c)$ is a finitely consistent theory in the language $L'$. By the compactness theorem there is an $L'$-structure $N'\models p(c)$. Let $N$ be the reduced of $N'$ to $L$. That is the $L$-structure with the same domain and the same interpretation of $N'$ on the symbols of $L$. Then $N$ realises $p(x)$.  

As for the second claim, let $a$ be an enumeration of $M$. We can assume that $p(x)$ has the form $p'(x,a)$ for some $p'(x,z)\in L$. Define

\ceq{\hfill q(z)}{=}{\big\{\phi(z)\ :\ M\models \phi(a)\big\}}

Clearly, $q(z)\cup p'(x,z)$ is finitely consistent (in $M$). By the first part of the proof there is a model $N'$ such that $N'\models p'(a',b')$ for some $a',b'$. Let $h$ be the function $\{\<a,a'\>\}$. Then $h:M\to N'$ is an embedding and we can identify $M$ with $h[M]$. The proposition is proved if we can show that $h[M]\preceq N'$. For any $\phi(z)\in L$ we have


\hfil $h[M]\models\phi(ha)\ \ \IFF\ \  M\models \phi(a)\ \  \IFF\ \  \phi(z)\in q(z)\ \   \IMP\ \  N'\models \phi(a')$.

Then $h[M]\preceq N'$ follows because all sentences in $L(M)$ have the form $\phi(a)$ for some $\phi(z)\in L$.
\end{proof}

The following corollary is historically important.

\begin{void_thm}[Upward L\"owenheim-Skolem Theorem]
Every infinite structure has arbitrarily large elementary extensions.
\end{void_thm}

\begin{proof}
Let $x=\<x_i:i<\lambda\>$ be a tuple distinct variables, where $\lambda$ is an arbitrary cardinal. The type $p(x)=\big\{x_i\neq x_j: i<j<\lambda\big\}$ is finitely consistent in every infinite structure and every structure that realises $p$ has cardinality $\ge\lambda$. Hence the claim follows from Theorem~\ref{thm_compattezzatipi}.
\end{proof}


\end{document}