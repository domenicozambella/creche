% !TEX root = creche.tex
\documentclass[creche.tex]{subfiles}
\begin{document}
\chapter{Externally definable sets}
\label{external}

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}



In this chapter we fix a signature $L$, a complete theory $T$ without finite models, and a saturated model $\U$ of inaccessible cardinality $\kappa>|L|$.
The notation and implicit assumptions are as in Section~\hyperref[monster]{\ref*{saturation}.\ref*{monster}}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Approximable sets}
\label{approximable}

\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

Let $\grC,\grD\subseteq\U^{|{\gr z}|}$.
The set $\grD\cap A^{|{\gr z}|}$ is called the \emph{trace\/} of $\grD$ over $A$.
We write $\grC=_A\grD$ if  $\grC$ and $\grD$ have the same trace on $A$.

We say that $\grD$ is \emph{externally definable\/} if it is of the form ${\gr\D_{p,\phi}}$ for some global type $p\in S_{\mr x}(\U)$ and some formula $\phi({\mr x}\,;{\gr z})\in L$, see Section~\hyperref[invariant_sets]{\ref*{invariant}.\ref*{invariant_sets}} for the notation.
We may say that $\grD$ is externally definable \emph{by $p({\mr x})$ and $\phi({\mr x}\,;{\gr z})$}.
Equivalently, a set $\grD$ is externally definable if it is the trace over $\U$ of a set which is definable in some elementary extension of $\U$.
Precisely, $\grD$ is the trace on $\U$ of a set of the form $\phi({\mr b'}\,;{\gr\U'})$ where $\U'$ is elementary extension of $\U$ and ${\mr b'}\in\U'^{|{\mr x}|}$.
The latter interpretation explains the terminology.

\noindent\llap{\textcolor{red}{\Large\danger}\kern1.5ex}We prefer to deal with external definability in a different, though equivalent, way.
This is not the most common approach.

\begin{definition}\label{def_epprox}
We say that $\grD$ is \emph{approximated\/} by the formula $\phi({\mr x}\,;{\gr z})$ if for every finite $B$ there is a ${\mr b}\in\U^{|{\mr x}|}$ such that $\phi({\mr b}\,;{\gr\U})=_B\grD$.
If in addition we have that $\phi({\mr b}\,;{\gr\U})\subseteq\grD$, we say that  $\grD$ is \emph{approximated from below}.
Similarly, when $\grD\subseteq\phi({\mr b}\,;{\gr\U})$ we say that  $\grD$ is \emph{approximated from above}.
We may call $\phi({\mr x}\,;{\gr z})$ the \emph{sort} of $\grD$.\QED
\end{definition} 
 
The following proposition is clear by compactness.

\begin{proposition}\label{prop_approx=external}
For every $\grD$ the following are equivalent
\begin{itemize}
\item[1.] $\grD$ is approximated by $\phi({\mr x}\,;{\gr z})$;
\item[2.] $\grD$ is externally definable by $\phi({\mr x}\,;{\gr z})$.\QED
\end{itemize}
\end{proposition}

Approximability from below is an adaptation to our context of the notion of \textit{having an honest definition} in \cite{CS}.
\begin{definition}\label{def_defble_type}
We say that the global type $p\in S_{{\mr x}}(\U)$ is \emph{honestly definable\/} if for every $\phi({\mr x}\,;{\gr z})\in L$ the set ${\gr\D_{p,\phi}}$ is approximated from below (by some formula).
We say that $p$ is \emph{definable\/} if the sets ${\gr\D_{p,\phi}}$ are all definable (over $\U$).
Note that the terminology is misleading: honestly definable is weaker than definable.
\end{definition}

\begin{example}
Every definable set is trivially approximable.
Sets may be approximable by different formulas.
For instance, if $T=T_{\rm dlo}$, then $\D=\{z\in\U:a\le z\le b\}$ is approximable both from below and from above by the formula $x_1<z<x_2$ though it is not definable by this formula.

Now, let $T=T_{\rm rg}$.
Then every $\D\subseteq\U$ is approximable and, when $\D$ has small infinite cardinality, it is approximable from above but not from below, see Exercise~\ref{ex_rg_small_def_set}.\QED
\end{example}

In Definition~\ref{def_epprox}, the sort $\phi({\mr x}\,;{\gr z})$ is fixed (otherwise any set would be approximable) but this requirement of uniformity may be dropped if we allow $B$ to have larger cardinality.

\begin{proposition}\label{lem_approx_nonunif}
For every $\grD$ the following are equivalent
\begin{itemize}
\item[1.] $\grD$ is approximable;
\item[2.] for every $C\subseteq\U$ of cardinality $\le|T|$ there is $\psi({\gr z})\in L(\U)$ such that $\psi({\gr\U})=_C\grD$.
\end{itemize}
Similarly, the following are equivalent
\begin{itemize}
\item[3.] $\grD$ is approximable from below;
\item[4.]  for every ${\gr C}\subseteq\grD$ of cardinality $\le|T|$ there is $\psi({\gr z})\in L(\U)$ such that ${\gr C}\subseteq \psi({\gr\U})\subseteq\grD$.
\end{itemize}
\end{proposition}

\begin{proof}
To prove \ssf{2}$\IMP$\ssf{1} assume \ssf{2} and negate \ssf{1} for a contradiction.
For each formula $\psi({\mr x}\,;{\gr z})\in L$ choose a finite set $B$ such that $\psi({\mr b}\,;{\gr\U})\neq_B\grD$ for every ${\mr b}\in\U^{|{\mr x}|}$.
Let $C$ be the union of all these finite sets.
Clearly $|C|\le|T|$.
By \ssf{2} there are a formula $\phi({\mr x}\,;{\gr z})$ and a tuple ${\mr c}$ such that $\phi({\mr c}\,;{\gr\U})=_C\grD$, contradicting the definition of $C$.

Implication \ssf{1}$\IMP$\ssf{2} is obtained by compactness and the equivalence \ssf{3}$\IFF$\ssf{4} is proved similarly.
\end{proof}



\begin{remark}\label{prop_approx_el_eq}
If $\grD\subseteq\U^{|{\gr z}|}$ is approximated by $\phi({\mr x}\,;{\gr z})$ then so is any $\grC$ such that $\grC\equiv\grD$, see Section~\hyperref[expansions]{\ref*{invariantL}.\ref*{expansions}} for the notation.
In fact, if the set $\grD$ is approximable by $\phi({\mr x}\,;{\gr z})$ then for every $n$

\hfil$\displaystyle\A {\gr z_1},\dots,{\gr z_n}\;\E {\mr x}\ \bigwedge^n_{i=1}\big[\phi({\mr x}\,;{\gr z_i})\ \iff\ {\gr z_i}\in{\gr \D}\big]$.


So the same holds for any $\grC\equiv\grD$.
A similar remark apply to approximability from below and from above (e.g.\@ for approximability from below, add the conjunct $\A {\gr z}\,\big[\phi({\mr x}\,;{\gr z})\imp {\gr z}\in\grD\big]$ to the formula above).\QED
\end{remark}

From the following easy observation of Chernikov and Simon~\cite{CS} we obtain an interesting (and misterious) quantifier elimination result originally due to Shelah, see Corollary~\ref{corol_sh_exp_qe} below.

% \begin{proposition}
% Let $\C\subseteq\U^{|{\gr z},w|}$ be approximated from below by the formula $\phi({\mr x}\,;{\gr z},w)$. Then $\grD=\big\{{\gr z}:\E w\ \big({\gr z}\,w\in\C\big)\big\}$ is approximated from below by the formula $\E w\,\phi({\mr x}\,;{\gr z}\,w)$.
% \end{proposition}
% 
% \begin{proof}
% Let $B\subseteq\U$ be finite. 
% We want ${\mr a}\in\U^{|{\mr x}|}$ such that 
% 
% \ceq{\ssf{a.}\hfill \E w\ \big({\gr b}\,w\in\C\big)}{\iff}{\E w\,\phi({\mr a}\,;{\gr b}\,w)}\hfill for every ${\gr b}\in B^{|{\gr z}|}$
% 
% \ceq{\ssf{b.}\hfill \A {\gr z}\;\Big[\E w\,\phi({\mr a}\,;{\gr z}\,w)}{\imp}{\E w\ \big({\gr z}\,w\in\C\big)\Big]}
% 
% Let $C\subseteq\U$ be a finite set such that 
% 
% \ceq{\ssf{c.}\hfill \E w\in C^{|w|}\ \big({\gr b}\,w\in\C\big)}{\iff}{\E w\ \big({\gr b}\,w\in\C\big)}\hfill for every ${\gr b}\in B^{|{\gr z}|}$
% 
% As $\C$ is approximable from below, there is an ${\mr a}$ such that
% 
% \ceq{\ssf{a'.}\hfill {\gr b}\,c\in\C}{\iff}{\phi({\mr a}\,;{\gr b}\,c)}\hfill for every ${\gr b}\,c\in \big(B\cup C\big)^{|{\gr z}\,w|}$
% 
% \ceq{\ssf{b'.}\hfill \A {\gr z}\,w\ \Big[\phi({\mr a}\,;{\gr z}\,w)}{\imp}{{\gr z}\,w\in\C\Big]}
% 
% We obtain \ssf{b} from \ssf{b'} simply by logic. 
% Implication $\imp$ in \ssf{a} follows from \ssf{a'} and \ssf{c}. 
% Implication $\pmi$ follows from \ssf{b}.
% \end{proof}

\begin{proposition}\label{prop_sh_exp_qe}
Let $\C\subseteq\U^{|y\,{\gr z}|}$ be approximated from below by the formula $\phi({\mr x}\,;y\,{\gr z})$.
Then $\grD=\big\{{\gr z}:\E y\ \big(y\,{\gr z}\in\C\big)\big\}$ is approximated from below by the formula $\E y\,\phi({\mr x}\,;y\,{\gr z})$.
\end{proposition}

\begin{proof}
\def\vl{\gr}
Let $B\subseteq\U$ be finite. 
We want ${\mr a}\in\U^{|{\mr x}|}$ such that 

\ceq{\ssf{a.}\hfill \E y\ \big(y\,{\vl b}\in\C\big)}{\iff}{\E y\,\phi({\mr a}\,;y\,{\vl b})}\hfill for every ${\vl b}\in B^{|{\vl z}|}$

\ceq{\ssf{b.}\hfill \A {\vl z}\;\Big[\E y\,\phi({\mr a}\,;y\,{\vl z})}{\imp}{\E y\ \big(y\,{\vl z}\in\C\big)\Big]}

Let $D\subseteq\U$ be a finite set such that 

\ceq{\ssf{c.}\hfill \E y\in D^{|y|}\ \big(y\,{\vl b}\in\C\big)}{\iff}{\E y\ \big(y\,{\vl b}\in\C\big)}\hfill for every ${\vl b}\in B^{|{\vl z}|}$

As $\C$ is approximable from below, there is an ${\mr a}$ such that

\ceq{\ssf{a'.}\hfill d\,{\vl b}\in\C}{\iff}{\phi({\mr a}\,;d\,{\vl b})}\hfill for every $d\,{\vl b}\in \big(D\cup B\big)^{|y\,{\vl z}|}$

\ceq{\ssf{b'.}\hfill \A y\,{\vl z}\ \Big[\phi({\mr a}\,;y\,{\vl z})}{\imp}{y\,{\vl z}\in\C\Big]}

We obtain \ssf{b} from \ssf{b'} simply by logic. 
Implication $\imp$ in \ssf{a} follows from \ssf{a'} and \ssf{c}. 
Implication $\pmi$ follows from \ssf{b}.
\end{proof}



\begin{corollary}
If $p\in S_{{\mr x}}(\U)$ is honestly definable then the family of sets externally definable by $p$ is closed under quantifiers and Boolean combinations. 
\end{corollary}

\begin{proof}
The sets externally definable by $p({\mr x})$ are always closed under Boolean operations. By the proposition above, they are closed under quantifiers. 
\end{proof}

% Let ${\gr z}=\<z_i:i<\lambda\>$ and let $\grD\subseteq\U^{|{\gr z}|}$. 
% For $I\subseteq\lambda$ we write $\E z_{\restriction I}\,\grD$ for the projection of $\grD$ to the $\lambda\sm I$ coordinates, i.e.\@ the set $\{b_{\restriction\lambda\sm I}: {\gr b}\in\grD\}$. 
% Expand the language with a symbol for $\E z_{\restriction I}\,\grD$ for every finite $I\subseteq\lambda$. 
% Then the theory of $\U$ in the expanded language has positive $\Delta$-quantifier elimination, for $\Delta=L\cup\big\{\E z_{\restriction I}\,\grD: I\subseteq\lambda\textrm{ finite}\big\}$, see Section~\hyperref[eliminazionequantificatoricriterio]{\ref*{elimination}.\ref*{eliminazionequantificatoricriterio}}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ladders and definability}

Partitioned formulas have been introduced in Definition~\ref{def_partitioned_fla}. Here we write \emph{$\phi({\mr x}\,;{\gr z})^*$\/} for the partitioned formula where the order of the two tuples is inverted (i.e.\@ it is the opposite of what displayed).

Let $\phi({\mr x}\,;{\gr z})\in L(\U)$ be a partitioned formula. We say that $\<{\mr a_i}\,;{\gr b_i} : i<\alpha\>$ is a \emph{ladder sequence\/} for $\phi({\mr x}\,;{\gr z})$ if 

\ceq{\#\hfill i\le j}{\IFF}{\phantom{\neg}\phi({\mr a_i}\,;{\gr b_j})}\hfill for all $0\le i,j\le\alpha$

We say that $\phi({\mr x}\,;{\gr z})$ is \emph{stable\/} if for some finite $n$ all ladders have length at most $n$. Otherwise we say it is \emph{unstable} or that it has the \emph{order property}. 
Note that if a formulas admits ladder sequences of unbounded finite length, then it admits an infinite one, hence it has the order property.

It is clear that $\phi({\mr x}\,;{\gr z})$ is stable if and only if $\phi({\mr x}\,;{\gr z})^*$ is stable.

%Suppose $\phi({\mr x}\,;{\gr z})$ is unstable and let $\<{\mr a_i}\,;{\gr b_i} : i<\omega\>$ be a ladder sequence. By padding redundant variables, we can read $\phi({\mr x}\,;{\gr z})$ as a formula $\phi({\mr x}\,{\gr z}\,;{\mr y}\,{\gr w})$. Then $\phi({\mr x}\,{\gr z}\,;{\mr y}\,{\gr w})$ defines the order of the sequence $\<{\mr a_i}\,{\gr b_i} : i<\omega\>$. For this reason it is also common to say that $\phi({\mr x}\,;{\gr z})$ has the \emph{order property}, this simply means that it is unstable. 

The following theorem claims what is arguably one of the most important properties of stable formulas: any set externally definable by a stable formula is definable (by a related formula).

\begin{theorem}\label{thm_def_stable_formula}
Any $\grD\subseteq\U^{|{\gr z}|}$ approximated by a stable formula is definable.
Precisely, if $\phi({\mr x}\,;{\gr z})$ is a stable formula that approximates $\grD$ then there are ${\mr a_{1,1}},\dots,{\mr a_{n,m}}\in\U^{|{\mr x}|}$ such that 

\ceq{\hfill {\gr z}\in\grD}{\iff}{\bigvee^n_{i=1}\bigwedge^m_{j=1}\phi({\mr a_{i,j}}\,;{\gr z})}
\end{theorem}

\begin{proof}
The theorem follows immediately from the the three lemmas below.
\end{proof}

The converse of the theorem above holds and is proved separately in Theorem~\ref{thm_def_stable_formula2}.  

\begin{remark}\label{rem_sability_no_compactness}
The conclusion of Theorem~\ref{thm_def_stable_formula} is often stated in the following  apparently more general form:
for every $\Aa\subseteq\U$ there are ${\mr a_{1,1}},\dots,{\mr a_{n,m}}\in \Aa^{|{\mr x}|}$ such that

\ceq{\hfill {\gr z}\in\grD}{\iff}{\bigvee^n_{i=1}\bigwedge^m_{j=1}\phi({\mr a_{i,j}}\,;{\gr z})}

holds for all ${\gr z}\in{\gr\Aa}^{|{\gr z}|}$.

The proof is exactly the same. In fact, elementarity and saturation are never used. In a sense, no model theory is used, either -- just finite combinatorics -- unlike in the proof of Theorem~\ref{thm_def_stable_formula2} where compactness is essential.\QED
\end{remark}

\begin{lemma}
If $\grD$ is approximated from below by a stable formula $\phi({\mr x}\,;{\gr z})$ then

\ceq{\hfill {\gr z}\in\grD}{\iff}{\bigvee^n_{i=0}\phi({\mr a_i}\,;{\gr z})}

for some ${\mr a_0},\dots,{\mr a_n}\in\U^{|{\mr x}|}$. 
\end{lemma}

\begin{proof}
We define by recursion a ladder sequence for $\phi({\mr x}\,;{\gr z})$.
Suppose that ${\gr b_0},\dots,{\gr b_{n-1}}\in\grD$ have been defined (this assumption is empty if $n=0$).
We first define ${\mr a_n}$, then ${\gr b_n}$. 
Choose ${\mr a_n}\in\U^{|{\mr x}|}$ such that ${\gr b_0},\dots,{\gr b_{n-1}}\in\phi({\mr a_n}\,;{\gr\U})\subseteq\grD$.
This is possible because $\grD$ is approximated from below.
Now, if possible, choose ${\gr b_n}$ such that

\ceq{\hfill{\gr b_n}}{\in}{\grD\sm\bigvee^n_{i=0}\phi({\mr a_i}\,;{\gr\U})}.

Then $\<{\mr a_i}\,;{\gr b_i} : i\le n\>$ is a ladder sequence. 
By stability, for some $n$, the tuple ${\gr b_n}$ does not exist.
This yields the required ${\mr a_0},\dots,{\mr a_n}$.
\end{proof}


\begin{lemma}
If $\grD$ is approximated by a stable formula $\phi({\mr x}\,;{\gr z})$.
Then, for some $m$, the formula 

\ceq{\hfill\psi({\mr x_0},\dots,{\mr x_m}\,;{\gr z})}{=}{\bigwedge^m_{j=0}\phi({\mr x_j}\,;{\gr z})}

approximates $\grD$ from below.
\end{lemma}

\begin{proof}
Let $m$ be such that there is no ladder sequence for $\phi({\mr x}\,;{\gr z})$ of length greater then $m$.
Let ${\gr B}\subseteq\grD$ be finite.
We prove that there are some ${\mr a_0},\dots,{\mr a_m}$ such that ${\gr B}\subseteq\psi({\mr a_0},\dots,{\mr a_m}\,;{\gr\U})\subseteq\grD$.
As in the proof above, we define by recursion a ladder sequence for $\phi({\mr x}\,;{\gr z})$.
Suppose that ${\mr a_0},\dots,{\mr a_{n-1}}$ and ${\gr b_0},\dots,{\gr b_{n-1}}\notin\grD$ have been defined.
We first define ${\mr a_n}$, then ${\gr b_n}$. 
Choose ${\mr a_n}\in\U^{|{\mr x}|}$ such that 

\hfil${\gr B}\ \subseteq\ \phi({\mr a_n}\,;{\gr\U})\ \subseteq\ \U^{|{\gr z}|}\sm\{{\gr b_0},\dots,{\gr b_{n-1}}\}$.

This ${\mr a_n}$ exists, because $\grD$ is approximated by $\phi({\mr x}\,;{\gr z})$.
Then, if possible, let ${\gr b_n}$ such that

\ceq{\hfill{\gr b_n}}{\in}{\bigwedge^n_{i=0}\phi({\mr a_i},{\gr\U})\sm\grD}

This procedure has to stop at some $n\le m$.
Hence the required parameters are ${\mr a_1},\dots,{\mr a_n}={\mr a_{n+1}}=\dots={\mr a_{m}}$.
\end{proof}

\begin{lemma}\label{lem_stable3}
If $\phi({\mr x}\,;{\gr z})$ is a stable formula then for every $m$ the formula 

\ceq{\hfill \psi({\mr x_1},\dots,{\mr x_m}\,;{\gr z})}{\iff}{\bigwedge^m_{j=1}\phi({\mr x_j}\,;{\gr z})}

is stable.
\end{lemma}

\begin{proof}
It suffices to prove that if $\phi_1({\mr x_1}\,;{\gr z})\wedge\phi_2({\mr x_2}\,;{\gr z})$ is unstable then one of the formulas $\phi_n({\mr x_i}\,;{\gr z})$ is unstable. For simplicity, we use that instability implies the existence of an infinite ladder (this uses compactness, apparently contradicting Remark~\ref{rem_sability_no_compactness}). We leave to the reader to adapt the argument so that compactness is not required.

Let ${\mr a^1_i},{\mr a^2_i}\in\U^{|{\mr x}|}$ and ${\gr b_i}\in\U^{|{\gr z}|}$ be such that 

\ceq{\hfill i\le j}{\IFF}{\phantom{\neg}\phi_1({\mr a^1_i}\,;{\gr b_j})\wedge\phi_2({\mr a^2_i}\,;{\gr b_j})}\hfill for all $i,j<\omega$

For $n=1,2$ let $H_n\subseteq{\omega\choose 2}$ contain those pairs $j<i$ such that $\neg\phi_n({\mr a^n_i}\,;{\gr b_j})$. 
By the equivalence above $H_1\cup H_2={\omega\choose 2}$. 
By the Ramsey Theorem there is an infinite set $H$ such that ${H\choose 2}\subseteq H_n$ for at least one of $n=1,2$. Suppose $H_1$ for definiteness. So, we obtain an infinite sequence $a^1_i$, $b_i$ such that

\ceq{\hfill j<i}{\IFF}{\neg\phi_1({\mr a^1_i}\,;{\gr b_j})}\hfill for all $i,j<\omega$

hence $\phi_1({\mr x_1}\,;{\gr z})$ is unstable.
\end{proof}

This last lemma concludes the proof of Theorem~\ref{thm_def_stable_formula}. 


\begin{theorem}\label{thm_def_stable_formula2}
  The following are equivalent
  \begin{itemize}
    \item[1.] $\phi({\mr x}\,;{\gr z})$ is stable;
    \item[2.] every subset of $\U^{|{\gr z}|}$ that is externally definable by $\phi({\mr x}\,;{\gr z})$ is definable;
    \item[3.] there are $\le\kappa$ subsets of $\U^{|{\gr z}|}$ that are externally definable by $\phi({\mr x}\,;{\gr z})$;
    \item[4.] there are $<2^\kappa$ subsets of $\U^{|{\gr z}|}$ that are externally definable by $\phi({\mr x}\,;{\gr z})$.
  \end{itemize}
\end{theorem}

\begin{proof}
\ssf{1}$\IMP$\ssf{2} is clear by Proposition~\ref{prop_approx=external} and Theorem~\ref{thm_def_stable_formula}.

\ssf{2}$\IMP$\ssf{3}$\IMP$\ssf{4} are obvious.

\ssf{4}$\IMP$\ssf{1} is proved by contraposition.
Suppose that $\phi({\mr x}\,;{\gr z})$ is not stable.
By compactness there is a ladder sequence  $\<{\mr a_i}\,;{\gr b_i} : i\in I\>$ where $I,<_I$ a dense linear order of cardinality $\kappa$ with $2^\kappa$ cuts.
By \textit{cut\/} we mean a subset $c\subseteq I$ that is closed downward.
For every such $c\subseteq I$ we pick a global type

\ceq{\hfill p_c({\mr x} ) }{\supseteq}{\big\{\phi({\mr x}\,;{\gr b_i})\iff i\in c\ :\ i\in I\big\}}

Clearly sets ${\gr\D_{p_c,\,\phi} }$ are all distinct.
\end{proof}

\begin{exercise}\label{ex_harrington}
\def\grB{{\gr{\EuScript B}}}
\def\mrA{{\mr{\EuScript A}}}
The following is a version of Harrington's mysterious 
Lemma (cfr.~\cite[Lemma 8.3.4]{TZ}).
Let $\phi({\mr x}\,;{\gr z})\in L$ be a stable formula and suppose $\grB\subseteq\U^{|{\gr z}|}$ and $\mrA\subseteq\U^{|{\mr x}|}$ are approximated by $\phi({\mr x}\,;{\gr z})$ and  $\phi({\mr x}\,;{\gr z})^*$, respectively.
Then at least one of the conditions \ssf{1} and \ssf{2} below occurs

\begin{itemize}
\item[1.]
\ssf{a.}\kern2ex$\phi({\mr x}\,;{\gr z})^{\phantom{*}}\wedge\ {\mr x}\in{\mrA}$ approximates $\grB$ and\\
\ssf{b.}\kern2ex$\phi({\mr x}\,;{\gr z})^*\wedge\ {\gr z}\in{\grB}$ approximates $\mrA$.

\item[2.]
\ssf{a.}\kern2ex$\phi({\mr x}\,;{\gr z})^{\phantom{*}}\wedge\ {\mr x}\notin{\mrA}$ approximates $\grB$ and\\
\ssf{b.}\kern2ex$\phi({\mr x}\,;{\gr z})^*\wedge\ {\gr z}\notin{\grB}$ approximates $\mrA$.

\end{itemize}
Hint: Note that at least one of \ssf{1a} or \ssf{2a} occurs.
Hence it suffices to prove that \ssf{1a}$\IMP$\ssf{1b} and \ssf{2a}$\IMP$\ssf{2b}. The two implications are essentially equivalent.
% \begin{proof}
% Note that at least one of \ssf{1a} or \ssf{2a} occurs.
% Hence it suffices to prove that \ssf{1a}$\IMP$\ssf{1b} and \ssf{2a}$\IMP$\ssf{2b}.
% We only prove the first.
% The second follows because $\neg\grB$ and $\neg\mrA$ are approximated by $\neg\phi({\mr x}\,;{\gr z})$ and  $\neg\phi({\mr x}\,;{\gr z})^*$, respectively.
% 
% Assume \ssf{1a} and negate \ssf{1b} for a contradiction.
% Then \ssf{2b} holds.
% Pick ${\mr a_0}$ arbitrarily, then recursively find ${\gr b_i}\notin\grB$ and  ${\mr a_i}\in\mrA$ such that
% 
% {\def\medrel#1{\parbox[t]{12ex}{$\displaystyle\kern2ex #1$}}
% 
% \ceq{\hfill\phi(\U\,;{\gr b_i})}{ =_{{\mr a_0},\dots,{\mr a_{i-1}}}}{\mrA} 
% 
% \ceq{\hfill\phi({\mr a_i}\,;\U)}{ =_{{\gr b_0},\dots,{\gr b_i}}}{\grB}
% }
% 
% Then
% 
% {\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\kern2ex #1$}}
% 
% \ceq{\hfill i< j}{\IMP}{\phantom{\neg}\phi({\mr a_i}\,;{\gr b_j})}
% 
% \ceq{\hfill j\le i}{\IMP}{\neg\phi({\mr a_i}\,;{\gr b_j})}
% 
% }
% 
% Which contradicts the stability of $\phi({\mr x}\,;{\gr z})$.
% \end{proof}
\end{exercise}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Vapknik-Chervonenkis dimension}
\label{sectionVC}

\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

We say that the formula $\phi({\mr x}\,;{\gr z})\in L$ has \emph{Vapknik-Chervonenkis dimension $n$\/} if this is the largest finite cardinatity of a set ${\mr A}\subseteq\U^{|{\mr x}|}$ such that $|S_\phi({\mr A})|=2^n$. If such $n$ does not exist, we say that we say that  $\phi({\mr x}\,;{\gr z})$ has \emph{infinite VC-dimension}. 

Note that the condition $|S_\phi({\mr A})|=2^n$ is equivalent to saying that every subset of ${\mr A}$ is the trace of some definable set of sort $\phi({\mr x}\,;{\gr z})$.

For instance, the formula ${\gr z_1}<{\mr x}<{\gr z_2}$ in $T_{\rm dlo}$ has VC-dimension $1$.

Arguing by compactness we obtain the following proposition whose proof is left as an exercise for the reader.

\begin{proposition}
The following are equivalent 
\begin{itemize}
\item[1.] $\phi({\mr x}\,;{\gr z})\in L$ has finite VC-dimension;
\item[2.] there is no infinite set ${\mr A}\subseteq\U^{|{\mr x}|}$ such that every subset of ${\mr A}$ is the trace of some definable set of sort $\phi({\mr x}\,;{\gr z})$.\QED
\end{itemize}
\end{proposition}

From the proposition above and Proposition~\ref{prop_count_types} below it follows that all stable formulas have finite VC-dimension.

We say that the a sequence of sentences $\<\phi_i:i<\omega\>$ \emph{converges\/} if the truth value of $\phi_i$ is eventually constant.

\begin{lemma}\label{lem_altrank}
The following are equivalent
\begin{itemize}
\item[1.] $\phi({\mr x}\,;{\gr z})\in L$ has finite VC-dimension;
\item[2.] $\<\phi({\mr a_i}\,;{\gr b}):i<\omega\>$ converges for any ${\gr b}$ and any indiscernible sequence $\<{\mr a_i}:i<\omega\>$.
\end{itemize}
\end{lemma}

\begin{proof}
\ssf{1}$\IMP$\ssf{2} Assume $\neg$\ssf{2}. It suffices to prove that for every $I\subseteq\omega$ the type that says 

\ceq{\hfill\phi({\mr a_i}\,;{\gr z})}{\IFF}{i\in I}

is finitely consistent. Let $\psi_{I\restriction n}({\mr x_0},\dots,{\mr x_{n-1}})$ the formula that says that there is a ${\gr z}$ such that

\ceq{\hfill\phi({\mr x_i}\,;{\gr z})}{\IFF}{i\in I}\quad for all $i<n$.

is finitely consistent we need to prove that $\psi_{I\restriction n}({\mr a_0},\dots,{\mr a_{n-1}})$ is true. If there is a ${\gr b}$ such that the truth value of $\<\phi({\mr a_i}\,;{\gr b}):i<\omega\>$ oscillates at least $n$ times, then we can find $k_0<\dots<k_{n-1}$ such that 


\ceq{\hfill \phi({\mr a_{k_i}}\,;{\gr b})}{\IFF}{i\in I.}

This proves that $\psi_{I\restriction n}({\mr a_{k_0}},\dots,{\mr a_{k_{n-1}}})$ is true. By indiscernibility, also $\psi_{I\restriction n}({\mr a_0},\dots,{\mr a_{n-1}})$ holds true.

\ssf{2}$\IMP$\ssf{1} Let $I\subseteq\omega$ be the set of even integers. Assume $\neg$\ssf{1} and let  $\<{\mr c_i}:i<\omega\>$ be an infinite sequence that is shattered by $\phi({\mr x}\,;{\gr z})$.
Let  $\<{\mr a_i}:i<\omega\>$ be an indiscernible sequence with the same EM-type as $\<{\mr c_i}:i<\omega\>$. Then $\<{\mr a_i}:i<\omega\>$ satisfies $\psi_{I\restriction n}({\mr x_0},\dots,{\mr x_{n-1}})$ for all $n$. By compactness there is a $b$ such that

\ceq{\hfill\phi({\mr a_i}\,;{\gr z})}{\IFF}{i}\quad is even.

This proves $\neg$\ssf{2}.
\end{proof}

In the next section we need the following corollary.

\begin{corollary}\label{corol_altrank}
If $\mrC\subseteq\U^{|{\mr x}|}$ is a set approximable by a formula with finite VC-dimension, then $\<{\mr a_i}\in\mrC:i<\omega\>$ converges for any indiscernible sequence $\<{\mr a_i}:i<\omega\>$.\QED
\end{corollary}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Honest definitions}
\label{-theory}

In this section we present a beautiful theorem of Chernikov and Simon~\cite{CS} and their alternative proof of a famous quantifier elimination result of Shelah. 

We write \emph{$\neg^n$\/} for $\neg\!\stackrel{n\ \rm times}{\dots\dots\dots}\!\neg$. We abbreviate $\neg^n(\cdot\in\cdot)$ as \emph{$\notin^n$}.

\begin{lemma}\label{lem_honest}
Let $\mrC$ be a set approximable by a formula with finite VC-dimension and let $A$ be any (small) set of parameters. Then every global $A$-invariant type $p({\mr x})$ contains a formula $\psi({\mr x})$ such that either $\psi({\mr x})\imp {\mr x}\in\mrC$ or $\psi({\mr x})\imp {\mr x}\notin\mrC$. Moreover, for every sufficiently saturated model $M$ containing $A$, we can require that $\psi({\mr x})\in L(M)$
\end{lemma}

\begin{proof}
The property we want to prove is elementary in $L(\mrC)$ therefore, by Remark~\ref{rem_el_sat} we can assume that $\mrC$ is saturated. By Corollary~\ref{corol_altrank}, there is no infinite sequence $\<{\mr a_i}:i<\omega\>$

\ceq{\hfill {\mr a_i}}{\models}{p_{A,\,a\restriction i}({\mr x})\ \cup\ \{{\mr x}\notin^i\mrC\}}

Let $n$ be the largest integer such that $\<{\mr a_i}:i<n\>$ satisfies the condition above. Then

\ceq{\hfill p_{A,\,a\restriction n}({\mr x})}{\imp}{{\mr x}\notin^n\mrC}

and the first claim of the lemma follows by compactness. 

Now let $M$ be a model that contains $A$ and such that $\<M,\mrC\>\preceq\<\U,\mrC\>$. Assume also that $\<M,\mrC\>$ is saturated, we can further require that all ${\mr a_i}\in M^{|{\mr x}|}$. Hence $\psi({\mr x})\in L(M)$.
\end{proof}

\begin{theorem}\label{thm_honest}
Let $\mrC$ be a set approximable by a formula with finite VC-dimension. Then $\mrC$ is approximable from above and from below.
\end{theorem}

\begin{proof}
Let ${\mr A}\subseteq\mrC$ be any non empty (small) set. As above, by  Remark~\ref{rem_el_sat} we can assume that $\mrC$ is saturated. Let $M$ be a saturated elementary substructure of $\U$, in the language $L(\mrC)$. Define

\ceq{\hfill q({\mr x})}{=}{\big\{\phi({\mr x})\in L(M)\ :\ {\mr A}\subseteq\phi({\mr\U})\big\}.}

By compactness, it suffices to prove that $q({\mr x})\imp {\mr x}\in\mrC$. Suppose not and fix some ${\mr a}\models q({\mr x})\wedge {\mr x}\notin\mrC$. Let $p({\mr x})=\tp({\mr a}/M)$. As $p({\mr x})$ is finitely satisfied in ${\mr A}$ and $M$ is saturated, from Lemma~\ref{lem_honest} yields a formula $\psi({\mr x})\in p({\mr x})$ such that either $\psi({\mr x})\imp {\mr x}\in\mrC$ or $\psi({\mr x})\imp {\mr x}\notin\mrC$. But the first contradicts ${\mr a}\models\psi({\mr x})$ and the second cannot hold because $\psi({\mr x})$ is satisfied in ${\mr A}\subseteq\mrC$. 
\end{proof}

When all formulas have finite VC-dimension, we say that the theory $T$ has the \emph{non-independence property\/} or, for short, that $T$ \emph{is nip}.

Let $\<\D_i:i<\lambda\>$ be the collection of all subsets of $\U$, of arbitrary finite arity, that are externally definable. The expansion of $\U$ to the language $L(\X_i:i<\lambda)$ is called the \emph{Shelah expansion\/} of $\U$ and is denoted by \emph{$\U^{\rm Sh}$}. 

From Theorem~\ref{thm_honest} and Proposition~\ref{prop_sh_exp_qe} we obtain the following.

\begin{corollary}\label{corol_sh_exp_qe}
If $T$ is nip then $\U^{\rm Sh}$ has $L$-elimination of quantifiers. (I.e.\@ every formula is Boolean combination of formulas in $L$ and formulas of the form $z\in\D_i$.)\QED
\end{corollary}


\section{Stable theories}
\label{stable_teories}

We say that $T$ is a \emph{stable theory\/} if every formula is stable. By Theorem~\ref{thm_def_stable_formula2} this is equivalent to requiring that all externally definable sets are definable.

If $p({\mr x})\in S(\U)$ is a global type, a \emph{canonical base\/} of $p({\mr x})$ is a definably closed set $\emph{$\Cb(p)$}\subseteq \U^\eq$ such that an automorphism $f\in\Aut(\U)$ fixes $p({\mr x})$ if and only if it fixes $\Cb(p)$ pointwise. When they exist, canonical bases are unique, see Exercise~\ref{ex_Cb}.

Clearly, all definable types (Definition~\ref{def_defble_type}) have a canonical base, namely

\ceq{\hfill\Cb(p)}{=}{{\dcl}^\eq\Big(\big\{{\gr\D_{p,\phi}}\ :\ \phi({\mr x}\,;{\gr z})\in L\big\}\Big).}

Therefore if $T$ is stable, all global types have a canonical base.

We now turn to Lascar invariance. Quite interestingly when $T$ is stable this reduces to a more manageable kind of invariance.

\begin{proposition}\label{prop_type_over_acl2} Let $T$ be stable and let $p({\mr x})\in S(\U)$. Then the following are equivalent
\begin{itemize}
\item[1.] $p({\mr x})$ is Lascar invariant over $A$;
\item[2.] $p({\mr x})$ is definable over $\acl^\eq\!A$;
\item[3.] ${\gr\D_{p,\phi}}\in \acl^\eq\!A$ for all $\phi({\mr x}\,;{\gr z})\in L$.
\end{itemize}
\end{proposition}
\begin{proof}
 \ssf{3}$\IMP$\ssf{2}$\IMP$\ssf{1} are clear (stability is not required).
 
 \ssf{1}$\IMP$\ssf{3} The sets ${\gr\D_{p,\phi}}$ are externally definable therefore, by Theorem~\ref{thm_def_stable_formula2}, definable (over $\U$).
 As $p({\mr x})$ is Lascar invariant over $A$, so are the sets ${\gr\D_{p,\phi}}$.
 Hence they belong to $\acl^\eq\!A$ by Theorem~\ref{thm_Galois_alg=alg}.
\end{proof}
% 
% \begin{proposition}\label{prop_type_over_dcl} Let $T$ be stable and let $p({\mr x})\in S(\U)$ be Lascar invariant over $A$. Then for every formula $\phi({\mr x}\,;{\gr z})\in L$ the set ${\gr\D_{p,\phi}}$ belongs to $\dcl^\eq(A,c)$ for every $c\models p_{\restriction A}(x)$.
% \end{proposition}
% \begin{proof}
% Without loss of generality we can assume $p({\mr x})\in S(\U^\eq)$. 
% \end{proof}

A type $q({\mr x})\subseteq L(A)$ is \emph{stationary\/} if it has a unique global extension that is Lascar invariant over $A$.
The following proposition says that in a stable theory with elimination of imaginaries types over algebraically closed sets are stationary.

\begin{proposition}\label{prop_type_over_acl_stationary} If $T$ is stable then every type $q({\mr x})\in S\big(\acl^\eq\!A\big)$ is stationary.
\end{proposition}

\begin{proof}
Let $p_i({\mr x})\in S(\U^\eq)$, for $i=1,2$, be two global types that extend $q({\mr x})$ and are invariant over $\acl^\eq\!A$.
To prove that $p_1({\mr x}) =p_2({\mr x})$, it suffices to show that for every formula $\phi({\mr x}\,;{\gr z})\in L$

\ceq{\#\hfill {\gr\D_{p_1,\,\phi}}}{=}{{\gr\D_{p_2,\,\phi}}}

Note that, by Proposition~\ref{prop_type_over_acl2} both sets belong to  $\acl^\eq\!A$.
Clearly, for $i=1,2$, the formula $\A{\gr z}\,\big[\phi({\mr x}\,;{\gr z})\iff {\gr z}\in {\gr\D_{p_i,\,\phi}}\big]$ belongs to $p_i({\mr x})$.
Then both formulas belong to $q({\mr x})$ and $\#$ follows.
\end{proof}

\begin{corollary}
If $T$ is stable then the following are equivalent
\begin{itemize}
\item[1.] ${\mr a}\equivL_A{\mr b}$, see Definition~\ref{def_Lascar_type};
\item[2.] ${\mr a}\equivSh_A{\mr b}$, see Definition~\ref{def_Sh_strong_type}.
\end{itemize}
\end{corollary}
\begin{proof}\ssf{1}$\IMP$\ssf{2}.
  This is left as an exercise to the reader (stability is not required).

  \ssf{2}$\IMP$\ssf{1}.
  Assume ${\mr a}\equivSh_A{\mr b}$.
  By Proposition~\ref{prop_Shelah_strong_types} this is equivalent to ${\mr a}\equiv_{\acl^\eq\!A}{\mr b}$.
  Let $q({\mr x})=\tp({\mr a}/{\acl}^\eq\!A)=\tp({\mr b}/{\acl}^\eq\!A)$. Let $p({\mr x})\in S(\U^\eq)$ be the unique global type that is invariant over $\acl^\eq\! A$ and extends $q({\mr x})$ which we obtain from by Proposition~\ref{prop_type_over_acl_stationary}.
  Let ${\mr\bar c}=\<{\mr c_i}:i<\omega\>$ be such that ${\mr c_i}\models p{\restriction \acl^\eq(A),\,{\mr a},\,{\mr b},\,{\mr c_{\restriction i}}}$.
  Then ${\mr a},{\mr\bar c}$ and ${\mr b},{\mr\bar c}$ are $A$-indiscernible sequences, which proves \ssf{1}, see Exercise~\ref{ex_Lstp_indiscernibles}.
\end{proof}

We end this section with a characterization of stability which is not directly related with the properties discussed above. 

\begin{proposition} The following are equivalent
\begin{itemize}
\item[1.] $T$ is stable;
\item[2.] every $A$-indiscernible sequence is totally $A$-indiscernible.
\end{itemize}
\end{proposition}

\begin{proof}
\ssf{2}$\IMP$\ssf{1}. Assume $\neg$\ssf{1} and let $\phi({\mr x}\,;{\gr z})$ be an unstable formula witnessed by the ladder sequence $\<{\mr a_i}\,;{\gr b_i}:i<\omega\>$. Let $\<{\mr a'_i}\,;{\gr b'_i} : i<\omega\>$ be 
indiscernible sequence with the same Ehren\-feucht-Mostowski type as $\<{\mr a_i}\,;{\gr b_i} : i<\omega\>$. This is not totally indiscernible because $\phi({\mr a'_i}\,;{\gr b'_j})$ if and if $i< j$.

\ssf{1}$\IMP$\ssf{2}. Assume $\neg$\ssf{2} and let $\<a_i : i<\omega\>$ be an $A$-indiscernible sequence, which is not totally $A$-in\-dis\-cern\-ible. Then there is a formula $\phi(x, y)\in L(A)$ and some $i<j$ such that $\phi(a_i , a_j )\wedge\neg\phi(a_j , a_i) $. By indiscernibility  $\phi(a_i, a_j)$ holds if and only if $i\le j$. Hence $\phi(x\,; y)$ is not stable.
\end{proof}

\begin{exercise}\label{ex_stable_orderproperty}
Prove that the following are equivalent
\begin{itemize}
\item[1.] $T$ is stable;
\item[2.] there is an infinite set $A\subseteq\U^{|{\mr x}|}$ and a formula  $\psi({\mr x}\,;{\mr y})$ such that $A$ is linearly ordered by the relation ${\mr a}<{\mr b}\iff\psi({\mr a}\,;{\mr b})$.
\end{itemize}
Hint: suppose $\phi({\mr x}\,;{\gr z})$ is unstable and let $\<{\mr a_i}\,;{\gr b_i} : i<\omega\>$ be an infinite ladder sequence, then $A=\{{\mr a_i}\,{\gr b_i} : i<\omega\}$ is linearly ordered by ${\mr x}<{\gr z}\,;{\mr y}\,{\gr w})=\phi({\mr x}\,;{\gr z})$.\QED
\end{exercise}


\begin{exercise}
Prove that if every formula $\phi({\mr x}\,;{\gr z})\in L$ with $|{\mr x}|=1$ is stable then $T$ is stable. Hint: by compactness, if all sets approximable by $\phi({\mr x}\,;y,{\gr z})$ are definable, so are the sets approximable by $\phi({\mr x},y\,;{\gr z})$.\QED
\end{exercise}


\begin{exercise}
Prove that strongly minimal theories are stable.\QED
\end{exercise}


\begin{exercise}\label{ex_Cb}
Let $p({\mr x})\in S(\U)$. Prove that there is at most one definably closed set $A\subseteq\U^\eq$ such that $\Aut(\U/A)$ is the set of automorphisms that fix $p({\mr x})$.\QED
\end{exercise}

\section{Stability and the number of types}

The following proposition highlights the connection between stability and the cardinality of types. 

Binary trees of formulas have been introduced in Definition~\ref{def_tree_formulas}. Here we restrict to trees $\<\psi_s:s\in 2^{<\lambda}\>$ of a particular form. Namely, $\psi_\0=\top$ and for every $s\in 2^{<\lambda}$ we have $\psi_{s1}=\phi({\mr x}\,;{\gr b_s})$ and $\psi_{s0}=\neg\phi({\mr x}\,;{\gr b_s})$. When such a binary tree of height $\omega$ exists, we say that $\phi({\mr x}\,;{\gr z})$ has the \emph{binary tree property}.

\begin{proposition}\label{prop_count_types}
The following are equivalent
\begin{itemize}
\item[1.] $\phi({\mr x}\,;{\gr z})$ is a stable formula;
\item[2.] $\big|S_{\phi}(A)\big|=|A|$ for all infinite sets $A$;
\item[3.] $\big|S_{\phi}(A)\big|<2^{|A|}$ for all infinite sets $A$;
\item[4.] $\phi({\mr x}\,;{\gr z})$ does not have the binary tree property.
\end{itemize}
\end{proposition}

\def\ceq#1#2#3{\parbox[t]{15ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

\begin{proof}\ssf{2}$\IFF$\ssf{3}$\IFF$\ssf{4}. This is proved as in Lemma~\ref{lem_bin_tree}.

\ssf{3}$\IMP$\ssf{1}.
Assume $\neg$\ssf{1}. Let $I,<_I$ be a dense linear order of cardinality $|A|$. Let ${\mr x_i}$ and ${\gr z_i}$, for $i\in I$, be a tuples of variables. The type that says that

\ceq{\hfill i< j}{\IFF}{\phantom{\neg}\phi({\mr x_i}\,;{\gr z_j})}\hfill for all $i,j\in I$

is finitely consistent by $\neg$\ssf{1}.
If ${\mr a_i}$, ${\gr b_i}$ is a realization of this type, then for every $<_I$-upward closed set $C\subseteq I$ the type

\hfil $\big\{\phi({\mr x}\,;{\gr b_j})\ :\ j\in C\big\}\ \ \cup\ \ \big\{\neg\phi({\mr x}\,;{\gr b_j})\ :\ j\notin C\big\}$

is a finitely consistent.
Any two such types are mutually inconsistent.
As there are $2^{|A|}$ Dedekind's cuts in $I$, $\neg$\ssf{3} follows.

\ssf{1}$\IMP$\ssf{4} Assume $\phi({\mr x}\,;{\gr z})$ has the binary tree property witnessed, say, by  $\<{\gr b_s}:s\in 2^{<\omega}\>$.
We show that there is a ladder sequence of length $n$. For $i=0,\dots, n$ abbreviate ${\gr b_{1^i}}$ by ${\gr b_i}$.
Let ${\mr a_j}$ be such that

\vskip-1ex \ceq{\hfill {\mr a_j}}{\models}{\displaystyle \neg\phi({\mr x}\,;{\gr b_j})\wedge\bigwedge^{j-1}_{i=0}\phi({\mr x}\,;{\gr b_i}).}

\vskip-2ex Then

\ceq{\hfill i<j}{\IFF}{\phi({\mr a_i}\,;{\gr b_j}),}

so $\<{\mr a_i}\,;{\gr b_i} : i<n\>$ is a ladder sequence of length $n$.
\end{proof}

\begin{theorem}
The following are equivalent
\begin{itemize}
\item[1.] $T$ is stable;
\item[2.] $|S(A)|\le|A|$ some infinite cardinal $\lambda$, and all sets $A$ of cardinality $\le\lambda$;
\item[3.] $|S(A)|\le|A|$ for every set $A$ such that $|L|<\cf(A)$.
\end{itemize}
\end{theorem}
\begin{proof}
\ssf{2}$\IMP$\ssf{1}. Suppose a formula $\phi({\mr x}\,;{\gr z})$ is unstable.
Let $\<{\gr z_s}:s\in2^{<\lambda}\>$ be a sequence variables of length $|{\gr z}|$.
Let $p({\gr z_s}:s\in2^{<\lambda})$ be the type that says that $\big\<{\gr z_s}:i<2^{<\lambda}\big\>$ witnesses a binary tree of height $\lambda$.
As  $\phi({\mr x}\,;{\gr z})$ is unstable, $p$ is finitely consistent.
As $\lambda$ is an arbitrary infinite cardinal, this contradicts \ssf{2}.

\ssf{3}$\IMP$\ssf{2}.
Trivial.

\ssf{1}$\IMP$\ssf{3}.
Proposition~\ref{prop_count_types} implies that $|S(A)|\le |A|^{|L|}$. Therefore, when $|L|<\cf(A)$, we obtain $|S(A)|\le |A|$.
\end{proof}
\begin{exercise}
Prove that $\phi(x\,;z)$ is stable if and only if $|S_\phi(\U)|\le2^\kappa$.\QED
\end{exercise}

\begin{exercise}
Prove that $\phi(x\,;z)$ is stable if and only if every set approximated by $\phi(x\,;z)$ is definable.\QED
\end{exercise}

\end{document}


