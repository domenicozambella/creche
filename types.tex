\documentclass[creche.tex]{subfiles}
\begin{document}
\chapter{Types and morphisms}
\label{types}

\def\ceq#1#2#3{\parbox[b]{20ex}{$\displaystyle #1$}\parbox[b]{6ex}{\hfil$#2$}$\displaystyle #3$}

Section~\ref{reticoli} and~\ref{prime_filters} introduce distributive lattices and prime filters and prove Stone's representation theorem for distributive lattices. 
In Section~\ref{frammenti} we discuss lattices that arise from sets of formulas and their prime filters (prime types). %We set the terminology that will be used in Chapter~\ref{algebraic} we between algebraic objectswhere types appear as filters in lattices of formulas. , and we need a correspondence between algebraic objects (such as ideals of rings of polynomials) and $\Delta\jj$types where $\Delta$ is a set of equations.

There is a lot of notation in this chapter. The reader may skim through and return to it when we refer to it.


%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
\section{Semilattices and filters}\label{reticoli}
\label{stone}

A \emph{preorder\/} is a set $\PP$ with a transitive and symmetric relation which we usually denote by $\le$. If $A,B\subseteq\PP$ we write $A\le B$ if $a\le b$ for every $a\in A$ and $b\in B$. We write $a\le B$ and $A\le b$ for $\{a\}\le B$ and  $A\le \{b\}$ respectively. 

Quotienting a preorder by the equivalence relation 

\ceq{\hfill a\sim b}{\dIFF}{a\le b\quad\textrm{and}\quad b\le a}

gives a \emph{(partial) order}. We often do not distinguish between a preorder and the partial order associated to it. Preorders are very common; here we are interested in the one induced by the relation of logical consequence

\ceq{\hfill \phi\le\psi}{\dIFF}{\phi\proves\psi,}

or, more generally, by the relation of \emph{logical consequence over a theory $T$}, that is

\ceq{\hfill \phi\le_T\psi}{\dIFF}{\phi\proves_T\psi}\parbox{6ex}{\hfil$\dIFF$}$T\cup\{\phi\}\proves\psi$.

A partial order $\PP$ is a \emph{lower semilattice\/} if for each pair $a,b\in\PP$ there is a maximal element $c$ such that $c\le\{a,b\}$. We call $c$ the \emph{meet\/} of $a$ and $b$. The meet is unique and is denoted by \emph{$a\swedge b$}. Dually, a partial order is an \emph{upper semilattice\/} if for each pair of elements $a$ and $b$ there is a minimal element $c$ such that $\{a,b\}\le c$. This $c$ is called the \emph{joint\/} of $a$ and $b$. The joint is unique and is denoted by \emph{$a\svee b$}. A \emph{lattice\/} is simultaneously a lower and an upper semilattice.

An element $c$ such that $c\le \PP$ is called a \emph{lower bound\/} or a \emph{bottom}. An element such that $\PP\le c$ is called an \emph{upper bound\/} or a \emph{top}. Lower and upper bounds are unique and will be denoted by \emph{$0$}, respectively \emph{$1$}. Other symbols common in the literature are \emph{$\bot$}, respectively \emph{$\top$}. A semilattice is \emph{bounded\/} if it has both an upper and a lower bound. 

For the rest of this section we assume that $\PP$ is a bounded lower semilattice.

The meet is associative and commutative

\ceq{\hfill (a\swedge b)\swedge c}{=}{a\swedge (b\swedge c)}

\ceq{\hfill a\swedge b}{=}{a\swedge b}.

Hence we may unambiguously write  $a_1\swedge\dots\swedge a_n$. When $C\subseteq\PP$ is finite, we write \emph{$\swedge C$} for the meet of all the elements of $C$. We agree that $\swedge\0=1$.

In an upper semilattice, the dual properties hold for the joint. We write \emph{$\svee C$} for the joint of all elements in $C$ and we agree that  $\svee\0=0$.

A \emph{filter\/} of $\PP$ is a non-empty set $F\subseteq \PP$ that satisfies the following for every $a,b\in \PP$
%\ceq{}{}{}
\begin{itemize}
\def\ceq#1#2#3{\hspace*{16ex}\llap{$#1$}\parbox{5ex}{\hfil$#2$}\rlap{$#3$}}
\item[f1.] \ceq{a\in F\ \textrm{ and }\ a\le b}{\IMP}{b\in F}
\item[f2.] \ceq{a, b\in F}{\IMP}{a\swedge  b\in F.}
\end{itemize}
We say that $F$ is a \emph{proper filter\/} if $F\neq \PP$. We say that $F$ is \emph{principal\/} if $F=\big\{b\ :\ a\le b\big\}$ for some $a\in \PP$. More precisely, we say that $F$ is the \emph{principal filter generated by $a$}. A proper filter $F$ is \emph{maximal\/} if there is no filter $H$ such that $F\subset H\subset \PP$. 

We say that a filter $F$ is \emph{maximal relative to $c$\/} if $c\notin F$ and $c\in H$ for every $H\supset F$. So, a filter $F$ is maximal if it is maximal relative to $0$. We say that  $F$ is \emph{relatively maximal\/} when it is maximal relative to some $c$. 

For $B\subseteq\PP$ we define the \emph{filter generated by $B$\/} to be the intersection of all the filters containing $B$. It is easy to verify that this is indeed a filter.  When $B$ is a finite set, the filter generated by $B$ is the principal filter generated by $\swedge B$. In general we have the following.


\begin{proposition} \label{prop_filter_generated}
For every $B\subseteq \PP$, the filter generated by $B$ is the set 

\hfill$\big\{a\ :\ \swedge C\le a\ \textrm{ for some finite non-empty }\ C\subseteq B\big\}$.\QED
\end{proposition}

This has the following important consequence.

\begin{proposition}\label{esistenzamassimale2}
Let $B\subseteq \PP$ and $c\in \PP$. If $\swedge C\not\le c$ for every finite non-empty $C\subseteq B$, then $B$ is contained in a maximal filter relative to $c$.
\end{proposition}

\begin{proof}
Let $\F$ be the set of filters $F$ such that $B\subseteq F$ and $c\notin F$. By Proposition~\ref{prop_filter_generated}, $\F$ is non-empty. It is immediate that $\F$ is closed under unions of arbitrary chains. Then, by Zorn's lemma, $\F$ has a maximal element.
\end{proof}

\begin{exercise}\label{ex_maximal_equivalent}
Prove that the following are equivalent
\begin{itemize}
\item[1.] $F$ is maximal relative to $c$;
\item[2.] for every $a\notin F$ there is $d\in F$ such that $d\wedge a\le c$.
\end{itemize}
\end{exercise}

\begin{exercise}
Let $B\subseteq \PP$ and $c\in \PP$ be such that $\swedge C\not\le c$ for every finite non-empty $C\subseteq B$. Prove that the following are equivalent
\begin{itemize}
\item[1.] $B$ is a maximal filter relative to $c$;
\item[2.] $a\notin B\ \ \IMP\ \ b\swedge a \le c$\ \  for some \ \ $b\in B$.\QED
%\item[3.] $a\notin B\ \ \IMP\ \ \swedge C\swedge a\le c$\ \ per qualche $C\subseteq B$ finito non vuoto.
\end{itemize}
% \begin{proof}
% Dimostriamo \ssf{1}\,$\IMP$\,\ssf{2}. Poich\'e $B$ \`e un filtro, quindi chiuso per intersezione, \ssf{2} afferma che se $a\notin B$ allora $\swedge C\not\le c$ per ogni insieme finito non vuoto $C\subseteq B\cup \{a\}$. Per il corollario~\ref{proppif}, questo equivale ad affermare che $B$ \`e un filtro massimale relativo a $c$. L'implicazione \ssf{2}\,$\IMP$\,\ssf{3} \`e ovvia. Per dimostrare \ssf{3}\,$\IMP$\,\ssf{1}, osserviamo per prima cosa che \ssf{3} implica che  $B$ \`e un filtro. Verifichiamo \ssf{f1}: sia $a\in B$ e $a\le b$. Se per assurdo $b\notin B$ allora da \ssf{3} otteniamo $\swedge C\swedge b\le c$ per qualche $C\subseteq B$ finito non vuoto. Da $a\le b$ otteniamo $\swedge C\swedge a\le c$. Ma $C\cup\{a\}\subseteq B$ in contraddizione con le ipotesi del lemma.  Verifichiamo \ssf{f2}: siano $a,b\in B$ e supponiamo che per assurdo $a\swedge  b\notin B$. Allora $ \swedge C\swedge a\swedge  b\le c$ per qualche $C\subseteq B$ finito non vuoto. Ma $C\cup\{a,b\}\subseteq B$ in contraddizione con le ipotesi del lemma. Infine per dimostrare la massimalit\`a osserviamo che se $H$ \`e un filtro tale che $B\subset H$ e $c\notin H$, allora un qualunque $a\in H\sm B$ contraddice \ssf{3}.
% \end{proof}
\end{exercise}


\begin{exercise}
Let $F\subseteq\PP$ be a non-principal filter. Is $F$ always contained in a maximal non-principal filter\,?\QED
\end{exercise}



%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
\section{Distributive lattices and prime filters}\label{prime_filters}

Let\ $\PP$ be a lattice. We say that $\PP$ is \emph{distributive\/} if for every $a,b,c\in\PP$ we have the following

\ceq{\hfill a\swedge (b\svee c)}{=}{(a\swedge b)\svee (a\swedge c)}

\ceq{\hfill a\svee (b\swedge c)}{=}{(a\svee b)\swedge (a\svee c)}

Throughout this section we assume that $\PP$ is a bounded distributive lattice.

A proper filter $F$ is \emph{prime\/} if for every $a,b\in\PP$

\ceq{\hfill a\svee b \in F}{\IMP}{a\in F\quad\textrm{or}\quad b\in F.}

\begin{proposition}\label{prop_massimalisonoprimi}
Every relatively maximal filter of\/ $\PP$ is prime.
\end{proposition}

\begin{proof}
Let $F$ be maximal relative to $c$ and assume that $a\notin F$ and $b\notin F$. Then, by Exercise~\ref{ex_maximal_equivalent}, there are $d_1, d_2\in F$ such that $d_1\swedge a\le c$ and $d_2\swedge b\le c$. Let $d=d_1\wedge d_2$. Then  $d\swedge a\le c$ and $d\swedge b\le c$ and therefore $(d\swedge a)\svee(d\swedge b)\le c$. Hence, by distributivity, $d\swedge (a\svee b)\le c$. Then $a\svee b\notin F$.
\end{proof}

The \emph{Stone space\/} of $\PP$ is a topological space that we denote by \emph{$S(\PP)$}. The points of \emph{$S(\PP)$} are the prime filters of $\PP$. The closed sets of the \emph{Stone topology} are arbitrary intersections of sets of the form

\ceq{\hfill\emph{$[a]_\PP$}}{\deq}{\Big\{\,F\ :\ \textrm{ prime filter such that } a\in F\,\Big\}.}

for $a\in\PP$. In other words, the sets above form a base of closed sets of the Stone topology. Using \ssf{1} and \ssf{3} in the following proposition the reader can easily check that this is indeed a base for a topology topology.

\begin{proposition}\label{prop_brouwerstopology}
For every $a,b\in\PP$ we have
\begin{itemize}
\item[1.]\ $\big[0\big]_\PP\ =\ \0$;
\item[2.]\ $\big[1\big]_\PP\ =\ S(\PP)$;
\item[3.]\ $\big[a\big]_\PP\ \cup\ \big[b\big]_\PP\ \ =\ \ \big[a\svee b\big]_\PP$;
\item[4.]\ $\big[a\big]_\PP\ \cap\ \big[b\big]_\PP\ \ =\ \ \big[a\swedge b]_\PP$.
\end{itemize}
\end{proposition}
\begin{proof}
The verification is immediate. Only \ssf{3} requires that the filters in $S(\PP)$ are prime.
\end{proof}

The closed subsets of $S(\PP)$ ordered by inclusion form a distributive lattice. The following is a representation theorem for distributive lattices.

\begin{theorem}
The map $a\mapsto [a]_\PP$ is an embedding of $\PP$ in the lattice of the closed subsets of $S(\PP)$. In particular
\begin{itemize}
\item[1.]\ $0\mapsto \0$;
\item[2.]\ $1\mapsto S(\PP)$;
\item[3.]\ $a\svee b\mapsto \big[a\big]_\PP\ \cup\ \big[b\big]_\PP$;
\item[4.]\ $a\swedge b\mapsto\big[a\big]_\PP\ \cap\ \big[b\big]_\PP$.
\end{itemize}
\end{theorem}

\begin{proof}
It is immediate that the map above preserves the order and Proposition~\ref{prop_brouwerstopology} shows that it preserves the lattice operations. We prove that the map is injective. Let $a\neq b$, say  $a\nleq b$. We claim that $\big[a\big]_\PP\nsubseteq\big[b\big]_\PP$. There is a filter $F$ that contains $a$ and is maximal relative to $b$. By Proposition~\ref{prop_massimalisonoprimi} such an $F$ is prime. Then $F\in [a]_\PP\sm[b]_\PP$. 
\end{proof}


\begin{theorem}\label{thm_reticolocompatto}
With the Stone topology, $S(\PP)$ is a compact space.
\end{theorem}
\begin{proof}
Let $\<[a_i]_\PP:i\in I\>$ be basic closed sets such that for every finite $J\subseteq I$

\ceq{\ssf{a.}\hfill\bigcap_{i\in J}[a_i]_\PP}{\neq}{\0.}

We claim that

\ceq{\ssf{b.}\hfill\bigcap_{i\in I}[a_i]_\PP}{\neq}{\0.}

By \ssf{4} of Proposition~\ref{prop_brouwerstopology} and \ssf{a} we obtain that $\swedge C\nleq 0$ for every finite $C\subseteq \{a_i:i\in I\}$. By Proposition~\ref{esistenzamassimale2}, there is a maximal (relative to $0$) filter containing $\{a_i:i\in I\}$. By Proposition~\ref{prop_massimalisonoprimi}, such filter is prime and it belongs to the intersection in \ssf{b}.
\end{proof}

Let $a,b\in\PP$. If $a\swedge  b=0$ and $a\svee b=1$, we say that $b$ is the \emph{complement\/} of $a$ (and vice versa). The complement of an element need not exist. If the complement exists it is unique, the complement of $a$ is denoted by \emph{$\neg a$}. 

\begin{lemma}\label{Stone_aperti_chiusi}
Let $U\subseteq S(\PP)$ be a clopen set. Then $U=[a]_\PP$ for some $a\in\PP$ (and therefore $a$ has a complement).
\end{lemma}

\begin{proof}
As both $U$ and $S(\PP)\sm U$ are closed, for some sets $A, B\subseteq\PP$


\ceq{\hfill \bigcap_{x\in A}[x]_\PP}{=}{U}

\ceq{\hfill \bigcap_{y\in B}[y]_\PP}{=}{S(\PP)\sm  U.}

By compactness, that is Theorem~\ref{thm_reticolocompatto}, there are some finite $A_0\subseteq A$ and $B_0\subseteq B$ such that

\ceq{\hfill \bigcap_{x\in A_0}[x]_\PP}{\cap}{\bigcap_{y\in B_0}[y]_\PP}$\quad=\quad\0$

Let $a=\swedge A_0$ and $b=\swedge B_0$. From claim \ssf{4} of Proposition~\ref{prop_brouwerstopology} we obtain $[a]_\PP\cap[b]_\PP=\0$. Therefore $U\subseteq [a]_\PP\ \subseteq\ S(\PP)\sm  [b]_\PP\ \subseteq\ U$. Hence $U= [a]_\PP$ and $b=\neg a$.
\end{proof}

A \emph{Boolean algebra\/} is a bounded distributive lattice where every element has a complement. In a Boolean algebra, the sets $[a]_\PP$ are clopen and they form also a base of open set of the topology of $S(\PP)$. A topology that has a base of clopen sets is called \emph{zero-dimensional}. By the following proposition the Stone topology is Hausdorff.

A proper filter of a Boolean algebra is an \emph{ultrafilter\/} if either $a\in F$ or $\neg a\in F$ for every $a$.

\begin{proposition}
Let $\PP$ be a Boolean algebra. Then the following are equivalent
\begin{itemize}
\item[1.] $F$ is maximal;
\item[2.] $F$ is prime;
\item[3.] $F$ is an ultrafilter.
\end{itemize}
\end{proposition}
\begin{proof}
Implication \ssf{2}\,$\IMP$\,\ssf{3} is obtained observing that $a\svee\neg a\in F$. The rest is immediate.
\end{proof}

\begin{exercise}
Suppose we defined $S(\PP)$ as the set of relatively maximal filters. What essential property would not hold\,?\QED 
\end{exercise}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Types as filters}\label{frammenti}

This section we work with a fixed set of formulas \emph{$\Delta$\/} all with free variables among those of some fixed tuple \emph{$x$}. In this section we do not display $x$ in the notation. Subsets of $\Delta$ are called \emph{$\Delta\jj$types}.

We associate to $\Delta$ a bounded lattice \emph{$\PP(\Delta)$}. This is the closure under conjunction and disjunction of the formulas in $\Delta\cup\{\bot,\top\}$. The (pre)order relation in $\PP(\Delta)$ is given by

\ceq{\hfill \psi\le\phi}{\dIFF}{\psi\ \provesT\ \phi}, 

for some fixed theory $T$. In this section, to lighten notation, we write $\proves$ for $\provesT$. If $p$ is a $\Delta\jj$type we denote by $\<p\>_\PP$ the filter in $\PP(\Delta)$ generated by $p$.




\begin{lemma}\label{lem_poiuyhdsdfd}
For every $\Delta\jj$type $p$

\ceq{\hfill \<p\>_\PP}{=}{\Big\{\ \phi\;\in\;\PP(\Delta)\ \ \ :\ \ \ p\ \proves\ \phi\ \Big\}.}

In particular $p$ is consistent if and only if $\<p\>_\PP$ is a proper filter.
\end{lemma}



\begin{proof}
Inclusion $\subseteq$ is clear. Inclusion $\supseteq$ is a consequence of the Compactness Theorem. In fact $p\proves\phi$ implies that $\psi\proves\phi$ for some formula $\psi$ that is conjunction of formulas in $p$. Then $\phi\in\<p\>_\PP$ follows from $\psi\in\<p\>_\PP$ and $\psi\le\phi$.
\end{proof}

We say that $p\subseteq\Delta$ is a \emph{principal $\Delta\jj$type\/} if $\<p\>_\PP$ is a principal. The following lemma is an immediate consequence of the Compactness Theorem. Note that in \ssf{3} the formula $\phi$ is arbitrary, possibly not even in $\PP(\Delta)$. 

\begin{lemma}
For every $\Delta\jj$type $p$ the following are equivalent
\begin{itemize}
\item[1.] $p$ is principal;
\item[2.] $\psi \;\proves\; p \;\proves\; \psi$ for some formula $\psi$ (here $\psi$ is any formula, it need not be in $\Delta$);
\item[3.] $\phi \;\proves\; p$ where $\phi$ is conjunction of formulas in $p$.\QED 
\end{itemize}
\end{lemma}

\begin{proof}
Implications \ssf{1}$\IMP$\ssf{2} is immediate by Lemma~\ref{lem_poiuyhdsdfd}. To prove \ssf{2}$\IMP$\ssf{3} suppose $\psi\proves p\proves\psi$. Apply compactness to obtain a formula $\phi$, conjunction of formulas in $p$, such that $\phi\proves\psi$. Implications \ssf{3}$\IMP$\ssf{1}is trivial.
\end{proof}

\begin{definition}
We say that $p\subseteq\Delta$ is a \emph{prime $\Delta\jj$type\/} if $\<p\>_\PP$ is a  prime filter. We say that $p$ is a \emph{complete $\Delta\jj$type\/} if $\<p\>_\PP$ is a maximal filter.\QED
\end{definition}

Though in general neither $\Delta$ not $\PP(\Delta)$ are closed under negation, Lemma~\ref{lem_poiuyhdsdfd} has the following consequence.

\begin{proposition}\label{prop_test_completezza}
For every consistent $\Delta\jj$type $p$ the following are equivalent
\begin{itemize}
\item[1.] $p$ is complete;
\item[2.] $p$ is consistent and either $p\proves\phi$ or $p\proves\neg\phi$ for every formula $\phi\in\Delta$.
\end{itemize}
\end{proposition}
\begin{proof}
\ssf{2}$\IMP$\ssf{1}. Assume \ssf{2}. As $p$ is consistent, $\<p\>_\PP$ is a proper filter. To prove that it is maximal suppose $\phi\notin\<p\>_\PP$. Then $p\notproves\phi$ and from \ssf{2} it follows that  $p\cup\{\neg\phi\}$ is inconsistent. Hence no proper filter contains $p\cup\{\phi\}$.

\ssf{1}$\IMP$\ssf{2}. Suppose that $p$ is complete and $p\notproves\phi$. Then $\<p\>_\PP$ is a maximal filter. Then $\phi\notin\<p\>_\PP$ and, as $\<p\>_\PP$ is maximal, $p\cup\{\phi\}$ generates the improper filter. Then $p\cup\{\phi\}$ is inconsistent. Hence $p\proves\neg\phi$. 
\end{proof}

Given a model $M$ and a tuple $c\in M^{|x|}$ the \emph{$\Delta\jj$type of $c$ in $M$\/} is the sets

\ceq{\hfill \emph{$\Delta\jj$tp$_M(c)$}}{=}{\Big\{\phi(x)\in\Delta\ :\ M\models\phi(c)\Big\}}

When the model $M$ is clear from the context we omit the subscript. Note that here and in the following, by \textit{model\/} we understand \textit{model of $T$}, where $T$ is the theory we have fixed in the background. When $x$ and $c$ are the empty tuple, we write \emph{$\Th_\Delta(M)$} for $\Deltatp_M(c)$.

\begin{lemma}\label{lemmatipiprimiconsistenti}
For every $\Delta\jj$type $p$ the following are equivalent
\begin{itemize}
\item[1.] $p$ is prime;
\item[2.] $p\ \cup\ \big\{\neg\phi\ :\  \phi\;\in\;\Delta\ \ \textrm{such that}\ \ p\notproves\phi\ \big\}$ is consistent;
\item[3.] $\big\{\phi\in\Delta : p\proves\phi\big\}\ = \ \Deltatp_M(c)$ for some model $M$ and some tuple $c\in M^{|x|}$.
\end{itemize}
\end{lemma}
\begin{proof} 
Implications \ssf{2}$\IMP$\ssf{3}$\IMP$\ssf{1} are clear, we prove \ssf{1}$\IMP$\ssf{2}. By compactness if the type in \ssf{2} is inconsistent then there are finitely many formulas $\phi_1,\dots,\phi_n\in\Delta$ such that $p\notproves\phi_i$ and 

\ceq{\hfill p}{\proves}{\bigvee^n_{i=1}\phi_i.}

hence $p$ is not prime.
\end{proof}

The following corollary is immediate. When it comes to verifying that a given $\Delta\jj$type is prime, it relieves the most boring details.

\begin{corollary}\label{coroll_test_primalita}
For every $\Delta\jj$type $p$ the following are equivalent
\begin{itemize}
\item[1.] $p$ is prime;
\item[2.] $\displaystyle p\ \proves\ \bigvee^n_{i=1}\phi_i$\parbox{6ex}{\hfil$\IMP$}$p\proves\phi_i$ for some $i\le n$,\hfill for every $n$ and every $\phi_1,\dots,\phi_n\in\Delta$.\QED
\end{itemize}
\end{corollary}

The set $\Delta$ in this section contains only formulas with variables among those of the tuple $x$. In the following it is convenient to consider sets $\Delta$ that are closed under substitution of variables with any other variable. Then we may write \emph{$\Delta_{\restriction x}$} for the set of formulas in $\Delta$ with variables among those of the tuple $x$. But when $x$ is clear from the context $\Delta$ may be used for $\Delta_{\restriction x}$. The set of prime $\Delta\jj$types is denoted by \emph{$S(\Delta)$}, and we write \emph{$S_x(\Delta)$\/} for $S(\Delta_{\restriction x})$. 

The most common $\Delta$ used in the sequel is the set of all formulas in $L(A)$ and the underlying theory is $\Th(M/A)$ for some given model $M$ containing $A$. In this case we write \emph{tp$_M(c/A)$} for $\Deltatp_M(c)$ or, when $A$ is empty, \emph{tp$_M(c)$}. The set $S_x(\Delta)$ is denoted by $S_x(A)$. The topology on  $S_x(A)$ is generated by the clopen 

\ceq{\hfill\big[\phi(x)\big]}{=}{\Big\{p\in S_x(A)\ :\ \phi(x)\in p\Big\}.}

Sometimes $\Delta$ is the set of all formulas of a given syntactic form. Then we use some more suggestive notation that we summarize below.

\begin{notation}\label{note_tipi_diagramma}
The following are some of the most common $\Delta$-types and $\Delta$-theories
\def\ceq#1#2{\parbox[b]{15ex}{#1}\parbox[b]{14ex}{\hfill #2}}


\ceq{\ssf{1.}\hfill\emph{\textrm{at-tp}$(c)$},}{\emph{$\Th_{\textrm{\scriptsize at}}(M)$\/}}\qquad when $\Delta=\atL$

\ceq{\ssf{2.}\hfill\emph{\textrm{at$^\pm$-tp}$(c)$},}{\emph{$\Th_{\textrm{\scriptsize at}^\pm}(M)$\/}}\qquad when $\Delta=\atpmL$

\ceq{\ssf{3.}\hfill\emph{$\qftp(c)$},}{\emph{$\Th_{\textrm{\scriptsize qf}}(M)$\/}}\qquad when $\Delta=\qfL$.

Clearly, the types/theories in \ssf{2} and \ssf{3} are equivalent. Most used is the theory $\Th_{\textrm{\scriptsize at}^\pm}(M/M)$ which is called the \emph{diagram of $M$\/} and has a dedicated symbol: \emph{Diag$(M)$}.\QED
\end{notation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Morphisms}

\def\ceq#1#2#3{\parbox[b]{15ex}{$\displaystyle #1$}\parbox[b]{6ex}{\hfil$#2$}$\displaystyle #3$}

First we set the meaning that the word \emph{map\/} has in these notes.

\begin{definition}\label{defmappa}
A \emph{map\/} consists a triple $f:M\imp N$ where 
\begin{itemize}
\item[1.] $M$ is a set (usually a structure) called the \emph{domain of the map};
\item[2.] $N$ is a set (usually a structure) called the \emph{codomain the map};
\item[3.] $f$ is a function with \emph{domain of definition\/} $\dom f\subseteq M$ and \emph{image} $\range f\subseteq N$.
\end{itemize}
By \emph{cardinality of $f:M\imp N$\/} we understand the cardinality of the function $f$.\QED
\end{definition}

If $\dom f = M$ we say that the map is \emph{total}; if $\range f=N$ we say that it is \emph{surjective\/}. The \emph{composition\/} of two maps and the \emph{inverse\/} of a map are defined in the obvious way.

\begin{definition}\label{defpreservaveritas}
Let $\Delta$ be a set of formulas with free variables in the tuple $x=\<x_i: i<\lambda\>$. The map $h:M\imp N$ is a \emph{$\Delta\jj$morphism\/} if it  \emph{preserves the truth\/} of all formulas in $\Delta$. By this we mean that 
\begin{itemize}
\item[p.] $M\models\phi(a)\ \ \IMP\ \ N\models\phi(ha)$\hfill for every $\phi(x)\in\Delta$ and every $a\in(\dom h)^{|x|}$.
\end{itemize}
Notation: if $a$ is the tuple $\<a_i: i<\lambda\>$ then $ha$ is the tuple $\<ha_i: i<\lambda\>$.\QED
\end{definition}

When $\Delta=L$ we say \emph{elementary map\/} for $\Delta\jj$morphism. When  $\Delta=\atL\ $ we say  \emph{partial homomorphism\/} and when $\Delta=\atpmL\ $ we say \emph{partial embedding\/} or \emph{partial isomorphism}. We say \emph{embedding\/} for partial embedding which is a total. We say \emph{isomorphism\/} for a partial embedding which is a total and surjective. As usual, if domain and codomain coincide, we say \emph{automorphism}.


We use $\Delta\jj$morphisms to compare, locally, two structures (or different loci of the same structure). There are different ways to do this, in the proposition below we list a few synonymous expressions. But first some more notation. When $x$ is a fixed tuple of variables, $a\in M^{|x|}$ and $b\in N^{|x|}$ we write

\ceq{\hfill\emph{$M,a$}}{\emph{$\Rrightarrow_\Delta$}}{\emph{$N,b$}}\hfill if $M\models\phi(a)\IMP N\models\phi(b)$ for every $\phi(x)\in\Delta$. 

\ceq{\hfill\emph{$M,a$}}{\emph{$\equiv_\Delta$}}{\emph{$N,b$}}\hfill if $M\models\phi(a)\IFF N\models\phi(b)$ for every $\phi(x)\in\Delta$. 

The following equivalences are immediate and will be used without explicit reference.

\begin{proposition}\label{oss_Delta-morfismi}
For every given set of formulas $\Delta$ and every map $h:M\imp N$ the following are equivalent
\begin{itemize}
\item[1.] $h:M\imp N$ is a $\Delta\jj$morphism;
\item[2.] $M,a\Rrightarrow_\Delta N,ha$  for every $a\in(\dom h)^{|x|}$;
\item[3.] $\Deltatp_M(a)\subseteq\Deltatp_N(ha)$ for every $a\in(\dom h)^{|x|}$;
\item[4.] $N,ha\models p(x)$ for every $a\in(\dom h)^{|x|}$ and $p(x)=\Deltatp_M(a)$.\QED
\end{itemize}
\end{proposition}



\begin{remark}\label{rmk_characteristic}
Condition \ssf{p} in Definition~\ref{defpreservaveritas} apply to tuples $x$ of any length, in particular to the empty tuple. In this case $\phi(x)$ is a sentence, $a\in(\dom h)^0=\{\0\}$ is the empty tuple, and \ssf{p} asserts that $\Th_\Delta(M)\subseteq\Th_\Delta(N)$. When $h=\0$ this is actually all what \ssf{p} says. In fact $\0^{|x|}=\0$ unless $|x|=0$. Still,  $\Th_\Delta(M)\subseteq\Th_\Delta(N)$ may be a non trivial requirement.\QED
\end{remark}


\begin{definition}\label{def_characteristic}
We call $\Th_\Delta(M)$ the \emph{$\Delta\jj$characteristic} of $M$. We say that $T$  decides the $\Delta\jj$characteristic if $\Th_\Delta(M)=\Th_\Delta(N)$ for all $M,N\models T$. In other words, for any pair of models of $T$, the empty map $\0:M\to N$ is a $\Delta$-morphism. When $\Delta=\atpmL$ we say simply \emph{characteristic}, then $T$ decides the characteristic $\<\0\>_M\simeq\<\0\>_N$ for all $M,N\models T$.\QED
\end{definition}

Next proposition shows that we are correctly generalizing the usual notions of homomorphism and embedding. The definition given above allows some more flexibility when the homomorphism is not defined on a substructures of the domain. See also Remark~\ref{rem_extension_homo}.

\begin{proposition}
Let $h:M\imp N$ be a map and suppose that $\dom h$ is a substructure of $M$. Then $h:M\to N$ is a \emph{partial homomorphism\/} if and only if 

\ceq{\ssf{1.}\hfill a\in r^M}{\IMP}{ha\in r^N}\hfill for every $r\in L_{\rm rel}$ and $a\in(\dom h)^{n_r}$;\smallskip\par

\ceq{\ssf{2.}\hfill h\,f^M(a)}{=}{f^N(h\,a)}\hfill for every $f\in L_{\rm fun}$ and $a\in(\dom h)^{n_f}$.

Moreover, $h:M\imp N$ is a \emph{partial embedding\/} if and only if it is an injective homomorphism and the converse implication in \ssf{1} holds.
\end{proposition}

Note that for for $0\jj$ary functions, i.e.\@ constants, \ssf{2} reads $hc^M=c^N$.\medskip

\begin{proof}[Sketch of proof]
Requirement \ssf{1} is equivalent to 

\ceq{\ssf{1'.}\hfill M\models r(a)}{\IMP}{N\models r(ha)}\hfill for every $r\in L_{\rm rel}$ and $a\in(\dom h)^{n_r}$.

Requirement \ssf{2} implies

\ceq{\ssf{2'.}\hfill h\,t^M(a)}{=}{t^N(h\,a)}\hfill for every $L$-term $t(x)$ and $a\in(\dom h)^{n_f}$.

Together these yield

\ceq{\ssf{3.}\hfill M\models \phi(a)}{\IMP}{N\models \phi(ha)}\hfill for every $\phi(x)\in L_{\rm at}$ and $a\in(\dom h)^{|x|}$.

As for the second claim, note that preserving  $\atpmL$ is equivalent to strengthening \ssf{3} with a double implication and that injectivity is equivalent to preserving the truth of $a\neq b$.
\end{proof}

\begin{remark}\label{rem_extension_homo}
For every map  $h:M\to N$ the following are equivalent 
\begin{itemize}
\item[1.] $h:M\to N$ is a partial isomorphism;
\item[2.] there is an isomorphism $k:\<\dom h\>_M\to\<\range h\>_N$ that extends $h$.
\end{itemize}
Moreover, $k$ unique. The equivalence holds replacing isomorphism by homomorphism (in which case we in \ssf{2} we obtain an surjection).

The extension $k$ is defining $k\big(t(a)\big)=t(ha)$.\QED
\end{remark}

\begin{theorem}\label{thm_isomorfoeleq}
Every isomorphism $h:M\imp N$ is an elementary map.
\end{theorem}

Note that in particular we obtain that if $M\simeq N$ then $M\equiv N$.

\begin{proof}
We prove  by induction on the syntax of $\phi(x)$ that

\ceq{\hfill M\models \phi(a)}{\IFF}{N\models \phi(ha)}\hfill for every $\phi(x)\in L$ and every $a\in M^{|x|}$.

If $\phi(x)$ is atomic the claim is easily obtained from the definition. Induction for the boolean connectives is obvious, so here we only deal with the existential quantifier. Assume the claim holds for $\phi(x,y)$ that is

\ceq{\hfill M\models \phi(a,b)}{\IFF}{N\models \phi(ha,hb)} per ogni tupla $a$ ed elemento $b$ in $M$.

Fix some $a\in M^{|x|}$ then

\ceq{\hfill M\ \models\ \E y\;\phi(a,y)}{\IFF}{M\models\phi(a,b)} for some $b\in M$

\ceq{\hfill ~}{\IFF}{N\models\phi(ha,hb)} for some $b\in M$\hfill by induction hypothesis

\ceq{\hfill ~}{\IFF}{N\models\phi(ha,c)} for some $c\in N$\hfill for $\PMI$ we need surjectivity

\ceq{\hfill ~}{\IFF}{N\models\E y\,\phi(ha,y)}.
\end{proof}




We conclude this section by dissecting Theorem~\ref{thm_isomorfoeleq}. This is not immediately required in the following. There is a relation between some properties of $\Delta\jj$morphisms closure of $\Delta$ logical connectives. When $\ssf{C}\subseteq\{\A,\E,\neg,\vee,\wedge\}$ is a set of connectives, we write \emph{$\ssf{C}\Delta$} for the closure of $\Delta$ with respect to all connectives in $\ssf{C}$. We write \emph{$\neg\Delta$} for the set containing the negation of the formulas in $\Delta$. Warning: do not confuse this with $\{\neg\}\Delta$.

It is clear that $\Delta$ morphisms are  $\{\wedge,\vee\}\Delta\jj$morphisms. The following propositions are immediate. More interestingly, a sort of converse of Propositions~\ref{presesis} and~\ref{presuniv} holds and will be proved in Chapter~\ref{eliminazione}.

\begin{proposition}\label{presneg}
For every given set of formulas $\Delta$ and every injective map $h:M\imp N$ the following are equivalent
\begin{itemize}
\item[a.] $h:M\imp N$ is a $\neg\Delta\jj$morphism;
\item[b.] $h^{-1}:M\imp N$ is a $\Delta\jj$morphism.\QED
\end{itemize}
\end{proposition}

\begin{proposition}\label{presesis}
For every set of formulas $\Delta$, every $\Delta\jj$embedding $h:M\to N$ is a $\{\E\}\Delta\jj$mor\-phism.
\end{proposition}
\begin{proof}
Formulas in $\{\E\}\Delta$ ave the form $\E y\,\phi(x,y)$ where $y$ is a finite tuples of variables and  $\phi(x,y)\in\Delta$. For every tuple $a\in(\dom h)^{|x|}$ we have:

\hfil
$\begin{array}{rcl}
M\models\E y\,\phi(a,y) %&\IFF&\\
&\IMP& M\models\phi(a,b)\textrm{ per una tupla } b\in M^{|y|}  \\[2mm]
&\IMP& N\models\phi(ha,hb) \\[2mm]
&\IMP& N\models\phi(ha,c)\textrm{ per una tupla } c\in N^{|y|}  \\[2mm]
&\IMP& N\models\E y\,\phi(ha,y).\\
\end{array}$

Note that the second implication requires the totality of  $h:M\to N$ which guarantees that $\phi(a,y)$ has a solution in $\dom h$.
\end{proof}

When $h:M\to N$ is injective the following is a corollary of Propositions~\ref{presneg} and~\ref{presesis}. The general proof is the `dual' of that of Propositions~\ref{presesis}.

\begin{proposition}\label{presuniv}
For every set of formulas $\Delta$, every surjective $\Delta\jj$morphism $h:M\to N$ is a $\{\A\}\Delta\jj$mor\-phism.\QED
\end{proposition}

\begin{exercise}\label{ex_diagram}
Let $M$ be any structure and let $A\subseteq M$. Recall that $\<A\>_M$ demotes the substructure of $M$ generated by $A$. Prove that the following are equivalent for every structure $N$
\begin{itemize}
\item[1.] $N\models\Diag\<A\>_M$
\item[2.] $\id_A:\<A\>_M\to N$ is a partial isomorphism.
\item[3.] there is an embedding $k:\<A\>_M\to N$ that extends $\id_A$.
\end{itemize}
\end{exercise}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Quotient structures}\label{quotient}
\def\ceq#1#2#3{\parbox[b]{20ex}{$\displaystyle #1$}\parbox[b]{6ex}{\hfil$#2$}$\displaystyle #3$}


If $\mathrel{E}$ is an equivalence relation on $N$ we write \emph{$[c]_E$\/} for the equivalence class of $c\in N$. If $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$ are tuples of elements of $N$ we write \emph{$a\mathrel{E} b$\/} if $a_i\mathrel{E} b_i$ holds for all $i$; we write \emph{$[a]_E$\/} for the tuple of equivalence classes $[a_1]_E,\dots,[a_n]_E$. 

An equivalence relation $\mathrel{E}$ on a structure $N$ is a \emph{congruence\/} if for every $f\in L_{\rm fun}$

\ceq{\ssf{c1}.\hfill a\mathrel{E} b}{\IMP}{f^N a\mathrel{E} f^N b;}

When $\mathrel{E}$ is a congruence on $N$ we write \emph{$N/E$\/} for the a structure that has as domain the set of equivalence classes and the following interpretation of $f\in L_{\rm fun}$ and $r\in L_{\rm rel}$:

\ceq{\ssf{c2.}\hfill f^{N/E}[a]_E}{\deq}{\big[f^N a\big]_E\,;}

\ceq{\ssf{c3.}\hfill [a]_E\ \in\ r^{N/E}}{\dIFF}{[a]_E\cap r^{N}\neq\0.}

By \ssf{1} this interpretation is well-defined. We call $N/E$ the \emph{quotient structure}. The reader will recognize it as a familiar notion by the following proposition (which is not required in the following).

Recall that the \emph{kernel\/} of a total map $h:N\to M$ is the equivalence relation $\mathrel{E}$ such that

\ceq{\hfill a\mathrel{E} b}{\IFF}{ha=hb} 

for every $a,b\in N$.

\begin{proposition}
Let $h:N\to M$ be a surjective homomorphism and let $E$ be the kernel of $h$. Then there is an isomorphism $k$ that makes the following diagram commute


\hspace*{25ex}\begin{tikzcd}
 N \arrow{r}{h}\arrow{d}{\pi} & M \\[3ex]
 N/E \arrow{ur}{k}\\
\end{tikzcd}

where $\pi:a\mapsto [a]_E$ is the projection map.\QED
\end{proposition}


\noindent\llap{\textcolor{red}{\Large\danger}\kern1.5ex}Quotients clutter the notation with brackets. To avoid the mess, we prefer to reason in $N$ and tweak the satisfaction relation.  We replace equality with $\mathrel{E}$ and adapt the interpretation of relation symbols to \ssf{3} above. The following definition makes this precise. Warning: it is not standard. 

\begin{definition}\label{def_pseudostructure}
For $t_2$, $t_2$ closed terms of $L(N)$ define

\ceq{\ssf{1$^*$}\hfill N/E\ \pmodels\ t_1=t_2}{\IFF}{t_1^N\mathrel{E}t_2^N}

For $t$ a tuple of closed terms of $L(N)$ and $r\in L_{\rm rel}$ a relation symbol

\ceq{\ssf{2$^*$}\hfill N/E\ \pmodels\ rt}{\IFF}{[t^N]_E\cap r^N\neq0}

Finally the definition of $N/E\ \pmodels\ \phi$ is extended to all sentences $\phi\in\ L(N)$ by induction in the usual way.\QED
\end{definition}

Note that if we treat $=$ as a relation symbol  (i.e.\@ not as a logical symbol) and interpret it with $E$, clause \ssf{1$^*$} becomes an instance of \ssf{2$^*$} in fact


\ceq{\hfill t_1^N\mathrel{E}t_2^N}{\IFF}{[t^N_1,t^N_2]_E\cap E\neq \0}

by transitivity of $E$. 



\begin{proposition}\label{prop_pseudomodel}
Let $\mathrel{E}$ be a congruence relation of $N$. Then the following are equivalent for every $\phi(x)\in L(N)$

\ceq{\ssf{1.}\hfill N/E}{\pmodels}{\phi(a);}

\ceq{\ssf{2.}\hfill N/E}{\models}{\phi\big([a]_E\big).}
\end{proposition}

In particular this implies that $N/E\ \pmodels\ \phi(a)\iff\phi(b)$ for every $a\mathrel{E} b$.

\begin{proof}
First note that \ssf{c1} and \ssf{c2} above generalize to terms

\ceq{\ssf{c1'}.\hfill a\mathrel{E} b}{\IMP}{t^N a\mathrel{E} t^N b;}

\ceq{\ssf{c2'.}\hfill t^{N/E}[a]_E}{=}{\big[t^N a\big]_E\,.}

So if $\phi(x)$ is atomic, say it is the formula $rt(x)$ for $r\in L_{\rm rel}\cup\{=\}$ and $t(x)$ is a tuple of terms, then the equivalence \ssf{1}$\IFF$\ssf{2} follows from Definition~\ref{def_pseudostructure}. For general $\phi(x)$ the equivalence is proved by straightforward induction on the syntax. 
\end{proof}




\end{document}


