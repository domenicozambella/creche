% !TEX root = creche.tex
\chapter{Invariant sets}
\label{invariant}

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{16ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

In this chapter, $L$ is a signature, $T$ is a complete theory without finite models, and $\U$ is a saturated model of inaccessible cardinality $\kappa$ strictly larger than $|L|$.
We use the same notation and make the same implicit assumptions as in Section~\ref{monster}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Invariant sets and types}\label{invariant_sets}

Let $\grD\subseteq\U^{\gr z}$, where ${\gr z}$ is a tuple of length $<\kappa$.
We say that $\grD$ is an \emph{$A$-invariant set} if it is fixed setwise by all $A$-automorphisms.
That is, $f[\grD]=\grD$ for every automorphism $f\in\Aut(\U/A)$ or, yet in other words,

\ceq{\ssf{is1.}\hfill {\gr a}\in\grD}{\iff}{f{\gr a}\in\grD}\hfill for every ${\gr a}\in\U^{\gr z}$ and every $f\in\Aut(\U/A)$,

which, by homogeneity, is equivalent to,

\ceq{\ssf{is2.}\hfill {\gr a}\in\grD}{\iff}{{\gr b}\in\grD}\hfill for all ${\gr a},{\gr b}\in\U^{\gr z}$ such that ${\gr a}\equiv_A{\gr b}$.

These equivalent conditions yield the following bound on the number of invariant sets.

\begin{proposition}\label{prop_numberIS}
Let $\lambda=|L_{\gr z}(A)|$.
There are at most $2^{2^{\lambda}}$ sets $\grD\subseteq\U^{\gr z}$ that are invariant over $A$.
\end{proposition}
\begin{proof}
By \ssf{is2}, sets that are invariant over $A$ are unions of equivalence classes of the relation $\equiv_A$, that is, unions of sets of the form $p({\gr\U})$ where $p({\gr z})\in S(A)$.
Then the number of $A$-invariant sets is at most $2^{|S_{\gr z}(A)|}$.
Clearly $|S_{\gr z}(A)|\le 2^\lambda$.
\end{proof} 

We say that $\grD$ is an \emph{invariant set\/} if it is invariant over some (small) set $A$.
Since  $\kappa$ is assumed to be inaccessible, there are exactly $\kappa$ invariant sets.

In this chapter we are mainly interested in $\Delta$-types where either $\Delta=L(\Aa)$ for some $\Aa\subseteq\U$ or 

\ceq{\#\hfill\Delta}{=}{\Big\{\phi({\mr x}\,;{\gr b}),\ \neg\phi({\mr x}\,;{\gr b})\ :\ {\gr b}\in\Aa^{\gr z}\Big\}} 

for some given $\phi({\mr x}\,;{\gr z})\in L$.
In the latter case $\Delta$-types are called \emph{$\phi$-types.}
We denote by \emph{$S_\phi(\Aa)$\/} the set of maximal $\phi$-types with parameters in $\Aa$.
Typically, $\Aa$ is either $\U$ or some small set $A\subseteq\U$.
Types in \emph{$S_{\phi}(\U)$\/} are called \emph{global $\phi$-types.}
We identify $S_\phi(\Aa)$ with a subset of $\Aa^{\gr z}$.
Namely, $p({\mr x})\in S_\phi(\Aa)$ is identified with
   
  \ceq{\hfill\grD}{=}{\Big\{{\gr b}\in\Aa^{\gr z}\ :\ \phi({\mr x}\,;{\gr b})\in p\Big\}.}

% \begin{proposition}
% Suppose $M$ realizes every consistent type $p({\gr z})\subseteq L(A)$.
% Let $D\subseteq M^{\gr z}$ be such that \ssf{is2} holds for $D$ when restricted to ${\gr a},{\gr b}\in M^{\gr z}$.
% Then $D$ is the trace on $M$ of some unique $A$-invariant set $\grD$.
% \end{proposition}
% 
% \begin{proof}
% The set $\grD$ is the union, for $p({\gr z})\in S(A)$, of the sets $p(\U)$ that intersect $D$.
% \end{proof}

Let $p({\mr x})\subseteq L(\U)$ be a consistent type.
For every formula $\phi({\mr x}\,;{\gr z})\in L$ we define

\ceq{\hfill\emph{$\gr\D_{p,\phi}$}}{=}{\Big\{{\gr a}\in\U^{\gr z}\ :\ \phi({\mr x}\,;{\gr a})\in p\Big\}.}

We can read the notation in two ways: either the tuple ${\gr z}$ has length $\omega$ and is the same for all formulas, or it is finite and depends on $\phi$.
This is possible because adding or erasing dummy variables to the tuple of ${\gr z}$ does not change ${\gr\D_{p,\phi}}$ in any relevant way; in particular, invariance is preserved.
A $\phi$-type $p({\mr x})$ can be identified with the set ${\gr\D_{p,\phi}}$.
Therefore any type $p({\mr x})\subseteq L(\U)$ can be identified with the collection of the sets ${\gr\D_{p,\phi}}$, where $\phi({\mr x}\,;{\gr z})$ ranges over $L$.

Let $p({\mr x})\subseteq L(\U)$ be a consistent type.
We say that $p({\mr x})$ is an \emph{invariant over $A$\/} if, for every formula $\phi({\mr x}\,;{\gr z})\in L$, 

\ceq{\ssf{it1.}\hfill\phi({\mr x}\,;{\gr a})\in p}{\IFF}{\phi({\mr x}\,;f{\gr a})\in p}\hfill for every ${\gr a}\in\U^{\gr z}$ and every $f\in\Aut(\U/A)$.

Hence $p({\mr x})$ is invariant exactly when all the sets $\gr\D_{p,\phi}$ are. 

We say that the type $p({\mr x})\subseteq L(\U)$ \emph{does not split\/} over $A$ if for every formula $\phi({\mr x}\,;{\gr z})\in L$

\ceq{\ssf{it2.}\hfill  {\gr a}\equiv_A{\gr b}}{\IMP}{\Big(\phi({\mr x}\,;{\gr a})\in p\,\IFF\,\phi({\mr x}\,;{\gr b})\in p\Big)}\hfill for all ${\gr a},{\gr b}\in\U^{\gr z}$

By homogeneity, non-splitting is equivalent to invariance.
For global $\phi$-types types \ssf{it2} is equivalent to

\ceq{\ssf{it2$^\prime$.}\hfill  {\gr a}\equiv_A{\gr b}}{\IMP}{p({\mr x})\,\models\,\phi({\mr x}\,;{\gr a})\iff\phi({\mr x}\,;{\gr b})}

The following is another important equivalent characterization of invariance over $A$ of a global type $p({\mr x})\in S(\U)$ that follows easily  from \ssf{it2}

\ceq{\ssf{it3.}\hfill {\gr a}\equiv_A{\gr b}}{\IMP}{{\gr a}\equiv_{A,\,{\mr c}}{\gr b}}\hfill for all ${\gr a},{\gr b}\in\U^{\gr z}$ and for all ${\mr c}\models p_{\restriction A,{\gr a},{\gr b}}$.

Note that \ssf{it3} applies to complete types but not to $\phi$-types.

%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%
\section{Invariance from a dual perspective}

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}The following terminology is non-standard.
We say that the set $\mrB\subseteq\U^{\mr x}$, typically a definable set, is \emph{quasi-invariant\/} over $M$ if whenever $f_1,\dots,f_n$ is a finite tuple of automorphisms in $\Aut(\U/M)$, the sets $f_i[\mrB]$ have non-empty intersection.

We say that the type $p({\mr x})\subseteq L(\U)$, typically a global type, is \emph{quasi-invariant\/} over $M$ if $\phi({\mr\U})$ is quasi-invariant over $M$  for every $\phi({\mr x})$ that is conjunction of formulas in $p({\mr x})$.

The definitions above and all what we say in this paragraph remains valid if we replace the model $M$ with an arbitrary set $A$.
However the correct generalization to a set involves the notion of strong automorphism developed in Chapter~\ref{invariant}.
%For types of small cardinality, this is equivalent to requiring that $p({\mr\U})$ is quasi-invariant.
% So, the type $p({\mr x})$ is quasi-invariant if the set $p({\mr\V})$ is invariant, where $\V$ is an large saturated extension of $\U$, see Exercise~\ref{ex_quasi_inv_type}.

For global types, quasi-invariance coincides with invariance. In fact we have the following equivalence.


\begin{proposition}\label{prop_invariance-quasi-invariance}
Let $p({\mr x})\in S_{\phi}(\U)$ be a global $\phi$-type. Then the following are equivalent
\begin{itemize}
\item[1.] $p({\mr x})$ is invariant over $M$
\item[2.] $p({\mr x})$ is quasi-invariant over $M$.
\end{itemize}
\end{proposition}
\begin{proof}
\ssf{1}$\IMP$\ssf{2}.
Assume $p({\mr x})$ is invariant and let $\psi({\mr x}\,;{\gr b})\,\in\, p$ where ${\gr b}\in\U^{\gr z}$.
Then $\psi({\mr x}\,;f{\gr b})\,\in\, p$ for every $f\in\Aut(\U/M)$, so \ssf{2} follows from the finite consistency of $p({\mr x})$.

\ssf{2}$\IMP$\ssf{1}.
Assume $p({\mr x})$ is not invariant.
Then there is ${\gr b}\in\U^{\gr z}$ such that $\phi({\mr x}\,;{\gr b})\in p$ and $\phi({\mr x}\,;f{\gr b})\notin p$ for some  $f\in\Aut(\U/M)$.
By completeness, $p({\mr x})$ contains the formula $\phi({\mr x}\,;{\gr b})\wedge\neg\phi({\mr x}\,;f{\gr b})$ which clearly is not consistent with its $f$-translate.
\end{proof}

Unfortunately, a quasi-invariant type does not necessarily extend to a global type that is also quasi-invariant.
A better notion is obtained with the following definition (that will not be used in this chapter).

We say that a set $\mrB\subseteq\U^{\mr x}$ is \emph{strongly quasi-invariant\/} over $M$ if for every finite cover of $\mrB$ by definable sets

\ceq{\hfill\mrB}
{\subseteq}
{\bigcup_{i=1}^n\mr\D_i}

at least one of these $\mr\D_i$ is quasi-invariant over $M$.
Strongly quasi invariant types are defined similarly to quasi-invariant types.
Note that for global types the two notions coincide.

The following easy proposition is the motivation behind the definition above.

\begin{proposition}
  Every type $p(x)\subseteq L(\U)$ that is strongly quasi invariant over $M$ extends to a global type that is quasi invariant over $M$.
\end{proposition}






%Quasi-invariance makes sense also for incomplete types.
%Unfortunately it is not true in general that every quasi-invariant type can be extended to a global one. In next section we consider the stronger notion of types that are \textit{coheirs}. We shall see in Proposition~\ref{prop_exisntence_coheirs} that coheirs have this desirable property.


\begin{comment}
We say that $\mrB$ is \emph{drifting over $A$\/} if whenever $f_1,\dots,f_n$ is a finite tuple in $\Aut(\U/A)$, there is $g\in\Aut(\U/A)$ such that $g[\mrB]$ is disjoint from all $f_i[\mrB]$.
%We say that  $\mrB$ is \emph{piecewise drifting\/} if it is the union of finitely many drifting sets.

\begin{lemma}\label{lem_newelski}
A quasi-invariant set is not the union of finitely many drifting sets.
\end{lemma}

\begin{proof}
% \def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
% \def\ceq#1#2#3{\noindent\parbox[t]{30ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

It is convenient to prove an apparently more general claim.
If ${\mr\B_1},\dots,{\mr\B_n}$ are all drifting and $\Ll$ is such that for some finite $F\subseteq G$\medskip 

\ceq{\sharp\hfill\Ll}{\subseteq}{\bigcup_{f\in F}f[{\mr\B_1}\cup\dots\cup{\mr\B_n}],} 

then ${\mr\Ll}$ is not quasi-invariant.
The claim is vacuously true for $n=0$.
Now, assume $n$ is positive and that the claim holds for $n-1$.
Define $\mrC={\mr\B_1}\cup\dots\cup{\mr\B_{n-1}}$ and rewrite $\sharp$ as follows

\ceq{\hfill{\mr\Ll}}{\subseteq}{\bigcup_{f\in F}f[\mrC]\ \cup\ \bigcup_{h\in F}h[{\mr\B_n}]}

Since ${\mr\B_n}$ is drifting there is a $g\in G$ such that $g[{\mr\B_n}]$ is disjoint from $h[{\mr\B_n}]$ for every $h\in F$, which implies that\medskip 

\ceq{\hfill{\mr\Ll}\cap g[{\mr\B_n}]}{\subseteq}{\bigcup_{f\in F}f[\mrC].} 

Hence for every $h$ there holds\medskip 

\ceq{\hfill h g^{-1}[{\mr\Ll}]\cap h[{\mr\B_n}]}{\subseteq}{\bigcup_{f\in F}hg^{-1}f[\mrC]} 

So, from $\sharp$ we obtain\medskip 

\ceq{\hfill{\mr\Ll}\cap\bigcap_{h\in F}h g^{-1}[{\mr\Ll}]}{\subseteq}{\bigcup_{f\in F}f[\mrC]\ \cup\ \bigcup_{h\in F}\bigcup_{f\in F}hg^{-1}f[\mrC].}\smallskip


\noindent By the induction hypothesis, the set on the r.h.s.\@ is not quasi-invariant.
Hence neither is ${\mr\Ll}$, proving the claim and with it the lemma.
\end{proof}

Every non piecewise drifting type extends to a non drifting global type.

\label{coheirs}
\end{comment}


\begin{exercise}[Nonsensical, correggere!]
  Suppose that there is a unique global type $p(x)\in S(\U)$ containing $\phi(x)\in L(M)$ that is invariant over $M$.
  Then for every $\psi(x)\in L(\U)$ the following are equivalent
  \begin{itemize}
    \item[1.] $\psi(x)\in p$
    \item[2.] there are some finitely many formulas $\psi_i(x)$ such that 
    
    \ceq{\hfill p(x)}{\imp}{\psi(x)\wedge\bigwedge_{i=1}^n\psi_i(x)}
    
    and for every $i$ finitely many conjugates of $\psi_i(\U)$ cover $\phi(\U)$.
  \end{itemize}
\end{exercise}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Heirs and coheirs}
\label{coheirs}

The easiest way to obtain types that are invariant over a model $M$ is via types that are finitely satisfiable in $M$.
We say that a type $p({\mr x})$ is  \emph{finitely satisfiable\/} in $M$ if every conjunction of formulas in $p({\mr x})$ has a solution in $M^{\mr x}$.

\begin{proposition}\label{prop_coeredi_quasiinvarienti}
Every type $p({\mr x})\subseteq L(\U)$ that is finitely satisfiable in $M$ is quasi-invariant over $M$.
\end{proposition}

\begin{proof}
Clearly, the same ${\mr a}\in M^{\mr x}$ that satisfies $\phi({\mr x})$ also satisfies every $\Aut(\U/M)$-translate of $\phi({\mr x})$.
\end{proof}

Propositions~\ref{prop_invariance-quasi-invariance} and~\ref{prop_coeredi_quasiinvarienti} yield the following (but a direct proof is also easy).

\begin{proposition}\label{prop_coeredi_invarienti}
Let $p({\mr x})\in S_{\phi}(\U)$ be a global $\phi$-type that is finitely satisfiable in $M$.
Then $p({\mr x})$ is $M$-in\-vari\-ant.
\end{proposition}

\begin{proposition}\label{prop_exisntence_coheirs}
Every type $q({\mr x})\subseteq L(\U)$ that is finitely satisfiable in $M$ has an extension to a global type that is finitely satisfiable in $M$.
\end{proposition}

\begin{proof} 
Let $p({\mr x})\subseteq L(\U)$ be maximal among the types that contain $q({\mr x})$ and are finitely satisfiable in $M$.
We prove that $p({\mr x})$ is complete.
If for a contradiction $p({\mr x})$ contains neither $\psi({\mr x})$ nor $\neg\psi({\mr x})$, then  neither $p({\mr x})\cup\big\{\psi({\mr x})\big\}$ nor $p({\mr x})\cup\big\{\neg\psi({\mr x})\big\}$ are finitely satisfiable in $M$.
This contradicts the finite satisfiability of $p({\mr x})$.
\end{proof}

In most cases we work with types that are finitely satisfiable over a model. The reason is explained by the next proposition, which is clear by elementarity.

\begin{proposition}\label{prop_coher_over_model}
    Every consistent type over a model is finitely satisfiable in that model, that is, whenever $p({\mr x})\subseteq L(M)$ is consistent, $p({\mr x})$ is finitely satisfiable in $M$. 
\end{proposition}

\begin{definition}\label{def_choeir_uno} A type $p({\mr x}) \subseteq L(\U)$ that is finitely satisfiable in $M$ is said to be a \emph{coheir\/} of $p_{\restriction M}({\mr x})$. 
\end{definition}

%A type that extends $p({\mr x})$ and is finitely satisfied in $M$ is called a \emph{coheir\/} of $p({\mr x})$ over~$M$.

In many cases it is useful to focus on elements instead of types.
We introduce the following notation to express that $\tp({\mr a}/M,{\gr b})$ is finitely satisfied in $M$.

\begin{definition}\label{def_coheir_idepencence} 
  For every ${\mr a}\in\U^{\mr x}$ and ${\gr b}\in\U^{\gr z}$ we define

  \noindent\llap{\textcolor{red}{\Large\danger}\kern1.5ex}
  %
  \ceq{\hfill\emph{${\mr a}\cnonfork_M{\gr b}$}}
  {\IFF}
  {\phi({\mr\U},{\gr b})\cap M^{\mr x}\neq\0
  \textrm{ for all }\phi({\mr x}\,;{\gr z})\in L(M) 
  \textrm{ such that }\phi({\mr a}\,;{\gr b})}.

  %We call this the \emph{coheir-heir} relation.
  %
  We say that $\tp({\mr a}/M,{\gr b})$ is a \emph{coheir} of $\tp({\mr a}/M)$, or, equivalently, that $\tp({\mr b}/M,{\gr a})$ is a \emph{heir} of $\tp({\mr b}/M)$.
  
  We define the type

  \ceq{\hfill\emph{${\mr x}\cnonfork_M{\gr b}$}}
  {=}
  {\Big\{\phi({\mr x}\,;{\gr b})
  \ :\ 
  \phi({\mr x}\,;{\gr b})\in L(M)
  \textrm{ and } M^{\mr x}\subseteq\phi(\mrU\,;{\gr b})\Big\}.}

    % 
  We will use the symbol \emph{${\mr a}\equiv_M{\mr x}\cnonfork_M{\gr b}$} 
  for the union of the types ${\mr x}\cnonfork_M{\gr b}$ and 
  $\tp({\mr a}/M)$.
\end{definition}
 The tuples ${\mr a}$ realizing ${\mr x}\cnonfork_M{\gr b}$ are exactly those such that ${\mr a}\cnonfork_M{\gr b}$. Note that $\tp({\mr a}/M,{\gr b})$ is a coheir of $\tp({\mr a}/M)$ according to Definition~\ref{def_choeir_uno}, so the terminology is consistent.

We think of  ${\mr a}\cnonfork_M{\gr b}$ as saying that 
${\mr a}$ is \emph{independent\/} from ${\gr b}$ over $M$.
%
%This is a strong notion of independence.
%
In general %it is not symmetric, that is 
${\mr b}\cnonfork_M{\gr a}$ is not 
equivalent to ${\gr a}\cnonfork_M{\mr b}$. 
%(symmetry is equivalent to stability).

We shall use, sometimes without explicit reference, the following easy lemma.

\begin{lemma}\label{lem_coheir_independence}
    The following properties hold for all $M,{\mr a},{\mr b}$, and $c$
    \begin{itemize}
    \item[1.] ${\mr a}\cnonfork_M{\gr b}\ \ \IMP\ \ f{\mr a}\cnonfork_Mf{\gr b}$ \ \ 
              for every $f\in\Aut(\U/M)$\hfill \textit{invariance}
    \item[2.] ${\mr a}\cnonfork_M{\gr b}\ \ \IFF\ \ {\mr a_0}\cnonfork_M{\gr b_0}$
              \ for all finite ${\mr a_0}\subseteq{\mr a}$ and 
              ${\gr b_0}\subseteq{\gr b}$ \hfill\textit{finite character}
    \item[3.] ${\mr a}\cnonfork_Mc,{\gr b}$ \ and \ 
              $c\cnonfork_M{\gr b}\ \ \IMP\ \ {\mr a},c\cnonfork_M{\gr b}$
              \hfill\hfill\hfill\textit{transitivity}
    \item[4.] ${\mr a}\cnonfork_M{\gr b}\ \ \IMP\ \ $ 
              there exists ${\mr a'}\equiv_{M,\,{\gr b}}{\mr a}$ such that 
              ${\mr a'}\cnonfork_M{\gr b},c$
              \hspace{\stretch{20}}\textit{coheir extension}
    \item[5.] ${\mr a}\cnonfork_M{\gr b_1},{\gr b_2}$ \ and \ 
    ${\gr b_1}\equiv_M{\gr b_2}\ \ \IMP\ \ {\gr b_1}\equiv_{M,\,{\mr a}}{\gr b_2}$
              \hspace{\stretch{20}}\textit{non-splitting}
    \end{itemize}
    \end{lemma}
\begin{proof}

Properties \ssf{1}-\ssf{3} follow immediately from Definition~\ref{def_coheir_idepencence}.
We prove \ssf{4}.
Assume ${\mr a}\cnonfork_M{\gr b}$, that is,  $\tp({\mr a}/M,{\gr b})$ is finitely satisfiable in $M$. By Proposition~\ref{prop_exisntence_coheirs} $\tp({\mr a}/M,{\gr b})$ extends to a global type $p({\mr x})$ that is finitely satisfiable in $M$.
Then any ${\mr a'}\models p_{\restriction M,\,{\gr b},\,c}({\mr x})$ proves the lemma.
The proof of \ssf{5} is left to the reader.
\end{proof}

\begin{proposition}\label{prop_saturate_heir}
  Let ${\mr a}\cnonfork_M{\gr b}$ then there is $\V\preceq\U$ that is isomorphic to $\U$ and such that ${\gr b}\in\V^{\gr z}$ and ${\mr a}\cnonfork_M\V$.
\end{proposition}

\begin{proof}
  Let $c$ be an enumeration of $\U$.
  Let $p(w,{\gr z})=\tp(c,{\gr b}/M)$.
  We can take $\V$ to be the structure enumerated by the tuple that realizes symultaneously $p(w,{\gr b}) $ and the following type 

  \ceq{\hfill\Big\{\neg\phi({\mr a},w,{\gr b})}{:}{\phi({\mr x},w,{\gr z})\in L(M),\ \ p(w,{\gr b})\imp\phi(M,w,{\gr b})=\0\Big\}.}

  We only need to prove consistency.
  If inconsistent, then 

  \ceq{\hfill\theta(w,{\gr b})}{\imp}{\bigvee_{i=1}^n\phi_i({\mr a},w,{\gr b})}
  
for some $\theta(w,{\gr b})\in p$ and some $\phi_i({\mr x},w,{\gr b})$ such that $p(w,{\gr b})\imp\phi_i(M,w,{\gr b})=\0$.
We obtain a contradiction because by elementarity we can replace ${\mr a}$ by some ${\mr a'}\in M^{\mr x}$.
\end{proof}

%Transitivity has dual version that holds under stronger assumptions.

The type ${\mr a}\equiv_M{\mr x}\cnonfork_M{\gr b}$ in Definition~\ref{def_coheir_idepencence} is the intersection of all global coheirs of $\tp({\mr a}/M)$.
%
Its consistency is guaranteed by the fact that $M$ is a model (see Proposition~\ref{prop_coher_over_model}).
%
However, in general it need not be a complete type over $M,{\gr b}$.
%
In fact, completeness in this case is a strong property.

\begin{definition}\label{def_coheir_stationary} We say that $\cnonfork_M$ is \emph{stationary\/} if ${\mr a}\equiv_M{\mr x}\cnonfork_M{\gr b}$ is a complete type over $M,{\gr b}$ for all finite tuples ${\gr b}$ and ${\mr a}$. 
We say \emph{$n$-stationary\/} if this is restricted to $|{\mr a}|=n$.
\end{definition}
%
An application of stationarity is given in Section~\ref{semigroups}.

Stationarity is often ensured by the following property, which will receive due attention in Section~\ref{stable_theories}. 

\begin{proposition}
Let ${\mr x}$ be a tuple of variables of length $n$.
If for every $\phi({\mr x})\in L(\U)$ there is a formula $\psi({\mr x})\in L(M)$ such that $\phi(\U)=_M\psi(\U)$ then $\cnonfork_M$ is $n$-stationary.
\end{proposition}

\begin{proof}
Let  ${\gr b}\in\U^{\gr z}$ and ${\mr a_1},{\mr a_2}\in\U^{\mr x}$ 
be such that ${\mr a_i}\cnonfork_M{\gr b}$ and ${\mr a_1}\equiv_M{\mr a_2}$.
We claim that ${\mr a_1}\equiv_{M,\,{\gr b}}{\mr a_2}$.
We need to prove that $\phi({\gr b}\,;{\mr a_1})\iff\phi({\gr b}\,;{\mr a_2})$ 
for every  $\phi({\gr z}\,;{\mr x})\in L(M)$.
Let $\psi({\mr x})\in L(M)$ be such that $\phi({\gr b}\,;{\mr \U})=_M\psi({\mr \U})$.
From ${\mr a_i}\cnonfork_M{\gr b}$ we obtain that  $\phi({\gr b}\,;{\mr a_i})\iff\psi({\mr a_i})$.
Finally, the claim follows because ${\mr a_1}\equiv_M{\mr a_2}$.
\end{proof}

% \begin{lemma}\label{lem_coheirext}
% If ${\gr a}\nonforkc_A{\mr c}$ then for every ${\gr b}$ there is ${\mr c'}$ such that ${\gr a},\,{\gr b}\nonforkc_A{\mr c'}\equiv_{A,\,{\gr a}}{\mr c}$.
% \end{lemma}

% \begin{exercise}.
% Prove that every invariant type $q({\mr x})\subseteq L(\U)$ can be extended to a global invariant type $p({\mr x})\in S(\U)$.(?)
% \end{exercise}

% We say that $p({\mr x})\in S(\U)$ is a \emph{global heir\/} of $p_{\restriction M}({\mr x})$ if  
% 
% \ceq{\hfill{\gr\D_{p,\phi}}\cap M^{\gr z}\neq\0}{\IFF}{{\gr\D_{p,\phi}}\neq\0}  for every formula $\phi({\mr x}\,;{\gr z})\in L$.

%Every type over a model has an extension to a global coheir. 
%A satisfactory generalization of this notions to types over sets should guarantee this existence.
%Unfortunately, this is not possible in general and the definition Section~\hyperref[coheirs_sets]{\ref*{invariantL}.\ref*{coheirs_sets}} is as good as it gets.

\begin{remark}\label{rk_coheir_stationary}
%The stationarity of $\cnonfork_A$ over every set $A$, or just over every model, is equivalent to the stability of $T$, see Section~\hyperref[stable_teories]{\ref*{external}.\ref*{stable_teories}}.
There are many theories where the stationarity of $\cnonfork_M$ holds for some particular $M$.
For example, if every subset of $M^n$ is $M$-definable then $\cnonfork_M$ is clearly $n$-stationary.
This simple observation will help in the proof of Theorem~\ref{thm_Hindman}.
For a natural example, let $T=T_{\rm dlo}$ and let $M\subseteq\U$ have the order type of $\RR$.
By quantifier elimination every definable subset of $\U$ is a union of finitely many intervals.
By Dedekind completeness, the trace on $M$ of any interval of $\U$ coincides with that of an $M$-definable interval. 
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Morley sequences and indiscernibles}

In what follows $\alpha$ is some ordinal $\le\kappa$, typically $\omega$, and ${\mr x}$ is a tuple of variables of length $<\kappa$.

Let \mbox{$p({\mr x})\in S(\U)$} be a global type.
We say that ${\mr\bar c}=\<{\mr c_i}:i<\alpha\>$ is a \emph{Morley sequence\/} of $p({\mr x})$ over $A$ if for every $i<\alpha$

\ceq{\ssf{Ms.}\hfill {\mr c_i}}{\models}{p_{\restriction  A,\,{\mr c_{\restriction i}}}({\mr x})}.

When $A$ is a model, say $M$, and $p({\mr x})$ is finitely satisfiable in $M$, we say that ${\mr\bar c}$ is a \emph{coheir sequence\/} of $p({\mr x})$ over $M$. 

When we say that ${\mr\bar c}$ is a coheir sequence over $M$ (with no explicit reference to a global type), we mean that \textit{there is\/} a type $p({\mr x})\in S(\U)$ that is finitely satisfiable in $M$ such that ${\mr\bar c}$ is a \emph{coheir sequence\/} of $p({\mr x})$.

The following is a convenient characterization of coheir sequences.

\begin{lemma}\label{lem_coheir_property}
The following are equivalent
\begin{itemize}
\item[1.] ${\mr\bar c}=\<{\mr c_n}:n<\omega\>$ is a coheir sequence over $M$
\item[2.] ${\mr c_n}\cnonfork_M{\mr c_{\restriction n}}$ and ${\mr c_{n+1}}\equiv_{M,\,{\mr c_{\restriction n}}}{\mr c_n}$ for every $n<\omega$.
\end{itemize}
\end{lemma}

\begin{proof}
\ssf{1}$\IMP$\ssf{2}.
Assume \ssf{1} and let $p({\mr x})\in S(\U)$ be a global type that is finitely satisfiable in $M$ and such that ${\mr c_i}\models p_{\restriction M,{\mr c_{\restriction i}}}({\mr x})$.
The requirement ${\mr c_{n+1}}\equiv_{M,{\mr c_{\restriction n}}} {\mr c_n}$ is clear.
Now, suppose $\phi({\mr c_{n+1}})$ for some $\phi({\mr x})\in L(M,{\mr c_{\restriction n+1}})$.
Then $\phi({\mr x})$ belongs to $p({\mr x})$, so $\phi({\mr\U})\cap M^{\mr x}\neq\0$ because $p({\mr x})$ is finitely satisfiable in $M$. This proves ${\mr c_n}\cnonfork_M{\mr c_{\restriction n}}$.

\ssf{2}$\IMP$\ssf{1}.
Let $q({\mr x})=\{\phi({\mr x})\in L(M, {\mr\bar c})\,:\, \phi({\mr c_n}) \textrm{ holds for cofinitely many } n\}$.
%
We claim that $q({\mr x})$ is finitely satisfiable in $M$.
%
Let $\phi({\mr x}\,;{\mr z})\in L(M)$ be such that $\phi({\mr x}\,;{\mr c_{\restriction n}})\in q$.
%
By the definition of $q({\mr x})$, the formula $\phi({\mr c_m}\,;{\mr c_{\restriction n}})$ holds for all sufficiently large $m$.
%
Hence, from \ssf{2} we infer ${\mr c_m}\cnonfork_M{\mr c_{\restriction n}}$ and conclude that $\phi({\mr x}\,;{\mr c_{\restriction n}})$ is satisfied in $M$.

Let $p({\mr x})$ be any global extension of $q({\mr x})$ finitely saisfied in $M$. 
%
We prove that ${\mr\bar c}$ is a Morley sequence of $p({\mr x})$ over $M$.
%
By \ssf{2} either ${\mr c_m}\models p_{\restriction  M,\,{\mr c_{\restriction n}}}({\mr x})$ for all $m\ge n$ or ${\mr c_m}\notmodels p_{\restriction  M,\,{\mr c_{\restriction n}}}({\mr x})$ for all $m\ge n$.
%
As $p({\mr x})$ extends $q({\mr x})$, the latter cannot occur.
\end{proof}

Let $(I,<_I)$ be a linear order.
A function ${\mr\bar a}:I\to\U^{\mr x}$ is said to be an \emph{$I$-sequence}, or simply a \emph{sequence\/} when $I$ is clear.
We will often introduce an $I$-sequence as ${\mr\bar a}=\<{\mr a_i}: i\in I\>$.

If $I_0\subseteq I$ we call ${\mr a_{\restriction I_0}}$ a \emph{subsequence\/} of ${\mr\bar a}$.
The subsets $I_0\subseteq I$ that are well-ordered by $<_I$, in particular the finite ones, are especially relevant.
When $I_0$ has order type $\alpha$, an ordinal, we identify ${\mr a_{\restriction I_0}}$ with a tuple of length $\alpha$.

Recall that \emph{$I^{(n)}$} denotes that the set of \emph{$n$-subsets\/} of $I$,  i.e.\@ the subsets of $I$ of cardinality $n$.
The notation \smallskip

\ceq{\hfill\emph{$\displaystyle\binom{I}{n}$}}{=}{I^{(n)}}

is also common.
\begin{definition}
Let $(I,<_I)$ be an infinite linear order and let ${\mr\bar a}$ be an $I$-sequence.
We say that ${\mr\bar a}$ is a \emph{sequence of indiscernibles\/} over $A$ or, an \emph{$A$-indiscernible sequence\/}, if ${\mr a_{\restriction I_0}}\equiv_A {\mr a_{\restriction I_1}}$ for every $I_0,I_1\in I^{(n)}$ and $n<\omega$.

\end{definition}

The indiscernibility condition can be formulated in a number of equivalent ways.
For example, we can require that, for every formula $\phi(x_1,\dots,x_n)\in L(A)$ and every pair of tuples in $I^n$ such that $i_0<\dots<i_n$ and $j_0<\dots<j_n$,


\ceq{\hfill\phi(a_{i_0},\dots,a_{i_n})}{\iff}{\phi(a_{j_0},\dots,a_{j_n})}

Alternatively, we can simply say that for all $i_0,\dots,i_n\in I$ the type $\tp(a_{i_0},\dots,a_{i_n}/A)$ only depends on the order type of $i_0,\dots,i_n$.

\begin{proposition}
Let $p({\mr x})\in S(\U)$ be a global $A$-invariant type and let ${\mr\bar c}=\<{\mr c_i}:i<\alpha\>$ be a Morley sequence of $p({\mr x})$ over $A$.
Then ${\mr\bar c}$ is a sequence of indiscernibles over $A$.
\end{proposition}

\begin{proof}

%\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}{\hspace*{1ex}$\displaystyle #2$\hspace*{1ex}}{$\displaystyle #3$}}

We prove by induction on $n<\omega$ that

\ceq{\sharp\hfill {\mr c_{\restriction n}}}{\ \equiv_A}{\mr c_{\restriction I_0}}\ \ \ for every $I_0\subseteq\alpha$ of cardinality $n$.

For $n=0$ the claim is trivial. We assume inductively that $\,\sharp\,$ above is true and prove that

\ceq{\hfill {\mr c_{\restriction n}},{\mr c_n}}{\equiv_A}{{\mr c_{\restriction I_0}},{\mr c_i}}\ \ \ for every $I_0<i<\alpha$.

As ${\mr\bar c}$ is  Morley sequence, ${\mr c_n}\equiv_{A,{\mr c_{\restriction n}}} {\mr c_i}$ whenever $n<i$.
Hence we can equivalently prove that

\ceq{\hfill {\mr c_{\restriction n}},{\mr c_i}}{\equiv_A}{{\mr c_{\restriction I_0}},{\mr c_i},}

which is equivalent to

\ceq{\hfill {\mr c_{\restriction n}}}{\equiv_{A,\,{\mr c_i}}}{{\mr c_{\restriction I_0}}.}

The latter holds by induction hypothesis $\,\sharp\,$ and the invariance of $p({\mr x})$ as formulated in \ssf{it3} of Section~\ref{invariant_sets}.
\end{proof}

%Let $I,<_I$ and $J,<_J$ be two infinite linear orders and let $a$ and $b$ be an $I$-sequence, respectively a $J$-sequence
%Note that the expression $a\equiv_A b$ is meaningless unless there is a unique isomorphism between $I,<_I$ and $J,<_J$. However it always make sense, even for non isomorphic orders, when $a$ and $b$ are indiscernibles over $A$. In fact, we agree that \emph{$a\equiv_A b$\/} means $a_{\restriction I_0}\equiv_A b_{\restriction J_0}$ for every finite $I_0\subseteq I$ and $J_0\subseteq J$ of equal cardinality.% That being said, the following proposition is immediate.


% \begin{proposition}\label{prop_embedding_indsc_seq}
% Let $J,<_J$ be an infinite linear orders of cardinality $<\kappa$ and let $a$ be an $A$-in\-dis\-cern\-i\-ble $J$-sequence.

% Let $I,<_I$ be another infinite linear order, and $b$ and  $A$-in\-dis\-cern\-i\-ble $I$-sequence such that $a\equiv_Ab$. Let $f:J\to I$ be an embedding of linear orders. Then $h(a_i)=b_{f(i)}$ for some $h\in\Aut(\U/A)$.
% \end{proposition}


% 
% \begin{exercise}
% Let $c=\<{\mr c_i}:i<\alpha \>$ be a constant sequence, i.e.\@ ${\mr c_0}={\mr c_i}$ for all $i$. Prove that $c$ is a Morley sequence over $A$ if and only if ${\mr c_0}\in(\dcl A)^{\mr x}$ and that $c$ is a coheir sequence over $A$ if and only if  ${\mr c_0}\in A^{\mr x}$. 
% \end{exercise}



% \begin{exercise}
% The following are equivalent
% \begin{itemize}
%  \item[1.] $\grD$ is invariant over $M$;
%  \item[2.] $c_0\in\grD\iff c_1\in\grD$ for every $M$-indiscernible sequence $\<c_i:i<\omega\>$ 
% \end{itemize}
% 
% \end{exercise}

