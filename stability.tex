% !TEX root = creche.tex
\chapter{Stability}
\label{stability}

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
Chapter under revision.

In this chapter we fix a signature $L$, a complete theory $T$ without finite models, and a saturated model $\U$ of inaccessible cardinality $\kappa>|L|$.
The notation and implicit assumptions are as in Section~\ref{monster}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Externally definable sets}
\label{externally}

Let $p({\mr x})\subseteq L(\U)$ be a finitely consistent type.
Recall from Section~\ref{invariant_sets} that for every formula $\phi({\mr x}\,;{\gr z})\in L$ we define

\ceq{\hfill\emph{$\gr\D_{p,\phi}$}}{=}{\Big\{{\gr a}\in\U^{\gr z}\ :\ \phi({\mr x}\,;{\gr a})\in p\Big\}.}

We say that $\grD$ is \emph{externally definable\/} if $\grD={\gr\D_{p,\phi}}$ for some type $p({\mr x})\in S_\phi(\U^{\gr z})$.
% We say that $\grD$ is externally definable \emph{by $p({\mr x})$ and $\phi({\mr x}\,;{\gr z})$}.

Equivalently, a set $\grD$ is externally definable if it is the trace over $\U^{\gr z}$ of a set which is definable in some elementary extension of $\U$.
More precisely, $\grD=\phi({\mr ^{*\kern-.3ex}b}\,;{}^{*\kern-.2ex}\U^{\gr z})\cap\U^{\gr z}$ where $ ^{*\kern-.2ex}\U\succeq\U$ and ${\mr  ^{*\kern-.3ex}b}\in {}^{*\kern-.2ex}\U^{\mr x}$.
This explains the terminology.

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}%
We prefer to deal with external definability in a different, though equivalent, way.

\begin{definition}\label{def_approx}
We say that $\grD$ is \emph{approximated\/} by the formula $\phi({\mr x}\,;{\gr z})$ if for every finite ${\gr B}\subseteq\U^{\gr z}$ there is a tuple ${\mr a}\in\U^{\mr x}$ such that $\phi({\mr a}\,;{\gr B})=\grD\cap{\gr B}$.
We call $\phi({\mr x}\,;{\gr z})$ the \emph{sort} of $\grD$.
If in addition $\phi({\mr a}\,;\U^{\gr z})\subseteq\grD$, we say that  $\grD$ is \emph{approximated from below}.
Equivalently, we say that  $\grD$ is approximated from below if for every finite ${\gr B}\subseteq\grD$ there is a tuple ${\mr a}\in\U^{\mr x}$ such that  ${\gr B}\subseteq\phi({\mr a}\,;\U^{\gr z})\subseteq\grD$.
The dual notion of \emph{approximation from above\/} is defined as expected (and coincides with $\neg\grD$ being approximated by $\neg\phi({\mr x}\,;{\gr z})$ from below).
\end{definition} 

The following proposition is clear by compactness.

\begin{proposition}\label{prop_approx=external}
   For every $\grD$ the following are equivalent
   \begin{itemize}
   \item[1.] $\grD$ is approximated by $\phi({\mr x}\,;{\gr z})$
   \item[2.] $\grD$ is externally definable by $\phi({\mr x}\,;{\gr z})$.
   \end{itemize}
\end{proposition}

The rest of this section is only required in Chapter~\ref{vc}.

Approximability from below is an adaptation to our context of the notion of \textit{having an honest definition} in \cite{CS}.
% We say that the global type $p\in S_{{\mr x}}(\U)$ is \textit{honestly definable\/} if for every $\phi({\mr x}\,;{\gr z})\in L$ the set ${\gr\D_{p,\phi}}$ is approximated from below (by some formula).
% We say that $p$ is \emph{definable\/} if the sets ${\gr\D_{p,\phi}}$ are all definable (over $\U$).
% Note that the terminology is misleading: honestly definable is weaker than definable.

\begin{example}
Every definable set is trivially approximable.
Sets may be approximable by different formulas.
For instance, if $T=T_{\rm dlo}$, then $\D=\{z\in\U:a\le z\le b\}$ is approximable both from below and from above by the formula $x_1<z<x_2$ though it is not definable by this formula.

Now, let $T=T_{\rm rg}$.
Then every $\D\subseteq\U$ is approximable and, when $\D$ has small infinite cardinality, it is approximable from above but not from below.
\end{example}

In Definition~\ref{def_approx}, the sort $\phi({\mr x}\,;{\gr z})$ is fixed (otherwise any set would be approximable) but this requirement of uniformity may be dropped if we allow $B$ to have larger cardinality.

\begin{proposition}\label{lem_approx_nonunif}
For every $\grD$ the following are equivalent
\begin{itemize}
\item[1.] $\grD$ is approximable
\item[2.] for every ${\gr C}\subseteq\U^{\gr z}$ of cardinality $\le|L|$ there is $\psi({\gr z})\in L(\U)$ such that $\psi({\gr C})=\grD\cap{\gr C}$.
\end{itemize}
\end{proposition}

\begin{proof}
To prove \ssf{2}$\IMP$\ssf{1} negate \ssf{1}
For each formula $\psi({\mr x}\,;{\gr z})\in L$ choose a finite set ${\gr B}$ such that $\psi({\mr b}\,;{\gr B})\neq\grD\cap{\gr B}$ for every ${\mr b}\in\U^{\mr x}$.
Let ${\gr C}$ be the union of all these finite sets.
Then ${\gr C}$ witnesses the failure of \ssf{2}.
\end{proof}

% \begin{remark}\label{prop_approx_el_eq}
% If $\grD\subseteq\U^{\gr z}$ is approximated by $\phi({\mr x}\,;{\gr z})$ then so is any $\grC$ such that $\grC\equiv\grD$, see Section~\ref{expansions} for the notation.
% In fact, if the set $\grD$ is approximable by $\phi({\mr x}\,;{\gr z})$ then for every $n$

% \hfil$\displaystyle\A {\gr z_1},\dots,{\gr z_n}\;\E {\mr x}\ \bigwedge^n_{i=1}\big[\phi({\mr x}\,;{\gr z_i})\ \iff\ {\gr z_i}\in{\gr \D}\big]$.

% So the same holds for any $\grC\equiv\grD$.
% A similar remark apply to approximability from below and from above (e.g.\@ for approximability from below, add the conjunct $\A {\gr z}\,\big[\phi({\mr x}\,;{\gr z})\imp {\gr z}\in\grD\big]$ to the formula above).
% \end{remark}

From the following easy observation of Chernikov and Simon~\cite{CS} we obtain an interesting (and mysterious) quantifier elimination result originally due to Shelah, see Corollary~\ref{corol_sh_exp_qe} below.

% \begin{proposition}
% Let $\C\subseteq\U^{|{\gr z},w|}$ be approximated from below by the formula $\phi({\mr x}\,;{\gr z},w)$. Then $\grD=\big\{{\gr z}:\E w\ \big({\gr z}\,w\in\C\big)\big\}$ is approximated from below by the formula $\E w\,\phi({\mr x}\,;{\gr z}\,w)$.
% \end{proposition}
% 
% \begin{proof}
% Let $B\subseteq\U$ be finite. 
% We want ${\mr a}\in\U^{\mr x}$ such that 
% 
% \ceq{\ssf{a.}\hfill \E w\ \big({\gr b}\,w\in\C\big)}{\iff}{\E w\,\phi({\mr a}\,;{\gr b}\,w)}\hfill for every ${\gr b}\in{\gr B}$
% 
% \ceq{\ssf{b.}\hfill \A {\gr z}\;\Big[\E w\,\phi({\mr a}\,;{\gr z}\,w)}{\imp}{\E w\ \big({\gr z}\,w\in\C\big)\Big]}
% 
% Let $C\subseteq\U$ be a finite set such that 
% 
% \ceq{\ssf{c.}\hfill \E w\in C^{|w|}\ \big({\gr b}\,w\in\C\big)}{\iff}{\E w\ \big({\gr b}\,w\in\C\big)}\hfill for every ${\gr b}\in{\gr B}$
% 
% As $\C$ is approximable from below, there is an ${\mr a}$ such that
% 
% \ceq{\ssf{a'.}\hfill {\gr b}\,c\in\C}{\iff}{\phi({\mr a}\,;{\gr b}\,c)}\hfill for every ${\gr b}\,c\in \big(B\cup C\big)^{|{\gr z}\,w|}$
% 
% \ceq{\ssf{b'.}\hfill \A {\gr z}\,w\ \Big[\phi({\mr a}\,;{\gr z}\,w)}{\imp}{{\gr z}\,w\in\C\Big]}
% 
% We obtain \ssf{b} from \ssf{b'} simply by logic. 
% Implication $\imp$ in \ssf{a} follows from \ssf{a'} and \ssf{c}. 
% Implication $\pmi$ follows from \ssf{b}.
% \end{proof}

\begin{proposition}\label{prop_sh_exp_qe}
Let $\C\subseteq\U^{y\,{\gr z}}$ be approximated from below by the formula $\phi({\mr x}\,;y\,{\gr z})$.
Then $\grD=\big\{{\gr z}:\E y\ \big(y\,{\gr z}\in\C\big)\big\}$ is approximated from below by $\E y\,\phi({\mr x}\,;y\,{\gr z})$.
\end{proposition}

\begin{proof}
Let $B\subseteq\U$ be finite.
We want ${\mr a}\in\U^{\mr x}$ such that

\ceq{\ssf{a.}\hfill \E y\ \big(y\,{\gr b}\in\C\big)}{\iff}{\E y\,\phi({\mr a}\,;y\,{\gr b})}\hfill for every ${\gr b}\in{\gr B}$

\ceq{\ssf{b.}\hfill \A {\gr z}\;\Big[\E y\,\phi({\mr a}\,;y\,{\gr z})}{\imp}{\E y\ \big(y\,{\gr z}\in\C\big)\Big]}

Let $D\subseteq\U^y$ be a finite set such that 

\ceq{\ssf{c.}\hfill \E y\in D\ \big(y\,{\gr b}\in\C\big)}{\iff}{\E y\ \big(y\,{\gr b}\in\C\big)}\hfill for every ${\gr b}\in{\gr B}$

As $\C$ is approximable from below, there is an ${\mr a}$ such that

\ceq{\ssf{a$'$.}\hfill d\,{\gr b}\in\C}{\iff}{\phi({\mr a}\,;d\,{\gr b})}\hfill for every $d\,{\gr b}\in D,{\gr B}$

\ceq{\ssf{b$'$.}\hfill \A y\,{\gr z}\ \Big[\phi({\mr a}\,;y\,{\gr z})}{\imp}{y\,{\gr z}\in\C\Big]}

We obtain \ssf{b} from \ssf{b$'$} simply by logic.
Implication $\imp$ in \ssf{a} follows from \ssf{a$'$} and \ssf{c}.
Implication $\pmi$ follows from \ssf{b}.
\end{proof}

\begin{corollary}
If $p({\mr x})\in S(\U)$ is honestly definable then the family of sets externally definable by $p({\mr x})$ is closed under quantifiers and Boolean combinations.
\end{corollary}

\begin{proof}
The sets externally definable by $p({\mr x})$ are always closed under Boolean operations.
By the proposition above, they are closed under quantifiers.
\end{proof}

% Let ${\gr z}=\<z_i:i<\lambda\>$ and let $\grD\subseteq\U^{\gr z}$. 
% For $I\subseteq\lambda$ we write $\E z_{\restriction I}\,\grD$ for the projection of $\grD$ to the $\lambda\sm I$ coordinates, i.e.\@ the set $\{b_{\restriction\lambda\sm I}: {\gr b}\in\grD\}$. 
% Expand the language with a symbol for $\E z_{\restriction I}\,\grD$ for every finite $I\subseteq\lambda$. 
% Then the theory of $\U$ in the expanded language has positive $\Delta$-quantifier elimination, for $\Delta=L\cup\big\{\E z_{\restriction I}\,\grD: I\subseteq\lambda\textrm{ finite}\big\}$, see Section~\hyperref[eliminazionequantificatoricriterio]{\ref*{elimination}.\ref*{eliminazionequantificatoricriterio}}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ladders and definability}

%Here we write \emph{$\phi({\mr x}\,;{\gr z})^*$\/} for the partitioned formula where the order of the two tuples is inverted (i.e.\@ it is the opposite of what displayed).

Let $\pi\subseteq\U^{\mr x}\times\U^{\gr z}$ be a binary relation (which need not be definable in any sense).
We denote by $\pi({\mr x}\,;{\gr z})$ the predicate associated to $\pi$.
We say that $\<{\mr a_i}\,;{\gr b_i} : i<\alpha\>$ is a \emph{ladder\/} of length $\alpha$ for $\pi({\mr x}\,;{\gr z})$ if for every $i<j<\alpha$

\ceq{\hfill\pi({\mr a_i}\,;{\gr b_j})}{\wedge}{\neg\pi({\mr a_j}\,;{\gr b_i}).}

We say that $\pi({\mr x}\,;{\gr z})$ is \emph{stable\/} if for some $n$ there is no ladder of length $n$.
Otherwise we say it is \emph{unstable} or that it has the \emph{order property}.
We will mainly deal with relations that are definable or type-definable.
We will say that a formula or a type is stable accordingly.
The proof of the following easy fact is left to the reader.

\begin{fact}\label{}
  The following are equivalent for every $p({\mr x}\,;{\gr z})\subseteq L(A)$
  \begin{itemize}
    \item [1.] $p({\mr x}\,;{\gr z})$ is stable
    \item [1.] for some finite $n$, there is no ladder of length $n$ for $p({\mr x}\,;{\gr z})$
    \item [2.] there is $q({\mr x}\,;{\gr z})\subseteq L(A)$ equivalent to $p({\mr x}\,;{\gr z})$ containing only stable formulas.
  \end{itemize}
\end{fact}

In this section there is no blanket assumption of invariance over $A$ as it is not strictly necessary.
The invariance of $\pi$ would simplify the discussion as it allows to require that the ladder is an indiscernible sequence (cf.\@ Lemma~\ref{lem_stab_Boole}). 

\begin{theorem}\label{thm_sability_indiscernibility}
  Let $\pi({\mr x}\,;{\gr z})$ be invariant over $A$.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $\pi({\mr x}\,;{\gr z})$ is stable
    \item[2.] $\pi({\mr a_0}\,;{\gr b_1})\imp\pi({\mr a_1}\,;{\gr b_0})$ for every $A$-indiscernible sequence $\<{\mr a_i}\,;{\gr b_i} : i<\omega\>$.
  \end{itemize}
\end{theorem}

\begin{proof}
  (2$\IMP$1) \ Assume $\pi({\mr x}\,;{\gr z})$ is unstable and that this is witnessed by the ladder $\<{\mr a_i}\,;{\gr b_i} : i<\omega\>$.
  Let $\<{\mr a'_i}\,;{\gr b'_i} : i<\omega\>$ be a sequence of $A$-indiscernibles with the same EM-type as $\<{\mr a_i}\,;{\gr b_i} : i<\omega\>$.
  By invariance $\pi({\mr a'_0}\,;{\gr b'_1})$ and $\neg\pi({\mr a'_1}\,;{\gr b'_0})$.

  (2$\IMP$1) Immediate by indiscernibility.
\end{proof}
%It is clear that $p({\mr x}\,;{\gr z})$ is stable if and only if $p({\mr x}\,;{\gr z})^*$ is stable.

%Suppose $p({\mr x}\,;{\gr z})$ is unstable and let $\<{\mr a_i}\,;{\gr b_i} : i<\omega\>$ be a ladder sequence. By padding redundant variables, we can read $p({\mr x}\,;{\gr z})$ as a formula $p({\mr x}\,{\gr z}\,;{\mr y}\,{\gr w})$. Then $p({\mr x}\,{\gr z}\,;{\mr y}\,{\gr w})$ defines the order of the sequence $\<{\mr a_i}\,{\gr b_i} : i<\omega\>$. For this reason it is also common to say that $p({\mr x}\,;{\gr z})$ has the \emph{order property}, this simply means that it is unstable. 

\begin{lemma}\label{lem_stab_Boole}
  Boolean combinations of stable relations are stable.
  Moreover, if $\pi({\mr x}\,;{\gr z})$ then  $\pi^{-1}({\mr x}\,;{\gr z})$ and $\pi({\mr x},x'\,;{\gr z},z')$ are also stable formula (in the latter $x'$ and $z'$ are dummy variables).
\end{lemma}

\begin{proof}
  The second claim is immediate.
  To prove the first, it suffices to consider conjunction and negation.
  Negation is immediate, in fact if $\<{\mr a_i}\,;{\gr b_i} : i<n\>$ is a ladder for $\pi({\mr x}\,;{\gr z})$ then $\<{\mr a_{n-i}}\,;{\gr b_{n-i}} : i<n\>$ is a ladder for $\neg\pi({\mr x}\,;{\gr z})$.
  As for conjunction, note that when $\pi$ is invariant over $A$ it easily follows from Theorem~\ref{thm_sability_indiscernibility}.
  In general we reason as follows.

  Assume $\pi_1({\mr x}\,;{\gr z})\wedge\pi_2({\mr x}\,;{\gr z})$ is unstable and pick a ladder sequence $\<{\mr a_i}\,;{\gr b_i} : i<m\>$, where $m$ is specified below.
  Let $H_1,H_2\subseteq m^{(2)}$ contain those pairs $j<i$ such that $\neg\pi_1({\mr a_i}\,;{\gr b_j})$, respectively $\neg\pi_2({\mr a_i}\,;{\gr b_j})$. 
  Then $H_1\cup H_2= m^{(2)}$. 
  If $m$ is large enough, by the (finite) Ramsey Theorem there is a set $H$ of size $n$ such that $H^{(2)}$ is either contained in $H_1$ or in $H_2$. Suppose the first for definiteness. 
  Let $H=\{h_1,\dots,h_n\}$ then $\<{\mr a_{h_i}}\,;{\gr b_{h_i}} : i<n\>$ is a ladder sequence for $\pi_1({\mr x}\,;{\gr z})$.
\end{proof}

The following theorem claims what is arguably one of the most important properties of stable formulas: any set that is externally definable by a stable formula is definable (by a related formula).

\begin{theorem}\label{thm_def_stable_formula}
Any $\grD\subseteq\U^{\gr z}$ approximated by a stable formula is definable.
Precisely, if $\pi({\mr x}\,;{\gr z})$ is a stable relation that approximates $\grD$ then there are ${\mr a_{i,j}}\in\U^{\mr x}$ such that

\ceq{\hfill {\gr z}\in\grD}{\iff}{\bigvee^n_{i=1}\bigwedge^m_{j=1}\pi({\mr a_{i,j}}\,;{\gr z})}
\end{theorem}

Theorem~\ref{thm_def_stable_formula2} will prove the converse: if every set approximated by $\pi({\mr x}\,;{\gr z})$ is definable then $\pi({\mr x}\,;{\gr z})$ is stable.

\begin{proof}
  The theorem follows immediately from the two lemmas below.
\end{proof}

\begin{lemma}
If $\grD$ is approximated from below by a stable formula $\pi({\mr x}\,;{\gr z})$ then

\ceq{\hfill {\gr z}\in\grD}{\iff}{\bigvee^n_{i=0}\pi({\mr a_i}\,;{\gr z})}

for some ${\mr a_0},\dots,{\mr a_n}\in\U^{\mr x}$.
\end{lemma}

\begin{proof}
The elements ${\mr a_0},\dots,{\mr a_n}$ are defined recursively together with some auxiliary elements ${\gr b_0},\dots,{\gr b_{n-1}}\in\grD$.

Suppose ${\gr b_0},\dots,{\gr b_{n-1}}$ have been defined (this assumption is empty if $n=0$).
We first define ${\mr a_n}$, then ${\gr b_n}$.
Choose ${\mr a_n}\in\U^{\mr x}$ such that ${\gr b_0},\dots,{\gr b_{n-1}}\in\pi({\mr a_n}\,;\U^{\gr z})\subseteq\grD$.
This is possible because $\grD$ is approximated from below.
Now, if possible, choose ${\gr b_n}$ such that

\ceq{\hfill{\gr b_n}}{\in}{\grD\sm\bigcup^n_{i=0}\pi({\mr a_i}\,;\U^{\gr z})}.

Then $\<{\mr a_i}\,;{\gr b_i} : i\le n\>$ is a ladder sequence.
By stability, for some $n$, the tuple ${\gr b_n}$ does not exist.
This yields the required ${\mr a_0},\dots,{\mr a_n}$.
\end{proof}

\begin{lemma}\label{lem_stab_approx_below}
If $\grD$ is approximated by a stable formula $\pi({\mr x}\,;{\gr z})$.
Then, for some $m$, the formula

\ceq{\hfill\psi({\mr x_0},\dots,{\mr x_m}\,;{\gr z})}{=}{\bigwedge^m_{j=0}\pi({\mr x_j}\,;{\gr z})}

approximates $\grD$ from below.
\end{lemma}

\begin{proof}
Let $m$ be such that there is no ladder sequence for $\pi({\mr x}\,;{\gr z})$ of length greater than $m$.
Let ${\gr C}\subseteq\grD$ be finite.
We prove that there are some ${\mr a_0},\dots,{\mr a_m}$ such that ${\gr C}\subseteq\psi({\mr a_0},\dots,{\mr a_m}\,;\U^{\gr z})\subseteq\grD$.
As in the proof above, we define by recursion a ladder sequence for $\pi({\mr x}\,;{\gr z})$.
Suppose that ${\mr a_0},\dots,{\mr a_{n-1}}$ and ${\gr b_0},\dots,{\gr b_{n-1}}\notin\grD$ have been defined.
We first define ${\mr a_n}$, then ${\gr b_n}$. 
Choose ${\mr a_n}\in\U^{\mr x}$ such that 

\hfil${\gr C}\ \subseteq\ \pi({\mr a_n}\,;\U^{\gr z})\ \subseteq\ \U^{\gr z}\sm\{{\gr b_0},\dots,{\gr b_{n-1}}\}$.

This ${\mr a_n}$ exists, because $\grD$ is approximated by $\pi({\mr x}\,;{\gr z})$.
(Apply Definition~\ref{def_approx} with any $B$ such that ${\gr C}\cup\{{\gr b_0},\dots,{\gr b_{n-1}}\}\subseteq{\gr B}$.)
Then, if possible, let ${\gr b_n}$ such that

\ceq{\hfill{\gr b_n}}{\in}{\bigcap^n_{i=0}\pi({\mr a_i},\U^{\gr z})\sm\grD}

This procedure has to stop at some $n\le m$.
Therefore the required parameters are ${\mr a_1},\dots,{\mr a_n}={\mr a_{n+1}}=\dots={\mr a_{m}}$.
\end{proof}

% \begin{lemma}\label{lem_stable3}, say $P=\{p_1,\dots,p_n\}$
% If $\pi({\mr x}\,;{\gr z})$ is a stable formula then for every $m$ the formula $\psi({\mr x_0},\dots,{\mr x_m}\,;{\gr z})$ defined above is stable.
% \end{lemma}

% \begin{proof}
% It suffices to prove that if $\pi_1({\mr x_1}\,;{\gr z})\wedge\pi_2({\mr x_2}\,;{\gr z})$ is unstable then one of the formulas $\pi_n({\mr x_i}\,;{\gr z})$ is unstable. For simplicity, we use that instability implies the existence of an infinite ladder (this uses compactness, apparently contradicting Remark~\ref{rem_sability_no_compactness}). We leave to the reader to adapt the argument so that compactness is not required.

% Let ${\mr a^1_i},{\mr a^2_i}\in\U^{\mr x}$ and ${\gr b_i}\in\U^{\gr z}$ be such that 

% \ceq{\hfill i\le j}{\IFF}{\phantom{\neg}\pi_1({\mr a^1_i}\,;{\gr b_j})\wedge\pi_2({\mr a^2_i}\,;{\gr b_j})}\hfill for all $i,j<\omega$

% For $n=1,2$ let $H_n\subseteq{\omega\choose 2}$ contain those pairs $j<i$ such that $\neg\pi_n({\mr a^n_i}\,;{\gr b_j})$. 
% By the equivalence above $H_1\cup H_2={\omega\choose 2}$. 
% By the Ramsey Theorem there is an infinite set $H$ such that ${H\choose 2}\subseteq H_n$ for at least one of $n=1,2$. Suppose $H_1$ for definiteness. So, we obtain an infinite sequence $a^1_i$, $b_i$ such that

% \ceq{\hfill j<i}{\IFF}{\neg\pi_1({\mr a^1_i}\,;{\gr b_j})}\hfill for all $i,j<\omega$

% hence $\pi_1({\mr x_1}\,;{\gr z})$ is unstable.
% \end{proof}

By Lemma~\ref{lem_stab_Boole} the formula $\psi({\mr x_0},\dots,{\mr x_m}\,;{\gr z})$ is stable therefore this concludes the proof of Theorem~\ref{thm_def_stable_formula}.

\begin{remark}\label{rem_sability_no_compactness}
  Theorem~\ref{thm_def_stable_formula} is often cast in the following  apparently more general form.
  Let $\mrA\subseteq\U^{\mr x}$ and $\grB\subseteq\U^{\gr z}$.
  We say that $\pi({\mr x}\,;{\gr z})$ is stable between $\mrA$ and $\grB$ if for some $n$ no ladder of length $n$ exists with ${\mr a_i}\in\mrA$ and ${\gr b_i}\in\grB$.
  Let $\grD\subseteq\grB$ be approximable by $\pi({\mr x}\,;{\gr z})\wedge {\mr x}\in\mrA$.
  Then for any such $\grD$ there are ${\mr a_{1,1}},\dots,{\mr a_{n,m}}\in \mrA$ such that 
  
  \ceq{\hfill {\gr b}\in\grD}{\iff}{\bigvee^n_{i=1}\bigwedge^m_{j=1}\pi({\mr a_{i,j}}\,;{\gr b}).}
\end{remark} 

% \begin{exercise}
%   Prove Fact~\ref{fact_stability_compactness}.
% \end{exercise}

\begin{exercise}
  Prove that if $p({\mr x}\,;{\gr z})$ admits ladder sequences of arbitrary finite length, then it admits a ladder sequence of infinite length.
\end{exercise}

\begin{exercise}
  Let $\phi(x,y)\in  L$, where $|x|=|y|=1$.
  Suppose there is an infinite set $A\subseteq\U$ such that $\phi(a,b)\niff\phi(b,a)$ for every two distinct $a,b\in A$.
  Prove that $\phi(x\,;y)$ is unstable.
\end{exercise}


% \begin{exercise}\label{ex_harrington}
%   Prove the following claim (a version of Harrington's mysterious Lemma cf.~\cite[Lemma 8.3.4]{TZ}).
%   Let $\phi({\mr x}\,;{\gr z})\in L$ be a stable formula and suppose $\grB\subseteq\U^{\gr z}$ and $\mrA\subseteq\U^{\mr x}$ are approximated by $\phi({\mr x}\,;{\gr z})$ and  $\phi({\mr x}\,;{\gr z})^{\rm op}$, respectively.
%   Then at least one of the conditions \ssf{1} and \ssf{2} below occurs
  
%   \begin{itemize}
%   \item[1.]
%   \ssf{a.}\kern2ex$\phi({\mr x}\,;{\gr z})^{\phantom{{\rm op}}}\wedge\ {\mr x}\in{\mrA}$ approximates $\grB$ and\\
%   \ssf{b.}\kern2ex$\phi({\mr x}\,;{\gr z})^{\rm op}\wedge\ {\gr z}\in{\grB}$ approximates $\mrA$.
  
%   \item[2.]
%   \ssf{a.}\kern2ex$\phi({\mr x}\,;{\gr z})^{\phantom{{\rm op}}}\wedge\ {\mr x}\notin{\mrA}$ approximates $\grB$ and\\
%   \ssf{b.}\kern2ex$\phi({\mr x}\,;{\gr z})^{\rm op}\wedge\ {\gr z}\notin{\grB}$ approximates $\mrA$.
%   \end{itemize}
%   Hint: Note that at least one of \ssf{1a} or \ssf{2a} occurs.
%   Hence it suffices to prove that \ssf{1a}$\IMP$\ssf{1b} and \ssf{2a}$\IMP$\ssf{2b}. The two implications are essentially equivalent.
%   \begin{proof}
%   Note that at least one of \ssf{1a} or \ssf{2a} occurs.
%   Hence it suffices to prove that \ssf{1a}$\IMP$\ssf{1b} and \ssf{2a}$\IMP$\ssf{2b}.
%   We only prove the first.
%   The second follows because $\neg\grB$ and $\neg\mrA$ are approximated by $\neg\phi({\mr x}\,;{\gr z})$ and  $\neg\phi({\mr x}\,;{\gr z})^*$, respectively.
  
%   Assume \ssf{1a} and negate \ssf{1b} for a contradiction.
%   Then \ssf{2b} holds.
%   Pick ${\mr a_0}$ arbitrarily, then recursively find ${\gr b_i}\notin\grB$ and  ${\mr a_i}\in\mrA$ such that
  
%   {\def\medrel#1{\parbox[t]{12ex}{$\displaystyle\kern2ex #1$}}
  
%   \ceq{\hfill\phi(\U\,;{\gr b_i})}{ =_{{\mr a_0},\dots,{\mr a_{i-1}}}}{\mrA} 
  
%   \ceq{\hfill\phi({\mr a_i}\,;\U)}{ =_{{\gr b_0},\dots,{\gr b_i}}}{\grB}
%   }
  
%   Then
  
%   {\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\kern2ex #1$}}
  
%   \ceq{\hfill i< j}{\IMP}{\phantom{\neg}\phi({\mr a_i}\,;{\gr b_j})}
  
%   \ceq{\hfill j\le i}{\IMP}{\neg\phi({\mr a_i}\,;{\gr b_j})}
  
%   }
  
%   Which contradicts the stability of $\phi({\mr x}\,;{\gr z})$.
%   \end{proof}
%   \end{exercise} 

  % \begin{exercise}\label{ex_stability_conjunction}
  %   Prove that if $p({\mr x}\,;{\gr z})$ and $q({\mr x}\,;{\gr z})$ are stable between $\mrA$ and $\grB$, then so is $p({\mr x}\,;{\gr z})\cup q({\mr x}\,;{\gr z})$.
  % \end{exercise}

%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%
\section{Stability and the number of types}


The following proposition highlights the connection between the stability of the formula $\phi({\mr x}\,;{\gr z})$ and the cardinality of $S_\phi(\U)$, equivalently the number of sets externally definable by $\phi({\mr x}\,;{\gr z})$. 

\begin{theorem}\label{thm_def_stable_formula2}
   The following are equivalent
   \begin{itemize}
     \item[1.] $\phi({\mr x}\,;{\gr z})$ is stable
     \item[2.] every subset of $\U^{\gr z}$ that is externally definable by $\phi({\mr x}\,;{\gr z})$ is definable
     \item[3.] there are $\le\kappa$ subsets of $\U^{\gr z}$ that are externally definable by $\phi({\mr x}\,;{\gr z})$
     \item[4.] there are $<2^\kappa$ subsets of $\U^{\gr z}$ that are externally definable by $\phi({\mr x}\,;{\gr z})$.
   \end{itemize}
 \end{theorem}
 
 \begin{proof}
 \ssf{1}$\IMP$\ssf{2} Clear by Proposition~\ref{prop_approx=external} and Theorem~\ref{thm_def_stable_formula}.
 
 \ssf{2}$\IMP$\ssf{3}$\IMP$\ssf{4} Obvious.
 
 \ssf{4}$\IMP$\ssf{1} Suppose that $\phi({\mr x}\,;{\gr z})$ is not stable.
 By compactness there is a ladder sequence  $\<{\mr a_i}\,;{\gr b_i} : i\in I\>$ where $I,<_I$ a dense linear order of cardinality $\kappa$ with $2^\kappa$ cuts.
 Here, a \textit{cut\/} is a subset $c\subseteq I$ that is closed downward.
 For every such $c\subseteq I$ we pick a global type
 
 \ceq{\hfill p_c({\mr x} ) }{\supseteq}{\big\{\phi({\mr x}\,;{\gr b_i})\iff i\in c\ :\ i\in I\big\}.}
 
 Clearly the sets ${\gr\D_{p_c,\,\phi} }$ are all distinct.
 \end{proof}


Binary trees of formulas have been introduced in Definition~\ref{def_tree_formulas}.
Here we restrict to trees of a particular form.
Namely, $\<\psi_s:s\in 2^{<\omega}\>$  where $\psi_\varnothing=\top$ and for $s\in 2^{<\omega}$ and $i\in 2$ we have $\psi_{s^\frown 0}({\mr x})=\neg\phi({\mr x}\,;{\gr b_s})$ and $\psi_{s^\frown 1}({\mr x})=\phi({\mr x}\,;{\gr b_s})$.
If we define $\phi^0=\neg\phi$ and $\phi^1=\phi$ the condition of consistency becomes for every $s\in 2^\omega$ the type $\{\phi^{s_n}({\mr x}\,;{\gr b_{s\restriction n}})\ :\ n<\omega\}$.


% Set the overall layout of the tree
\tikzstyle{level 1}=[level distance=3.5cm, sibling distance=2.5cm]
\tikzstyle{level 2}=[level distance=3.5cm, sibling distance=1.2cm]
\tikzstyle{level 3}=[level distance=2.5cm, sibling distance=0.5cm]
\tikzstyle{level 4}=[level distance=0.5cm, sibling distance=0.5cm]

% Define styles for bags and leafs
\tikzstyle{bag0} = [text width=1.5ex, align=left]
\tikzstyle{bag} = [text width=7.5ex, align=right]
%\tikzstyle{end} = [circle, minimum width=3pt,fill, inner sep=0pt]

\def\leaf{...}

\quad
\begin{tikzpicture}[grow=right]
\node[bag0] {{$\top$}}
    child {
        node[bag] {\llap{$\neg$}$\phi(x;b_{\varnothing}\!)$}      
            child {
                node[bag] {\llap{$\neg$}$\phi(x;b_0\!)$}
                    child {
                       node[bag] {\footnotesize\llap{$\neg$}$\phi(x;b_{00})$\rlap{$\ \cdots$}}
                       edge from parent
                    }    
                    child {
                       node[bag] {\footnotesize$\phi(x;b_{00})$\rlap{$\ \cdots$}}
                       edge from parent
                    }  
                 edge from parent
            }
            child {
                node[bag] {$\phi(x;b_0\!)$}
                edge from parent
                    child {
                       node[bag] {\footnotesize\llap{$\neg$}$\phi(x;b_{01})$\rlap{$\ \cdots$}}
                       edge from parent
                    }    
                    child {
                       node[bag] {\footnotesize$\phi(x;b_{01})$\rlap{$\ \cdots$}}
                       edge from parent
                    }  
                 edge from parent
            }
       edge from parent 
    }
    child {
        node[bag] {$\phi(x;b_{\varnothing}\!)$}         
            child {
                node[bag] {\llap{$\neg$}$\phi(x;b_1\!)$}
                    child {
                       node[bag] {\footnotesize\llap{$\neg$}$\phi(x;b_{10})$\rlap{$\ \cdots$}}
                       edge from parent
                    }    
                    child {
                       node[bag] {\footnotesize$\phi(x;b_{10})$\rlap{$\ \cdots$}}
                       edge from parent
                    }  
                 edge from parent
            }
            child {
                node[bag] {$\phi(x;b_1\!)$}
                edge from parent
                    child {
                       node[bag] {\footnotesize\llap{$\neg$}$\phi(x;b_{11})$\rlap{$\ \cdots$}}
                       edge from parent
                    }    
                    child {
                       node[bag] {\footnotesize$\phi(x;b_{11})$\rlap{$\ \cdots$}}
                       edge from parent
                    }  
                 edge from parent
            } 
        edge from parent
    };
\end{tikzpicture}

\medskip
When a tree of this form exists, we say that $\phi({\mr x}\,;{\gr z})$ has the \emph{binary tree property.}

\begin{theorem}\label{thm_count_types}
  The following are equivalent
  \begin{itemize}
  \item[1.] $\phi({\mr x}\,;{\gr z})$ is unstable
  \item[2.] $\phi({\mr x}\,;{\gr z})$ has the binary tree property.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf{1}$\IMP$\ssf{2}.
  The argument is the same as in the proof of Lemma~\ref{lem_bin_tree}.
  Assume \ssf1.
  By Theorem~\ref{thm_def_stable_formula2} there are $2^\kappa$ sets externally definable by $\phi({\mr x}\,;{\gr z})$.
  Then there is ${\gr b_\varnothing}\in{\U^z}$ such that there are $2^\kappa$ sets ${\gr\D}$ externally definable by $\phi({\mr x}\,;{\gr z})$ and such that ${\gr b_\varnothing}\in{\gr\D}$ and $2^\kappa$ sets such that ${\gr b_\varnothing}\notin{\gr\D}$.

  Assume inductively that ${\gr b}:2^n\to{\gr\U^z}$ is such that for all $s\in2^n$ and $r\in2^{n+1}$ there are $2^\kappa$ sets ${\gr\D}$ externally definable by $\phi({\mr x}\,;{\gr z})$ and such that ${\gr b_{s\restriction i}}\in\D\iff r(i)=1$.
  Reasoning as above we can extend ${\gr b}$ to a map ${\gr b'}:2^{n+1}\to{\gr\U^z}$ with the same property.

  % We show that if there is a ladder of length $m=2^n$, say $a_1,\dots,a_{m-1}$ and $b_0,\dots,b_{m-1}$, then there is a branching tree $\bar a'$ of height $n$.
  
  % The branching tree $\bar b'=\<b'_r\, :\, r\in{}^{<n}2\>$ is defined as follows

  % \quad $a'_r=b_h$\quad  where $h$ is obtained reading $r^\frown1^\frown0^{n-|r|-1}$ as an $n$-digit binary number.

  % To verify \ssf{2r} we define for $s\in{}^n2$ 
  
  % \quad $a'_s=b_k$\quad  where $k$ is obtained reading $s$ as an $n$-digit binary number.

  % Then it is easy to verify that for all pairs $r\subset s\in{}^n2$

  % \ceq{\hfill\phi(b'_r\,;a'_s)}
  % {\IFF}
  % {\phi(a_h\,;b_k)}\hfill where $h$ and $k$ are like above

  % \ceq{}
  % {\IFF}
  % {h\le k}

  % \ceq{}
  % {\IFF}
  % {r^\frown1^\frown0^{n-|r|-1}\ \le\ s}\hfill  as $n$-digit binary numbers

  % \ceq{}
  % {\IFF}
  % {r^\frown1\ \subseteq\ s}

  \ssf{2}$\IMP$\ssf{1}. From $\ssf{2}$, by compactness, there is a binary tree of height $\kappa$. 
  Hence there are $2^\kappa$ sets that are externally definable by $\phi({\mr x}\,;{\gr z})$.
  Therefore, by Theorem~\ref{thm_def_stable_formula2}, $\phi({\mr x}\,;{\gr z})$ is not stable.
\end{proof}

\begin{corollary}\label{corol_count_types}
The following are equivalent
\begin{itemize}
\item[1.] $\phi({\mr x}\,;{\gr z})$ is a stable formula
\item[2.] $\big|S_{\phi}(A^{\gr z})\big|\le|A|$ for all countable sets $A$
\item[3.] $\big|S_{\phi}(A^{\gr z})\big|<2^{|A|}$ for all countable sets $A$.
\end{itemize}
\end{corollary}

\begin{proof}
  It follows immediately from Lemma~\ref{lem_bin_tree} and Theorem~\ref{thm_count_types}.
\end{proof}

We use binary trees to prove the following fundamental lemma (attributed by Harnik and Harrington~\cite{HH} to Martin Ziegler).

\begin{lemma}\label{lem_ziegler}
   Let $\phi({\mr x}\,;{\gr z}),\psi({\mr x}\,;{\gr z}) \in L(A)$.
   Let ${\gr b}\in\U^{\gr z}$.
   Assume that $\phi({\mr x}\,;{\gr z})$ is stable and that $\phi({\mr x}\,;{\gr b})\vee\psi({\mr x}\,;{\gr b})$ is finitely satisfied in every $M\supseteq A$.
   Then $\phi({\mr x}\,;{\gr b})$ or $\psi({\mr x}\,;{\gr b})$ is finitely satisfied in every $M\supseteq A$.
\end{lemma} 

\begin{proof}
  Negate the theorem.
  Then there are two models containing $A$, the first omitting $\phi({\mr x}\,;{\gr b})$, the second omitting $\psi({\mr x}\,;{\gr b})$.
  It is easy to see that we can expand these models to two substructures $\U_0$ and $\U_1$ that are $A$-isomorphic to $\U$.
  Then $\phi(\U_0^{{\mr x}}\,;{\gr b})=\psi(\U_1^{{\mr x}}\,;{\gr b})=\varnothing$.

  Let $f_i:\U\to\U_i$ be the $A$-isomorphisms mentioned above. 
  Set $f_\varnothing=\id_\U$, then define inductively $f_{s\frown i}=f_i\circ f_s$, for every $s\in 2^{<\omega}$.
  We write $\U_s=f_s[\U]$ and ${\gr b_s}=f_s\,{\gr b}$.
  Then, we obtain

  \ceq{\#\hfill\phi(\U_{s\frown0}^{{\mr x}}\,;{\gr b_s})}{=}{\psi(\U_{s\frown0}^{{\mr x}}\,;{\gr b_s})\ \ =\ \ \varnothing}
  
  We prove that the branches of the tree $\<\phi({\mr x}\,;{\gr b_s})\, :\,  s\in2^{<\omega}\>$ are consistent. 
  By Theorem~\ref{thm_count_types}, this contradicts the stability of $\phi({\mr x}\,;{\gr z})$.
  Assume provisionally that there is a formula $\theta({\mr x})\in L(A)$ such that
  
  \ceq{\#\#\hfill\varnothing\ \ \neq\ \ \theta(\mrX)}{\subseteq}{\phi(\mrX\,;{\gr b})\cup\psi(\mrX\,;{\gr b})}
  
  Let ${\mr a}\in\theta(\U^{\mr x})$ be arbitrary.
  Let $s\in2^n$ be given.
  We prove that ${\mr a_s}=f_s{\mr a}$ witnesses the consistency of $\{\phi^{s_i}({\mr x}\,;{\gr b_{s\restriction i}})\, :\,i<n\}$.
  Clearly ${\mr a_s}\in\theta(\U_s^{\mr x})$, then, as $\U_s\preceq\U_{s\restriction i}$, we have that ${\mr a_s}\in\theta(\U_{s\restriction i}^{\mr x})$.
  We prove that $\phi^{s_i}({\mr a_s}\,;{\gr b_{s\restriction i}})$.
  When $s_i=0$, from \# we obtain $\U_{s\restriction(i+1)}^{\mr x}\subseteq\neg\phi(\U_{s\restriction(i+1)}^{{\mr x}}\,;{\gr b_{s\restriction i}})$ and $\phi^0({\mr a}\,;{\gr b_{s\restriction i}})$ follows.
  When $s_i=1$, from the second inclusion in \# we obtain $\U_{s\restriction(i+1)}^{{\mr x}}\subseteq\neg\psi(\U_{s\restriction(i+1)}^{{\mr x}}\,;{\gr b_{s\restriction i}})$.
  Therefore, from $\theta({\mr a})$ and \#\#, we obtain  $\U_{s\restriction(i+1)}^{{\mr x}}\subseteq\phi(\U_{s\restriction(i+1)}^{{\mr x}}\,;{\gr b_{s\restriction i}})$ and $\phi^1({\mr a_s}\,;{\gr b_{s\restriction i}})$ follows.

  We are left with proving that the provisional assumption is redundant.
  By Exercise~\ref{ex_almost_satisfied} there is a formula $\theta({\mr\bar x})\in L(A)$ such that

  \ceq{\hfill\theta({\mr\bar x})}{\imp}{\phi'({\mr\bar x}\,;{\gr b})\vee\psi'({\mr\bar x}\,;{\gr b})}

  where ${\mr\bar x}={\mr x_1},\dots,{\mr x_n}$ and 

  \ceq{\hfill\phi'({\mr\bar x}\,;{\gr b})}{=}{\bigvee_{i=1}^n\phi({\mr x_i}\,;{\gr b})}

  \ceq{\hfill\psi'({\mr\bar x}\,;{\gr b})}{=}{\bigvee_{i=1}^n\psi({\mr x_i}\,;{\gr b})}

  Note that $\phi'({\mr\bar x}\,;{\gr z})$ is a stable formula.
  Therefore we can apply what proved above to the formulas $\phi'({\mr\bar x}\,;{\gr b})$ and $\psi'({\mr\bar x}\,;{\gr b})$ and note that these formulas are satisfied in $M^{\mr\bar x}$ if and only if $\phi({\mr x}\,;{\gr b})$, respectively $\psi({\mr x}\,;{\gr b})$, are satisfied in $M^{\mr x}$.
\end{proof}

% \begin{theorem}
% The following are equivalent
% \begin{itemize}
% \item[1.] $T$ is stable
% \item[2.] $|S(A)|\le|A|$ for some infinite cardinal $\lambda$, and all sets $A$ of cardinality $\le\lambda$
% \item[3.] $|S(A)|\le|A|$ for every set $A$ such that $|L|<\cf(A)$.
% \end{itemize}
% \end{theorem}
% \begin{proof}
% \ssf{2}$\IMP$\ssf{1}.
% Suppose a formula $\phi({\mr x}\,;{\gr z})$ is unstable.
% Let $\<{\gr z_s}:s\in2^{<\lambda}\>$ be a sequence variables of length $|{\gr z}|$.
% Let $p({\gr z_s}:s\in2^{<\lambda})$ be the type that says that $\big\<{\gr z_s}:i<2^{<\lambda}\big\>$ witnesses a binary tree of height $\lambda$.
% As  $\phi({\mr x}\,;{\gr z})$ is unstable, $p$ is finitely consistent.
% As $\lambduse the fact that a$ is an arbitrary infinite cardinal, this contradicts \ssf{2}.

% \ssf{3}$\IMP$\ssf{2}.
% Trivial.

% \ssf{1}$\IMP$\ssf{3}.
% Proposition~\ref{thm_count_types} implies that $|S(A)|\le |A|^{|L|}$. Therefore, when $|L|<\cf(A)$, we obtain $|S(A)|\le |A|$.
% \end{proof}
\section{Symmetry and stationarity}\label{stationarity}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

% We say that $T$ is a \emph{stable theory\/} if every formula is stable.
% Most theorems in this section have a formulation that only requires the stability of some given formulas $\phi({\mr x}\,;{\gr z})\in L$.

Let \emph{$\Delta$\/} $\subseteq L_{{\mr x}\,{\gr z}}(\U)$.
We say that $\Delta$ is stable if all formulas in $\Delta$ are stable.
% When $|{\mr x}|=|{\gr z}|=\omega$ and $\Delta=L_{{\mr x}\,{\gr z}}$ the stability of $\Delta$ is tantamount to the stability of $T$.

The following corollary of Theorem~\ref{lem_ziegler} is of fundamental importance.
It implies, in particular the existence of Lascar invariant types.

\begin{corollary}\label{corol_stable_coheir_over_models}
  Let  $\Delta$ be stable.
  Let $q({\mr x})\subseteq L(\U)$ be finitely satisfiable in every $M\supseteq A$.
  Then there is a type $p({\mr x})\in S_\Delta(\U^{\gr z})$ such that $q({\mr x})\cup p({\mr x})$ is finitely satisfiable in every $M\supseteq A$.
\end{corollary}

\begin{proof}
  Let $p({\mr x})\subseteq \pmDelta(\U^{\gr z})$ be maximal such that $q({\mr x})\cup p({\mr x})$ is finitely satisfiable in every $M\supseteq A$.
  We prove that $p({\mr x})$ is complete.
  Suppose not than there are a conjunction $\alpha({\mr x})$ of formulas in $q({\mr x})$, a conjunction $\theta({\mr x}\,;{\gr b_1},\dots,{\gr b_n})$ of formulas in $p({\mr x})$, and a formula $\phi({\mr x}\,;{\gr b})$ for some $\phi({\mr x}\,;{\gr z})\in\Delta$ such that 

  \hfil$\alpha({\mr x})\wedge\theta({\mr x}\,;{\gr b_1},\dots,{\gr b_n})\wedge\phi({\mr x}\,;{\gr b})$ \ \ and\ \   $\alpha({\mr x})\wedge\theta({\mr x}\,;{\gr b_1},\dots,{\gr b_n})\wedge\neg\phi({\mr x}\,;{\gr b})$ 
 
  are not satisfied in every $M\supseteq A$.
  The disjunction of the two formulas is satisfied in every $M\supseteq A$ by the definition of $p({\mr x})$.
  Moreover the formulas obtained replacing ${\gr b},{\gr b_1},\dots,{\gr b_n}$ by ${\gr z},{\gr z_1},\dots,{\gr z_n}$ are stable.
  This contradicts Theorem~\ref{lem_ziegler}
\end{proof}

\begin{theorem}[ (Symmetry)]\label{thm_symmetry}
  Let $\phi({\mr x}\,;{\gr z})\in L(M)$ be stable.
  Let ${\mr a}\in\U^{\mr x}$ and ${\gr b}\in\U^{\gr z}$ be such that ${\mr a}\cnonfork_M{\gr b}$.
  Then\smallskip

  \ceq{\hfill\phi({\mr a}\,;{\gr b})}{\IMP}{\phi({\mr a}\,;M^{\gr z})\neq\varnothing.}
\end{theorem}

Note that, when $\Delta= L_{{\mr x}\,{\gr z}}(M)$, the theorem says

\ceq{\hfill{\mr a}\cnonfork_M{\gr b}}{\IMP}{{\gr b}\cnonfork_M{\mr a}.}


\vspace*{-\parskip}
\begin{proof}
  Assume $\phi({\mr a}\,;{\gr b})$.
  Let $\V\preceq\U$ be isomorphic to $\U$ over $M$ and such that ${\gr b}\in\V^{\gr z}$ and ${\mr a}\cnonfork_M\V$. Such $\V$ exists by Proposition~\ref{prop_saturate_heir}.
  By stability, there is $\psi({\gr z})\in L(\V)$ such that $\psi(\V^{\gr z})=\phi({\mr a},\V^{\gr z})$.
  Recall that by Lemma~\ref{lem_coheir_independence} (non-splitting) if ${\gr b'}\equiv_M{\gr b''}$ are in $\V$ then ${\gr b'}\equiv_{M,\kern.2ex{\mr a}}{\gr b''}$.
  Then $\psi(\V^{\gr z})$ is invariant under $\Aut(\V/M)$, so we can assume that $\psi({\gr z})\in L(M)$.
  Therefore $\psi({\gr z})$ is satisfied in $M$ and so is $\phi({\mr a},{\gr z})$.
\end{proof}

We deduce a version of Harrington's mysterious Lemma cf.~\cite{TZ}*{Lemma 8.3.4}.


\begin{corollary}\label{corol_harrington0}
  Let $\Delta$ be stable.
  Let ${\mr a}\in\U^{\mr x}$ and ${\gr b}\in\U^{\gr z}$. 
  Suppose there exist $\mrA\subseteq\U^{\mr x}$ and $\grB\subseteq\U^{\gr z}$ that are $\BDelta(M^{\gr z})$, respectively $\BDelta(M^{\mr x})$-definable and \smallskip

  \ceq{\ssf1.\hfill\phi({\mr a}\,;M^{\gr z})}{=}{\grB\cap M^{\gr z}}\smallskip

  \ceq{\ssf2.\hfill\phi(M^{\mr x};{\gr b})}{=}{\mrA\cap M^{\mr x}},\smallskip

  for some $\phi({\mr x}\,;{\gr z})\in\Delta$.
  Then ${\mr a}\in\mrA\ \iff\ {\gr b}\in\grB$.
  %
  % Let ${\mr a}\in\U^{\mr x}$ and ${\gr b}\in\U^{\gr z}$.
  % Finally, let $\theta({\mr x}),\psi({\gr z})\in L(M)$ be such that $\theta(M^{\mr x})=\phi(M^{\mr x};{\gr b})$ and $\psi(M^{\gr z})=\phi({\mr a}\,;M^{\gr z})$.
  % Such formulas exist by stability.
  % Then $\theta({\mr a})\iff\psi({\gr b})$.
\end{corollary}

\begin{proof}
  Note that we can assume ${\mr a}\cnonfork_M{\gr b}$.
  Then, from \ssf2 we obtain immediately

  \ceq{\ssf2$'$.\hfill\phi({\mr a};{\gr b})}{\iff}{{\mr a}\in\mrA}.

  The corollary follows if we can also show that

  \ceq{\ssf1$'$.\hfill\phi({\mr a}\,;{\gr b})}{\iff}{{\gr b}\in\grB}

  Negate \ssf1$'$.
  As the formula $\phi({\mr x}\,;{\gr z})\niff{\gr z}\in\grB$ is stable, from $\neg\ssf1'$ and Theorem~\ref{thm_symmetry}, we obtain that $\phi({\mr a}\,;{\gr b'})\niff{\gr b'}\in\grB$ for some ${\gr b'}\in M^{\gr z}$.
  But this contradicts \ssf1.
\end{proof}

The above corollary is usually applied in the following form. 

\begin{corollary}\label{corol_harrington1}
  Let $\phi({\mr x}\,;{\gr z})\in L$ be stable.
  Let $p({\mr x})\in S_\phi(\U^{\gr z})$ and $q({\gr z})\in S_{\phi^{\rm op}}(\U^{\mr x})$ be invariant over $M$.
  Then for every ${\mr a}\models p({\mr x}){\restriction}M$ and ${\gr b}\models q({\gr z}){\restriction}M$\smallskip
  
  \ceq{\hfill{\mr a}\in{\mr\D_{q,\phi^{\rm op}}}}{\iff}{{\gr b}\in{\gr\D_{p,\phi}}.}
\end{corollary}

Now we show that under the assumption of stability Lascar invariance reduces to a tamer form of invariance.

\begin{proposition}\label{prop_type_over_acl2}
  Let $\Delta$ be stable.
  Then for every $p({\mr x})\in S_\Delta(\U^{\gr z})$ the following are equivalent
  \begin{itemize}
  \item[1.] ${\gr\D_{p,\phi}}\in \acl^\eq\!A$ for every $\phi({\mr x}\,;{\gr z})\in\Delta$.
  \item[2.] $p({\mr x})$ is finitely satisfied in every $M\supseteq A$
  \item[3.] $p({\mr x})$ is Lascar invariant over $A$
  \item[4.] $p({\mr x})$ is invariant over $\acl^\eq\!A$.
  \end{itemize}
\end{proposition}
\begin{proof}
  \ssf2$\IMP$\ssf3$\IMP$\ssf1 and \ssf4$\IMP$\ssf1 are clear.

  \ssf{1}$\IMP$\ssf{2}
  Let $M\supseteq A$ be given.
  Let $\psi({\mr x})$ be a conjunction of formulas in $p({\mr x})$, we prove that $\phi({\mr x}\,;{\gr b})$ is satisfied in $M$.
  For simplicity we assume that $\psi({\mr x})$ and the form $\phi({\mr x}\,;{\gr b})$.
  The same argument extends easily because $\acl^\eq\!A$ is closed under Boolean combinations and Cartesian product.

  Pick ${\mr a}\in\U^{\mr x}$ such that $\phi({\mr a}\,;M^{\gr z})={\gr\D_{p,\phi}}\cap M^{\gr z}$ and ${\gr b}\cnonfork_M{\mr a}$.
  As ${\gr\D_{p,\phi}}\in M^\eq$, for every ${\gr b}\cnonfork_M{\mr a}$ we have $\phi({\mr a}\,;{\gr b})\iff{\gr b}\in{\gr\D_{p,\phi}}$.
  As ${\gr b}\in{\gr\D_{p,\phi}}$ is true, so is $\phi({\mr a}\,;{\gr b})$.
  By symmetry $\phi(M^{\mr x};{\gr b})\neq\varnothing$.
\end{proof}

The sets $\Delta\subseteq L_{{\mr x}\,{\gr z}}(\U)$ and $A\subseteq\U$ are implicit in the definition below.
A type $q({\mr x})\subseteq L(\U)$ is \emph{stationary\/} if it has a unique global extension $p({\mr x})\in S_\Delta(\U)$ that is Lascar invariant over $A$.
The following proposition says that in a stable theory with elimination of imaginaries types over algebraically closed sets are stationary.

% Finally, define \emph{$\GDelta(A)$\/} to be the set of formulas $\phi({\mr x})\in\BDelta(\U)$ that are invariant over $A$.
% Note that though these formulas are equivalent to formulas over $A$, they need not be in $\BDelta(A)$.
% In the literature these formulas are called \textit{generalized\/} $\Delta$-formulas.
% Note that when $A$ is a model $\GDelta(A)$-formulas are equivalent to $\BDelta(A)$-formulas.

\begin{theorem}[ (Stationarity)]\label{thm_stationarity}
  Let $\Delta$ be stable.
  Let $q({\mr x})\subseteq L(\U)$ be a type that is finitely satisfiable in every $M\supseteq A$ and decides all $\BDelta(\U^{\gr z})$-formulas that are Lascar invariant over $A$.
  Then there is a unique type $p({\mr x})\in S_\Delta(\U^{\gr z})$ finitely consistent with $q({\mr x})$ that is Lascar invariant over $A$.
\end{theorem}

\begin{proof}
  Existence follows from Corollary~\ref{corol_stable_coheir_over_models} and Proposition~\ref{prop_type_over_acl2}.
  To prove uniqueness, pick two types $p_i({\mr x})\in S_\Delta(\U^{\gr z})$, for $i=1,2$, that are finitely consistent with $q({\mr x})$ and Lascar invariant over $A$.
  It suffices to prove that ${\gr\D_{p_1,\phi}}={\gr\D_{p_2,\phi}}$ for every $\phi({\mr x}\,;{\gr z})\in\Delta$.
  Let ${\gr b}\in\U^{\gr z}$ and $\phi({\mr x}\,;{\gr z})\in\Delta$ be fixed but arbitrary.

  Let $M\supseteq A$.
  By stability there exists a type $t({\gr z})\in S_\phi(\U^{\mr x})$ that is invariant over $M$ and is finitely consistent with $\tp({\gr b}/M)$.
  By stability and invariance ${\gr\D_{p_i,\phi}}$ and ${\mr\D_{t,\phi^{\rm op}}}$ are in definable over $M$.
  % Let ${\gr b'}$ be such that ${\gr b}\equiv_M{\gr b'}\models t({\gr z}){\restriction}M$.
  Let ${\mr a_i}\models p_i({\mr x}){\restriction}M$.
  By Corollary~\ref{corol_harrington1}, ${\mr a_i}\in{\mr\D_{t,\phi^{\rm op}}}\iff{\gr b}\in{\gr\D_{p_i,\phi}}$.
  Note that the formula ${\mr x}\in{\mr\D_{t,\phi^{\rm op}}}$ is among those decided by $q({\mr x})$.
  Then ${\mr a_1}\in{\mr\D_{t,\phi^{\rm op}}}\iff{\mr a_2}\in{\mr\D_{t,\phi^{\rm op}}}$.
  Therefore ${\gr b}\in{\gr\D_{p_1,\phi}}\iff{\gr b}\in{\gr\D_{p_2,\phi}}$.
  % Finally, the theorem follows because ${\gr b}\equiv_{\acl^\eq\!A}{\gr b'}$.
\end{proof}

% If $p({\mr x})\in S(\U)$ is a global type, a \emph{canonical base\/} of $p({\mr x})$ is a definably closed set $\emph{$\Cb(p)$}\subseteq \U^\eq$ such that an automorphism $f\in\Aut(\U)$ fixes $p({\mr x})$ if and only if it fixes $\Cb(p)$ pointwise. When they exist, canonical bases are unique, see Exercise~\ref{ex_Cb}.
% Clearly, all definable types (Definition~\ref{def_defble_type}) have a canonical base, namely

% \ceq{\hfill\Cb(p)}{=}{{\dcl}^\eq\Big(\big\{{\gr\D_{p,\phi}}\ :\ \phi({\mr x}\,;{\gr z})\in L\big\}\Big).}

% Therefore, when $T$ is stable all global types have a canonical base.

% \begin{proposition}\label{prop_type_over_dcl} Let $T$ be stable and let $p({\mr x})\in S(\U)$ be Lascar invariant over $A$. Then for every formula $\phi({\mr x}\,;{\gr z})\in L$ the set ${\gr\D_{p,\phi}}$ belongs to $\dcl^\eq(A,c)$ for every $c\models p_{\restriction A}(x)$.
% \end{proposition}
% \begin{proof}
% Without loss of generality we can assume $p({\mr x})\in S(\U^\eq)$. 
% \end{proof}

% \begin{proposition}
%   ($T$ stable)
%   Let $p({\mr x})\in S(\U)$.
%   Then the following are equivalent
%   \begin{itemize}
%   \item[1.] $p({\mr x})\in S(\U)$ invariant over $\acl^\eq\!A$
%   \item[2.] $p({\mr x})$ is almost finitely satisfiable in $A$. 
%   \end{itemize}
% \end{proposition}
% \begin{proof}
%   (\ssf2$\IMP$\ssf1) As \ssf2 implies that $p({\mr x})$ is Lascar invariant over $A$, \ssf1 follows from Proposition~\ref{prop_type_over_acl2}

%   (\ssf1$\IMP$\ssf2) Let $M\supseteq A$. 
%   By Corollary~\ref{corol_stable_coheir_over_models}, there exists a global type $q({\mr x})$ that extends $p({\mr x})\restriction\acl^\eq\!A$ and is almost finitely satisfied in $A$.
%   As $q({\mr x})$ is Lascar invariant over $A$, by stationarity it coincides with $p({\mr x})$.
% \end{proof}

The following theorem presents a property of definability that seems to go in the opposite direction.
It has an application in the proof of Theorem~\ref{thm_thick_finsat}.

\begin{theorem}\label{thm_stability_definable_rovescio1}
  Let $\phi({\mr x}\,;{\gr z})$ be stable.
  Let $M$ and ${\gr b}\in\U^{\gr z}$ be arbitrary.
  Then, for some ${\gr b_i}\equiv_M{\gr b}$, where $i=1,\dots,n$, some positive Boolean combination of the sets $\phi(\U^{\mr x};{\gr b_i})$ is definable over $M$.
\end{theorem}

\begin{proof}
  Let $\V\preceq\U$ be isomorphic to $\U$ over $M$.
  By Theorem~\ref{thm_def_stable_formula} with $\V$ for $\U$ and the role of the two sorts reversed, there are  some  ${\gr b_i}\equiv_M{\gr b}$ in $\V$, such that $\phi(\V^{\mr x}\,;{\gr b})$ is a positive Boolean combination of the sets $\phi(\V^{\mr x}\,;{\gr b_i})$.
  Let $\theta(\V^{\mr x}\,;{\gr b_1},\dots,{\gr b_n})$ be such a Boolean combination.
  Now, by Proposition~\ref{prop_saturate_heir}, we can choose $\V$ such that ${\gr b}\cnonfork_M\V$.
  By non-splitting, i.e.\@ reasoning as in Theorem~\ref{thm_symmetry}, there is a formula $\psi({\mr x})\in L(M)$ such that $\psi(\V^{\mr x})=\phi(\V^{\mr x}\,;{\gr b})$.
  Finally, by elementarity, we obtain that $\psi(\U^{\mr x})=\theta(\U^{\mr x};{\gr b_1},\dots,{\gr b_n})$.
\end{proof}

A more general version of the theorem holds, but it requires a different proof.
It is not necessary in the following.

\begin{theorem}\label{thm_stability_definable_rovescio2}
  Let $\phi({\mr x}\,;{\gr z})\in L(\U)$ be stable.
  Let $A$ and ${\gr b}\in\U^{\gr z}$ be arbitrary.
  Then, for some ${\gr b_i}\equiv_{\acl^\eq\!A}{\gr b}$, where $i=1,\dots,n$, some positive Boolean combination of the sets $\phi(\U^{\mr x};{\gr b_i})$ is definable over $A$.
\end{theorem}

\begin{proof}
  Let $q({\gr z})=\tp({\gr b}/\acl^\eq\!A)$.
  By Corollary~\ref{corol_stable_coheir_over_models} there is a type $p({\gr z})\in S_\phi(\U)$ that is finitely consistent with $q({\gr z})$ and invariant over $\acl^\eq\!A$.
  By Theorem~\ref{thm_def_stable_formula}, with the role of the two sorts reversed, there are some ${\gr b_1},\dots,{\gr b_n}\models q({\gr z})$ such that ${\mr\D_{p,\phi^{\rm op}}}$ is equivalent to a positive Boolean combination of the sets $\phi(\U^{\mr x};{\gr b_i})$.
  Let $\theta(\U^{\mr x};{\gr b_1},\dots,{\gr b_n})$ be such a Boolean combination.
  As ${\mr\D_{p,\phi^{\rm op}}}\in\acl^\eq\!A$ by Proposition~\ref{prop_type_over_acl2}, this proves the theorem when $A=\acl^\eq\!A$.

  For the general case, reason as follows.
  Let 
  
  \ceq{\hfill\bigcup_{f\in\Aut(\U/A)} f{\mr\D_{p,\phi^{\rm op}}}}{=}{\bigvee_{f\in\Aut(\U/A)}\theta(\U^{\mr x};f{\gr b_1},\dots,f{\gr b_n}).}

  As ${\mr\D_{p,\phi^{\rm op}}}\in\acl^\eq\!A$, this is a finite union, respectively disjunction.
  The set on the l.h.s.\@ is invariant (hence definable) over $A$.
  The formula on the r.h.s.\@ is the required positive Boolean combination.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The action of the Lascar group on stable formulas}\label{Lascar_action}

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{10ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

\def\DLascar{L\kern-.6ex\raisebox{1.1ex}{\tiny$\Delta$}\kern-.1ex ascar}

We adopt the notation and terminology of Chapter~\ref{actions}.
The set $\Delta\subseteq L_{{\mr x}\,{\gr z}}$ is fixed and assumed to be stable.
The set $\grZ\subseteq\U^{\gr z}$ is arbitrary, while $\mrX$ will be specified in the context.
As in Chapter~\ref{actions}, \emph{$G$\/} is a subgroup of $\Aut(\UDelta)$.
We also write \emph{$H$\/} for $\Autf(\UDelta)$.
Therefore $H$-invariance is Lascar invariance over $\varnothing$ in the language $\LDelta$.
We stress that in this section $H$ is not required to be a subgroup of $G$.

% \ceq{\hfill\Psi}{=}{\big\{\theta({\gr z})\in\BDelta(\mrX)\ : \textrm{ with finite $G$-orbit}\big\}}

% Let $K=\Aut(\UDelta/\Psi)$, i.e.\@ the set of automorphisms that fix every $\Psi$-definable set.
% Clearly, $H\le K$.

% \begin{remark}\label{rem_type_over_acl2}
%   Let $\Delta$ be stable.
%   Reading Proposition~\ref{prop_type_over_acl2} in the language $\LDelta$, we obtain that $p({\mr x})$ is $H$-invariant if and only if for every $\phi({\mr x}\,;{\gr z})\in\Delta$ the sets ${\gr\D_{p,\phi}}$ have finite $G$-orbit.
%   By stability, the sets ${\gr\D_{p,\phi}}$ are $\BDelta(\mrX)$-definable.
%   Therefore if $p({\mr x})$ is $H$-invariant then it is also $K$-invariant (the converse is trivial).
% \end{remark}

% The following theorem consists of two parts. 
The following theorem shows that when $\Delta$ is stable Theorem~\ref{thm_coalesce} applies (however, note the requirement on $\mrX$).
% The second part is shows that in some cases $H$ can be replaced by $K$.

\begin{theorem}\label{thm_thick_finsat}
  Let $\Delta$ be stable.
  Let $\mrX=q(\U^{\mr x})$, where $q({\mr x})\subseteq\LDelta(\mrX,\grZ)$ be a type that is finitely satisfiable in every $\LDelta$-model (in particular $\mrX$ is $H$-invariant).
  Then for every $\mrD\in\BDelta(\grZ)$ the following are equivalent 
  \begin{itemize}
    \item[1.] $\mrD$ is $H$-thick
    \item[2.] $\mrD$ is $H$-wide.
  \end{itemize}\smallskip
\end{theorem}
\begin{proof}
  % Implications \ssf2$\IMP$\ssf1 and \ssf4$\IMP$\ssf3 are trivial.
  % Implications \ssf3$\IMP$\ssf1 and \ssf4$\IMP$\ssf3 hold because  $H\le K$.
  The implication \ssf2$\IMP$\ssf1 is trivial.
  We prove the converse.
  As Boolean combinations of stable formulas are stable, we can assume that $\mrD$ is defined by the formula $\phi({\mr x}\,;{\gr b})$ for some $\phi({\mr x}\,;{\gr z})\in\Delta$.

  It suffices to prove that $q({\mr x})\cup\{\phi({\mr x}\,;{\gr b})\}$ is finitely satisfied in every $\LDelta$-model $M$.
  Then from Corollary~\ref{corol_stable_coheir_over_models} we obtain a type $p({\mr x})\in S_\Delta(\grZ)$ containing $\phi({\mr x}\,;{\gr b})$ such that $q({\mr x})\cup p({\mr x})$ is finitely  satisfied in every $\LDelta$-model $M$. 
  As $p({\mr x})$ is $H$-thick, $\mrD$ is $H$-wide by Theorem~\ref{thm_syndetic_invariant2}.
  
  Let $M$ be any  $\LDelta$-model.
  By invariance we can assume that $q({\mr x})\subseteq\LDelta(M)$.
  Let $\psi({\mr x})$ be a conjunction of formulas in $q({\mr x})$.
  We can write $\phi({\mr x}\,;{\gr z})$ for $\psi({\mr x})\wedge\phi({\mr x}\,;{\gr z})$, which is also stable.
  Let $\theta({\mr x}\,;{\gr b_1},\dots,{\gr b_n})$ be the formula in the proof of Theorem~\ref{thm_stability_definable_rovescio1}.
  As it is equivalent to a formula in $\LDelta(M)$, by elementarity it is satisfiable in $M$.
  Hence so is $\phi({\mr x}\,;{\gr b_i})$ for some $i$.
  As ${\gr b_i}\equiv_M{\gr b}$, also $\phi({\mr x}\,;{\gr b})$ is satisfiable.
  % \ssf2$\IMP$\ssf4.
  % Assume \ssf2.
  % Then some $H$-invariant type $p({\mr x})\in S_\Delta(\grZ)$ entails ${\mr x}\in\mrD$.
  % By Remark~\ref{rem_type_over_acl2} $p({\mr x})$ is $K$-invariant.
  % Then $\mrD$ is $K$-wide.
\end{proof}

% \begin{proposition}\label{prop_stable_lanscape}
%   Let $\Delta\subseteq L_{{\mr x}\,{\gr z}}$ be stable.
%   Let $\mrX= q(\U^{\mr x})$ for some $q({\mr x})\subseteq L(\acl^\eq\!A)$.
%   Then the equivalent conditions of Theorem~\ref{thm_coalesce} are satisfied.
% \end{proposition}

% \begin{proof}
%   Let $\mrD$ be a $\BDelta(\U)$-definable set that is weakly $H$- thick.
%   We prove that $\mrD$ is $H$- thick.
%   Pick a finite $H\subseteq\Autf(\U/A)$ such that $\cup\,H\,\mrD$ is $H$- thick.
%   By Theorem~\ref{thm_thick_finsat}, the type $\{{\mr x}\in\cup\,H\,\mrD\}\cup q({\mr x})$ is finitely satisfiable in every $M\supseteq A$.
%   Then, by Corollary~\ref{corol_stable_coheir_over_models} there is a $H$- invariant type $p({\mr x})\in S_\Delta(\U)$ containing ${\mr x}\in\cup\,H\,\mrD$ and finitely consistent with $q({\mr x})$.
%   By completeness and invariance ${\mr x}\in\mrD$ is in $p({\mr x})$.
%   Then $\mrD$ is thick by Theorem~\ref{thm_syndetic_invariant}.
% \end{proof}

\begin{proposition}\label{prop_stable_syndeticiffthick}
  Let $\Delta$ be stable.
  Let $\mrX=q(\U^{\mr x})$, where $q({\mr x})\subseteq\LDelta(\mrX,\grZ)$ is a type that is finitely satisfiable in every $\LDelta$-model and decides all $H$-invariant $\BDelta(\grZ)$-formulas.
  % Assume that $H$ acts transitively on $\mrX$.
  Then for every $\mrD\in\BDelta(\grZ)$, the following are equivalent
  \begin{itemize}
    \item[1.] $\mrD$ is $H$-syndetic
    \item[2.] $\mrD$ is $H$-thick.
  \end{itemize}\smallskip
\end{proposition}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  By Theorems~\ref{thm_coalesce} and~\ref{thm_thick_finsat}.

  \ssf2$\IMP$\ssf1.
  Assume $\mrD$ is not $H$-syndetic.
  Then $\neg\mrD$ is $H$-thick.
  Assume for a contradiction that also $\mrD$ is $H$-thick.
  By Theorem~\ref{thm_thick_finsat} both $\mrD$ and $\neg\mrD$ are $H$-wide.
  Then by Theorem~\ref{thm_syndetic_invariant2} both ${\mr x}\in\mrD$ and ${\mr x}\notin\mrD$ extend to $H$-invariant global $\BDelta(\grZ)$-types.
  This contradicts stationarity of the type $q({\mr x})$, see Proposition~\ref{prop_type_over_acl2} and Theorem~\ref{thm_stationarity}.
\end{proof}

\begin{corollary}\label{corol_stable_syndetic}
  Let $\Delta$ be stable.
  Let $\mrX=q(\U^{\mr x})$, where $q({\mr x})\subseteq\LDelta(\mrX,\grZ)$ is a type that is finitely satisfiable in every $\LDelta$-model and decides all $H$-invariant $\BDelta(\grZ)$-formulas.
  Then for every $\mrD\in\BDelta(\grZ)$, either $\mrD$ or $\neg\mrD$ is $H$-syndetic.
\end{corollary}

\begin{proof}
  By Theorem~\ref{thm_stationarity} there is a type $p({\mr x})\in S_\Delta(\grZ)$ consistent with $q({\mr x})$ that is $H$-invariant and therefore thick.
  Hence, by Corollary~\ref{corol_def_mu}, $\mrD$ and $\neg\mrD$ are not both $H$-syndetic.
  If $\mrD$ is not $H$-syndetic then $\neg\mrD$ is $H$-thick and, by Proposition~\ref{prop_stable_syndeticiffthick}, $H$-syndetic.
\end{proof}

\begin{theorem}\label{thm_FER}
  Let $\Delta$ be stable.
  Let $\mrX=t(\U^{\mr x})$, where $t({\mr x})\in\LDelta\mbox{-}S(\varnothing)$.
  Define \smallskip
  
  \ceq{\hfill P}{=}{\big\{p({\mr x})\in S_\Delta(\grZ)\ :\ p({\mr x})\textrm{ is $H$-invariant}\big\}}. \smallskip
  
  Then the following hold
  \begin{itemize}
    \item [1.] $G$ acts transitively on $P$
    \item [2.] if $\Delta$ is finite, then $P$ is finite
    % \item [3.] there is a finite equivalence relation $\epsilon({\mr x}\,;{\mr y})\in\GDelta(A)$ such that for all $p_i,p_j\in P$ 
    
    % \ceq{\hfill p_i=p_j}{\IFF}{p_i({\mr x})\cup p_j({\mr y}) \textrm{ is consistent with }\epsilon({\mr x},{\mr y})}.
    % 
    \item [3.] let $E$ be as in Definition~\ref{def_G0}~--~then for every ${\mr a}\in\mrX$ there is a unique $p({\mr x})\in P$ that is consistent with $\big\{\epsilon({\mr x}\,;{\mr a})\ :\ \epsilon({\mr x}\,;{\mr y})\in E\big\}$.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1.
  Let $p_i({\mr x})$, for $i=1,2$, be two elements of $P$.
  Let $\Phi$ be as in Definition~\ref{def_G0}.
  Note that the formulas in $\Phi$ are exactly those that are $H$-invariant.
  Write $q_i({\mr x})$ for the set of $\Phi$-formulas that are consequence of $p_i({\mr x})$.
  Note that $G$ acts transitively on $\mrX$.
  Therefore, by the mentioned lemma, $f\,q_1({\mr x})=q_2({\mr x})$ for some $f\in G$.
  Then $f\,p_1({\mr x})$ is consistent with $q_2({\mr x})$.
  By stationarity $f\,p_1({\mr x})=p_2({\mr x})$.

  \ssf2.
  We may identify a type $p({\mr x})\in S_\Delta(\U)$ with the tuple $\<{\gr\D_{p,\phi}}:\phi({\mr x}\,;{\gr z})\in\Delta\>$.
  The $G$-orbit of $p({\mr x})$ corresponds to the $G$-orbit of $\<{\gr\D_{p,\phi}}:\phi({\mr x}\,;{\gr z})\in\Delta\>$.
  As $p({\mr x})\in P$ is $H$-invariant the sets ${\gr\D_{p,\phi}}$ have a finite $G$-orbit.
  If $\Delta$ is finite, also the orbit of $\<{\gr\D_{p,\phi}}:\phi({\mr x}\,;{\gr z})\in\Delta\>$ is finite, and so is the orbit of $p({\mr x})$.
  Therefore by \ssf1, $P$ is finite.

  \ssf3.
  Follows immediately from stationarity.
\end{proof}

\begin{theorem}\label{thm_Gsyndetic_thick}
  Let $\Delta$ be stable.
  Let $\mrX=t(\U^{\mr x})$, where $t({\mr x})\in\LDelta\mbox{-}S(\varnothing)$.
  Assume $G$ acts transitively on $\mrX$.
  Then for every $\mrD\in\BDelta(\grZ)$ the following are equivalent
  \begin{itemize}
    \item [1.] $\mrD$ is $G$-syndetic
    \item [2.] $\mrD$ is $H$-wide.
  \end{itemize}\smallskip
\end{theorem}

\begin{proof} 
  \ssf1$\IMP$\ssf2.
  By stability, there exist a type $p({\mr x})\in S_\Delta(\grZ)$ that is $H$-invariant.
  Then $\gamma_H({\mr x})$ is consistent and Proposition~\ref{prop_Gsyndetic_Hthick1} applies.
  
  \ssf2$\IMP$\ssf1.
  % Negate \ssf1.
  % Then $\neg\mrD$ is $G$-thick.
  By \ssf2, there is an $H$-invariant type $p({\mr x})\in S_\Delta(\grZ)$ consistent with ${\mr x}\in\mrD$.
  Let $q({\mr x})$ be the set of $\Phi$-formulas that are consequence of $p({\mr x})$, where $\Phi$ is as in Definition~\ref{def_G0}.
  Then $\mrD$ is $H$-wide relative to $q(\U^{\mr x})$ and, by Proposition~\ref{prop_stable_syndeticiffthick}, $H$-syndetic relative to $q(\U^{\mr x})$.
  For every $g\in G$ we also have that $g{\cdot}\mrD$ is $H$-syndetic relative to $g{\cdot}q(\U^{\mr x})$.
  Therefore $\mrD$ is also $H$-syndetic relative to $g{\cdot}q(\U^{\mr x})$.
  The $G$-orbit of $q(\U^{\mr x})$ has small cardinality and covers $\mrX$.
  Therefore there is a set $C\subseteq G$ of small cardinality such that $\cup\,C{\cdot}\mrD$ covers $t(\U^{\mr x})$.
  By compactness, we can take $C$ finite.
  % \ssf1$\IMP$\ssf2.
  % Let ${\gr g}$ be given.
  % By stability, there is a type $p({\mr x})\in L'\mbox{-}S(\grZ)$ that is invariant, and therefore definable, over $L'\mbox{-}\acl^\eq\varnothing$.
  % If $\phi({\mr x}\,;{\gr g})$ is $\grZ$-syndetic, $p({\mr x})\proves\phi({\mr x}\,;{\gr h}\,{\gr g})$ for some ${\gr h}\in\grZ$.
  % Then $\phi({\mr x}\,;{\gr g})\in{\gr h^{-1}}p$.
  % We claim that ${\gr h^{-1}}p({\mr x})$ is also definable over $L'\mbox{-}\acl^\eq\varnothing$.
  % Indeed, it suffices to note that ${\gr\D_{{h^{-1}}p,\phi}}={\gr h^{-1}}\,{\gr\D_{p,\phi}}$ and that if ${\gr\D_{p,\phi}}\in L'\mbox{-}\acl^\eq\varnothing$ then also ${\gr h^{-1}}\,{\gr\D_{p,\phi}}\in L'\mbox{-}\acl^\eq\varnothing$.
  % Now read ${\gr h^{-1}}p({\mr x})$ as a type $q({\mr x})\in S_\Delta(\grZ)$ in the natural way.
  % Note that $\phi({\mr x}\,;{\gr g})\in q$ and that $q({\mr x})$ is definable over $\acl^\eq\varnothing$ since this is a superset of $L'\mbox{-}\acl^\eq\varnothing$.
  % This shows that there is $H$-invariant type containing $\phi({\mr x}\,;{\gr g})$.
  % As the finite satisfiability in $\mrX$ is evident, \ssf1 follows.
  % \ssf3$\IMP$\ssf1.
  % Let ${\gr g}$ be such that $\phi({\mr x}\,;{\gr g})$ is not $H$-thick.
  % Then $\neg\phi({\mr x}\,;{\gr g})$ is $H$-syndetic.
  % Then it is also  $\grZ$-syndetic.
  % The $\grZ$-syndeticity of $\neg\phi({\mr x}\,;{\gr 1})$ follows.
\end{proof}

Finally we prove that $Q=P$, where $Q$ is as defined in Definition~\ref{def_Q} and $P$ is as in Theorem~\ref{thm_Gsyndetic_thick}.
In particular $H=\Stab(P)=\Stab(Q)$.

\begin{theorem}\label{thm_P=Q}
  Let $\Delta$ be stable.
  Let $\mrX=t(\U^{\mr x})$, where $t({\mr x})\in\LDelta\mbox{-}S(\varnothing)$.  
  Then $Q=P$.%there is a one-to-one correspondence between $Q$ and $P$ given by the relation $q({\mr x})\cup p({\mr x})$ is consistent.
\end{theorem}

\begin{proof}
  Let $p({\mr x})\in P$.
  All formulas in $p({\mr x})$ are $H$-wide, and therefore $G$-syndetic.
  As $p({\mr x})$ complete, $p({\mr x})\in Q$.
  Let $q({\mr x})\in Q$ be given.
  By Theorem~\ref{thm_FER}, every formula in $q({\mr x})$ is $H$-wide, then $q({\mr x})$ is consistent with some $p({\mr x})\in P$.
  By completeness $q({\mr x})=p({\mr x})$.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Stable groups}\label{stable_groups}

We assume the hypotheses and the notation of Section~\ref{definablegroups}.
Recall that $\Psi\subseteq L_{\mr x}(A)$ is some fixed set of formulas and \emph{$\Delta$\/} contains the formulas $\phi({\mr x}\,;{\gr z})$ of the form  $\psi({\gr z^{-1}}\!\cdot{\mr x})$ for $\psi({\mr x})\in\Psi$.
In this section \emph{$G$\/} = $\Aut(\UDelta)$ and \emph{$H$\/} = $\Autf(\UDelta)$.
% Recall that $G=\Aut(\UDelta)$ has two relevant normal subgroups $H=\Autf(\UDelta)$ and $\grZ$.
We will always assume that $\grZ$ acts transitively. 
Then, as $\grZ\le\Aut(\UDelta)$, all elements of $\mrX$ have the same $\LDelta$-type.

\begin{theorem}
  Let $\Delta$ be stable.
  Assume that $\grZ$ acts transitively.
  Then for every $\mrD\in\BDelta(\grZ)$ the following are equivalent
  \begin{itemize}
  \item [1.] $\mrD$ is $\grZ$-syndetic
  \item [2.] $\mrD$ is $G$-syndetic
  \item [3.] $\mrD$ is $H$-wide.
  \end{itemize}\smallskip
\end{theorem}

\begin{proof} 
  \ssf1$\IMP$\ssf2.
  Because $\grZ$-syndetic implies $G$-syndetic.
  
  \ssf2$\IMP$\ssf3.
  By Theorem~\ref{thm_Gsyndetic_thick}, which applies because, by transitivity, the elements of $\mrX$ have the same $\LDelta$-type.

  \ssf3$\IMP$\ssf1.
  After replacing $G$ by $\grZ$, we may repeat the proof of \ssf2$\IMP$\ssf1 of Theorem~\ref{thm_Gsyndetic_thick}.
  %
  % \ssf1$\IMP$\ssf2.
  % Let ${\gr g}$ be given.
  % By stability, there is a type $p({\mr x})\in L'\mbox{-}S(\grZ)$ that is invariant, and therefore definable, over $L'\mbox{-}\acl^\eq\varnothing$.
  % If $\phi({\mr x}\,;{\gr g})$ is $\grZ$-syndetic, $p({\mr x})\proves\phi({\mr x}\,;{\gr h}\,{\gr g})$ for some ${\gr h}\in\grZ$.
  % Then $\phi({\mr x}\,;{\gr g})\in{\gr h^{-1}}p$.
  % We claim that ${\gr h^{-1}}p({\mr x})$ is also definable over $L'\mbox{-}\acl^\eq\varnothing$.
  % Indeed, it suffices to note that ${\gr\D_{{h^{-1}}p,\phi}}={\gr h^{-1}}\,{\gr\D_{p,\phi}}$ and that if ${\gr\D_{p,\phi}}\in L'\mbox{-}\acl^\eq\varnothing$ then also ${\gr h^{-1}}\,{\gr\D_{p,\phi}}\in L'\mbox{-}\acl^\eq\varnothing$.
  % Now read ${\gr h^{-1}}p({\mr x})$ as a type $q({\mr x})\in S_\Delta(\grZ)$ in the natural way.
  % Note that $\phi({\mr x}\,;{\gr g})\in q$ and that $q({\mr x})$ is definable over $\acl^\eq\varnothing$ since this is a superset of $L'\mbox{-}\acl^\eq\varnothing$.
  % This shows that there is $H$-invariant type containing $\phi({\mr x}\,;{\gr g})$.
  % As the finite satisfiability in $\mrX$ is evident, \ssf1 follows.
  % \ssf3$\IMP$\ssf1.
  % Let ${\gr g}$ be such that $\phi({\mr x}\,;{\gr g})$ is not $H$-thick.
  % Then $\neg\phi({\mr x}\,;{\gr g})$ is $H$-syndetic.
  % Then it is also  $\grZ$-syndetic.
  % The $\grZ$-syndeticity of $\neg\phi({\mr x}\,;{\gr 1})$ follows.
\end{proof}

Corollary~\ref{corol_stable_syndetic} becomes the following.,

\begin{corollary}\label{corol_syndeticornotsyndetic}
  Let $\Delta$ be stable.
  Assume that $\grZ$ acts transitively.
  Let $\mrD\in\BDelta(\grZ)$.
  Then $\mrD$ or $\neg\mrD$ is $H$-syndetic.
\end{corollary}

% \begin{proof}
%    The transitivity of the action implies that 
% \end{proof}

\begin{theorem}\label{thm_FER2}
  Let $\Delta$ be stable.
  Assume that $\grZ$ acts transitively.
  Define \smallskip
  
  \ceq{\hfill P}{=}{\big\{p({\mr x})\in S_\Delta(\grZ)\ :\ p({\mr x})\textrm{ is $H$-invariant}\big\}}. \smallskip
  
  Then the following hold
  \begin{itemize}
    \item [1.] $\grZ$ acts transitively on $P$
    \item [2.] if $\Delta$ is finite, then $P$ is finite
    % \item [3.] there is a finite equivalence relation $\epsilon({\mr x}\,;{\mr y})\in\GDelta(A)$ such that for all $p_i,p_j\in P$ 
    
    % \ceq{\hfill p_i=p_j}{\IFF}{p_i({\mr x})\cup p_j({\mr y}) \textrm{ is consistent with }\epsilon({\mr x},{\mr y})}.
    % 
    \item [3.] let $E$ be as in Definition~\ref{def_G0}~--~then for every ${\mr a}\in\mrX$ there is a unique $p({\mr x})\in P$ that is consistent with $\big\{\epsilon({\mr x}\,;{\mr a})\ :\ \epsilon({\mr x}\,;{\mr y})\in E\big\}$.
  \end{itemize}
\end{theorem}

\begin{proposition}
  Let $\Delta$ be stable.
  Assume that the action of $\grZ$ is transitive.
  Then every $\grZ$-syndetic type $q({\mr x})\in S_\Delta(\grZ)$ is fixed by any ${\gr g}\in\gr\Z^0$.
\end{proposition}

\begin{proof}
  We can assume that $\Delta$ is finite.
\end{proof}

The stabilizer of the type $q({\mr x})\in S_\Delta(\grZ)$ is the subgroup $\{{\gr h}\in\grZ\ :\ q({\mr x})={\gr h}{\cdot}q({\mr x})\}$.
Which we can write also as $\{{\gr h}\in\grZ\ :\ {\gr\D_{q,\phi}}={\gr h}{\cdot}{\gr\D_{q,\phi}},\textrm{ for every }\phi({\mr x}\,;{\gr z})\in\Delta\}$.
When $\Delta$ is stable, it is a $\BDelta(\mrX)$-type-definable set (definable, when $\Delta$ is finite).

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{5ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}
\begin{theorem}\label{thm_Z0_stable}
  Let $\Delta$ be stable.
  Assume that $\mrX=\grZ$.
  Then\smallskip
  
  \ceq{\hfill{\gr\Z^0}}{=}{\big\{{\gr g}\in\grZ\ :\ \mrD\cap{\gr g}{\cdot}\mrD\neq\varnothing\textrm{ for every }\LDelta(\grZ)\textrm{-definable }\grZ\textrm{-syndetic set }\mrD\big\}}.
  
\end{theorem}

\begin{proof}  
  By Proposition~\ref{prop_G0_inclusione2} and Theorem~\ref{thm_P=Q}.
\end{proof}

\begin{exercise}
  Let $\Delta\subseteq L_{{\mr x}\,{\gr z}}$ be stable.
  Write $H$ for $\Autf(\UDelta)$.
  Assume that the action of $\grZ$ is regular.
  Prove that $\big\<\bigcup_{{\gr g}\in\grZ}({\gr g})_H^{-1}\!\cdot({\gr g})_H\big\>$ contains the set on the r.h.s.\@ in Theorem~\ref{thm_Z0_stable} and that it has finite index in $\grZ$.
\end{exercise}

% \begin{theorem}
%   Let $\Delta\subseteq L_{{\mr x}\,{\gr z}}$ be stable.
%   Write $H$ for $\LDelta\mbox{-}\Autf(\varnothing)$.
%   Assume that the action of $\grZ$ is regular.
%   Then
  
%   \ceq{\hfill{\gr\Z^0}}{=}{\Big\<\bigcup_{{\gr g}\in\grZ}({\gr g})_H^{-1}\!\cdot({\gr g})_H\Big\>}.
  
% \end{theorem}

% \begin{proof}
%   By Theorem~\ref{thm_Gsyndetic_thick}  

%   \ceq{\hfill{\gr\Z^0}}{\subseteq}{\big\{{\gr g}\in\grZ\ :\ \mrD\cap{\gr g}{\cdot}\mrD\neq\varnothing\textrm{ for every }\BDelta(\grZ)\textrm{-definable }H\textrm{-thick set }\mrD\big\}}

%   and, by Proposition~\ref{prop_stabilizer1} 
  
%   \ceq{}{\subseteq}{\Big\<\bigcup_{{\gr g}\in\grZ}({\gr g})_H^{-1}\!\cdot({\gr g})_H\Big\>}.

%   For the converse inclusion it suffices to prove that $\big\<\bigcup_{{\gr g}\in\grZ}({\gr g})_H^{-1}\!\cdot({\gr g})_H\big\>$ has finite index in $\grZ$.
%   As the action of $\grZ\le G$ on itself is transitive, ${\gr z}={\gr z}$ is a complete $\LDelta$-type over $\varnothing$.
%   Then, by Theorem~\ref{thm_FER}, there are finitely many $H$-orbits in $\grZ$.
%   If ${\gr h}$ and ${\gr k}$ are in the same $H$-orbit then ${\gr h^{-1}}{\cdot}{\gr k}\in\big\<\bigcup_{{\gr g}\in\grZ}({\gr g})_H^{-1}\!\cdot({\gr g})_H\big\>$, and therefore they are in the same coset.
% \end{proof}

% Define 

% \ceq{\hfill\Stab(\grD)}{=}{\big\{g\in G\ :\ g\cdot\grD=\grD\big\}}

% \ceq{\hfill\Stab(p)}{=}{\bigcap_{\phi\in\Delta}\Stab_G(\gr\D_{p,\phi})}

% \begin{proposition}
%   Let $\Delta\subseteq L_{{\mr x}\,{\gr z}}$ be stable.
%   $\grZ$ acts transitively on the set of 
% \end{proposition}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Stable theories}
\label{stable_theories}
 We say that $T$ is a \emph{stable theory\/} if $\Delta=L_{{\mr x}\,{\gr z}}$, where $|{\mr x}|=|{\gr z}|=\omega$, is stable.

\begin{corollary}\label{corol_Ltype_Shtype}
  ($T$ stable)
  The following are equivalent\smallskip
  \begin{itemize}
  \item[1.] ${\mr a}\equivL_A{\mr b}$, see Definition~\ref{def_Lascar_type}\smallskip
  \item[2.] ${\mr a}\equivSh_A{\mr b}$, see Definition~\ref{def_Sh_strong_type}\smallskip
  \end{itemize}
  \end{corollary}
  \begin{proof}\ssf{1}$\IMP$\ssf{2}.
    This is left as an exercise to the reader~--~stability is not required.
  
    \ssf{2}$\IMP$\ssf{1}.
    Assume \ssf2 which, by Proposition~\ref{prop_Shelah_strong_types}, is equivalent to ${\mr a}\equiv_{\acl^\eq\!A}{\mr b}$.
    Write $q({\mr x})$ for $\tp({\mr a}/{\acl}^\eq\!A)=\tp({\mr b}/{\acl}^\eq\!A)$. Let $p({\mr x})\in S(\U^\eq)$ be the unique global type that is invariant over $\acl^\eq\!A$ and extends $q({\mr x})$ which we obtain from Theorem~\ref{thm_stationarity}.
    Let ${\mr\bar c}=\<{\mr c_i}:i<\omega\>$ be such that ${\mr c_i}\models p({\mr x}){\restriction}\acl^\eq\!A,\,{\mr a},\,{\mr b},\,{\mr c_{\restriction i}}$.
    Then ${\mr a},{\mr\bar c}$ and ${\mr b},{\mr\bar c}$ are $A$-indiscernible sequences, which proves \ssf{1}, see Exercise~\ref{ex_Lstp_indiscernibles}.
  \end{proof}
  

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{15ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

\begin{theorem}[ (Pierre Simon)]
  If every formula $\phi(x\,;y)\in L(\U)$, where $|x|=|y|=1$, is stable then $T$ is stable.
\end{theorem}

\begin{proof}
  Suppose $\phi(x\,;y,z)\in L(\U)$ is not stable.
  We prove that there is a formula $\psi(x\,;y)\in L(\U)$ that is not stable.
  Let $\<a_i\,;b_i,c_i\ :\ i\in\QQ\>$ is a sequence of indiscernibles such that 

  \ceq{\hfill i< j}{\IFF}{\phi(a_i\,;b_j,c_j)}\hfill for all $i,j\in\QQ$.

  Let $\QQ^*=\QQ\sm\{0\}$.
  Assume first that the sequence $\<a_i\ :\ i\in\QQ^*\>$ is indiscernible over $c_0$.
  Then for every $k\in\QQ^*$ the type below is consistent

  \ceq{\hfill p_k(y)}{=}{\{\phi(a_i\;y,c_0)\iff i<k\ \ :\ i\in\QQ^*\sm\{k\}\}.}

  In fact, by indiscernibility, $b_0$ witnesses the consistency of all finite subsets of $p_k(y)$.
  Let $b'_k\models p_k(y)$.
  Then

  \ceq{\hfill i< k}{\IFF}{\phi(a_i\,;b'_k,c_0)}\hfill for all $i,j\in\QQ^*, i\neq j$

  From this the instability of $\psi(x\,;y)=\phi(x\,;y,c_0)$ follows easily.

  Now, assume instead that $\<a_i\ :\ i\in\QQ^*\>$ is not indiscernible over $c_0$.
  Note that the sequences $\<a_i\ :\ i<0\>$ and $\<a_i\ :\ i>0\>$ are mutually indiscernible over $c_0$.
  Then there is a maximal $n$ such that

  \ceq{\hfill a_{\restriction\{-1,\dots,-n\}}}{\equiv_{c_0}}{a_{\restriction\{1,\dots,n\}}.}

  Let $A=a\restriction\{\pm1,\dots,\pm n\}$.
  By maximality, $a_i\nequiv_{c_0,A}a_j$ for every $-1<i<0<j<1$.
  Let $\psi(x\;y)$ be a formula such that $\psi(a_i\,;c_0)$ and $\neg\psi(a_j\,;c_0)$.
  We claim that for every $k\in(-1,0)\cup(0,1)$ the type below is consistent

  \ceq{\hfill q_k(z)}{=}{\{\psi(a_i\;y)\iff i<k\ \ :\ i\in (-1,0)\cup(0,1)\}.}

  In fact as $\<a_i\ :\ i\in(-1,0)\cup(0,1)\>$ is indiscernible over $A$, all finite subsets of $q_k(z)$ are realized by $c_0$.
  Finally let $c'_k\models p_k(z)$.
  Then $\<a_i,c'_i\ :\ i\in(-1,0)\cup(0,1)\>$ witness the instability of $\psi(x\;z)$.
\end{proof}

\begin{exercise}
  Prove that if every formula $\phi(x\,;z)\in L$, where $|x|=1$, is stable then $T$ is stable.
\end{exercise}

\begin{exercise}
  A sequence $\<a_i:i<\omega\>$ is totally indiscernible if $a_1,\dots,a_n\equiv a_{i_1},\dots,a_{i_n}$ for every distinct $i_1,\dots,i_n$.
  Prove that the following are equivalent
  \begin{itemize}
  \item[1.] $T$ is stable
  \item[2.] every indiscernible sequence is totally indiscernible.
  \end{itemize}
\end{exercise}

\begin{exercise}\label{ex_stable_orderproperty}
Prove that the following are equivalent
\begin{itemize}
\item[1.] $T$ is unstable
\item[2.] there is an infinite set $A\subseteq\U^n$ and a formula  $\psi(x\,;y)$, with $|x|=|y|=n$ such that $A$ is linearly ordered by the relation $a<b\iff\psi(a\,;b)$.
\end{itemize}
\end{exercise}

\begin{exercise}
Prove that strongly minimal theories are stable.
\end{exercise}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notes and references}
\begin{biblist}[]\normalsize
\bib{CS}{article}{
  author={Chernikov, Artem},
  author={Simon, Pierre},
  title={Externally definable sets and dependent pairs},
  note={\href{https://arxiv.org/abs/1007.4468}{ArXiv:1007.4468}},
  journal={Israel J. Math.},
  volume={194},
  date={2013},
  number={1},
  pages={409--425},
  %note={},
  %issn={0021-2172},
  %doi={10.1007/s11856-012-0061-9},
}\smallskip
  \bib{HH}{article}{
   author={Harnik, Victor},
   author={Harrington, Leo},
   title={Fundamentals of forking},
   journal={Ann. Pure Appl. Logic},
   volume={26},
   date={1984},
   number={3},
   pages={245--286},
  %  issn={0168-0072},
  %  review={\MR{0747686}},
  %  doi={10.1016/0168-0072(84)90005-8},
}\smallskip
\bib{TZ}{book}{
  author={Tent, Katrin},
  author={Ziegler, Martin},
  title={A course in model theory},
  series={Lecture Notes in Logic},
  volume={40},
  publisher={Association for Symbolic Logic, Cambridge University Press},
  date={2012},
  pages={x+248},
  %isbn={978-0-521-76324-0},
  %doi={10.1017/CBO9781139015417},
}\smallskip
\bib{S}{article}{
  author={Simon, Pierre},
  title={A note on stability and NIP in one variable},
  note={\href{https://arxiv.org/abs/2103.15799}{ArXiv:2103.15799}},
  date={2021},
  %note={},
  %issn={0021-2172},
  %doi={10.1007/s11856-012-0061-9},
}\smallskip
\end{biblist}