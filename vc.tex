% !TEX root = creche.tex
\chapter{Vapnik-Chervonenkis theory}
\label{vc}


\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
Chapter under revision.

\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

In this chapter we fix a signature $L$, a complete theory $T$ without finite models, and a saturated model $\U$ of inaccessible cardinality $\kappa>|L|$.
The notation and implicit assumptions are as in Section~\ref{monster}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Vapnik-Chervonenkis dimension}
\label{VCdim}

\def\ceq#1#2#3{\parbox{25ex}{$\displaystyle #1$}\medrel{#2}$\displaystyle  #3$}

We say that the formula $\phi({\mr x}\,;{\gr z})\in L$ has \emph{Vapnik-Chervonenkis dimension $n$\/} if this is the largest finite cardinatity of a set ${\gr B}\subseteq\U^{\gr z}$ such that $|S_\phi({\gr B})|=2^n$. If such $n$ does not exist, we say that we say that  $\phi({\mr x}\,;{\gr z})$ has \emph{infinite VC-dimension}. 

Note that the condition $|S_\phi({\gr B})|=2^n$ is equivalent to saying that every subset of ${\gr B}$ is the trace of some definable set of sort $\phi({\mr x}\,;{\gr z})$.

For instance, the formula ${\mr x_1}<{\gr z}<{\mr x_2}$ in $T_{\rm dlo}$ has VC-dimension $2$.

Arguing by compactness we obtain the following proposition whose proof is left as an exercise for the reader.

\begin{proposition}
The following are equivalent 
\begin{itemize}
\item[1.] $\phi({\mr x}\,;{\gr z})\in L$ has finite VC-dimension
\item[2.] there is no infinite set ${\gr B}\subseteq\U^{\gr z}$ such that every subset of ${\gr B}$ is the trace of some definable set of sort $\phi({\mr x}\,;{\gr z})$.
\end{itemize}
\end{proposition}

From the proposition above and Proposition~\ref{thm_count_types} below it follows that all stable formulas have finite VC-dimension.

We say that the sequence of sentences $\<\phi_i:i<\omega\>$ \emph{converges\/} if the truth value of $\phi_i$ is eventually constant.

\begin{lemma}\label{lem_altrank}
The following are equivalent
\begin{itemize}
\item[1.] $\phi({\mr x}\,;{\gr z})\in L$ has finite VC-dimension
\item[2.] $\<\phi({\mr a}\,;{\gr b_i}):i<\omega\>$ converges for any ${\mr a}$ and any indiscernible sequence $\<{\gr b_i}:i<\omega\>$.
\end{itemize}
\end{lemma}

\begin{proof}
\ssf{1}$\IMP$\ssf{2} Negate \ssf{2} and let $n<\omega$. It suffices to prove that for every $I\subseteq n$ the formula $\psi_{I}({\mr x}\,;{\gr b_0},\dots,{\gr b_{n-1}} )$ that says 

\ceq{\hfill\phi({\mr x}\,;{\gr b_i})}{\IFF}{i\in I}

is consistent. If there is a ${\mr a}$ such that the truth value of $\<\phi({\mr a}\,;{\gr b_i}):i<\omega\>$ oscillates at least $n$ times, then we can find $k_0<\dots<k_{n-1}$ such that 

\ceq{\hfill \phi({\mr a}\,;{\gr b_{k_i}})}{\IFF}{i\in I.}

Then the formula $\psi_{I}({\mr x}\,;{\gr b_{k_0}},\dots,{\gr b_{k_{n-1}}})$ is consistent.
Therefore, by indiscernibility, also the formula  $\psi_{I}({\mr x}\,;{\gr b_0},\dots,{\gr b_{n-1}})$ is consistent.

\ssf{2}$\IMP$\ssf{1}
Negate \ssf{1} and let  $\<{\gr c_i}:i<\omega\>$ be an infinite sequence that is shattered by $\phi({\mr x}\,;{\gr z})$.
Let  $\<{\gr b_i}:i<\omega\>$ be an indiscernible sequence that models the EM-type of $\<{\gr c_i}:i<\omega\>$. Then $\<{\gr b_i}:i<\omega\>$ satisfies $\E{\mr x}\,\psi_{I\restriction n}({\mr x}\,;{\gr z_0},\dots,{\gr z_{n-1}})$ for all $n$. 
Let $I\subseteq\omega$ be the set of even integers.
By compactness there is a ${\mr a}$ such that

\ceq{\hfill\phi({\mr a}\,;{\gr b_i})}{\IFF}{i\in I}.

This proves $\neg$\ssf{2}.
\end{proof}

In the next section we need the following corollary.

\begin{corollary}\label{corol_altrank}
If $\grC\subseteq\U^{\gr z}$ is a set approximable by a formula with finite VC-dimension, then $\<{\gr b_i}\in\grC:i<\omega\>$ converges for any indiscernible sequence $\<{\gr b_i}:i<\omega\>$.
\end{corollary}

% We prove that if $\phi({\mr x}\,;{\gr z})$ has finite VC-dimension than also  $\phi({\mr x}\,;{\gr z})^*$ has finite VC-dimension. Note however that the dimension may increase exponentially.

% \begin{theorem}
%   .........
% \end{theorem}

% \begin{theorem}
%   If $\phi()$ has VC-dimension $k$ then for every $A$ of cardinality $\le n$
  
%   \ceq{\hfill\big|S_\phi(A)\big|}{\le}{\sum_{i=0}^k{n \choose i}} 

%   hence $\le e\cdot n^k$, where $e$ is Euler's constant.
% \end{theorem}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Honest definitions}
\label{honest}

In this section we present a beautiful theorem by Chernikov and Simon and their alternative proof of a famous quantifier elimination result by Shelah. 

We write \emph{$\neg^n$\/} for $\neg\!\stackrel{n\ \rm times}{\dots\dots\dots}\!\neg$.
We abbreviate $\neg^n(\cdot\in\cdot)$ as \emph{$\notin^n$}.

Saturated sets have been defined in Definition~\ref{def_ins_sat}. 

\begin{lemma}\label{lem_honest}
Let $\grC$ be saturated set approximable by a formula with finite VC-dimension and let $A$ be a set of parameters.
Then every global $A$-invariant type $p({\gr z})$ contains a formula $\psi({\gr z})$ such that either $\psi(\U^{\gr z})\subseteq\grC$ or $\psi(\U^{\gr z})\subseteq\neg\grC$.
Moreover, we can require that $\psi({\gr z})\in L(N)$, for any sufficiently saturated model $N$.
\end{lemma}

\begin{proof}
  By Corollary~\ref{corol_altrank}, there is no infinite sequence $\<{\gr b_i}:i<\omega\>$

\ceq{\hfill {\gr b_i}}{\models}{p_{A,\,{\gr b\restriction i}}({\gr z})\ \cup\ \{{\gr z}\notin^i\grC\}}

Let $n$ be the largest integer such that there is a sequence $\<{\gr b_i}:i<n\>$ that satisfies the condition above. Then

\ceq{\hfill p_{A,\,{\gr b\restriction n}}({\gr z})}{\imp}{{\gr z}\notin^{n+1}\grC}

and the first claim of the lemma follows by compactness. 

As for the second claim note that we can pick ${\gr b_i}\in N^{\gr z}$ as soon as $A\subseteq N$ and $\<N,\grC\>$ is $|A|^+$-saturated.
\end{proof}

\begin{corollary}\label{corol_honest}
  Let $\grC$ be a set approximable by a formula with finite VC-dimension and let $A$ be a set of parameters.
  Then there is a definable set $\grD\supseteq A^{\gr z}$ such that $\grD\cap\grC$ is definable.
  In particular, $\grC$ is approximable from below.
\end{corollary}

\begin{proof}
  Let $M$ be a model containing $A$.
  Let $c$ enumerate some $|M|^+$-saturated model containing $M$.
  For every ${\gr b}\cnonfork_Mc$ the type $\tp({\gr b}/c)$ extends to a global coheir over $M$. 
  By the lemma above, there is a formula $\psi_{\gr b}({\gr z})\in\tp({\gr b}/c)$ such that either $\psi_{\gr b}(\U^{\gr z})\subseteq\grC$ or $\psi_{\gr b}(\U^{\gr z})\subseteq\neg\grC$, depending on whether ${\gr b}\in\grC$ or ${\gr b}\notin\grC$.
  Hence

  \ceq{\hfill {\gr z}\cnonfork_Mc}{\imp}{\bigvee\Big\{\psi_{\gr b}({\gr z})\ :\ {\gr b}\cnonfork_Mc\Big\}.}

  By compactness,
  
  \ceq{\hfill {\gr z}\cnonfork_Mc}{\imp}{\bigvee^n_{i=1}\psi_{\gr b_i}({\gr z}).}

  Again by compactness, there is a formula $\phi({\gr z})$ such that 
  
  \ceq{\hfill \phi({\gr z})}{\imp}{\bigvee^n_{i=1}\psi_{\gr b_i}({\gr z}).}

  Let $\grD=\phi(\U^{\gr z})$.
  Let $\psi({\gr z})$ is the disjunction of those $\psi_{\gr b_i}({\gr z})$ such that ${\gr b_i}\in \grC$.
  Then  $\grD\cap\grC$ is defined by $\phi({\gr z})\wedge\psi({\gr z})$.

  As $\grC=_A\grD\cap\grC$, we obtain in particular that $\grC$ is approximable from below, see Lemma~\ref{lem_approx_nonunif}.
\end{proof}

When all formulas have finite VC-dimension, we say that the theory $T$ has the \emph{non-independence property\/} or, for short, that $T$ \emph{is nip}.

Let $\<\D_i:i<\lambda\>$ be the collection of all subsets of $\U$, of arbitrary finite arity, that are externally definable. The expansion of $\U$ to the language $L(\X_i:i<\lambda)$ is called the \emph{Shelah expansion\/} of $\U$ and is denoted by \emph{$\U^{\rm Sh}$}. 

From Corollary~\ref{corol_honest} and Proposition~\ref{prop_sh_exp_qe} we obtain the following.

\begin{corollary}\label{corol_sh_exp_qe}
If $T$ is nip then $\U^{\rm Sh}$ has $L$-elimination of quantifiers. (I.e.\@ every formula is Boolean combination of formulas in $L$ and formulas of the form $z\in\D_i$.)
\end{corollary}

\begin{exercise}
  ($T$ is nip.)
  Let $\<a_i:i<\omega\>$ be a sequence of indiscernibles over $A$.
  Let 
  
  \ceq{\hfill p(x)}{=}{\{\phi(x)\in L(\U)\ :\ \phi(a_i)\textrm{ holds for almost all }i\}}

  Prove that $p(x)$ is complete.
\end{exercise}
% \section{UDTFS}
% \label{UDTFS}

% \begin{proposition}
%   Choose a positive integer $q_\psi$ for each formula $\psi\in L$. 
%   Let $\phi({\mr x}\,;{\gr z})\in L$ be given.
%   Then there are finitely may formulas $\psi_j(y\,;{\gr z})$, for $j<n$, such that for every set $\grD$ that is approximable by $\phi({\mr x}\,;{\gr z})$ there is a $j<n$ such that for every $B$ of cardinality \smash{$<q_{\psi_j}$} there is a $d\in B^{|y|}$ such that $\grD=_B\psi_j(d\,;\U^{\gr z})\subseteq\grD$.
% \end{proposition}

% \begin{proof}
%   Negate the proposition
% \end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notes and references}
\begin{biblist}[]\normalsize
\bib{CS}{article}{
  author={Chernikov, Artem},
  author={Simon, Pierre},
  title={Externally definable sets and dependent pairs},
  note={\href{https://arxiv.org/abs/1007.4468}{ArXiv:1007.4468}},
  journal={Israel J. Math.},
  volume={194},
  date={2013},
  number={1},
  pages={409--425},
  %note={},
  %issn={0021-2172},
  %doi={10.1007/s11856-012-0061-9},
}\smallskip
\end{biblist}