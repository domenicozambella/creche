% !TEX root = creche.tex
\chapter{Actions of groups}
\label{actions}

\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{17ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
Chapter under revision.

In this chapter, $L$ is a signature, $T$ is a complete theory without finite models, and $\U$ is a saturated model of inaccessible cardinality $\kappa$ strictly larger than $|L|$.
We use the same notation and make the same implicit assumptions as in Section~\ref{monster}.

Assumption~\ref{notation_GXphi} below is in force throughtout the chapter. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The dual perspective on invariance}\label{dual_perspective}

The notions of invariance introduceted in Chapter~\ref{invariant} extend seemlessly to the action of a group $G$ on $\U^{\gr z}$.
It is convenient to work in a more general setting.

In this chapter $\Delta\subseteq L_{{\mr x}\,{\gr z}}(\U)$.
Let $\grZ\subseteq\U^{\gr z}$.
We write \emph{$\Delta(\grZ)$} for the set of formulas of the form $\phi({\mr x}\,;{\gr b})$ for some $\phi({\mr x}\,;{\gr z})\in\Delta$ and some ${\gr b}\in\grZ$.
We write \emph{$\pmDelta(\grZ)$} for the set of formulas in $\Delta(\grZ)$ or negation thereof.
We write $S_\Delta(\grZ)$ for the set of complete $\pmDelta(\grZ)$-types.

We write \emph{$\BDelta(\grZ)$} for the set of Boolean combinations of formulas in $\Delta(\grZ)$.

When $\Aa\subseteq\U$, we may use $\Aa$ for $\Aa^{\gr z}$ in the notation above.

Finally, define \emph{$\GDelta(A)$\/} to be the set of formulas $\phi({\mr x})\in L(\U)$ that are equivalent to some formula in $\BDelta(A)$ or, equivalently, that are invariant over $A$.
In the literature these formulas are called \textit{generalized\/} $\Delta$-formulas over $A$.
Note that when $A$ is a model $\GDelta(A)$-formulas are equivalent to $\BDelta(A)$-formulas.

\begin{assumption}\label{notation_GXphi}
  Let $G$ be a group that acts on some sets ${\mrX}\subseteq\U^{\mr x}$ and ${\grZ}\subseteq\U^{\gr z}$.
  We require that for every $\phi({\mr x}\,;{\gr z})\in\Delta$ the set $\phi(\mrX;\grZ)$ is invariant under the action of $G$.
  For convenience, we will assume that $G$ is the identity outside ${\mrX}$ and ${\grZ}$.

  When $p({\mr x})\subseteq\BDelta(\grZ)$ and  ${\mrD}\subseteq\U^{\mr x}$ we write $p({\mr x})\proves{\mr x}\in{\mrD}$ if the inclusion $\psi(\mrX)\subseteq{\mrD}$ for some $\psi({\mr x})$ that is conjunctions of formulas in $p({\mr x})$.
\end{assumption}

Let $\grD\subseteq\U^{\gr z}$.
We say that $\grD$ is \emph{invariant\/} under the action of $G$, or \emph{$G$-invariant,} if  $\grD$ is fixed setwise by $G$.
That is, $g\,\grD=\grD$ for every $g\in G$.
Yet in other words, if

\ceq{\ssf{is1.}\hfill {\gr a}\in\grD}{\iff}{g{\gr a}\in\grD}\hfill for every ${\gr a}\in\grZ$ and every $g\in G$.

A formula is $G$-invariant if the set it defines is $G$-invariant.
We say that $p({\mr x})\subseteq\BDelta(\grZ)$ is \emph{invariant\/} under the action of $G$, or \emph{$G$-invariant,} if for every $\BDelta(\grZ)$-formula $\theta({\mr x}\,;{\gr\bar a})$. 

\ceq{\ssf{it1.}\hfill\theta({\mr x}\,;{\gr\bar a})\in p}{\IFF}{\theta({\mr x}\,;g\,{\gr\bar a})\in p}\hfill for every $g\in G$.

It should be clear that invariant under the action of $\Aut(\U/A)$ coincides with invariant over $A$ and Lascar invariant over $A$ coincides with invariant under the action of $\Autf(\U/A)$.

Note that $p({\mr x})$ is $G$-invariant exactly when the sets ${\gr\D_{p,\theta}}\subseteq\U^{\gr z}$ are.
In this section we want to discuss invariance using sets $\mrD\subseteq\U^{\mr x}$.
We need stronger assumptions on the action of $G$.

An immediate consequence of the invariance of $\phi(\mrX\,;\grZ)$ is that any $G$-translate of a $\BDelta({\grZ})$-definable set is again $\BDelta({\grZ})$-definable.
In particular, by reasoning as in Remark~\ref{rem_image_def_set} we obtain that for every $\BDelta({\grZ})$-formula $\theta({\mr x}\,;{\gr\bar b})$ and every $g\in G$

\ceq{\hfill g[\theta(\mrX\,;{\gr\bar b})]}{=}{\theta(\mrX\,;g\,{\gr\bar b}).}

Therefore, a type $p({\mr x})\subseteq\BDelta(\grZ)$ is $G$-invariant if

\ceq{\hfill p({\mr x})\proves{\mr x}\in\mrD}{\IFF}{p({\mr x})\proves{\mr x}\in g\,\mrD}\hfill for every $\BDelta({\grZ})$-definable $\mrD\subseteq\mrX$ and $g\in G$.

% At the first reading the reader may assume that $G=\Aut(\U)$, $\mrX=\U^{\mr x}$, $\grZ=\U^{\gr z}$ and $\Delta=L_{{\mr x}\,;{\gr z}}$, where $|{\gr z}|=\omega$.
% Then $\pmDelta(\grZ)=L_{\mr x}(\U)$ and  $S_\Delta(\grZ)=S_{\mr x}(\U)$. 
% Note that when $G$ acts by automorphisms $\phi(\U^{\mr x};\U^{\gr z})$ is $G$-invariant for all $\phi({\mr x}\,;{\gr z})\in L$.

A set $\mrD\subseteq\mrX$ is \emph{generic\/} under the action of $G$, or \emph{$G$-generic\/} for short, if finitely many $G$-translates of $\mrD$ cover $\mrX$; we say \emph{$n$-$G$-generic\/} if $\le n$ translates suffices.
Dually, we say that $\mrD$ is \emph{persistent\/} under the action of $G$, or \emph{$G$-persistent\/} for short, if the intersection of any finitely many $G$-translates of $\mrD$ is nonempty; we say \emph{$n$-$G$-persistent\/} when the request is limited to $\le n$ translates.
When $\mrX$ and/or $\grZ$ are not clear from the context, we say that these notions are \emph{relative\/} to $\mrX$ and $\grZ$.

The same properties may be attributed to formulas (as these are identified with the set they define).
When these properties are attributed to a type $p({\mr x})$, we understand that they hold for every conjunction of formulas in $p({\mr x})$.
See Exercise~\ref{ex_persistent_types} for an alternative characterization when $p({\mr x})$ is small.

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
The terminology above is non-standard.
In~\cite{CK} the authors write \textit{quasi-non-dividing\/} for \textit{persistent\/} under the action of $\Aut(\U/A)$.
Their terminology has good motivations, but it would be a mouthful if adapted to our context.
In topological dynamics similar notions have been introduced with different terminology: \textit{syndetic\/} corresponds to \textit{generic\/} and \textit{thick\/} corresponds to \textit{persistent.}

\begin{example}
  If $p({\mr x})\subseteq L(\U)$ is finitely satisfiable in $A$ then $p({\mr x})$ is persistent under the action of $G=\Aut(\U/A)$ relative to any $\mrX\supseteq A^{\mr x}$.
  In fact, the same ${\mr a}\in A^{\mr x}$ that satisfies $\phi({\mr x})$ also satisfies every $\Aut(\U/A)$-translate of $\phi({\mr x})$.
\end{example}

Notation: for $\mrD\subseteq\U^{\mr x}$ and $H\subseteq G$ we write $H\,\mrD$ for $\{h\mrD: h\in H\}$.

In this notes many proofs require some juggling with negations as epitomized by the following fact.

\begin{fact}\label{fact_fip}
  %aaaaa
  The following are equivalent
  \begin{itemize}
    \item[1.] $\mrD$ is not $G$-generic
    \item[2.] $\neg\mrD$ is $G$-persistent.
  \end{itemize}
\end{fact}

\begin{proof}
  Immediate by spelling out the definitions
  \begin{itemize}
    \item[1.] there are no finite $H\subseteq G$ such that $\mrX\ \subseteq\ \cup\, H\,{\mr\D}$.
    \item[2.]  $\0\ \neq\ \mrX\,\cap\,\big(\cap\, H\neg{\mr\D}\big)$ for every finite $H\subseteq G$.\qedhere
  \end{itemize} 
\end{proof}

Define the following type

\ceq{\hfill\emph{$\gamma_G({\mr x})$}}{=}{\{\theta({\mr x})\in \BDelta({\grZ}): \theta({\mr x})\textrm{ is }G\textrm{-generic}\}}

\begin{corollary}\label{corol_q_pers}
  %aaaaa
  Let $p({\mr x})\subseteq\BDelta(\grZ)$ be such that $\gamma_G({\mr x})\cup p({\mr x})$ is finitely satisfiable in $\mrX$.
  Then $p({\mr x})$ is $G$-persistent.
\end{corollary}

\begin{proof}
  Let $\theta({\mr x})\in p$.
  As $\gamma_G({\mr x})$ is finitely satisfiable in $\theta(\mrX)$, it cannot be that $\neg\theta({\mr x})$ is $G$-generic.
  From Fact~\ref{fact_fip}, we obtain that $\theta({\mr x})$ is $G$-persistent.
\end{proof}

The converse implication holds for complete types.

\begin{theorem}\label{thm_generic_invariant}
  %aaaaa
  Let $p({\mr x})\in S_\Delta(\grZ)$ be finitely satisfiable in $\mrX$.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $p({\mr x})$ is $G$-invariant
    \item[2.] $p({\mr x})\proves\gamma_G({\mr x})$
    \item[3.] $p({\mr x})$ is $G$-persistent.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  Let $H\subseteq G$ be finite such that $\mrX\subseteq\cup\,H\,\mrD$.
  By completeness and finite satisfiability, $p({\mr x})\proves {\mr x}\in\cup\,H\,\mrD$.
  Again by completeness, $p({\mr x})\proves {\mr x}\in h\,\mrD$ for some $h\in H$.
  Finally, by invariance,  $p({\mr x})\proves{\mr x}\in\mrD$.
  
  \ssf2$\IMP$\ssf3.
  Let $\mrD$ be defined by a conjunction of formulas in $p({\mr x})$.
  If $\mrD$ is not $G$-persistent then, by Fact~\ref{fact_fip}, $\neg\mrD$ is $G$-generic. 
  By \ssf2, $p({\mr x})\proves{\mr x}\notin\mrD$, a contradiction.

  \ssf3$\IMP$\ssf1.
  % uppose $p({\mr x})$ is not $(n+2)$-persistent and let $n$ be minimal.
  % Let $g_1,\dots,g_{n+2}\in G$ and $\theta({\mr x})\,;{\gr\bar b}$ witness this.
  % Then 
  If $p({\mr x})$ is not $G$-invariant then, by completeness, $p({\mr x})\proves\phi({\mr x}\,;{\gr b})\wedge\neg\phi({\mr x}\,;g{\gr b})$ for some $g\in G$.
  Clearly $\phi({\mr x}\,;{\gr b})\wedge\neg\phi({\mr x}\,;g{\gr b})$ is not $2$-$G$-persistent as it is inconsistent with its $g$-translate.
\end{proof}

The theorem yields a necessary condition for the existence of $G$-invariant global $\BDelta({\grZ})$-types.

\begin{corollary}\label{corol_def_mu}
  %aaaaa
  If there exists a $G$-invariant type $p({\mr x})\in S_\Delta(\grZ)$ finitely satisfiable in $\mrX$ then for every $\BDelta({\grZ})$-definable set $\mrD$
  \begin{itemize}
    \item[1.] $\mrD$ and $\neg\mrD$ are not both $G$-generic
    \item[2.] if $\mrD$ is $G$-generic then it is $G$-persistent
    \item[3.] $\gamma_G({\mr x})$ is finitely satisfiable in $\mrX$.
  \end{itemize}
\end{corollary}

\begin{proof}
  Clearly, \ssf1 and \ssf2 are equivalent by Fact~\ref{fact_fip} and follow from \ssf3.
  Finally, \ssf3 is an immediate consequences of \ssf2 of Theorem~\ref{thm_generic_invariant}.
\end{proof}

The following theorem gives a necessary and sufficient condition for the  existence of global $G$-invariant $\BDelta({\grZ})$-type.
Ideally, we would like to have that every $G$-persistent $\BDelta({\grZ})$-type extends to a global persitent type.
Unfortunately this is not true in general (it requires stronger assumptions, see Section~\ref{tame_landscape}).
A set $\mrD$ is \emph{hereditarely\/} $G$-persistent if every finite cover of $\mrD$ by $\BDelta({\grZ})$-definable sets contains a $G$-persistent set.
In~\cite{CK} a similar property is called \textit{quasi-non-forking.}
A type is hereditarely $G$-persistent if every conjunction of formulas in the type is hereditarely $G$-persistent.

\begin{theorem}\label{thm_generic_invariant2}
  %aaaaa
  Let $\mrD$ be a $\BDelta(\grZ)$-definable set.
  Then the following are equivalent 
  \begin{itemize}
    \item[1.] there exists a $G$-invariant type $p({\mr x})\in S_\Delta(\grZ)$ finitely satisfiable in $\mrX\cap\mrD$
    \item[2.] $\mrD$ is hereditarely $G$-persistent.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  Suppose ${\mr\C_1},\dots,{\mr\C_n}$ cover $\mrD$ and pick $p({\mr x})$ as in \ssf1.
  By completeness, $p({\mr x})\proves {\mr x}\in{\mr\C_i}$ for some $i$.
  Then, by Theorem~\ref{thm_generic_invariant}, $\neg{\mr\C_i}$ is not $G$-generic.
  Therefore, by Fact~\ref{fact_fip}, ${\mr\C_i}$ is $G$-persistent.

  \ssf2$\IMP$\ssf1.
  Let $p({\mr x})$ be maximal among the $\BDelta({\grZ})$-types that are finitely satisfiable in $\mrX\cap\mrD$ and are such that $\theta(\U^{\mr x})$ is hereditarely $G$-persistent for every $\theta({\mr x})$ that is conjunction of formulas in $p({\mr x})$.
  We claim that $p({\mr x})$ is a complete $\BDelta({\grZ})$-type.
  Suppose for a contradiction that $\theta({\mr x}),\neg\theta({\mr x})\notin p$.
  By maximality there is some formula $\psi({\mr x})$, a conjunction of formulas in $p({\mr x})$, and some ${\mr\C_1},\dots,{\mr\C_n}$ that cover both $\psi(\U^{\mr x})\cap\theta(\U^{\mr x})$ and $\psi(\U^{\mr x})\smallsetminus\theta(\U^{\mr x})$ and such that no ${\mr\C_i}$ is $G$-persistent.
  As ${\mr\C_1},\dots,{\mr\C_n}$ cover $\psi(\U^{\mr x})$ this is a contradiction.
  It is only left to show that $p({\mr x})$ is $G$-invariant.
  his follows from completeness and Theorem~\ref{thm_generic_invariant}.
\end{proof}

Let $p({\mr x})\subseteq\BDelta(\grZ)$ be $G$-invariant.
We say that $p({\mr x})$ is \emph{$G$-prime\/} if for every $\BDelta(\grZ)$-definable set $\mrD$ and every $g\in G$ if $p({\mr x})\proves{\mr x}\in(\mrD\cup g\,\mrD)$ then $p({\mr x})\proves{\mr x}\in\mrD$.

\begin{proposition}
  %aaaaa
  Then $\gamma_G({\mr x})$ is $G$-prime.
\end{proposition}

\begin{proof}
  The following are equivalent for every $\BDelta(\grZ)$-definable set $\mrD$ 
  \begin{itemize}
    \item [1.] $\gamma_G({\mr x})\proves{\mr x}\in\mrD$
    \item [2.] $p({\mr x})\proves{\mr x}\in\mrD$ for every $G$-persistent $p({\mr x})\in S_\Delta(\grZ)$.
  \end{itemize}
  Now, assume $\gamma_G({\mr x})\proves{\mr x}\in(\mrD\cup g\,\mrD)$ and pick a $G$-persistent $p({\mr x})\in S_\Delta(\grZ)$.
  By completeness $p({\mr x})\proves{\mr x}\in\mrD$ or $p({\mr x})\proves{\mr x}\in g\,\mrD$.
  As $p({\mr x})$ is $G$-invariant, $p({\mr x})\proves{\mr x}\in\mrD$.
  As $p({\mr x})$ is arbitrary, $\gamma_G({\mr x})\proves{\mr x}\in\mrD$ follows from the above equivalence.
\end{proof}

\begin{exercise}
  Prove that if $p(x)\in S(\U)$ is finitely satisfiable in every $M\supseteq A$ then it is persistent under the action of $\Autf(\U/A)$.
  Is the same true for incomplete types?
\end{exercise}

\begin{exercise}
  %aaaaa
  Let $p(x)\in S_\Delta(\U)$ be $G$-persistent.
  Prove that the following are equivalent
  \begin{itemize}
    \item[1.] $p(x)$ is $G$-invariant and finitely satisfiable in $\X$
    \item[2.] $p(x)\proves x\in\D$ for every 2-$G$-generic definable set $\D$
    \item[3.] $p(x)$ is 2-$G$-persistent.
  \end{itemize}
\end{exercise}

\begin{exercise}
  %aaaaa
  Prove that the following are equivalent for every $\BDelta({\Z})$-definable set $\D\subseteq\U^x$
  \begin{itemize}
    \item[1.] there is a $G$-invariant type $p(x)\in S_\Delta(\Z)$ finitely satisfiable in $\X\cap\D$
    \item[2.] every finite cover of $\D$ by $\BDelta({\Z})$-definable sets contains a 2-$G$-persistent set.
  \end{itemize}
\end{exercise}

\begin{exercise}\label{ex_gen_sat}
  %aaaaa
  Let $p(x)\subseteq \BDelta(\Z)$ be $G$-generic.
  Prove that it is finitely satisfiable in $\X$.
\end{exercise}

\begin{exercise}\label{ex_persistent_types}
  %aaaaa
  Prove that for $p(x)\subseteq \BDelta(A)$ following are equivalent
  \begin{itemize}
    \item[1.] $p(x)$ is $G$-persistent
    \item[2.] $p(\U^x)$ is $G$-persistent.
  \end{itemize}
\end{exercise}

\begin{exercise}
  Give an example of a persistent set that is not hereditarely persistent.
  Hint: find inspiration in Example~\ref{ex_cyclic_order}.
\end{exercise}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Strong genericity}\label{strong_genericity}

Unfortunatelly, $G$-genericy is not preserved under intersection.
To obtain closure under intersection, we need to push the concept to a higher level of complexity.

A set $\mrD\subseteq\U^{\mr x}$ is \emph{strongly $G$-generic\/} if for every finite $H\subseteq G$ the set $\cap\,H\,\mrD$ is generic.
Dually, we say that $\mrD$ is \emph{weakly $G$-persistent\/} if for some finite $H\subseteq G$ the set $\cup\,H\,\mrD$ is persistent.
Again, the same properties may be attributed to formulas and types.

\begin{lemma}\label{lem_strongly_generic}
  %aaaaa
  The intersection of two strongly $G$-generic sets is strongly $G$-generic.
\end{lemma}

\begin{proof}
  We may assume that all sets mentioned below are subsets of $\mrX$.
  Let ${\mr\D}$ and ${\mr\C}$ be strongly $G$-generic and let $K\subseteq G$ be an arbitrary finite set.
  It suffices to prove that $\mrB=\cap\, K\,({\mr\C}\cap{\mr\D})$ is $G$-generic. 
  Clearly $\mrB={\mr\C'}\cap{\mr\D'}$, where ${\mr\C'}=\cap\, K\,{\mr\C}$ and ${\mr\D'}=\cap\, K\,{\mr\D}$.
  Note that ${\mr\C'}$ and ${\mr\D'}$ are both strongly $G$-generic.
  In particular $\mrX=\cup\,H\,\mr\D'$ for some finite $H\subseteq G$.
  Now, from
  
  \ceq{\hfill\cup\,H\,\mrB}{=}{\cup\,H\Big[{\mr\C'}\ \cap\ {\mr\D'}\Big]}

  \ceq{\hfill\cup\,H\,\mrB}{\supseteq}{\cup\,H\Big[\big(\cap\, H\,{\mr\C'}\big)\ \cap\ {\mr\D'}\Big]}
  
  \ceq{}{=}{ \big(\cap\, H\,{\mr\C'}\big)\ \cap\ \big(\cup\,H\,{\mr\D'}\big)}
  
  \ceq{}{=}{\cap\, H\,{\mr\C'}}
  
  As ${\mrC'}$ is strongly $G$-generic, $\cap\, H\,{\mr\C'}$ is $G$-generic.
  Therefore $\cup\,H\,\mrB$ is also $G$-generic.
  The $G$-genericity of $\mrB$ follows.
\end{proof}

Define the following type

\ceq{\hfill\emph{${}^{\rm s}\kern-.2ex\gamma_G({\mr x})$}}{=}{\{\theta({\mr x})\in \BDelta({\grZ}): \theta({\mr x})\textrm{ is strong }G\textrm{-generic}\}}

\begin{corollary}\label{corol_str_gen}
  %aaaaa
  The type ${}^{\rm s}\kern-.2ex\gamma_G({\mr x})$ is finitely satisfiable in $\mrX$, strongly $G$-generic, and $G$-invariant.
\end{corollary}

\begin{proof}
  The strong $G$-genericity is an immediate consequence of Lemma~\ref{lem_strongly_generic}.
  The finite satisfiability is a consequence of $G$-genericity, see Exercise~\ref{ex_gen_sat}.
  As for invariance, note that any translate of a strongly $G$-generic formula is also strongly $G$-generic.
\end{proof}

\begin{corollary}\label{corol_q_w_pers}
  %aaaaa
  Let $p({\mr x})\subseteq\BDelta(\grZ)$ be such that ${}^{\rm s}\kern-.2ex\gamma({\mr x})\cup p({\mr x})$ is finitely satisfiable in $\mrX$.
  Then $p({\mr x})$ is weakly $G$-persistent.
\end{corollary}

\begin{proof}
  Similar to Corollary~\ref{corol_q_pers}.
  Let $\theta({\mr x})\in p$.
  As ${}^{\rm s}\kern-.2ex\gamma({\mr x})$ is finitely satisfiable in $\theta(\U^{\mr x})$, we cannot have that $\neg\theta({\mr x})$ is strongly $G$-generic.
  From Fact~\ref{fact_fip}, we obtain that $\neg\theta(\U^{\mr x})$ non strongly $G$-generic is equivalent to $\theta({\mr x})$ weakly $G$-persistent.
\end{proof}

\begin{exercise}
  %aaaaa
  Show that $G$-generic sets need not be closed under intersection.
  Hint: find inspiration in Example~\ref{ex_cyclic_order}.
\end{exercise}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The diameter of a Lascar type}\label{newelski}

As an application we prove an interesting property of the Lascar types.
Recall that $\Ll({\mr a}/A)$, the Lascar strong type of ${\mr a}\in\U^{\mr x}$, is the union of a chain of type-definable sets of the form $\big\{{\mr x}\ :\ d_A({\mr a},{\mr x})\le n\big\}$.
In this section we prove that $\Ll({\mr a}/A)$ is type-definable (if and) only this chain is finite.
In other words, only if the connected component of ${\mr a}$ in the Lascar graph has finite diameter.

It is convenient to address the problem in more general terms.
We work under Assumption~\ref{notation_GXphi} and also assume that $G$ acts transitively on $\mrX$ i.e.\@ $G\,{\mr a}=\mrX$ for every ${\mr a}\in\mrX$.
Let $K\subseteq G$ be a set of generators that is
\begin{itemize}
  \item[1.] symmetric i.e.\@ it contains the unit and is closed under inverse
  \item[2.] conjugancy invariant i.e.\@ $g\,Kg^{-1}=K$ for every $g\in G$
\end{itemize}

We define a discrete metric on $\mrX$.
For ${\mr a},{\mr b}\in\mrX$ let $d({\mr a},{\mr b})$ be the minimal $n$ such that ${\mr a}\in K^n{\mr b}$.
This defines a metric which is $G$-invariant by \ssf2.
The \emph{diameter\/} of a set $\mrC\subseteq\mrX$ is the supremum of $d({\mr a},{\mr b})$ for ${\mr a},{\mr b}\in\mrC$.

We are interested in sufficient conditions for $\mrX$ to have finite diameter.
The notions introduced in Section~\ref{strong_genericity} offer some hint.

\begin{proposition}\label{prop_wpers_finite_diameter}
  If $\mrX$ has a weakly persistent subset of finite diameter, then $\mrX$ itself has finite diamenter.
\end{proposition}

\begin{proof}
  Let $\mrC\subseteq\mrX$ be a weakly persistent set of diameter $n$.
  Let $H\subseteq G$ be finite such that $\cup\,H\,\mrC$ is persistent.
  We claim that also $\cup\,H\,\mrC$ has finite diameter.
  Let ${\mr a}\in\mrC$ be arbitrary.
  Let $m$ be larger than $d(h{\mr a}, k{\mr a})$ for all $h,k,\in H$.
  Now, let $h{\mr b}$ and $k{\mr c}$, for some $h,k,\in H$ and ${\mr b},{\mr c}\in\mrC$, be two arbitrary elements of $\cup\,H\,\mrC$.
  As $h\mrC$ and $k\mrC$ have the same diameter of $\mrC$, 

  \ceq{\hfill d(h{\mr b},\, k{\mr c})}{\le}{d(h{\mr b},\,h{\mr a})\ +\ d(h{\mr a},\, k{\mr a})\ +\ d(k{\mr a},\,k{\mr c})}

  \ceq{}{\le}{n+m+n.}

  This proves that $\cup\,H\,\mrC$ has finite diameter.
  Therefore, without loss of generality, we may assume that $\mrC$ itself is persistent.
  
  By the transitivity of the action, any two elements of $\mrX$ are of the form $h{\mr a}$, $k{\mr a}$ for some $h,k\in G$ and some ${\mr a}\in\mrC$.
  By percistency, there are ${\mr c}\in\mrC\cap h\mrC$ and ${\mr d}\in\mrC\cap k\mrC$.
  Then 

  \ceq{\hfill d(h{\mr a},\, k{\mr a})}{\le}{d(h{\mr a},\,{\mr c})\ +\ d({\mr c},\, {\mr d})\ +\ d({\mr d},\,k{\mr a})}

  \ceq{}{\le}{n+n+n.}

  Therefore the diameter of $\mrX$ does not exceed $3n$.
\end{proof}

\begin{theorem}\label{thm_newelski}
  Suppose that $\mrX$ and the sets ${\mr\X_n}=K^n{\mr a}$, for some ${\mr a}\in\mrX$ that is $\BDelta(\grZ)$-type-definable.
  Then $\mrX$ has finite diameter.
\end{theorem}

\begin{proof}
  By Proposition~\ref{prop_wpers_finite_diameter}, it suffices to prove that ${\mr\X_n}$ is weakly persistent.
  By Corollary~\ref{corol_q_w_pers} it suffices to show that for some $n$ the type ${}^{\rm s}\kern-.2ex\gamma_G({\mr x})$ is finitely satisfied in ${\mr\X_n}$.
  Suppose not.
  Let $\psi_n({\mr x})\in\gamma_G$ be a formula that is not satisfied in $\mr\X_n$.
  The type $p({\mr x})=\{\psi_n({\mr x}):n\in\omega\}$ is finitely satisfied in $\mrX$.
  Then $p({\mr x})$ has a realization in $\mrX$. 
  As this realization belongs to some ${\mr\X_n}$ we contradict the definition of $\psi_n({\mr x})$. 
\end{proof}

% \ceq{\hfill p_n({\mr\X},{\mr\X})}{=}{\{\<{\mr a},{\mr b}\>\in{\mr\X^2}\ :\ {\mr a}\in K^n{\mr b}\}}

% Below we write ${\mr x}\in K^n{\mr y}$ for the type $p_n({\mr x},{\mr y})$ and ${\mr x}\in G\,{\mr y}$ for the disjunction of all these types (n.b.\@ an infinite disjunction of types need not be a type).

\begin{example}\label{ex_newelski}
  Let $K\subseteq\Aut(\U/A)$ be the set of automorphisms that fix a model containing $A$.
  Then the group $G$  generated by $K$ is $\Autf(\U/A)$ and $G\cdot{\mr a}=\mrX$ is $\Ll({\mr a}/A)$.
  Let $\Delta=L_{{\mr x}\,{\gr z}}$ and $\grZ=\U^{\gr z}$.
  Then $d({\mr a},{\mr b})$ concides with the dinstance in the Lascar graph.
  As shown in Proposition~\ref{prop_Lascar_distance_type_def} the sets $K^n\cdot{\mr a}=\{{\mr x}:d({\mr x},{\mr a})\le n\}$ are type definable.
  Then from Theorem~\ref{thm_newelski} it follows that $\Ll({\mr a}/A)$ is type definable (if and) only if it has a finite diameter.
\end{example} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A tamer landscape}\label{tame_landscape}

Under suitable assumptions -- e.g.\@ see Proposition~\ref{prop_stable_lanscape} -- some of the notions introduced in this chapter coalesce and we are left with a tamer landscape.
We prove the following theorem.

\begin{theorem}\label{thm_coalesce}
  %aaaaa
  The following are equivalent
  \begin{itemize}
    \item[1.] $G$-persistent $\BDelta({\grZ})$-definable sets are hereditarely $G$-persistent
    \item[2.] $G$-generic $\BDelta({\grZ})$-definable sets are closed under intersection 
    \item[3.] $G$-generic $\BDelta({\grZ})$-definable sets are strongly $G$-generic
    \item[4.] weakly persisent $\BDelta({\grZ})$-definable sets are $G$-persistent.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf2$\IFF$\ssf3$\IFF$\ssf4. Clear.

  \ssf1$\IMP$\ssf2.
  Let $\mrC$ and $\mrD$ be $G$-generic $\BDelta({\grZ})$-definable sets.
  Suppose for a contradiction that $\mrC\cap\mrD$ is not $G$-generic.
  Then $\neg(\mrC\cap\mrD)$ is $G$-persistent.
  By \ssf1 and Theorem~\ref{thm_generic_invariant2} there is a $G$-invariant global $\BDelta({\grZ})$-type $p({\mr x})$ containing ${\mr x}\notin\mrC\cap\mrD$.
  By completeness either $p({\mr x})\proves{\mr x}\notin\mrC$ or $p({\mr x})\proves{\mr x}\notin\mrD$.
  This is a contradiction because by Theorem~\ref{thm_generic_invariant} $p({\mr x})\proves{\mr x}\in\mrC$ and $p({\mr x})\proves{\mr x}\in\mrD$.

  \ssf4$\IMP$\ssf1.
  Note that, by \ssf3, the type ${}^{\rm s}\kern-.2ex\gamma_G({\mr x})$ coincides with $\gamma_G({\mr x})$, in particular $\gamma_G({\mr x})$ is finitely satisfied in $\mrX$.
  Let $\mrD$ be a $G$-persistent $\BDelta({\grZ})$-definable set.
  We show that$\gamma_G({\mr x})={}^{\rm s}\kern-.2ex\gamma_G({\mr x})$ is finitely satisfiable in $\mrX\cap\mrD$.
  Then, by \ssf4 and Corollary~\ref{corol_q_w_pers}, any global extension of $\gamma_G({\mr x})\cup\{{\mr x}\in\mrD\}$ witness \ssf2 of Theorems~\ref{thm_generic_invariant2}.
  Suppose not, then $\gamma_G({\mr x})\proves {\mr x}\notin\mrD$.
  Therefore $\neg\mrD$ is $G$-generic, contradicting the consistency of ${}^{\rm s}\kern-.2ex\gamma_G({\mr x})$.
\end{proof}

% \begin{assumption}\label{notation_2}
%   For $G$, $\mrX$, $\grZ$ and $\Delta$ as in Assumption~\ref{notation_GXphi} we also require that the equivalent conditions in Theorem~\ref{thm_coalesce} hold.
% \end{assumption}

\begin{remark}\label{rem_coalesce} 
  Assume that the equivalent conditions in Theorem~\ref{thm_coalesce} hold.
  Then the types $\gamma_G({\mr x})$ and ${}^{\rm s}\kern-.2ex\gamma_G({\mr x})$ coincide, and therefore $G$-invariant global types exist.
  It is also worth mentioning that every positive Boolean combination of $G$-generic sets is $G$-generic.
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Definable groups}\label{definablegroups}

In this section we work as always under Assumption~\ref{notation_GXphi}, but we further specify $G$ and $\Delta$.
We assume $G=\grZ$ and require that $\grZ$ and $\mrX$ are type-definable over $A$.
We also assume that the group operations and the group action are definable over $A$.
We use the symbol $\,\cdot\,$ for both the group multiplication and the group action.
Clearly, $\grZ$ also acts on itself by left multiplication.

Let $\psi({\mr x})\in L(A)$.
We write $\phi({\mr x}\,;{\gr z})$ for the formula $\psi({\gr z^{-1}}\cdot{\mr x})$.
In this section $\Delta$ contains the formula $\phi({\mr x}\,;{\gr z})$.
Note that $\phi(\mrX\,;\grZ)$ is $G$-invariant.

Let ${\gr 1}$ be the identity of $\grZ$ which, for simplicity, we think as a constant of $L$.
Clearly, $\phi(\mrX\,;{\gr g})={\gr g}\cdot\phi(\mrX\,;{\gr 1})$.

In this section we deal with the actions of two groups: $G=\grZ$ and $\Aut(\U/A)$.
As usual, invariant/persistent/generic over $A$ understand under the action of $\Aut(\U/A)$.
% Generic and persistent only refer to the action of $G$.
% We will be explicit about invariance.
The following implications are evident for the formulas of the form $\phi({\mr x}\,;{\gr g})$
\begin{itemize}
  \item [1.] $G$-persistent  $\IMP$ persistent over $A$
  \item [2.] generic over $A$ $\IMP$ $G$-generic 
\end{itemize}

\begin{assumption}\label{notation_3}
  Let $G$, $\mrX$, $\grZ$ and $\Delta$ be as described above.
  Note that these are compatible with Assumption~\ref{notation_GXphi}.
\end{assumption}

\begin{fact}
  (Assume~\ref{notation_3})\ \ 
  Let $\theta({\mr x}\,;{\gr\bar z})$ be a Bolean combination of the formulas $\phi({\mr x}\,;{\gr z_i})$, where $i=1,\dots,n$. 
  Then there is a formula $\psi({\gr\bar z})\in L(A)$ such that, for every  ${\gr\bar g}\in{\gr\Z^n}$

  \ceq{\hfill\psi({\gr\bar g})}{\IFF}{\theta({\mr x}\,;{\gr\bar g})\textrm{ is $G$-generic}.}

  In other words, the type $\gamma_G({\mr x})$ is definable.
\end{fact}

\begin{proof}
  % As $\phi({\mr x}\,;{\gr g}\,;a)$ is generic/persistent if and only if $\phi({\mr x}\,;{\gr 1}\,;a)$ is, we can replace ${\gr g}$ by ${\gr 1}$.
  By compactness, there is an $m$ such that for every ${\gr\bar g}\in{\gr\Z^n}$ if $\theta({\mr x}\,;{\gr\bar g})$ is generic then it is also $m$-generic.
  Then

  \ceq{\hfill\psi({\gr\bar z})}{=}{\E{\gr u_1},\dots,{\gr u_m}\ \A{\mr x}\bigvee_{i=1}^m\theta({\mr x}\;;\,{\gr u_i}{\cdot}{\gr\bar z})}
\end{proof}

An immediate consequence of this fact is that the automorphisms in $\Aut(\U/A)$ map generic/persistent $\BDelta(\grZ)$-definable sets to generic/persistent sets of the same form.

% \begin{fact}
%   (Assume~\ref{notation_3})\ \ 
%   Let $\theta({\mr x}\,;{\gr z})\in\pmDelta$.
%   There is a formula $\sigma({\gr u}\,;{\gr v})\in L(\Y)$ such that for every $g,h\in G$

%   \ceq{\hfill\sigma({\gr g}\,;{\gr h})}{\IFF}{\theta({\mr x}\,;{\gr g})\wedge\theta({\mr x}\,;{\gr h})\textrm{ is persistent}.}
% \end{fact}
% The same is true for generic/persistent types $p({\mr x})\in S_\Delta(\grZ)$ in fact, up to equivalence, we may assume that they contain only formulas of the form $\phi({\mr x}\,;{\gr g}\,;a)$ and negation thereof.

\begin{fact} 
  Let $p({\mr x})\in S_\Delta(\grZ)$ be $G$-persistent -- equivalently, $G$-invariant.
  Then $p({\mr x})$ is invariant over $A$.
\end{fact}

\begin{proof}
  We may assume that $p({\mr x})$ only contain the formulas $\phi({\mr x}\,;{\gr b})$ for $\phi({\mr x}\,;{\gr z})\in\Delta$ or negations thereof.
  As $p({\mr x})$ is $G$-invariant, $\phi({\mr x}\,;{\gr g})\in p\Leftrightarrow\phi({\mr x}\,;{\gr 1})\in p$.
  Then the $A$-invariance of $p({\mr x})$ follows from the $A$-invariance of $\phi({\mr x}\,;{\gr 1})$.
\end{proof}

% The set $\mrD$ is $\Delta$-definable, namely it is definable by the formula $\phi({\mr x}\,;{\gr 1})$ where ${\gr 1}$ is the identity of $\mrG$.

% We define an immersion of 

% \ceq{\hfill\sigma\ :\ \Aut(\U/A)}{\to}{\grG}\\
% \ceq{\hfill f}{\mapsto}{f\gr1}

% \begin{fact}
%   Let $\mrD\subseteq\U^{\mr x}$ be definable over $A$.
%   Let $\phi({\mr x}\,;{\gr z})$ be the formula ${\mr x}\in{\gr z}\cdot\mrD$.
%   \begin{itemize}
%     \item[1.] $\phi({\mr x}\,;{\gr 1})$ is $\grG$-generic
%     \item[2.] $\mrD$ is generic over $A$.
%   \end{itemize}
% \end{fact}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notes and references}

In Example~\ref{ex_newelski} we prove a theorem of Newelski's~\cite{Newelski}.
The original proof is rather long and complex.
A simplified proof (also due, reportedly, to Newelski) appears in Rodrigo Pel\'aez's thesis~\cite{Pelaez}*{Section 3.3} and~\cite{Casanovas}*{Chapter 9}.
The proof here is a streamlined and generalized version of the latter -- inspired by~\cite{Z16}.

  \begin{biblist}[]\normalsize
    \bib{Casanovas}{book}{
      author={Casanovas, Enrique},
      title={Simple theories and hyperimaginaries},
      series={Lecture Notes in Logic},
      volume={39},
      publisher={Cambridge
      University Press},
      date={2011},
      % pages={xiv+169},
      % isbn={978-0-521-11955-9},
      % review={\MR{2814891}},
      % doi={10.1017/CBO9781139003728},
   }\smallskip
    \bib{CK}{article}{
   author={Chernikov, Artem},
   author={Kaplan, Itay},
   title={Forking and dividing in ${\rm NTP}_2$ theories},
   journal={J. Symbolic Logic},
  %  volume={77},
   date={2012},
  %  number={1},
  %  pages={1--20},
  %  issn={0022-4812},
  %  review={\MR{2951626}},
  %  doi={10.2178/jsl/1327068688},
}\smallskip
\bib{Newelski}{article}{
   author={Newelski, Ludomir},
   title={The diameter of a Lascar strong type},
   journal={Fund. Math.},
  %  volume={176},
   date={2003},
  %  number={2},
  %  pages={157--170},
  %  issn={0016-2736},
  %  review={\MR{1971306}},
  %  doi={10.4064/fm176-2-4},
}\smallskip
\bib{Pelaez}{book}{
  author={Pel\'aez, Rodrigo},
  title={\href{http://www.ub.edu/modeltheory/documentos/ThesisRPP.pdf}{About the Lascar group}},
  series={PhD Thesis},
  publisher={Universitat de Barcelona, Departament de L\'ogica, Hist\'oria i Filosofia de la Ci\'encia},
  date={2008},
}\smallskip
\bib{Z16}{article}{
  author={Zambella, Domenico},
  title={On the diameter of Lascar strong types after Ludomir Newelski},
  conference={
    title={A tribute to Albert Visser},
  },
  book={
    % series={Tributes},
    % volume={30},
    publisher={Coll. Publ., [London]},
  },
  date={2016},
  status={\href{https://arxiv.org/abs/1605.00218}{arXiv:1605.00218}},
%  pages={231--236},
%  review={\MR{3559880}},
}\smallskip
  \end{biblist}

  