% !TEX root = creche.tex
\chapter{Group actions on models}
\label{actions}

\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{17ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
Chapter under revision.

In this chapter, $L$ is a signature, $T$ is a complete theory without finite models, and $\U$ is a saturated model of inaccessible cardinality $\kappa$ strictly larger than $|L|$.
We use the same notation and make the same implicit assumptions as in Section~\ref{monster}.

Assumption~\ref{notation_GXphi} below is in force throughout the chapter.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The dual perspective on invariance}\label{dual_perspective}
% \def\BDelta{\LDelta\kern-.4ex_{{\rm qf}}}

We revisit the notion of invariance introduceted in Chapter~\ref{invariant} in a more general setting.

\begin{assumption}\label{notation_GXphi}
Let $\Delta\subseteq L_{{\mr x}\,{\gr z}}(\U)$.
Given any \emph{$\mrX$\/} $\subseteq\U^{\mr x}$ and \emph{$\grZ$\/} $\subseteq\U^{\gr z}$, we define the structure \emph{$\UDelta$\/} $=\big\<\mrX\,;\grZ\big\>$.
This is a 2-sorted structure whose signature  \emph{$\LDelta$\/} contains relation symbols for every formula $\phi({\mr x}\,;{\gr z})\in\Delta$.
As there is little risk of confusion, these relations symbols are also denoted by $\phi({\mr x}\,;{\gr z})$, and we identify $\LDelta$ with a subset of $L$. 
\end{assumption}

When $\mrX$ and $\grZ$ are type definable and $\Delta$ is small, $\UDelta$ is a saturated structure.
As compactness is not always required, these sets are arbitrary unless explicitly required.

In the first few sections we only work a subset of the quantifier-free fragment of $\LDelta$.
Let $\BDelta(\grZ)$ be the set of Boolean combinations of the sets $\phi(\mrX\,;{\gr b})$, for $\phi({\mr x}\,;{\gr z})\in\Delta$ and ${\gr b}\in\grZ$.
The same symbol is also used to denote the collection of formulas defining these sets.
%  $\LDelta_{{\rm\,at^\pm}\!,\,{\mr x}}(\grZ)$ and 
% $\LDelta_{{\rm\,qf},\,{\mr x}}(\grZ)$ with 
% $\pmDelta(\grZ)$, respectively 

We write \emph{$S_\Delta(\grZ)$\/} for the set of complete $\BDelta(\grZ)$-types~--~which we may conveniently think as subsets of $\pmDelta(\grZ)$.
In this chapter the types in $S_\Delta(\grZ)$ are required to be finitely consistent $\mrX$~--~a piece of information that we will not display in the notation as there is little risk of ambiguity.
When the types are required to be finitely consistent in some $\mrY\subseteq\mrX$ we write \emph{$S_{\Delta,\Y}(\grZ)$.}

% A set $\mrD\subseteq\mrX$ is \emph{$\BDelta({\grZ})$-definable\/} if $\mrD=\phi(\mrX)$ for some $\phi({\mr x})\in\BDelta({\grZ})$.
% In the literature these sets are sometime called \textit{relatively\/} definable to distinguish them from $\phi(\U^{\mr x})$ and $\phi(\U^{\gr z})$.
% Similarly, we define \emph{$\BDelta({\grZ})$-type-definable\/} sets.

When $p({\mr x})\subseteq\LDelta(\grZ)$ and ${\mrD}\subseteq\mrX$ we write $p({\mr x})\proves{\mr x}\in{\mrD}$ if the inclusion $\psi(\mrX)\subseteq{\mrD}$ holds for some $\psi({\mr x})$ that is conjunctions of formulas in $p({\mr x})$.

Let \emph{$G$\/} $\le\Aut(\UDelta)$.
We say that $\grD\subseteq\grZ$ is \emph{invariant\/} under the action of $G$, or \emph{$G$-invariant,} if  $\grD$ is fixed setwise by $G$.
That is, $g\,\grD=\grD$ for every $g\in G$.
Yet in other words, if

\ceq{\ssf{is.}\hfill{\gr a}\in\grD}{\iff}{g\,{\gr a}\in\grD}\hfill for every ${\gr a}\in\grZ$ and every $g\in G$.

A formula is $G$-invariant if the set it defines is $G$-invariant.
We say that the type $p({\mr x})\subseteq\BDelta(\grZ)$ is \emph{invariant\/} under the action of $G$, or \emph{$G$-invariant,} if 

\ceq{\ssf{it.}\hfill\theta({\mr x}\,;{\gr\bar a})\in p}{\IFF}{\theta({\mr x}\,;g\,{\gr\bar a})\in p}\hfill for every $g\in G$ and every $\theta({\mr x}\,;{\gr\bar a})\in\BDelta(\grZ)$.

Note that $p({\mr x})$ is $G$-invariant exactly when the sets ${\gr\D_{p,\theta}}$ are.
In this section we want to discuss the invariance of types using the sets $\mrD\subseteq\mrX$.

An immediate consequence of the invariance of $\phi(\mrX\,;\grZ)$ is that $G$-translates sets in $\BDelta({\grZ})$ remain in $\BDelta({\grZ})$.
In particular, by reasoning as in Remark~\ref{rem_image_def_set} we obtain that for every $\BDelta({\grZ})$-formula $\theta({\mr x}\,;{\gr\bar b})$ and every $g\in G$

\ceq{\hfill g[\theta(\mrX\,;{\gr\bar b})]}{=}{\theta(\mrX\,;g\,{\gr\bar b}).}

Therefore, a type $p({\mr x})\subseteq\BDelta(\grZ)$ is $G$-invariant if

\ceq{\hfill p({\mr x})\proves{\mr x}\in\mrD}{\IFF}{p({\mr x})\proves{\mr x}\in g{\cdot}\mrD}\hfill for every $\mrD\subseteq\mrX$ and $g\in G$.

% At the first reading the reader may assume that $G=\Aut(\U)$, $\mrX=\U^{\mr x}$, $\grZ=\U^{\gr z}$ and $\Delta=L_{{\mr x}\,;{\gr z}}$, where $|{\gr z}|=\omega$.
% Then $\pmDelta(\grZ)=L_{\mr x}(\U)$ and  $S_\Delta(\grZ)=S_{\mr x}(\U)$. 
% Note that when $G$ acts by automorphisms $\phi(\U^{\mr x};\U^{\gr z})$ is $G$-invariant for all $\phi({\mr x}\,;{\gr z})\in L$.

Let $\mrY\subseteq\mrX$.
A set $\mrD\subseteq\mrX$ is \emph{syndetic\/} under the action of $G$ relative to $\mrY$, or \emph{$G$-syndetic\/} for short, if finitely many $G$-translates of $\mrD$ cover $\mrY$; we say \emph{$n$-$G$-syndetic\/} if $\le n$ translates suffices.
Dually, we say that $\mrD$ is \emph{thick\/} under the action of $G$ relative to $\mrY$, or \emph{$G$-thick\/} for short, if the intersection of any finitely many $G$-translates of $\mrD$ is consistent with $\mrY$; we say \emph{$n$-$G$-thick\/} when the request is limited to $\le n$ translates.

We omit reference of $\mrY$ when this is made clear in the context.

The same properties may be attributed to formulas (as these are identified with the set they define).
When these properties are attributed to a type $p({\mr x})$, we understand that they hold for every conjunction of formulas in $p({\mr x})$.
See Exercise~\ref{ex_thick_types} for an alternative characterization when $p({\mr x})$ is small.

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
The terminology above is taken from topological dynamics.
In other contexts (see eg.~\cite{Newelski09}) syndetic sets are called \textit{generic.}
In~\cite{CK} the authors write \textit{quasi-non-dividing\/} for \textit{thick\/} under the action of $\Aut(\U/A)$.
Their terminology has good motivations, but it would be a mouthful if adapted to our context.

Notation: for $\mrD\subseteq\mrX$ and $C\subseteq G$ we write \emph{$C{\cdot}\mrD$\/} for $\{h{\cdot}\mrD: h\in C\}$.

In this chapter many proofs require some juggling with negations as epitomized by the following fact.

\begin{fact}\label{fact_fip}
  Work relative to some given $\mrY\subseteq\mrX$.
  The following are equivalent
  \begin{itemize}
    \item[1.] $\mrD$ is not $G$-syndetic
    \item[2.] $\neg\mrD$ is $G$-thick.
  \end{itemize}\smallskip
\end{fact}

\begin{proof}
  Spelling out the definitions, \ssf1 and \ssf2 are, respectively, equivalent to
  \begin{itemize}
    \item[1$'$.] there are no finite $C\subseteq G$ such that $\mrY\ \subseteq\ \cup\, C{\cdot}{\mr\D}$.
    \item[2$'$.] $\varnothing\ \neq\ \mrY\,\cap\,\big(\cap\, C{\cdot}\neg{\mr\D}\big)$ for every finite $C\subseteq G$.
  \end{itemize} 
  Then the equivalence is evident.
\end{proof}

The following characterization is also useful (an is sometimes taken as the definition).

\begin{corollary}\label{fact_fip2}
  Work relative to some given $\mrY\subseteq\mrX$.
  The following are equivalent
  \begin{itemize}
    \item[1.] $\mrD$ is $G$-thick
    \item[2.] $\mrD\cap\mrC\neq\varnothing$ for every set $\mrC$ that is $G$-syndetic.
  \end{itemize}
\end{corollary}

\begin{proof}
  \ssf1$\IMP$\ssf2. 
  If $\mrD$ is $G$-thick and $\mrD\cap\mrC=\varnothing$ then $\mrD\subseteq\neg\mrC$.
  Then $\neg\mrC$ is also $G$-thick which, by Fact~\ref{fact_fip} implies that $\mrC$ is not $G$-syndetic.

  \ssf2$\IMP$\ssf1. 
  If $\mrD$ is not $G$-thick then $\mrD$ is $G$-syndetic then $\neg$\ssf2.
\end{proof}

Define the following type

\ceq{\hfill\emph{$\gamma_{G,\Y}({\mr x})$}}{=}{\big\{\theta({\mr x})\in \BDelta({\grZ})\ :\ \theta({\mr x})\textrm{ is }G\textrm{-syndetic relatve to }\mrY\big\}.}

We write $\gamma_G({\mr x})$ for $\gamma_{G,\X}({\mr x})$.

% We remark that the consistency of $\gamma_G({\mr x})$ is far from guaranteed.

\begin{corollary}\label{corol_q_pers}
  Work relative to some given $\mrY\subseteq\mrX$.
  Let $\mrD\in\BDelta(\grZ)$ and assume that $\gamma_{G,\Y}({\mr x})\cup\{{\mr x}\in\mrD\}$ is finitely consistent in $\mrY$.
  Then $\mrD$ is $G$-thick.
\end{corollary}

\begin{proof}
  As $\gamma_{G,\Y}({\mr x})\cup\{{\mr x}\in\mrD\}$ is finitely consistent in $\mrY$, it cannot be that $\neg\mrD$ is $G$-syndetic.
  Then from Fact~\ref{fact_fip} we obtain that $\mrD$ is $G$-thick.
\end{proof}

The converse implication holds for complete types.

\begin{theorem}\label{thm_syndetic_invariant}
  Work relative to some given $\mrY\subseteq\mrX$.
  For every $p({\mr x})\in S_{\Delta,\Y}(\grZ)$ the following are equivalent
  \begin{itemize}
    \item[1.] $p({\mr x})$ is $G$-invariant
    \item[2.] $p({\mr x})\proves\gamma_{G,\Y}({\mr x})$
    %\item[2$'$.] $p({\mr x})\proves\gamma_{G}({\mr x})$ and is finitely consistent in $\mrY$
    \item[3.] $p({\mr x})$ is $G$-thick.
    %\item[3$'$.] $p({\mr x})$ is $G$-thick and is finitely consistent in $\mrY$.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  Let $\mrD\in\BDelta(\grZ)$ be a $G$-syndetic.
  Pick $C\subseteq G$ be finite such that $\mrY\subseteq\cup\,C{\cdot}\mrD$.
  Then $p({\mr x})$ is finitely consistent with ${\mr x}\in\cup\,C{\cdot}\mrD$.
  By completeness, $p({\mr x})\proves {\mr x}\in h\,\mrD$ for some $h\in C$.
  Finally, by invariance, $p({\mr x})\proves{\mr x}\in\mrD$.
  
  \ssf2$\IMP$\ssf3.
  By Corollary~\ref{corol_q_pers}.

  \ssf3$\IMP$\ssf1.
  % uppose $p({\mr x})$ is not $(n+2)$-thick and let $n$ be minimal.
  % Let $g_1,\dots,g_{n+2}\in G$ and $\theta({\mr x})\,;{\gr\bar b}$ witness this.
  % Then 
  Negate \ssf1.
  Then $p({\mr x})$ is not $G$-invariant.
  % Then, by completeness, $p({\mr x})\proves\phi({\mr x}\,;{\gr b})\wedge\neg\phi({\mr x}\,;g\,{\gr b})$ for some $g\in G$ and $\phi({\mr x}\,;{\gr b})\in\BDelta(\grZ)$.
  % Clearly $\phi({\mr x}\,;{\gr b})\wedge\neg\phi({\mr x}\,;g\,{\gr b})$ is not $2$-$G$-thick as it is inconsistent with its $g$-translate.
  By completeness $p({\mr x})\proves{\mr x}\in(\neg\mrD\cap g{\cdot}\mrD)$ for some $g\in G$ and some $\mrD\in\BDelta(\grZ)$.
  Clearly $\neg\mrD\cap g{\cdot}\mrD$ is not $2$-$G$-thick as it is inconsistent with its $g$-translate.
%  \ssf1$\IMP$\ssf2$'{\IFF}$\ssf3$'$. Apply what proved above with $\mrX$ for $\mrY$.
\end{proof}

% \begin{corollary}\label{corol_gammaG_invaqriancer}
%   The following are equivalent for every $\BDelta(\grZ)$-definable set $\mrD$
%   \begin{itemize}
%     \item [1.] $\gamma_G({\mr x})\proves{\mr x}\in\mrD$
%     \item [2.] $p({\mr x})\proves{\mr x}\in\mrD$ for every $G$-thick $p({\mr x})\in S_\Delta(\grZ)$.
%   \end{itemize}
% \end{corollary}

% \begin{proof}
%   \ssf1$\IMP$\ssf2.
%   This is an immediate consequence of Theorem~\ref{thm_syndetic_invariant}.

%   \ssf2$\IMP$\ssf1.
%   Suppose $\gamma_G({\mr x})\not\proves{\mr x}\in\mrD$.
%   Then there is a type $p({\mr x})\in S_\Delta(\grZ)$ finitely consistent with $\gamma_G({\mr x})\cup\{{\mr x}\notin\mrD\}$.
%   By Corollary~\ref{corol_q_pers} $p({\mr x})$ is $G$-thick.
%   Then $\neg\ssf2$.
% \end{proof}

The theorem yields a necessary condition for the existence of global $\BDelta({\grZ})$-types that are $G$-thick.

\begin{corollary}\label{corol_def_mu}
  Work relative to some given $\mrY\subseteq\mrX$.
  If a type a $G$-thick $p({\mr x})\in S_{\Delta,\Y}(\grZ)$ exists, then for any $\mrD\in\BDelta({\grZ})$
  \begin{itemize}
    \item[1.] $\mrD$ and $\neg\mrD$ are not both $G$-syndetic
    \item[2.] if $\mrD$ is $G$-syndetic then it is $G$-thick
    \item[3.] $\gamma_{G,\Y}({\mr x})$ is finitely consistent in $\mrY$.\smallskip
  \end{itemize}
\end{corollary}

\begin{proof}
  Clearly, \ssf1 and \ssf2 are equivalent by Fact~\ref{fact_fip} and follow from \ssf3.
  Finally, \ssf3 is an immediate consequence of \ssf2 of Theorem~\ref{thm_syndetic_invariant}.
\end{proof}

The following theorem gives a necessary and sufficient condition for the  existence of global $G$-invariant $\BDelta({\grZ})$-type.
Ideally, we would like that every $G$-thick $\BDelta({\grZ})$-type extends to a global thick type.
Unfortunately this is not true in general (it is a strong assumption, see Section~\ref{tame_landscape}).

A set $\mrD$ is \emph{$G$-wide\/} relative to $\mrY$ if every finite cover of $\mrD$ by $\BDelta({\grZ})$-sets contains a set that is $G$-thick relative to $\mrY$.
A type is $G$-wide if every conjunction of formulas in the type is $G$-wide.

In~\cite{CK} a similar property is called \textit{quasi-non-forking.}
Our use of the term \textit{wide\/} is consistent with~\cite{Hr}, though we apply it to a narrow context.

\begin{theorem}\label{thm_syndetic_invariant2}
  Work relative to some given $\mrY\subseteq\mrX$.
  For every $\mrD\in\BDelta(\grZ)$ the following are equivalent 
  \begin{itemize}
    \item[1.] $\gamma_{G,\Y}({\mr x})\cup\{{\mr x}\in\mrD\}$ is finitely consistent in $\mrY$
    \item[2.] there is a $G$-thick type $p({\mr x})\in S_{\Delta,\Y}(\grZ)$ that entails ${\mr x}\in\mrD$
    \item[3.] $\mrD$ is $G$-wide.\smallskip
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  By Corollary~\ref{corol_q_pers}, it suffices to pick any $p({\mr x})\in S_{\Delta,\Y}(\grZ)$ that entails $\gamma_{G,\Y}({\mr x})\cup\{{\mr x}\in\mrD\}$.

  \ssf2$\IMP$\ssf1.
  By Theorem~\ref{thm_syndetic_invariant}.

  \ssf2$\IMP$\ssf3.
  Let ${\mr\C_1},\dots,{\mr\C_n}$ be $\BDelta({\grZ})$-sets that cover $\mrD$.
  Pick $p({\mr x})$ as in \ssf2.
  By completeness, $p({\mr x})\proves {\mr x}\in{\mr\C_i}$ for some $i$.
  Therefore, ${\mr\C_i}$ is $G$-thick.

  \ssf3$\IMP$\ssf2.
  Let $p({\mr x})$ be maximal among the $\BDelta({\grZ})$-types that are finitely satisfiable in $\mrY\cap\mrD$ and are $G$-wide.
  We claim that $p({\mr x})$ is a complete $\BDelta({\grZ})$-type.
  Suppose for a contradiction that $\theta({\mr x}),\neg\theta({\mr x})\notin p$.
  By maximality there is some formula $\psi({\mr x})$, a conjunction of formulas in $p({\mr x})$, and some $\BDelta({\grZ})$-sets ${\mr\C_1},\dots,{\mr\C_n}$ that cover both $\psi(\U^{\mr x})\cap\theta(\U^{\mr x})$ and $\psi(\U^{\mr x})\smallsetminus\theta(\U^{\mr x})$ and such that no ${\mr\C_i}$ is $G$-thick.
  As ${\mr\C_1},\dots,{\mr\C_n}$ cover $\psi(\U^{\mr x})$ this is a contradiction.
  It is only left to show that $p({\mr x})$ is $G$-thick.
  This follows from completeness and Theorem~\ref{thm_syndetic_invariant}.
\end{proof}

% For future reference we note that theorem also apply to type-definable sets.

% \begin{corollary}
%   Work relative to some given $\mrY\subseteq\mrX$.
%   For every $\BDelta(\grZ)$-type $q({\mr x})$ the following are equivalent 
%   \begin{itemize}
%     \item[1.] $\gamma_{G,\Y}({\mr x})\cup q({\mr x})$ is finitely consistent in $\mrY$
%     \item[2.] $p({\mr x})\cup q({\mr x})$ is finitely consistent in $\mrY$, for some $G$-thick type $p({\mr x})\in S_\Delta(\grZ)$ 
%     \item[3.] $q({\mr x})$ is $G$-wide.\smallskip
%   \end{itemize}
% \end{corollary}

% \begin{proof}
%   Implication \ssf1$\IMP$\ssf2 is obtained by the same proof as the in theorem.
%   The other implications follow immediately from the theorem.
% \end{proof}

\begin{corollary}\label{corol_intersectionGwide}
  Work relative to some given $\mrY\subseteq\mrX$.
  Let $\mrD\in\BDelta(\grZ)$ be a $G$-wide.
  Then $\mrD\cap g{\cdot}\mrD$ is $G$-wide for every $g\in G$.
\end{corollary}

\begin{proof}
  Let $p({\mr x})\in S_{\Delta,\Y}(\grZ)$ be a $G$-thick type such that $p({\mr x})\proves{\mr x}\in\mrD$.
  By $G$-invariance $p({\mr x})\proves{\mr x}\in g{\cdot}\mrD$.
\end{proof}

% Let $q({\mr x})\subseteq\BDelta(\grZ)$.
% We say that $q({\mr x})$ is \emph{$G$-prime\/} if for every $\BDelta(\grZ)$-definable set $\mrD$ and every $g_1,g_2\in G$ if $q({\mr x})\proves{\mr x}\in(g_1{\cdot}\mrD\cup g_2{\cdot}\mrD)$ then $q({\mr x})\proves{\mr x}\in g_i{\cdot}\mrD$ for some $i$.
% The following fact is immediate.

% \begin{fact}
%   The following are equivalent for every $\BDelta(\grZ)$-type $q({\mr x})$
%   \begin{itemize}
%     \item [1.] $q({\mr x})$ is $G$-prime and $G$-invariant
%     \item [2.] if $\mrD$ is $\BDelta(\grZ)$-definable, $g\in G$, and $q({\mr x})\proves{\mr x}\in(\mrD\cup g{\cdot}\mrD)$, then $q({\mr x})\proves{\mr x}\in\mrD$.
%   \end{itemize}
% \end{fact}

% \begin{proposition}
%   For every type $q({\mr x})\subseteq\BDelta(\grZ)$ the following are equivalent
%   \begin{itemize}
%     \item [1.] $q({\mr x})\proves\gamma_H({\mr x})$
%     \item [2.] $q({\mr x})$ is $G$-prime and $G$-invariant.
%   \end{itemize}
% \end{proposition}

% \begin{proof}
%   \ssf1$\IMP$\ssf2.
%   Suppose $q({\mr x})\proves{\mr x}\in(\mrD\cup g{\cdot}\mrD)$.
%   Let $p({\mr x})\in S_\Delta(\grZ)$ extend $q({\mr x})$.
%   By completeness $p({\mr x})\proves{\mr x}\in\mrD$ or $p({\mr x})\proves{\mr x}\in g{\cdot}\mrD$.
%   As $p({\mr x})$ is $G$-invariant by Theorem~\ref{thm_syndetic_invariant}, it follows that
%   $p({\mr x})\proves{\mr x}\in\mrD$.
%   Finally, as $p({\mr x})$ is arbitrary, $q({\mr x})\proves{\mr x}\in\mrD$. 

%   \ssf2$\IMP$\ssf1.
%   As $\mrD$ is $G$-syndetic and $q({\mr x})$ is $G$-prime, $q({\mr x})\proves{\mr x}\in g{\cdot}\mrD$ for some $g\in G$.
%   Finally $q({\mr x})\proves{\mr x}\in\mrD$ by invariance.
% \end{proof}

\begin{exercise}
  Let $\U^x=\U^z=\U$ and $\Delta=L_x$.
  Prove that if $p(x)\in S_\Delta(\U)$ is finitely satisfiable in every $M\supseteq A$ then it is thick under the action of $G=\Autf(\UDelta)$.
  Is the same true for incomplete types?
\end{exercise}

\begin{exercise}
  Prove that the following are equivalent
  \begin{itemize}
    \item[1.] $\D$ is $G$-thick
    \item[2.] there is a type $p(x)\in S_\Delta(\Z)$ containing $\{x\in g{\cdot}\D\;:\;g\in G\}$.
  \end{itemize}
\end{exercise}

\begin{exercise}
  Let $p(x)\in S_\Delta(\U)$.
  Prove that the following are equivalent
  \begin{itemize}
    \item[1.] $p(x)$ is $G$-invariant
    \item[2.] $p(x)\proves x\in\D$ for every 2-$G$-syndetic definable set $\D$
    \item[3.] $p(x)$ is 2-$G$-thick.
  \end{itemize}
\end{exercise}

\begin{exercise}
  Let $\D$ be a $\BDelta(\Z)$-type-definable set.
  Prove that the following are equivalent 
  \begin{itemize}
    \item[1.] there is a $G$-invariant type $p(x)\in S_\Delta(\Z)$ such that $p(x)\proves x\in\D$.
    \item[2.] every finite cover of $\D$ by $\BDelta(\Z)$-definable sets contains a 2-$G$-thick set.
  \end{itemize}
\end{exercise}

% \begin{exercise}\label{ex_gen_sat}
%   Let $p(x)\subseteq \BDelta(\Z)$ be $G$-syndetic.
%   Prove that it is finitely satisfiable in $\X$.
% \end{exercise}

\begin{exercise}\label{ex_thick_types}
  Prove that for every $p(x)\subseteq \BDelta(A)$ following are equivalent
  \begin{itemize}
    \item[1.] $p(x)$ is $G$-thick
    \item[2.] $p(\U^x)$ is $G$-thick.
  \end{itemize}
\end{exercise}

\begin{exercise}
  Give an example of a thick set that is not wide.
  Hint: find inspiration in Example~\ref{ex_cyclic_order}.
\end{exercise}

\begin{exercise}\label{ex_syndetic_type_vs_formulas}
  Let $\D\subseteq\X$ be a $G$-syndetic $\BDelta(\Z)$-type-definable set.
  Prove that $\D$ is definable by a $\BDelta(\Z)$-type containing only $G$-syndetic formulas.
\end{exercise}

% \begin{exercise}\label{ex_Hprime}
%   Prove that if $q(x)$ is $G$-prime and $q(x)\proves x\in \cup\,G{\cdot}\D$ for some finite $G\subseteq G$, then $q(x)\proves x\in\D$.
% \end{exercise}

% \begin{exercize}
%   Let $\mrD$ be a $\BDelta(\grZ)$-definable set.
%   Prove that the following are equivalent
%   \begin{itemize}
%     \item [1.] $\mrD$ is $G$-wide;
%     \item [2.] every finite cover of $\mrD$ by $\pmDelta({\grZ})$-definable sets contains a $G$-thick set.
%   \end{itemize}
% \end{exercize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Invariant equivalence relations}

We prove a necessary condition for the consistency of $\gamma_G({\mr x})$, i.e.\@ for the existence of $G$-invariant global types.
First, we need to relate the notions of thick, syndetic, etc.\@ when relative to different sets.

\begin{proposition}\label{prop_HgenGgen}
  Assume that $\mrX$ is type-definable.
  Let $\mrY\subseteq\mrX$.
  Assume that boundedly many $G$-translates of $\mrY$ cover $\mrX$.
  Then for every $\mrD\in\BDelta(\grZ)$ the following are equivalent
  \begin{itemize}
    \item [1.] $\mrD$ is $G$-syndetic
    \item [2.] $\mrD$ is $G$-syndetic relative to $\mrY$.
  \end{itemize}
\end{proposition}

\begin{proof}
  Only \ssf2$\IMP$\ssf1 requires a proof.
  If $\mrD$ is $G$-syndetic relative to $\mrY$ then is it is also $G$-syndetic relative to $g{\cdot}\mrY$ for any $g\in G$.
  Then boundedly many $G$-translations of $\mrD$ cover $\mrX$.
  By compactness (which we may apply because $\mrX$ is type-definable), finitely many translations suffices.
\end{proof}

\begin{proposition}\label{prop_HgenGgen}
  Assume that $\mrX$ is type-definable.
  Let $\mrY\subseteq\mrX$.
  Assume that boundedly many $G$-translates of $\mrY$ cover $\mrX$.
  Say, $C{\cdot}\mrY$ covers $\mrX$ for some small $C\subseteq G$.
  Then for every $\mrD\in\BDelta(\grZ)$ the following are equivalent
  \begin{itemize}
    \item [1.] $\mrD$ is $G$-wide
    \item [2.] $\mrD$ is $G$-wide relative to any $C$-translate of $\mrY$.
  \end{itemize}\smallskip
  In particular, if $\mrY$ is $\BDelta(\grZ)$-type-definable then $\mrD$ is $G$-wide relative to $\cap\,C{\cdot}\mrY$ (which therefore is nonempty).
\end{proposition}

\begin{proof}
  Only \ssf1$\IMP$\ssf2 requires a proof.
  Assume \ssf1.
  There is a $G$-invariant $p({\mr x})\in S_\Delta(\grZ)$ that implies ${\mr x}\in\mrD$.
  As $C{\cdot}\mrY$ is small and covers $\mrX$, then $p({\mr x})$ is finitely consistent in $h{\cdot}\mrY$ for some $h\in C$.
  Then $p({\mr x})$, which by invariance coincides with $g{\cdot}h^{-1}{\cdot}p({\mr x})$, is finitely consistent in $g{\cdot}\mrY$ for every $g\in C$.
  If $\mrY$ is type definable then  $p({\mr x})$ entails $g{\cdot}\mrY$ for every $g\in C$ and the second claim follows.
\end{proof}

\begin{corollary}
  Assume that $\mrX$ is type-definable and that $G$ acts transitively on $\mrX$.
  Then, if $\gamma_G({\mr x})$ is consistent, there is no bounded $G$-invariant $\BDelta(\grZ)$-type-definable equivalence relation.
\end{corollary}


% \begin{fact}
%   Assume \ssf1 of Theorem~\ref{thm_coalesce}.
%   Then the following are equivalent
%   \begin{itemize}
%     \item[1.] $H$ is stationary
%     \item[2.] the intersection of any two $H$-wide $\BDelta({\grZ})$-sets is $H$-wide.
%   \end{itemize}
% \end{fact}

% \begin{fact}
%   Assume that $G$ acts transitively and that all types in $P$ are realized in $\mrX$.
%   Then, when $H$ is stationary and \ssf1 of Theorem~\ref{thm_coalesce} holds, $P=Q_G$.
% \end{fact}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The connected component}\label{G0}
\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{12ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

Let \emph{$G$\/} $\le\Aut(\UDelta)$.
Unfortunately, syndeticity is not preserved under intersection.
In particular $\gamma_G({\mr x})$ is not a $G$-syndetic type, and it may even be inconsistent.
Then following notion is relevant.

\begin{definition}\label{def_Q}\ 

  \ceq{\hfill\emph{$Q_G$\/}}{=}{\big\{q({\mr x})\subseteq\gamma_G({\mr x})\;:\ q({\mr x})\textrm{ maximally syndetic}\big\}.}\smallskip

  In other words, the types in $Q_G$ are maximal among the subtypes of $\gamma_G({\mr x})$ that are closed under conjunction.
\end{definition}

It is easy to see that $Q_G$ is closed under the action of $G$.
We write $\Stab(q)$ for the stabilizer of $q({\mr x})\subseteq\BDelta(\grZ)$ in $G$, that is, the subgroup $\{g\in G:g{\cdot}q({\mr x})=q({\mr x})\}$.
We write $\Stab(\mrD)$ with a similar meaning.
Finally we define

\ceq{\hfill\emph{$\Stab(Q_G)$}}{=}{\bigcap_{q\in Q_G}\Stab(q).}

It is easy to verify that $\Stab(Q_G)\trianglelefteq G$.

\begin{proposition}\label{prop_StabQ}\ \smallskip

  \ceq{\hfill\Stab(Q_G)}{=}{\big\{g\in G\ :\ \mrD\cap g{\cdot}\mrD\in\gamma_G({\mr x})\textrm{ whenever }\mrD\in\gamma_G({\mr x})\big\}.}\smallskip
\end{proposition}

\begin{proof}
  $\subseteq$. 
  Pick $k\in\Stab(Q_G)$ and $\mrD\in\gamma_G({\mr x})$.
  Let $q({\mr x})\in Q_G$ be a type containing ${\mr x}\in\mrD$.
  From the $\Stab(Q_G)$-invariance of $q({\mr x})$ we obtain that $q({\mr x})\proves {\mr x}\in k{\cdot}\mrD$.
  Then $q({\mr x})\proves {\mr x}\in \mrD\cap k{\cdot}\mrD$, hence $\mrD\cap k{\cdot}\mrD$ is $G$-syndetic.

  $\supseteq$. 
  Pick $g\notin \Stab(Q_G)$.
  Then $q({\mr x})\neq g{\cdot}q({\mr x})$ for some $q({\mr x})\in Q_G$.
  Let $\phi({\mr x})\in q$ such that $q({\mr x})\not\proves g{\cdot}\phi({\mr x})$.
  By maximality, $\psi({\mr x})\wedge g{\cdot}\phi({\mr x})$ is not $G$-syndetic for some $\psi({\mr x})\in q$.
  As $q({\mr x})$ is closed under conjunction, we can assume $\phi({\mr x})=\psi({\mr x})$, then $g$ does not belong to the set on the r.h.s.
\end{proof}

\begin{theorem}\label{thm_gammaK}
  Write $K$ for $\Stab(Q_G)$.
  Then any finite conjunction of formulas in $\gamma_K({\mr x})$ is $G$-syndetic.
  In particular $\gamma_K({\mr x})$ is finitely consistent.
\end{theorem}

\begin{proof}
  \def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
  \def\ceq#1#2#3{\parbox[t]{23ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}
  Notice that from Proposition~\ref{prop_StabQ} it easily follows that for every $\mrD\in\gamma_G({\mr x})$ and every finite $F\subseteq K$ the set $\cap\,F{\cdot}\mrD$ is $G$-syndetic.
   
  Let  ${\mr\D_1},\dots,{\mr\D_n}\in\gamma_K({\mr x})$.
  Assume inductively that ${\mr\D_1}\cap\dots\cap{\mr\D_{n-1}}$ is $G$-syndetic.
  Let $F\subseteq K$ be such that $\cup\,F{\cdot}{\mr\D_n}=\mrX$.
  Then
  
  \ceq{\hfill\cup\,F{\cdot}[{\mr\D_1}\cap\dots\cap{\mr\D_n}]}
  {\supseteq}
  {\cup\,F{\cdot}\big[\cap\, F{\cdot}[{\mr\D_1}\cap\dots\cap{\mr\D_{n-1}}]\ \cap\ {\mr\D_n}\big]}

  \ceq{}{\supseteq}{\cap\, F{\cdot}[{\mr\D_1}\cap\dots\cap{\mr\D_{n-1}}]\ \cap\ \cup\,F{\cdot}{\mr\D_n}}

  \ceq{}{=}{\cap\, F{\cdot}[{\mr\D_1}\cap\dots\cap{\mr\D_{n-1}}].}

  This last set is $G$-syndetic by the inductive hypothesis and the remark above.
  The $G$-syndeticity of ${\mr\D_1}\cap\dots\cap{\mr\D_n}$ follows.
\end{proof}

From Theorems~\ref{thm_syndetic_invariant2} and~\ref{thm_gammaK} it follows that $K$-syndetic sets are $K$-wide.
But we can do better.
% In particular, every $q({\mr x})\in Q_G$ has an extension to a $K$-invariant $p({\mr x})\in S_\Delta(\grZ)$.
% If this extension is unique we say that $q({\mr x})$ is stationary.
First, we remark a useful consequence of normality.

\begin{remark}\label{rem_invariance_normalsubg}
% \newlength{\ceqlength}
% \settowidth{\ceqlength}{p(x) is H-invariant\ }
% \def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
% \def\ceq#1#2#3{\parbox[t]{\ceqlength}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}
\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}
  Assume $H\trianglelefteq G$.
  For every $\mrD\subseteq\mrX$ and every $g\in G$ \smallskip
  
  \ceq{\hfill\mrD\textrm{ is }H\textrm{-foo}}{\IFF}{g{\cdot}\mrD\textrm{ is }H\textrm{-foo},} \smallskip
  
  where \textit{foo\/} can be replaced by \textit{syndetic,} \textit{invariant,} \textit{thick,} \textit{wide.}
  In particular, the type $\gamma_G({\mr x})$ is $G$-invariant.
  % It also follows that for any $p({\mr x})\in S_\Delta(\grZ)$
  % \begin{itemize}
  %   \item [3.] \ceq{\hfill p({\mr x})\textrm{ is }H\textrm{-invariant}}{\IFF}{g\cdot p({\mr x})\textrm{ is }H\textrm{-invariant}.}
  % \end{itemize}
\end{remark}

Recall that when $\gamma_H({\mr x})$ is finitely consistent then $H$-syndetic sets are $H$-wide, see Theorem~\ref{thm_syndetic_invariant2}.
As it happens, under the assumption of normality, this can be strengthened as follows.

\begin{proposition}\label{prop_Gsyndetic_Hthick1}
  Assume $H\trianglelefteq G$ and that $\gamma_H({\mr x})$ is finitely consistent.
  Then every $G$-syndetic $\mrD\in\BDelta(\grZ)$ is $H$-wide.
  In particular all types in $Q_G$ are $K$-wide.
\end{proposition}

\begin{proof}
  Let $p({\mr x})\in S_\Delta(\grZ)$ be finitely consistent with $\gamma_H({\mr x})$.
  As $\mrD$ is $G$-syndetic, by completeness $p({\mr x})\proves{\mr x}\in g{\cdot}\mrD$ for some $g\in G$.
  Equivalently, $g^{-1}\!\cdot p({\mr x})\proves{\mr x}\in\mrD$.
  As $p({\mr x})$ is $H$-thick, by Remark~\ref{rem_invariance_normalsubg} also $g^{-1}\!\cdot p({\mr x})$ is $H$-thick.
  Then the proposition follows from Theorem~\ref{thm_syndetic_invariant2}.
\end{proof}

% \begin{theorem}
%   Every $\Stab(Q_G)$-thick $\BDelta(\grZ)$-set is $\Stab(Q_G)$-wide.
% \end{theorem}

It would help to have a more syntactic description of $\Stab(Q_G)$.
The group $G^0$ defined below is a candidate. %~--~we will see that under the assumption of stability it indeed coincides with $\Stab(Q_G)$. 
We revisit the notions introduced in Section~\ref{eq_algebraic} with the only difference that we apply them to $\BDelta(\grZ)$, not to the full language.%$\LDelta(\mrX,\grZ)$.

\begin{definition}\label{def_G0}
  Write \emph{$\Phi^0$\/} for the set of $\BDelta(\grZ)$-formulas/sets that have finite $G$-orbit and define%\vskip-1ex

  \ceq{\hfill\emph{$G^0$}}{=}{\Stab(\Phi)}\medrel{=}$\displaystyle\bigcap\big\{\Stab(\mrD) :\  \mrD\in\Phi^0\}$

  and%\vskip-.5ex

  \ceq{\hfill E^0}{=}{\big\{\epsilon_\D({\mr x},{\mr y})\ :\  \mrD\in\Phi^0\big\},}%\vskip-0.5ex
  
  where%\vskip-0.5ex

  \ceq{\hfill\epsilon_\D({\mr x},{\mr y})}{=}{\bigwedge_{g\in G}\big[{\mr x}\in g{\cdot}\mrD\iff{\mr y}\in g{\cdot}\mrD\big].}

  Let $P^0$ be the set of types of the form $\big\{\epsilon({\mr x}\,;{\mr a})\ :\ \epsilon({\mr x}\,;{\mr y})\in E^0\big\}$ for ${\mr a}\in\mrX$.
\end{definition}

Note that, when $G=\Aut(\UDelta)$, then $G^0$ is the group of $\LDelta$-automorphisms of $\UDelta$ that fix $\LDelta\mbox-\acl^\eq\varnothing$.% and $E$ contains all the the $\varnothing$-definable finite equivalence relations.

\begin{remark}\label{lem_trans_action}
  Equivalence classes of relations in $E^0$ are in $\Phi^0$ and every set in $\Phi^0$ is union of such equivalence classes.
  Then $G^0$ is the stabilizer of $P^0$.\smallskip

  Assume $G$ acts transitively.
  Then the sets in $\Phi^0$ are $G$-syndetic.
  Every $p({\mr x})\in P^0$ extends to some $q({\mr x})\in Q_G$.
  Then $\Stab(Q_G)\le G^0$.
\end{remark}

% \def\DLascar{L\kern-.6ex\raisebox{1.1ex}{\tiny$\Delta$}\kern-.1ex ascar}

Ideally, we would like to have $\Stab(Q_G)=G^0$.
This happens when the types in $P^0$ have a unique extension to a type in $Q_G$.
We will prove that this is the case under the assumption of stability.


\begin{definition}\label{def_G00}
  Write \emph{$\Phi^{00}$\/} for the collection of $\BDelta(\grZ)$-type-definable sets $\mrY$ with bounded $G$-orbit and define\smallskip

  \ceq{\hfill\emph{$G^{00}$}}{=}{\Stab(\Phi^{00})}\medrel{=}$\displaystyle\bigcap\big\{\Stab(\mrY) :\  \mrY\in\Phi^{00}\}$.
\end{definition}

We want to define $E^{00}$ and $P^{00}$ in analogy with $E^0$ and $P^0$.

\begin{question}
  Work under the assumption that $\mrX$ is type-definable and that $G$ acts transitively.
  How are the following properties connected?
  \begin{itemize}
    \item [1.] $\gamma_K({\mr x})$ is closed under conjunction
    \item [2.] the types in $Q_G$ are $K$-stationary
    \item [3.] $Q_G$ has small cardinality
    \item [4.] $G$ acts transitively on $Q_G$
    \item [5.] the types in $Q_G$ realized in $\mrX$ and $\mrX=\bigcup\{q(\mrX)\ :\ q({\mr x})\in Q_G\}$.
  \end{itemize}
\end{question}

% \begin{proposition}
%   For $\mrY\in\Phi^{00}$ define 

%   \ceq{\hfill\epsilon_\Y({\mr x},{\mr y})}{=}{\bigwedge_{g\in G}\big[{\mr x}\in g{\cdot}\mrY\iff{\mr y}\in g{\cdot}\mrY\big].}

%   Let $\M$ be a collection of $\LDelta$-models of cardinality $|\LDelta|$

%   \ceq{\hfill\epsilon_\Y({\mr x},{\mr y})}{\iff}{\big\{\big[\phi({\mr x})\iff\phi({\mr y})\ :\ \big]\big\}.}
% \end{proposition}


% and

% \ceq{\hfill E^{00}}{=}{\big\{\epsilon_\Y({\mr x},{\mr y})\ :\  \mrY\in\Phi^{00}\big\},}

% where

% \ceq{\hfill\epsilon_\Y({\mr x},{\mr y})}{=}{\bigwedge_{g\in G}\big[{\mr x}\in g{\cdot}\mrY\iff{\mr y}\in g{\cdot}\mrY\big].}

% Let $P^{00}$ be the set of types of the form $\big\{\epsilon({\mr x}\,;{\mr a})\ :\ \epsilon({\mr x}\,;{\mr y})\in E^{00}\big\}$ for ${\mr a}\in\mrX$.

% \begin{proposition}\label{prop_G0_inclusione2}
%   Assume that $G$ acts transitively.
%   Then $K\subsetyeq G^0$.\smallskip

%   % \ceq{\hfill \Stab(Q_G)}{\subseteq}{\big\{g\in G\ :\ \mrD\cap g{\cdot}\mrD\textrm{ is }G\textrm{-syndetic for all }G\textrm{-syndetic }\mrD\in\BDelta(\grZ)\big\}}\smallskip

%   % \ceq{}{\subseteq}{\big\{g\in G\ :\ \mrD\cap g{\cdot}\mrD\neq\varnothing\textrm{ for any }G\textrm{-syndetic }\mrD\in\BDelta(\grZ)\big\}}\smallskip


%   % \ceq{\hfill \Stab(Q_G)}{\subseteq}{\big\{g\in G\ :\ \mrD\cap g{\cdot}\mrD\in\gamma_G({\mr x})\textrm{ whenever }\mrD\in\gamma_G({\mr x})\big\}}\smallskip

%   % \ceq{}{\subseteq}{\big\{g\in G\ :\ \mrD\cap g{\cdot}\mrD\neq\varnothing\textrm{ whenever }\mrD\in\gamma_G({\mr x})\big\}}\smallskip

%   % \ceq{}{\subseteq}{G^0.}

% \end{proposition}

% % We will revisit this proposition under the assumption of stability and prove the converse inclusion.
% % See Theorem~\ref{thm_Z0_stable}.\vspace*{-0.5\baselineskip}

% \begin{proof}
%   The first inclusion is left to the reader.
%   We prove the second.
%   Let $g$ be an element of the second set.
%   Pick any $\mrD\in\Phi$.
%   We need to show that $g\in\Stab(\mrD)$.
%   % A fortiori $\grW$ is the stabilizer of a set with finite  $\grZ$-orbit.
%   Let $\mrC$ be an equivalence class of $\epsilon_\D({\mr x},{\mr y})$.
%   As $G$ acts transitively, $\mrC$ is $G$-syndetic.
%   Then $\mrC\cap g{\cdot}\mrC\neq\varnothing$.
%   As $\epsilon_\D({\mr x},{\mr y})$ is $G$-invariant, we conclude that $g{\cdot}\mrC=\mrC$.
%   But $\mrD$ is union of such equivalence classes.
%   Then $\mrD=g{\cdot}\mrD$.
% \end{proof}
% However it is not true in general, as the following example shows.

% \begin{example}\label{ex_H_neq_acleq}
%   Let $T_{\rm dlo}\models\U$.
%   Let $\mrX=\grZ=\U$ and $\Delta=\{{\mr x}<{\gr z}\}$.
%   It is easy to see that there are plenty of $G$-syndetic $\BDelta(\grZ)$-formulas but there is no nontrivial $\BDelta(\grZ)$-formula with finite $G$-orbit.
%   Therefore $P$ is empty and $\Stab(P)=G$.
% \end{example}

\begin{comment}
The following normal subgroup of $G$ is particularly interesting

{
\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{8ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\ceq{\hfill G^0}{=}{\big\{g\in G\ :\ g{\cdot}\mrD=\mrD\textrm{ for every }G\textrm{-syndetic }\BDelta(\grZ)\textrm{-type-definable set }\mrD\big\}}.
}

Note that by Exercise~\ref{ex_syndetic_type_vs_formulas} we can replace type-definable with definable in the definition of $G^0$.

\begin{proposition}
  Assume the action of $G$ is regular.
  Let $K\le G$ be such that all $K$-orbits (that is, $K{\cdot}{\mr a}$, for ${\mr a}\in\mrX$) are $\BDelta(\grZ)$-type-definable.
  Then, if $K$ has finite index, $G^0\le K$.
\end{proposition}

\begin{proof}
  Let $g\in G^0$.
  As $K$ has finite index and the action is transitive $K{\cdot}{\mr a}$ is $G$-syndetic for every ${\mr a}\in\mrX$.
  Then $g{\cdot}K{\cdot}{\mr a}=K{\cdot}{\mr a}$.
  By regularity, $g{\cdot}K=K$, then $g\in K$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{An example}
  \def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
  \def\ceq#1#2#3{\parbox[t]{13ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

% In this section $G=\Aut(\UDelta)$ and $\mrX=p_0(\U^{\mr x})$, for some $p_0({\mr x})\in S_\Delta(\grZ)$.
Let ${\mr y}$ be a variable of the same sort of ${\mr x}$.
Below $\BDelta(\grZ)$ may also denote $\LDelta_{{\rm\,qf},\,{\mr x},{\mr y}}(\grZ)$.
In this section a $\BDelta(\grZ)$-definable finite equivalence relation is a formula $\epsilon({\mr x}\,;{\mr y})\in\BDelta(\grZ)$ such that $\epsilon(\mrX\,;\mrX)$ is an equivalence relation with finitely many classes.
Note that when $G$ acts transitively on $\mrX$, equivalence classes of $G$-invariant finite equivalence relations are $G$-syndetic sets.
% \begin{remark}\label{rem_trans_action}
  % Assume that $G$ acts transitively on $\mrX$.
  Define
  
  \ceq{\hfill e({\mr x}\,;{\mr y})}{=}{\big\{\epsilon({\mr x}\,;{\mr y})\in\BDelta(\grZ)\ :\ G\textrm{-invariant, finite equivalence relation}\big\}}.

  The $e({\mr x}\,;{\mr y})$-equivalence classes are those defined by the types
  
  \ceq{\hfill q({\mr x})}{=}{\big\{\epsilon({\mr x}\,;{\mr a})\in\BDelta(\grZ)\ :\ G\textrm{-invariant, finite equivalence relation}\big\}.}

% \end{remark}

\begin{fact}
  Assume that $G$ acts transitively on $\mrX$.
  Let $\mrD$ be a $\BDelta(\grZ)$-definable set that intersects $\mrX$ and has finite $G$-orbit.
  Then $\mrD$ is $G$-syndetic.
\end{fact}

\begin{proof}
  Let $g_i{\cdot}\mrD$, for $i=1,\dots,n$, enumerate the $G$-orbit of $\mrD$.
  Define 

  \ceq{\hfill\epsilon({\mr x}\,;{\mr y})}{=}{\bigwedge_{i=1}^n\big[{\mr x}\in g_i{\cdot}\mrD\ \iff\ {\mr y}\in g_i{\cdot}\mrD\big]}

  Clearly, $\epsilon({\mr x}\,;{\mr y})$ is $G$-invariant.
  Pick any ${\mr a}\in\mrD$.  
  Then $\epsilon(\U^{\mr x};{\mr a})\subseteq\mrD$.
  As the action is transitive, $\epsilon(\U^{\mr x};{\mr a})$, and a fortiori $\mrD$, is $G$-syndetic.
\end{proof}

\end{comment}

\begin{comment}

\begin{corollary}
  Let $G=\Aut(\U/A)$.
  Let $\mrX=p(\U^{\mr x})$ where $p({\mr x})$ is a complete $\GDelta(A)$-type.
  Then for every $\BDelta(\grZ)$-definable set $\mrD$ that intersects $\mrX$ the following are equivalent
  \begin{itemize}
    \item [1.]  $\mrC\subseteq\mrD$ for some $\mrC\in\acl^\eq\!A$ that intersects $\mrX$
    \item [2.]  $\mrD$ is $G$-syndetic.
  \end{itemize}
\end{corollary}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  Pick any ${\mr a}\in\mrC\cap\mrX$.
  We can assume that $\mrC=\epsilon(\U^{\mr x}\,;{\mr a})$ is an equivalence class of some finite equivalence relation $\epsilon({\mr x}\,;{\mr y})\in L(A)$ 
  As $G$ acts transitively on $\mrX$ the orbit of $\mrC$ coves $\mrX$.
  Therefore $\mrC\subseteq\mrD$, and a fortiori $\mrD$, is $G$-syndetic.

  \ssf2$\IMP$\ssf1.
  Let $Q_G$ be as in Lemma~\ref{lem_trans_action}.
  Pick any $q({\mr x})\in Q_G$.
  By syndeticity $q({\mr x})\proves{\mr x}\in g{\cdot}\mrD$ for some $g\in G$.
  Then $g^{-1}\!\cdot q({\mr x})\proves{\mr x}\in \mrD$.
  Pick any ${\mr a}\models g^{-1}\!\cdot q({\mr x})$.
  As $g^{-1}\!\cdot q({\mr x})\in Q_G$, by the second claim in the lemma and compactness,  $\epsilon(\U^{\mr x}\,;{\mr a})\subseteq\mrD$ for some finite equivalence relation $\epsilon({\mr x}\,;{\mr y})\in\GDelta(A)$.
\end{proof}
\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Strong syndeticity}\label{strong_syndeticity}

% Unfortunately, syndeticity is not preserved under intersection.
% To obtain closure under intersection, we need to push the concept to a higher level of complexity.

A set $\mrD\subseteq\mrX$ is \emph{strongly $H$-syndetic\/} if for every finite $F\subseteq H$ the set $\cap\,F{\cdot}\mrD$ is syndetic (recall that $F{\cdot}\mrD$ stands for $\{h{\cdot}\mrD: h\in F\}$).
Dually, we say that $\mrD$ is \emph{weakly $H$-thick\/} if for some finite $F\subseteq H$ the set $\cup\,F{\cdot}\mrD$ is thick.
Again, the same properties may be attributed to formulas and types when every conjunction of formulas in the type has the property.

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
In topological dynamic, strong syndedic sets are called \textit{thickly syndetic\/} and weak thickness is called \textit{piecewise syndetic.}
Newelski in~\cite{Newelski09} says \textit{weak generic\/} for weakly thick.
These are terminologies that defy my intuition.

\begin{lemma}\label{lem_strongly_syndetic}
  The intersection of two strongly $H$-syndetic sets is strongly $H$-syndetic.
\end{lemma}

\begin{proof}
  We may assume that all sets mentioned below are subsets of $\mrX$.
  Let ${\mr\D}$ and ${\mr\C}$ be strongly $H$-syndetic and let $C\subseteq H$ be an arbitrary finite set.
  It suffices to prove that $\mrB=\cap\, C{\cdot}({\mr\C}\cap{\mr\D})$ is $H$-syndetic. 
  Clearly $\mrB={\mr\C'}\cap{\mr\D'}$, where ${\mr\C'}=\cap\, C{\cdot}{\mr\C}$ and ${\mr\D'}=\cap\, C{\cdot}{\mr\D}$.
  Note that ${\mr\C'}$ and ${\mr\D'}$ are both strongly $H$-syndetic.
  In particular $\mrX=\cup\,F{\cdot}\mr\D'$ for some finite $F\subseteq H$.
  Note that
  
  \ceq{\hfill\cup\,F{\cdot}\mrB}{=}{\cup\,F{\cdot}\big[{\mr\C'}\ \cap\ {\mr\D'}\big]}

  \ceq{}{\supseteq}{\cup\,F{\cdot}\big[\big(\cap\, F{\cdot}{\mr\C'}\big)\ \cap\ {\mr\D'}\big]}
  
  \ceq{}{\supseteq}{ \big(\cap\, F{\cdot}{\mr\C'}\big)\ \cap\ \big(\cup\,F{\cdot}{\mr\D'}\big)}
  
  \ceq{}{=}{\cap\, F{\cdot}{\mr\C'}}
  
  As ${\mr\C'}$ is strongly $H$-syndetic, $\cap\, F{\cdot}{\mr\C'}$ is $H$-syndetic.
  Therefore $\cup\,F{\cdot}\mrB$ is also $H$-syndetic.
  The $H$-syndeticity of $\mrB$ follows.
\end{proof}

Define the following type

\ceq{\hfill\emph{${}^{\rm s}\kern-.2ex\gamma_H({\mr x})$}}{=}{\{\theta({\mr x})\in \BDelta({\grZ})\ :\ \theta({\mr x})\textrm{ is strongly }H\textrm{-syndetic}\}.}\smallskip

Note that Theorem~\ref{thm_gammaK} shows that $\gamma_K({\mr x})\subseteq{}^{\rm s}\kern-.2ex\gamma_G({\mr x})$.

\begin{corollary}\label{corol_str_gen}
  ${}^{\rm s}\kern-.2ex\gamma_H({\mr x})$ is finitely consistent, strongly $H$-syndetic, and $H$-invariant.
\end{corollary}

\begin{proof}
  Strong $H$-syndeticity is an immediate consequence of Lemma~\ref{lem_strongly_syndetic}.
  Finite consistency is a consequence of syndeticity.
  Finally, $H$-invariance is clear because any translate of a strongly $H$-syndetic formula is also strongly $H$-syndetic.
\end{proof}

The following is similar to Corollary~\ref{corol_q_pers}, but now we obtain also the converse implication.

\begin{corollary}\label{corol_q_w_pers}
  For every $\mrD\in\BDelta(\grZ)$ the following are equivalent
  \begin{itemize}
    \item [1.] ${}^{\rm s}\kern-.2ex\gamma_H({\mr x})\cup\{{\mr x}\in\mrD\}$ is finitely consistent
    \item [2.] $\mrD$ is weakly $H$-thick.
  \end{itemize}
\end{corollary}

\begin{proof}
  \ssf1$\IMP$\ssf2. 
  Similar to Corollary~\ref{corol_q_pers}.
  If ${}^{\rm s}\kern-.2ex\gamma_H({\mr x})\cup\{{\mr x}\in\mrD\}$ is finitely consistent, then $\neg\mrD$ is strongly $H$-syndetic.
  From Fact~\ref{fact_fip}, we obtain that $\neg\mrD$ not being strongly $H$-syndetic is equivalent to $\mrD$ being weakly $H$-thick.

  \ssf2$\IMP$\ssf1.
  Suppose ${}^{\rm s}\kern-.2ex\gamma_H({\mr x})\proves{\mr x}\notin\mrD$.
  Then $\neg\mrD$ is strongly $H$-syndetic.
  From Fact~\ref{fact_fip}, $\mrD$ is not weakly $H$-thick.
\end{proof}

The following theorem asserts that weak thickness is partition regular.

\begin{theorem}\label{thm_wt_partreg}
  If $\mrC\cup\mrB$ is weakly $H$-thick then $\mrB$ or $\mrC$ is weakly $H$-thick.
\end{theorem}

\begin{proof}
  If ${\mr x}\in \mrC\cup\mrB$ is consistent with ${}^{\rm s}\kern-.2ex\gamma_H({\mr x})$ then so is one of the two sets.
\end{proof}

Assume that every $\mrD\in\BDelta(\grZ)$ has a small $H$-orbit.
% For instance, the action presented in the definition above has small orbits.
A set $\mrD$ with small $H$-orbit is $H$-thick if and only if $\cap\,H{\cdot}\mrD$ is nonempty.
Note that the latter set is always $H$-invariant.

\begin{proposition}
  Assume that every $\mrD\in\BDelta(\grZ)$ has a small $H$-orbit.
  Then the following are equivalent for every $\mrD\in\BDelta(\grZ)$
  \begin{itemize}
    \item [1.] $\mrD$ is weakly $H$-thick
    \item [2.]$\mrD$ is syndetic relative to some $H$-invariant $\BDelta(\grZ)$-type-definable set $\mrC$.
  \end{itemize}
\end{proposition}

\begin{proof}
  \ssf1$\IMP$\ssf2. Let $F\subseteq H$ be finite and such that $\cup\,F{\cdot}\mrD$ is $H$-thick.
  Then \ssf2 holds if we take $\cap\,H{\cdot}(\cup\,F{\cdot}\mrD)$ as $\mrC$.

  \ssf2$\IMP$\ssf1. Let $F\subseteq H$ be finite and such that $\mrC\subseteq\cup\,F{\cdot}\mrD$.
  As $\mrC$ is, trivially, $H$-thick, $\mrD$ is weakly $H$-thick.
\end{proof}

% Note that 
% %from Corollary~\ref{corol_str_gen} and~\ref{corol_q_w_pers} 
% the $H$-translate of a weakly $H$-thick type is weakly $H$-thick.

\begin{exercise}
  Prove that the following are equivalent
  \begin{itemize}
    \item[1.] $\D$ is weakly $H$-thick
    \item[2.] $\D=\C\cap\B$ for some $H$-syndetic set $\B$ and some $H$-thick set $\C$
    \item [3.] there is a non $H$-syndetic set $\C$ such that $\D\cup\C$ is syndetic.
  \end{itemize}
\end{exercise}

\begin{exercise}
  Prove that $H$-syndetic sets are weakly $H$-thick.
\end{exercise}

\begin{question}
  Let $H\trianglelefteq G$.
  Does strongly $G$-syndetic implies strongly $H$-syndetic or vice versa?
  Does strongly $G$-syndetic implies $K$-syndetic?
\end{question}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The diameter of a Lascar type}\label{newelski}

As an application we prove an interesting property of the Lascar types.
Recall that $\Ll({\mr a}/A)$, the Lascar strong type of ${\mr a}\in\U^{\mr x}$, is the union of a chain of type-definable sets of the form $\big\{{\mr x}\ :\ d_A({\mr a},{\mr x})\le n\big\}$.
In this section we prove that $\Ll({\mr a}/A)$ is type-definable (if and) only this chain is finite.
In other words, only if the connected component of ${\mr a}$ in the Lascar graph has finite diameter.

It is convenient to address the problem in more general terms.
We work under Assumption~\ref{notation_GXphi} and also assume that $H\le\Aut(\UDelta)$ acts transitively on $\mrX$.
Let \emph{$C$\/} $\subseteq H$ be a set of generators of $H$ that is
\begin{itemize}
  \item[1.] symmetric i.e.\@ it contains the unit and is closed under inverse
  \item[2.] conjugacy invariant i.e.\@ $g{\cdot}C{\cdot}g^{-1}=C$ for every $g\in H$
\end{itemize}

We define a discrete metric on $\mrX$.
For ${\mr a},{\mr b}\in\mrX$ let \emph{$d_C({\mr a},{\mr b})$\/} be the minimal $n$ such that ${\mr a}\in C^n{\mr b}$.
This defines a metric which is $H$-invariant by \ssf2.
The \emph{diameter\/} of a set $\mrC\subseteq\mrX$ is the supremum of $d_C({\mr a},{\mr b})$ for ${\mr a},{\mr b}\in\mrC$.

We are interested in sufficient conditions for $\mrX$ to have finite diameter.
The notions introduced in Section~\ref{strong_syndeticity} offer some hint.

\begin{proposition}\label{prop_wpers_finite_diameter}
  Let $H$ act transitively on $\mrX$.
  Then, if $\mrX$ contains a weakly thick subset of finite diameter, $\mrX$ itself has finite diameter.
\end{proposition}

\begin{proof}
  Let $\mrC\subseteq\mrX$ be a set of finite diameter, say $n$.
  Let $F\subseteq H$ be finite.
  We claim that also $\cup\,F{\cdot}\mrC$ has finite diameter.
  In fact, pick any ${\mr a}\in\mrC$.
  Then $\mrC$ is contained in a ball of radius $n$ centered in ${\mr a}$. Let $m$ be the maximum of $d_C(h{\mr a}, k{\mr a})$ for $h,k,\in F$.
  Clearly, the diameter of $\cup\,F{\cdot}\mrC$ is at most $2n+m$.
  This proves the claim.

  By the claim, if there is a weakly thick subset of finite diameter, there is also a (plain) thick subset $\mrC\subseteq\mrX$ of finite diameter, say $n$.
  
  By the transitivity of the action, any two elements of $\mrX$ are of the form $h{\mr a}$, $k{\mr a}$ for some $h,k\in H$ and some ${\mr a}\in\mrC$.
  By thickness, there are ${\mr c}\in\mrC\cap h\mrC$ and ${\mr d}\in\mrC\cap k\mrC$.
  Then 

  \ceq{\hfill d_C(h{\mr a},\, k{\mr a})}{\le}{d_C(h{\mr a},\,{\mr c})\ +\ d_C({\mr c},\, {\mr d})\ +\ d_C({\mr d},\,k{\mr a})}

  \ceq{}{\le}{n+n+n.}

  Therefore the diameter of $\mrX$ does not exceed $3n$.
\end{proof}

\begin{theorem}\label{thm_newelski}
  Suppose that $\mrX$ and the sets ${\mr\X_n}=C^n{\mr a}$, for some ${\mr a}\in\mrX$, are type-definable.
  Then $\mrX$ has finite diameter.
\end{theorem}

\begin{proof}
  By Proposition~\ref{prop_wpers_finite_diameter}, it suffices to prove that ${\mr\X_n}$ is weakly thick.
  By Corollary~\ref{corol_q_w_pers} it suffices to show that for some $n$ the type ${}^{\rm s}\kern-.2ex\gamma_G({\mr x})$ is finitely satisfiable in ${\mr\X_n}$.
  Suppose not.
  Let $\psi_n({\mr x})\in{}^{\rm s}\kern-.2ex\gamma_G$ be a formula that is not satisfied in $\mr\X_n$.
  Then the type $p({\mr x})=\{\psi_n({\mr x}):n\in\omega\}$ is finitely consistent.
  From the type-definablity of $\mrX$ it follows that $p({\mr x})$ has a realization in $\mrX$.
  As this realization belongs to some ${\mr\X_n}$ we contradict the definition of $\psi_n({\mr x})$.
\end{proof}

% \ceq{\hfill p_n({\mr\X},{\mr\X})}{=}{\{\<{\mr a},{\mr b}\>\in{\mr\X^2}\ :\ {\mr a}\in K^n{\mr b}\}}

% Below we write ${\mr x}\in C^n{\mr y}$ for the type $p_n({\mr x},{\mr y})$ and ${\mr x}\in G\,{\mr y}$ for the disjunction of all these types (n.b.\@ an infinite disjunction of types need not be a type).

\begin{example}\label{ex_newelski}
  Let $\Delta=L_{{\mr x}\,{\gr z}}(A)$, where $|{\gr z}|=\omega$.
  Let $\mrX=\Ll({\mr a}/A)$ and $\grZ=\U^{\gr z}$.
  Assume that $\mrX$ is type definable.
  Let $G=\Aut(\U)$.
  Let $C\subseteq G$ be the set of automorphisms that fix a model containing $A$.
  Then the group $H$ generated by $C$ is $\Autf(\U/A)$ and $H{\cdot}{\mr a}=\mrX$.
  
  Then $d_C({\mr a},{\mr b})$ coincides with the distance in the Lascar graph.
  As shown in Proposition~\ref{prop_Lascar_distance_type_def} the sets $C^n{\cdot}{\mr a}=\{{\mr x}:d_C({\mr x},{\mr a})\le n\}$ are type definable.
  Then from Theorem~\ref{thm_newelski} it follows that $\Ll({\mr a}/A)$ is type definable (if and) only if it has finite diameter.
\end{example} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A tamer landscape}\label{tame_landscape}

Under suitable assumptions some notions introduced in this chapter coalesce, and we are left with a tamer landscape.
We will see an example in Theorem~\ref{thm_thick_finsat}.

\begin{theorem}\label{thm_coalesce}
  Work relative to some given $\mrY\subseteq\mrX$.
  The following are equivalent
  \begin{itemize}
    \item[1.] $H$-thick $\BDelta({\grZ})$-sets are $H$-wide
    \item[2.] $H$-syndetic $\BDelta({\grZ})$-sets are closed under intersection 
    \item[3.] $H$-syndetic $\BDelta({\grZ})$-sets are strongly $H$-syndetic
    \item[4.] weakly $H$-thick $\BDelta({\grZ})$-sets are $H$-thick.
  \end{itemize}
\end{theorem}

\begin{proof}
  Clearly \ssf2$\IFF$\ssf3$\IFF$\ssf4.

  \ssf1$\IMP$\ssf2.
  Let $\mrC$ and $\mrD$ be $H$-syndetic $\BDelta({\grZ})$-sets.
  Suppose for a contradiction that $\mrC\cap\mrD$ is not $H$-syndetic.
  Then $\neg(\mrC\cap\mrD)$ is $H$-thick.
  By \ssf1 and Theorem~\ref{thm_syndetic_invariant2} there is a $H$-invariant type $p({\mr x})\in S_\Delta(\grZ)$ that is finitely consistent in $\mrY$ and such that $p({\mr x})\proves{\mr x}\notin\mrC\cap\mrD$.
  By completeness either $p({\mr x})\proves{\mr x}\notin\mrC$ or $p({\mr x})\proves{\mr x}\notin\mrD$.
  This is a contradiction because by Theorem~\ref{thm_syndetic_invariant} $p({\mr x})\proves{\mr x}\in\mrC$ and $p({\mr x})\proves{\mr x}\in\mrD$.

  % \ssf2$\IMP$\ssf1.
  % By \ssf2, $\gamma_H({\mr x})$ is consistent.
  % Then $\mrC$ is $H$-syndetic if and only if $\gamma_H({\mr x})\proves{\mr x}\in\mrC$.
  % If $\mrD$ is $H$-thick, then $\neg\mrD$ is not $H$-syndetic.
  % Then $\gamma_H({\mr x})\notproves{\mr x}\notin\mrD$ by what remarked above.
  % Then $\mrD$ is $H$-wide by Theorem~\ref{thm_syndetic_invariant2}.

  \ssf4$\IMP$\ssf1. By Theorem~\ref{thm_wt_partreg}
\end{proof}

A subset $\mrY\subseteq\mrX$ is \emph{$H$-stationary\/} if there is a unique $H$-invariant $p({\mr x})\in S_\Delta(\grZ)$ finitely consistent in $\mrY$.
Nolte, by Theorem~\ref{thm_syndetic_invariant2} this is equivalent to requiring that $\mrD$ and $\neg\mrD$ cannot be both wide relative to
The conditions in Theorem~\ref{thm_coalesce} together with stationarity, produce further simplification.

\begin{fact}\label{fact_starionarity_thick_syndetic}
  Work relative to some given $\mrY\subseteq\mrX$.
  Assume the equivalent conditions in Theorem~\ref{thm_coalesce} hold.
  Suppose that the set $\mrY$ is $H$-stationary.
  Then the following are equivalent
  \begin{itemize}
    \item [1.] $\mrD$ is $H$-syndetic
    \item [2.] $\mrD$ is $H$-wide.
  \end{itemize}\smallskip
\end{fact}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  By assumption, $\gamma_{H,\Y}({\mr x})$ is consistent.
  Then $H$-syndetic $\BDelta({\grZ})$-sets are $H$-thick by Corollary~\ref{corol_def_mu}.
  Finally, they are  $H$-wide by \ssf1 of Theorem~\ref{thm_coalesce}.
  (Stationarity is not required in this direction.)

  \ssf2$\IMP$\ssf1.
  If $\mrD$ was not $H$-syndetic then $\neg\mrD$ would be $H$-thick and therefore, by the assumption, $H$-wide.
  This contradicts $H$-stationarity.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Definable groups}\label{definablegroups}

\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
Section under major revision.

In this section we assume that $\grZ$ and $\mrX$ are type-definable.
Moreover we assume that $\grZ$ is a group that acts on $\mrX$.
The group operations and the group action are assumed definable.
We use the symbol $\,\cdot\,$ for both the group multiplication and the group action.
Let $\Psi\subseteq L_{\mr x}(\U)$.
In this section $\Delta$ contains formulas $\phi({\mr x}\,;{\gr z})$ of the form  $\psi({\gr z^{-1}}\!\cdot{\mr x})$ for $\psi({\mr x})\in\Psi$.
The sets $\phi(\mrX\,;\grZ)$ are $\grZ$-invariant.
We write ${\gr 1}$ for the identity of $\grZ$.
Note that $\phi(\mrX\,;{\gr g})={\gr g}\cdot\phi(\mrX\,;{\gr 1})$.

Note that as $\mrX$ and $\grZ$ are assumed to be type-definable, $\UDelta$ is a saturated $\LDelta$-structure.
It is worth noticing that automorphisms of $\UDelta$ need not preserve the group operations nor the group action.

To each ${\gr h}\in\grZ$ we associate the $\LDelta$-automorphism $\<{\mr a}\,;{\gr g}\>\mapsto\<{\gr h}{\cdot}{\mr a}\,;{\gr h}{\cdot}{\gr g}\>$.
Therefore $\grZ$ is, up to isomorphism, a subgroup of $\Aut(\UDelta)$.
For any ${\gr g}\in\grZ$, the orbit of $\phi(\mrX\,;{\gr g})$ under the action of $\grZ$ is $\{\phi(\mrX\,;{\gr h}) : {\gr h}\in\grZ\}$.
Therefore it coincides with the orbit under the action of $\Aut(\UDelta)$.
% The following fact follows immediately.

% \begin{fact}
%   For every  $\BDelta(\grZ)$-type-definable set $\mrD$ the following are 
%   \begin{itemize}
%     \item [1.] the $G$-orbit of $\mrD$ is bounded
%     \item [2.] the $\grZ$-orbit of $\mrD$ is bounded.
%   \end{itemize}
% \end{fact}


% In the applications $H$ will be either $\Autf(\UDelta)$ or $\Aut(\UDelta/M)$.

% \def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
% \def\ceq#1#2#3{\parbox[t]{6ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

% \begin{proposition}\label{prop_Gsyndetic_thick}
%   Let $\mrD$ be a $\BDelta(\grZ)$-definable set.
%   Assume that $\gamma_H({\mr x})$ is consistent.
%   Then \ssf1$\IMP$\ssf2 holds, where
%   \begin{itemize}
%     \item [1.] $\mrD$ is $\grZ$-syndetic
%     \item [2.] ${\gr g}{\cdot}\mrD$ is $H$-wide for every ${\gr g}\in\grZ$.
%   \end{itemize}
% \end{proposition}

% We will revisit this proposition under the assumption of stability and with $\Autf(\U^\Delta)$ for $H$~--~then the consistency of $\gamma_H({\mr x})$ is guaranteed, and also the converse implication holds.
% See Theorem~\ref{thm_Gsyndetic_thick}.\vspace*{-0.5\baselineskip}
% %
% \begin{proof}
%   Let ${\gr g}$ be given.
%   If $\mrD$ is $\grZ$-syndetic, then so is ${\gr g}{\cdot}\mrD$.
%   Then ${\gr g}{\cdot}\mrD$ is, a fortiori, $G$-syndetic.
%   Therefore \ssf2 follows from Proposition~\ref{prop_Gsyndetic_Hthick}.
% \end{proof}

We also consider the action an arbitrary subgroup $H\le\Aut(\UDelta)$.
We write \emph{$({\gr g})_H$\/} for the $H$-orbit of ${\gr g}$, that is, the set $\{f({\gr g})\ :\ f\in H\}$.

\begin{proposition}\label{prop_wideHcojugate}
  Let $\theta({\mr x}\,;{\gr z_1},\dots,{\gr z_n})$ be a Boolean combination of formulas $\phi_i({\mr x}\,;{\gr z_i})$ for some $\phi_i({\mr x}\,;{\gr z})\in\Delta$.
  Then for every ${\gr h_i}\in({\gr g_i})_H$ the following are equivalent
  \begin{itemize}
    \item [1.] $\theta({\mr x}\,;{\gr g_1},\dots,{\gr g_n})$ is $H$-wide
    \item [2.] $\theta({\mr x}\,;{\gr h_1},\dots,{\gr h_n})$ is $H$-wide.
  \end{itemize}
\end{proposition}

\begin{proof}
  Without loss of generality we can assume that only conjunctions occur in $\theta({\mr x}\,;{\gr g_1},\dots,{\gr g_n})$.
  Let ${\mr\C_i}=\phi_i(\mrX\,;{\gr 1})$.
  Then \ssf1 says that $\mrC={\gr g_1}{\cdot}{\mr\C_1}\cap\dots\cap{\gr g_n}{\cdot}{\mr\C_n}$ is $H$-wide.
  Let $f_i\in H$ be such that ${\gr h_i}=f_i({\gr g_i})$.
  Then, by Corollary~\ref{corol_intersectionGwide} also the intersection of the sets $f_i[\mrC]$ is $H$-wide.
  A fortiori the intersection of the sets $f_i[{\gr g_i}{\cdot}{\mr\C_i}]$ is $H$-wide.
  As $f_i[{\gr g_i}{\cdot}{\mr\C_i}]=f_i({\gr g_i}){\cdot}{\mr\C_i}$ the equivalence follows.
\end{proof}

Note that applying the theorem to  $H=\grZ$ we obtain that if $\theta({\mr x}\,;{\gr 1},\dots,{\gr 1})$ is $\grZ$-wide then $\theta({\mr x}\,;{\gr g_1},\dots,{\gr g_n})$ is $\grZ$-wide for every ${\gr g_1},\dots,{\gr g_n}\in\grZ$.
Below we prove a generalization of this. 

If $\grA\subseteq\grZ$, we write \emph{$\<\grA\>$} for the subgroup generated by $\grA$.

\begin{proposition}\label{prop_stabilizer1}
  \def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
  \def\ceq#1#2#3{\parbox[t]{15ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}
  Assume $H{\cdot}\grZ=\grZ{\cdot}H$.
   Let $\theta({\mr x}\,;{\gr z_1},\dots,{\gr z_n})$ be a Boolean combination of formulas $\phi_i({\mr x}\,;{\gr z_i})$ for some $\phi_i({\mr x}\,;{\gr z})\in\Delta$.
  Let ${\gr g}\in\grZ$ be arbitrary.
  Assume that $\theta({\mr x}\,;{\gr 1},\dots,{\gr 1})$ is $H$-wide.
  Then $\theta({\mr x}\,;{\gr h_1},\dots,{\gr h_n})$ is $H$-wide for every 
  
  \ceq{\hfill{\gr h_1},\dots,{\gr h_n}}{\in}{\Big\<\bigcup_{{\gr g}\in\grZ}({\gr g})_H^{-1}\!\cdot({\gr g})_H\Big\>.}
\end{proposition}

\begin{proof}
  We proceed by induction on the number of factors of the form ${\gr a^{-1}}\!\cdot{\gr b}$, for some ${\gr a},{\gr b}\in({\gr g})_H$, that occur in ${\gr h_1},\dots,{\gr h_n}$.
  Without loss of generality we can assume that only conjunctions occur in $\theta({\mr x}\,;{\gr g_1},\dots,{\gr g_n})$.
  Let ${\mr\C_i}=\phi_i(\mrX\,;{\gr 1})$.
  Assume inductively that ${\gr h_1}{\cdot}{\mr\C_1}\cap\dots\cap{\gr h_n}{\cdot}{\mr\C_n}$ is $H$-wide.
  Pick two arbitrary ${\gr a},{\gr b}\in({\gr g})_H$.
  By Remark~\ref{rem_invariance_normalsubg} 
  
  \hspace*{7ex}${\gr a}\cdot{\mr\C_1}\ \cap\ {\gr a}\cdot{\gr h_1^{-1}}\!\cdot{\gr h_2}\cdot{\mr\C_2}\ \cap\ \dots\dots\ \cap\ {\gr a}\cdot{\gr h_1^{-1}}\!\cdot{\gr h_n}\cdot{\mr\C_n}$ is $H$-wide.
  
  By Proposition~\ref{prop_wideHcojugate}, in this intersection we can replace ${\gr a}\cdot{\mr\C_1}$ by ${\gr b}\cdot{\mr\C_1}$.
  Then finally 

  \hspace*{7ex}${\gr h_1}\cdot{\gr a^{-1}}\!\cdot{\gr b}\cdot{\mr\C_1}\ \cap\ {\gr h_2}\cdot{\mr\C_2}\ \cap\ \dots\dots\ \cap\ {\gr h_n}\cdot{\mr\C_n}$ is $H$-wide.
\end{proof}

% In Section~\ref{stable_groups} we will give an interesting characterization of this group under the assumption of stability.

\begin{comment}
\section{Tentative}

In this section we work over a given $M\preceq\U^\Delta$.

Let $\mrD\subseteq\mrX$ be definable by some $p({\mr x})\subseteq\BDelta(M)$.
We say that $\mrD$ has 

A formula $\psi({\mr x})\in L$ is \emph{symmetric\/} if $\psi({\gr g}\cdot{\mr x})\iff\psi({\gr g^{-1}}\!\cdot{\mr x})$ holds for every ${\gr g}\in\grZ$.
We say that $\Psi\subseteq L_{\mr x}$ is symmetric if every formula in $\Psi$ is symmetric.
When $\Psi$ is symmetric, the map $\iota:\<{\mr a}\,;{\gr g}\>\mapsto\<{\mr a}\,;{\gr g^{-1}}\>$ is an automorphism of $\U^\Delta$.
As $H$ is normal and $\iota$ is an involution, $\iota\,H=H{\cdot}\iota$ and $H\cup\iota\,H$ is a subgroup of $G$.
In particular, if $f\in H$ and ${\gr g}\in\grZ$ then $f({\gr g^{-1}})=f'({\gr g})^{\gr -1}$ for some $f'\in H$.
We write \emph{$K$\/} for $H\cup\iota\,H$.

When $\Psi$ is symmetric, we can strengthen Fact~\ref{prop_wideHcojugate} as follows.

\begin{fact}\label{prop_wideHcojugate_symm}
  Let $\mrD=\phi(\mrX\,;{\gr 1})$ for some $\phi({\mr x}\,;{\gr z})\in\pmDelta$.
  For $i=1,2$ let ${\gr h_i}\in({\gr g_i})_K$. 
  Then \ssf1 and \ssf2 of Fact~\ref{prop_wideHcojugate} are equivalent
\end{fact}

\begin{proof}
  Let $f_i\in K$ be such that ${\gr h_i}\in f_i{\gr g_i})$.
  By Remark~\ref{rem_invariance_normalsubg} it suffices to consider the case $f_1\in H$ and $f_2\in\iota\,H$.
  Then $f_2({\gr g_2})=f_3({\gr g_2^{-1}})$.
  By Fact~\ref{prop_wideHcojugate}, \ssf2 is equivalent to claiming that ${\gr g_1}{\cdot}\mrD\ \cap\ {\gr g_2^{-1}}{\cdot}\mrD$ is $H$-wide. 
  By symmetry ${\gr g_2^{-1}}{\cdot}\mrD={\gr g_2}{\cdot}\mrD$, so the fact follows.
\end{proof}


For any $\grW\subseteq\grZ$, we write $\<\grW\>$ for the subgroup generated by $\grW$.

\begin{proposition}
  Assume $\Psi$ is symmetric.
  Let $\mrD=\phi(\mrX\,;{\gr 1})$ for some $\phi({\mr x}\,;{\gr z})\in\pmDelta$.
  Let ${\gr g}$ be such that $\mrD\cap{\gr g}{\cdot}\mrD$ is $H$-wide.
  Then $\mrD\cap{\gr g'}{\cdot}\mrD$ is $H$-wide for every ${\gr g'}\in\<\,({\gr g})_{K}^2\>$.
\end{proposition}

\begin{proof}
  Assume inductively that $\mrD\cap{\gr g'}{\cdot}\mrD$ is $H$-wide, where ${\gr g'}\in\<\,({\gr g})_{K}^2\>$.
  Pick two arbitrary ${\gr a},{\gr b}\in({\gr g})_K$.
  We claim that $\mrD\cap{\gr a}{\cdot}{\gr b}{\cdot}{\gr g'}{\cdot}\mrD$ is $H$-wide.
  From the induction hypothesis it follows that ${\gr b}{\cdot}\mrD\cap{\gr b}{\cdot}{\gr g'}{\cdot}\mrD$ is $H$-wide.
  By Fact~\ref{prop_wideHcojugate_symm}, ${\gr a^{-1}}{\cdot}\mrD\cap{\gr b}{\cdot}{\gr g'}{\cdot}\mrD$ is $H$-wide and the claim follows.
\end{proof}
\end{comment}


%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notes and references}

In Example~\ref{ex_newelski} we prove a theorem of Newelski's~\cite{Newelski}.
The original proof is rather long and complex.
A simplified proof (also due, reportedly, to Newelski) appears in~\cite{Pelaez}*{Section 3.3} and~\cite{Casanovas}*{Chapter 9}.
The proof here is a streamlined and generalized version of the latter~--~inspired by~\cite{Z16}.

\begin{biblist}[]\normalsize
\bib{Casanovas}{book}{
  author={Casanovas, Enrique},
  title={Simple theories and hyperimaginaries},
  series={Lecture Notes in Logic},
  volume={39},
  publisher={Cambridge
  University Press},
  date={2011},
  % pages={xiv+169},
  % isbn={978-0-521-11955-9},
  % review={\MR{2814891}},
  % doi={10.1017/CBO9781139003728},
}\smallskip
\bib{CK}{article}{
  author={Chernikov, Artem},
  author={Kaplan, Itay},
  title={Forking and dividing in ${\rm NTP}_2$ theories},
  journal={J. Symbolic Logic},
%  volume={77},
  date={2012},
%  number={1},
%  pages={1--20},
%  issn={0022-4812},
%  review={\MR{2951626}},
%  doi={10.2178/jsl/1327068688},
}\smallskip
\bib{Newelski09}{article}{
  author={Newelski, Ludomir},
  title={Topological dynamics of definable group actions},
  journal={J. Symbolic Logic},
  date={2009},
}\smallskip
\bib{Hr}{article}{
  label={Hr},
  author={Hrushovski, Ehud},
  title={Stable group theory and approximate subgroups},
  journal={J. Amer. Math. Soc.},
  volume={25},
  date={2012},
  number={1},
  pages={189--243},
  % issn={0894-0347},
  % doi={10.1090/S0894-0347-2011-00708-S},
}\smallskip
\bib{Newelski}{article}{
  author={Newelski, Ludomir},
  title={The diameter of a Lascar strong type},
  journal={Fund. Math.},
%  volume={176},
  date={2003},
%  number={2},
%  pages={157--170},
%  issn={0016-2736},
%  review={\MR{1971306}},
%  doi={10.4064/fm176-2-4},
}\smallskip
\bib{Pelaez}{book}{
  author={Pel\'aez, Rodrigo},
  title={\href{http://www.ub.edu/modeltheory/documentos/ThesisRPP.pdf}{About the Lascar group}},
  series={PhD Thesis},
  publisher={Universitat de Barcelona, Departament de L\'ogica, Hist\'oria i Filosofia de la Ci\'encia},
  date={2008},
  }\smallskip
\bib{Z16}{article}{
  author={Zambella, Domenico},
  title={On the diameter of Lascar strong types after Ludomir Newelski},
  conference={
  title={A tribute to Albert Visser},
  },
  book={
  % series={Tributes},
  % volume={30},
  publisher={Coll. Publ., [London]},
  },
  date={2016},
  status={\href{https://arxiv.org/abs/1605.00218}{arXiv:1605.00218}},
  %  pages={231--236},
  %  review={\MR{3559880}},
}\smallskip
\end{biblist}

  