% !TEX root = creche.tex
\documentclass[creche.tex]{subfiles}
\begin{document}

\chapter{Lascar invariant sets}
\label{invariantL}


\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{18ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\definecolor{brown}{RGB}{150, 50, 10}
\definecolor{green}{RGB}{10,120, 20}
\def\mr{\color{brown}}
\def\gr{\color{green}}


In this chapter we fix a signature $L$, a complete theory $T$ without finite models, and a saturated model $\U$ of inaccessible cardinality $\kappa$ strictly larger than $|L|$. Notation and implicit assumptions are as presented in Section~\ref{saturation}.\ref{monster}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Lascar strong types}
\label{Lst}
\def\equivL{\stackrel{\smash{\scalebox{.5}{\rm L}}}{\equiv}}


Let $\D\subseteq\U^{|{\gr z}|}$, where ${\gr z}$ is a tuple of length $<\kappa$. The \emph{orbit of $\D$ over $A$\/} is the set

\ceq{\hfill\emph{$\oorbit(\D/A)$}}{\deq}{\Big\{f[\D]\ :\ f\in\Aut(\U/A)\Big\}}

So, $\D$ is invariant over $A$ when $\oorbit(\D/A)=\big\{\D\big\}$. We say that \emph{$\D$ is Lascar invariant over $A$\/} if it is invariant over every model $M\supseteq A$. Recall that this means that if ${\gr a}\equiv_M{\gr c}$ for some model $M$ containing $A$ then ${\gr a}\in\D\iff{\gr c}\in\D$.


\begin{proposition}\label{prop_numero_quasi_invarianti}
  Let $\lambda=|L_{\gr z}(A)|$. There are at most $2^{2^{\lambda}}$ sets $\D\subseteq\U^{|{\gr z}|}$ that are Lascar invariant over $A$.
\end{proposition}

\begin{proof}
  Let $N$ be a model containing $A$ of cardinality $\le\lambda$. Every set that is Lascar invariant over $A$ is invariant over $N$. As $|L_{\gr z}(N)|=\lambda$ the bound follows from Proposition~\ref{prop_numberIS}.
\end{proof}

\begin{theorem}\label{thm_Lascar_indiscernibles}
  For every $\D$ and every $A\subseteq M$ the following are equivalent:
  \begin{itemize}
    \item[1.] $\D$ is Lascar invariant over $A$;
    \item[2.] every set in $\oorbit(\D/A)$ is $M\mbox{-}$invariant;
    \item[3.] $\oorbit(\D/A)$ has cardinality $\le 2^{2^{|L(A)|}}$;
    \item[4.] $\oorbit(\D/A)$ has cardinality $<\kappa$;
    \item[5.] ${\gr c_0}\in\D\iff{\gr c_1}\in\D$ for every $A\mbox{-}$indiscernible sequence $\<{\gr c_i}:i<\omega\>$.
  \end{itemize}
\end{theorem}

\begin{proof}
  The implication \ssf{1}$\IMP$\ssf{2} is clear because all sets in $o(\D/A)$ are Lascar invariant over $A$. When $|M|\le|L(A)|$ implication \ssf{2}$\IMP$\ssf{3} follows from the bounds discussed in Section~\ref{invariant}. So, we may temporary add this assumption on $M$ as, once the proof of the proposition is finished, it is easily seen to be redundant. Implication \ssf{3}$\IMP$\ssf{4} holds because $\kappa$ is strong limit.

  We now prove \ssf{4}$\IMP$\ssf{5}. Assume $\neg$\ssf{5}. Then we can find an  $A\mbox{-}$indiscernible sequence $\<{\gr c_i}:i<\kappa\>$ such that ${\gr c_0}\in\D\niff {\gr c_1}\in\D$. Define

  \ceq{\hfill E({\gr u}\,;{\gr v})}{\IFF}{{\gr u}\in\C\iff {\gr v}\in\C}\ \ \ for every $\C\in o(\D/A)$.

  Then $E({\gr u}\,;{\gr v})$ is an $A\mbox{-}$invariant equivalence relation. As $\neg E({\gr c_0}\,;{\gr c_1})$, indiscernibility over $A$ implies that $\neg E({\gr c_i\,},{\gr c_j})$ for every $i<j<\kappa$. Then $E({\gr u}\,;{\gr v})$ has $\kappa$ equivalence classes. As $\kappa$ is inaccessible, this implies $\neg$\ssf{4}.

  We prove \ssf{5}$\IMP$\ssf{1}. Assume \ssf{5} and fix any ${\gr a}\equiv_M{\gr b}$ for some model $M$ containing $A$. It suffices to prove that ${\gr a}\in\D\iff{\gr b}\in\D$. Let $p({\gr z})\in S(\U)$ be a global coheir of $\tp({\gr a}/M)=\tp({\gr b}/M)$. Let $c=\<{\gr c_i}:i<\omega\>$ be a Morley sequence of $p({\gr z})$ over $M,{\gr a},{\gr b}$. Then both ${\gr a},c$ and ${\gr b},c$ are $A\mbox{-}$indiscernible sequences. So from \ssf{5} we obtain ${\gr a}\in\D\iff{\gr c_0}\in\D\iff{\gr b}\in\D$. 
\end{proof}

The following corollary easily follows from Theorem~\ref{thm_Lascar_indiscernibles} and Proposition~\ref{prop_indiscernible_L(A,D)}. As an exercise the reader may wish to prove it using Proposition~\ref{prop_indiscernibles_set_model}.

\begin{corollary}
The following are equivalent
\begin{itemize}
\item[1.] $\D$ is Lascar invariant over $A$;
\item[2.] every sequence of $A$-indiscernibles is $L(A\,;\D)$-indiscernible.\QED
\end{itemize}
\end{corollary}

Given a tuple ${\gr a}\in\U^{|{\gr z}|}$, we write \emph{$\Ll(a/A)$\/} for the intersection of all sets containing ${\gr a}$ that are Lascar invariant over $A$. Clearly $\Ll({\gr a}/A)$ is Lascar invariant over $A$. We say that ${\gr a}$ and ${\gr b}$ have the same \emph{Lascar strong type over $A$\/} if ${\gr a}\in\D\iff{\gr b}\in\D$ for every set $\D$ that is Lascar invariant over $A$ or, in other words, if $\Ll({\gr a}/A)=\Ll({\gr b}/A)$. The symbol used is \emph{$a\stackrel{\smash{\scalebox{.5}{\rm\bf L}}}{\equiv}_Ab$}.

\noindent\llap{\textcolor{red}{\Large\danger}\kern1.5ex}Warning: the symbol $\Ll({\gr a}/A)$ is not standard. The relation ${\gr a}\equivL_A{\gr b}$ is sometime denoted by ${\gr a}E_{_{L/A}}{\gr b}$ or by ${\rm L{\jj}stp}({\gr a}/A)={\rm L{\jj}stp}({\gr b}/A)$.


\begin{proposition}
  The relation $\equivL_A$ is the finest equivalence relation with $<\kappa$ classes that is invariant over $A$.\QED
\end{proposition}

\begin{proof}
  Clearly $\equivL_A$ is an equivalence relation invariant over $A$. Each equivalence class is Lascar invariant over $A$, hence the number of equivalence classes is bounded by the number of Lascar invariant sets over $A$. To see that $\equivL_A$ is the finest of such equivalences. Suppose $\D$ is an equivalence class of an $A$-invariant equivalence relation with $<\kappa$ classes. Then $\oorbit(\D/A)$ has also cardinality $<\kappa$. Then $\D$ is Lascar invariant and as such is union of classes of the relation $\equivL_A$. 
\end{proof}


Let $p({\mr x})\in S(\U)$ be global type; we say that \emph{$p$ is Lascar invariant over $A$\/} if the sets $\D_{p,\phi}$ defined in Section~\ref{invariant} are all Lascar invariant over $A$.

\begin{proposition}\label{prop_Lascar_indiscernibles}
  Let $p({\mr x})\in S(\U)$ be a global type. Then the following are equivalent
  \begin{itemize}
    \item[1.] $p({\mr x})$ is Lascar invariant over $A$;
    \item[2.] every $A$-indiscernible sequence $c=\<{\gr c_i}:i<\omega\>$ is $A,{\mr a}\jj$indiscernible for every ${\mr a}\models p_{\restriction c}$.
  \end{itemize}
  Here we either assume $|{\gr z}|\ge\omega$ or in \ssf{2} we quantify over all $|{\gr z}|<\omega$.
\end{proposition}
\begin{proof}

  \def\ceq#1#2#3{\parbox[t]{30ex}{$\displaystyle #1$}\parbox[t]{5ex}{$\displaystyle\hfil #2$}{$\displaystyle #3$}}
  \ssf{2}$\IMP$\ssf{1}\quad If $p({\mr x})$ is not Lascar invariant over $A$ then ${\gr c_0}\in\D_{p,\phi}\niff {\gr c_1}\in\D_{p,\phi}$ for some $A$-indiscernible sequence $c=\<{\gr c_i}:i<\omega\>$ and some $\phi({\mr x}\,;{\gr z})\in L$. Then $p({\mr x})$ contains the formula $\phi({\mr x}\,;{\gr c_0})\niff \phi({\mr x}\,;{\gr c_1})$. Hence, $c$ is not indiscernible over any realization of $p({\mr x})_{\restriction{\gr c_0},{\gr c_1}}$ 

  \ssf{1}$\IMP$\ssf{2}\quad Assume \ssf{1} and fix an $A$-indiscernible sequence $c=\<{\gr c_i}:i<\omega\>$ and some $a\models p_{\restriction c}$. We need to prove that for every formula $\phi({\mr x}\,;z')\in L$, where $z'={\gr z_1},\dots,{\gr z_n}$, 

  \ceq{\hfill\phi({\mr a}\,;{\gr c_{0}},\dots,{\gr c_{n-1}})}{\iff}{\phi({\mr a}\,;{\gr c_{i_1}},\dots,{\gr c_{i_{n-1}}}).}

  holds for every $i_0<\dots<i_{n-1}<\omega$. Suppose not and let $m$ be any integer larger than $i_{n-1}$. Then the following equivalences cannot both be true

  \ceq{\hfill\phi({\mr a}\,;{\gr c_m},\dots,{\gr c_{m+n-1}})}{\iff}{\phi({\mr a}\,;{\gr c_0},\dots,{\gr c_{n-1}});}


  \ceq{\hfill\phi({\mr a}\,;{\gr c_m},\dots,{\gr c_{m+n-1}})}{\iff}{\phi({\mr a}\,;{\gr c_{i_0}},\dots,{\gr c_{i_{n-1}}}).}

  If the first is false, define $c'_k={\gr c_{km}},\dots,{\gr c_{km+n-1}}$ for all $k<\omega$. Otherwise, do this only for positive $k$ and set $c'_0={\gr c_{i_0}},\dots,{\gr c_{i_{n-1}}}$. In either cases $\<c'_k:k<\omega\>$ is a sequence of $A\jj$in\-dis\-cern\-i\-bles and $c'_0\in\D_{p,\phi}\niff c'_1\in\D_{p,\phi}$. This contradicts \ssf{1}.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The Lascar graph and Newelski's theorem}

Here we study Lascar strong types from a different viewpoint. The \emph{Lascar graph over $A$\/} has an arc between all pairs ${\gr a},{\gr b}\in \U^{|{\gr z}|}$ such that  ${\gr a}\equiv_M{\gr b}$ for some model $M$ containing $A$. We write \emph{$d_A(a,b)$\/} for the distance between ${\gr a}$ and ${\gr b}$ in the Lascar graph over $A$. Let us spell this out: $d_A({\gr a},{\gr b})\le n$ if there is a sequence ${\gr a_0},\dots,{\gr a_n}$ such that ${\gr a}={\gr a_0}$, ${\gr b}={\gr a_n}$, and ${\gr a_i}\equiv_{M_i}{\gr a_{i+1}}$ for some models $M_i$ containing $A$. We write \emph{$d_A(a,b)<\infty$\/} if ${\gr a}$ and ${\gr b}$ are in the same connected component of the Lascar graph over $A$.

\begin{proposition}\label{tipoforteLascarediametro} For every ${\gr a}\in\U^{|{\gr z}|}$

\ceq{\hfill\Ll({\gr a}/A)}{=}{\big\{{\gr c}\ :\ d_A({\gr a},{\gr c})<\infty\big\}.}
\end{proposition}


\begin{proof}
To prove inclusion $\supseteq$ it suffices to show that every Lascar $A\jj$invariant set containing ${\gr a}$ contains the set on the r.h.s. Let $\D$ be Lascar $A\jj$invariant, and let ${\gr b}\in\D$. Then $\D$ contains also every ${\gr c}$ such that ${\gr b}\equiv_M{\gr c}$ for some model $M$ containing $A$. That is, $\D$ contains every ${\gr c}$ such that $d_A({\gr b},{\gr c})\le 1$. It follows that $\D$ contains every ${\gr c}$ such that $d_A({\gr a},{\gr c})<\infty$. 

To prove inclusion $\subseteq$ we prove the set on the r.h.s.\@ is Lascar $A\jj$invariant. Suppose the sequence ${\gr a_0},\dots,{\gr a_n}$, where ${\gr a_0}={\gr a}$ and ${\gr a_n}={\gr c}$, witnesses $d_A({\gr a},{\gr c})\le n$ and suppose that ${\gr c}\equiv_M{\gr b}$ for some $M$ containing $A$, then the sequence ${\gr a_0},\dots,{\gr a_n},{\gr b}$ witnesses $d_A({\gr a},{\gr b})\le n+1$.
\end{proof}

We write \emph{Aut\kern.15ex{f}\kern.15ex$(\U/A)$\/} for the subgroup of $\Aut(\U/A)$ that is generated by the automorphisms that fix point-wise some model $M$ containing $A$. (The ``f'' in the symbol stands for \textit{fort\/}, the French word for \textit{strong}.) It is easy to verify that $\Autf(\U/A)$ is a normal subgroup of $\Aut(\U/A)$. The following is a corollary of Proposition~\ref{tipoforteLascarediametro}. 

\begin{corollary}
The following are equivalent
\begin{itemize}
 \item[1.] ${\gr a}\equivL_A{\gr b}$
 \item[2.] ${\gr a}=f{\gr b}$\ \ for some $f\in\Autf(\U/A)$.\QED
\end{itemize}
\end{corollary}

% \begin{corollary}
% Let $\Ll=\Ll({\gr a}/A)$ then the sets in $o(\Ll/A)$ is a partition of $\U^{|{\gr z}|}$.
% \end{corollary}
% \begin{proof}
% We claim that $f[\Ll]=\Ll$ for every $f\in\Aut(\U/A)$ such that $f{\gr a}\in\Ll$. To prove the claim assume $d({\gr a},f{\gr a})<\infty$. It suffices to show $\Ll\subseteq f[\Ll]$. If ${\gr b}\in\Ll$ then  $d({\gr a},{\gr b})<\infty$ so from Proposition~\ref{prop_Lascar_distance_type_def} we obtain $d(f{\gr a},f{\gr b})<\infty$ and therefore $d({\gr a},f{\gr b})<\infty$. Now the corollary follows because $\Ll=\Ll({\gr b}/A)$ for any ${\gr b}\in\Ll$.
% \end{proof}
% 
% \begin{corollary}
% Let $p({\gr z})\in S(A,{\gr a})$, then $p({\gr\U})\subseteq\Ll({\gr a}/A)$.\QED
% \end{corollary}

\begin{exercise}
  Prove that the equivalence relation ${\gr a}\stackrel{\smash{\scalebox{.5}{\rm\bf L}}}{\equiv}_A{\gr b}$ is the transitive closure of the relation: there is a sequence $\<{\gr c_i}:i<\omega\>$ indiscernible over $A$ such that ${\gr c_0}={\gr a}$ and ${\gr c_1}={\gr b}$.\QED
\end{exercise}

It may not be immediately obvious that the relation $d_A({\gr z},{\gr y})\le n$ is type-definable. 

\begin{proposition}\label{prop_Lascar_distance_type_def}
For every $n<\omega$ there is a type $p_n({\gr z},{\gr y})\subseteq L(A)$ equivalent to $d_A({\gr z},{\gr y})\le n$.  
\end{proposition}
\begin{proof}
It suffices to prove the proposition with $n=1$. Let $\lambda=|L(A)|$ and fix a tuple of distinct variables $w=\<w_i:i<\lambda\>$, then $p_1({\gr z},{\gr y})\;=\;\E w\;p(w,{\gr z},{\gr y})$ where

\ceq{\hfill p(w,{\gr z},{\gr y})}{=}{q(w)\ \cup\ \Big\{\phi({\gr z},w)\iff\phi({\gr y},w)\ :\ \phi({\gr z},w)\in L(A)\Big\}}

and $q(w)\subseteq L(A)$ is a consistent type with the property that all its realizations enumerate a model containing $A$.

It remains to verify that such a type exist. Let $\<\psi_i(x,w_{\restriction i}):i<\lambda\>$ be an enumeration of the formulas in $L_{x,w}(A)$, where $x$ is a single variable. Let 

\ceq{\hfill q(w)}{=}{\Big\{\E x\;\psi_i(x,w_{\restriction i})\;\imp\;\psi_i(w_i,w_{\restriction i})\ :\ i<\lambda\Big\}.}

Any realization of $q(w)$ satisfy the Tarski-Vaught test therefore it enumerates a model containing $A$. Vice versa it is clear that we can realize $q(w)$ in any model containing $A$.
\end{proof}

We conclude this section with a theorem of Ludomir Newelski. 

The following notions apply generally to any group $G$ acting on some set $\X$ and to any set $\D\subseteq \X$. Below we always have $G=\Autf(\U/A)$ and $\X=\U^{|{\gr z}|}$.  We say that \emph{$\D$ is drifting\/} if for every finitely many $f_1,\dots,f_n\in G$ there is a $g\in G$ such that $g[\D]$ is disjoint from all the $f_i[\D]$. We say that \emph{$\D$ is quasi-invariant\/} if for every finitely many $f_1,\dots,f_n\in G$ the sets  $f_i[\D]$ have non-empty intersection. We say that a formula or a type is drifting or quasi-invariant if the set it defines is.

The union of drifting sets need not be drifting. However, by the following lemma it cannot be quasi-invariant.

\begin{lemma}\label{lem_newelski}
The union of finitely many drifting sets in not quasi-invariant.
\end{lemma}





\begin{proof}
\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\noindent\parbox[t]{30ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

It is convenient to prove an apparently more general claim. If $\D_1,\dots,\D_n$ are all drifting and $\Ll$ is such that for some finite $F\subseteq G$\medskip 

\ceq{\sharp\hfill\Ll}{\subseteq}{\bigcup_{f\in F}f[\D_1\cup\dots\cup\D_n],} 

\noindent then $\Ll$ is not quasi-invariant. (The statement is slightly awkward since a superset of a quasi-invariant set must be quasi-invariant.)

The claim is vacuously true for $n=0$. Let $n$ be positive, let $\C=\D_1\cup\dots\cup\D_{n-1}$, and assume the claim holds for $n-1$. Since $\D_n$ is drifting there is a $g\in G$ such that $g[\D_n]$ is disjoint from $f[\D_n]$ for every $f\in F$, which implies that\medskip 

\ceq{\hfill\Ll\cap g[\D_n]}{\subseteq}{\bigcup_{f\in F}f[\C].} 

\noindent Hence for every $h\in G$ there holds\medskip 

\ceq{\hfill h g^{-1}[\Ll]\cap h[\D_n]}{\subseteq}{\bigcup_{f\in F}hg^{-1}f[\C].} 

\noindent Rewriting $\sharp$ as

\ceq{\hfill\Ll}{\subseteq}{\bigcup_{f\in F}f[\C]\ \cup\ \bigcup_{h\in F}h[\D_n],}


\noindent we observe that\medskip 


\ceq{\hfill \Ll \cap\bigcap_{h\in F}h g^{-1}[\Ll]}{\subseteq}{\bigcup_{f\in F}f[\C]\ \cup\ \bigcup_{h\in F}\bigcup_{f\in F}hg^{-1}f[\C].}\smallskip


\noindent By the induction hypothesis, the r.h.s.\@ cannot be quasi invariant. Hence neither is $\Ll$, proving the claim and with it the lemma.
\end{proof}

The following is a consequence of Baire's category theorem. We sketch a proof for the convenience of the reader.


\begin{lemma}\label{Baire}
Let $p(x)\subseteq L(B)$ and $p_n(x)\subseteq L(A)$, for $n<\omega$, be consistent types such that\smallskip

\ceq{\ssf{1.}\hfill p(x)}{\imp}{\bigvee_{n<\omega}p_n(x)}

\noindent Then there is an $n<\omega$ and a formula $\phi(x)\in L(A)$ consistent with $p(x)$ such that \smallskip

\ceq{\ssf{2.}\hfill p(x)\wedge\phi(x)}{\imp}{p_n(x)}
\end{lemma}
\begin{proof}
Negate \ssf{2} and choose inductively for every $n<\omega$ a formula $\psi_n(x)\in p_n(x)$ such that $p(x)\wedge\neg\psi_0(x)\wedge\dots\wedge\neg\psi_n(x)$ is consistent. By compactness, we contradict \ssf{1}.
\end{proof}



Finally we can prove Newelski's theorem.


\begin{theorem}[(Newelski)]
For every ${\gr a}\in\U^{|{\gr z}|}$ the following are equivalent
\begin{itemize}
 \item[1.] $\Ll({\gr a}/A)$ is type-definable;
 \item[2.] $\Ll({\gr a}/A)\ =\ \big\{{\gr c}\ :\ d_A({\gr a},{\gr c})<n\big\}$ for some $n<\omega$.
\end{itemize}
\end{theorem}
%\maintheorem*

\begin{proof}
Implications \ssf{2}$\IMP$\ssf{1} holds by Proposition~\ref{prop_Lascar_distance_type_def}. We prove  \ssf{1}$\IMP$\ssf{2}. Suppose $\Ll({\gr a}/A)$ is type-definable, say by the type $l({\gr z})$. Let $p({\gr z},{\gr y})$ be some consistent type (to be defined below) such that and $p({\gr z},{\gr y})\imp l({\gr z})\wedge l({\gr y})$. Then, in particular\smallskip

\ceq{\hfill p({\gr z},{\gr y})}{\imp}{\bigvee_{n<\omega}d_A({\gr z},{\gr y})<n.}

By Proposition~\ref{prop_Lascar_distance_type_def} and Lemma~\ref{Baire}, there is some $n<\omega$ and some $\phi({\gr z},{\gr y})\in L(A)$  consistent with $p({\gr z},{\gr y})$ such that\smallskip

\ceq{\sharp_1\hfill p({\gr z},{\gr y})\wedge\phi({\gr z},{\gr y})}{\imp}{d_A({\gr z},{\gr y})<n}.\smallskip

\noindent Below we define $p({\gr z},{\gr y})$ so that for every $\psi({\gr z},{\gr y})\in L(A)$\smallskip

\ceq{\sharp_2\hfill p({\gr z},{\gr a})\wedge\psi({\gr z},{\gr a})}{}{}\hfill is non-drifting whenever it is consistent. \smallskip

\noindent Drifting and quasi-invariance are relative to the action of $\Autf(\U/A)$ on $\U^{|{\gr z}|}$. Then, in particular, $p({\gr z},{\gr a})\wedge\phi({\gr z},{\gr a})$ is non-drifting and the theorem follows. In fact, by non-drifting, there are some ${\gr a_0},\dots, {\gr a_k}\in\Ll({\gr a}/A)$ such that every set $p(\U,{\gr c})\cap\phi(\U,{\gr c})$ for ${\gr c}\in\Ll({\gr a}/A)$ intersects some $p(\U, {\gr a_i})\cap\phi(\U,{\gr a_i})$. Let $m$ be such that $d_A({\gr a_i},{\gr a_j})\le m$ for every $i,j\le k$. From $\sharp_1$ we obtain that $d_A({\gr a},{\gr c})\le m+2n$. As ${\gr c}\in\Ll({\gr a}/A)$ is arbitrary, the theorem follows.

The required type $p({\gr z},{\gr y})$ is union of a chain of types $p_\alpha({\gr z},{\gr y})$ defined as follows\smallskip

\ceq{\hfill p_{0}({\gr z},{\gr y})}{=}{l({\gr z})\ \cup\ l({\gr y});}\smallskip

\ceq{\sharp_3\hfill p_{\alpha+1}({\gr z},{\gr y})}{=}{p_\alpha({\gr z},{\gr y})\ \cup\ \Big\{\neg\psi({\gr z},{\gr y})\in L(A)\ :\ p_\alpha({\gr z},{\gr a})\wedge\psi({\gr z},{\gr a}) \textrm{ is drifting}\Big\};}

\ceq{\hfill p_{\alpha}({\gr z},{\gr y})}{=}{\bigcup_{n<\alpha}p_{n}({\gr z},{\gr y})}\quad for limit $\alpha$.

\noindent Clearly, the chain stabilizes at some stage $\le|L(A)|$ yielding a type which satisfies $\sharp_2$. So we only need to prove consistency. We prove that $p_\alpha({\gr z},{\gr a})$ is quasi-invariant (so, in particular, consistent). Suppose that $p_n({\gr z},{\gr a})$ is quasi-invariant for every $n<\alpha$ but, for a contradiction, $p_\alpha({\gr z},{\gr a})$ is not. Then for some $f_1,\dots,f_k\in\Autf(\U/A)$

\ceq{\hfill p_\alpha({\gr z},{\gr a})}{\cup}{\bigcup^k_{i=1}p_\alpha({\gr z},f_i{\gr a})}

\noindent is inconsistent. By compactness there is some $n<\alpha$ and some $\psi_i({\gr z},{\gr y})$ as in $\sharp_3$ such that

\ceq{\hfill p_n({\gr z},{\gr a})}{\imp}{\neg\bigwedge^m_{j=1}\bigwedge^k_{i=1}\neg\psi_j({\gr z},f_i{\gr a})}

As $p_n({\gr z},{\gr a})$ is quasi-invariant, from Lemma~\ref{lem_newelski} we obtain that $p_n({\gr z},f_i{\gr a})\wedge\psi_j({\gr z},f_i{\gr a})$ is non-drifting for some $i,j$. Clearly we can replace $f_i{\gr a}$ with ${\gr a}$, then this contradicts the construction of $p_\alpha({\gr z},{\gr y})$ and proves the theorem.
\end{proof}

\begin{exercise}
Let $\Ll$ be quasi-invariant and let $\D$ be drifting, prove that  $\Ll\sm\D$ is quasi-invariant.\QED
\end{exercise}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Kim-Pillay types}\label{KPtypes}


Given a tuple ${\gr a}\in\U^{|{\gr z}|}$, we write \emph{$\K(a/A)$\/} for the intersection of all type-definable sets containing ${\gr a}$ that are Lascar invariant over $A$. Or, more concisely, the intersection of all sets that are type-definable over a model containing $A$. We call $\K(a/A)$ the \emph{Kim-Pillay strong type over $A$}. Clearly,  $\Ll({\gr a}/A)\subseteq\K({\gr a}/A)\subseteq\O({\gr a}/A)$. 

Clearly $\K({\gr a}/A)$ is Lascar invariant over $A$.  It also easy to see that $\K({\gr a}/A)$ is type-definable. In fact, by invariance, we can assume that all types in the intersection above are over $M$, for any fixed model containing $A$. Hence $\K({\gr a}/A)$ is the minimal type-definable set containing ${\gr a}$ and closed under the relation $\equivL_A$. It follows that if ${\gr b}\in\K({\gr a}/A)$ then $\K({\gr b}/A)\subseteq\K({\gr a}/A)$. 

If $\K({\gr a}/A)=\K({\gr b}/A)$, we say that ${\gr a}$ and ${\gr b}$ have the same  \emph{Kim-Pillay strong type over $A$}. We abbreviate this by \emph{$a\stackrel{\smash{\scalebox{.5}{\rm\bf KP}}}{\equiv}_Ab$}. In other words, ${\gr a}\equivKP_A{\gr b}$ holds when ${\gr a}\in\D\iff{\gr b}\in\D$ for every type-definable set $\D$ that is Lascar invariant over $A$.

%We say that ${\gr a}$ and ${\gr b}$ have the same \emph{Kim-Pillay strong type over $A$\/} if $\K({\gr a}/A)=\K({\gr b}/A)$ or, in other words, when ${\gr a}\in\D\iff{\gr b}\in\D$ for every type-definable set $\D$ that is Lascar invariant over $A$. We write \emph{$a\stackrel{\smash{\scalebox{.5}{\rm\bf KP}}}{\equiv}_Ab$}.

\noindent\llap{\textcolor{red}{\Large\danger}\kern1.5ex}Warning: the symbol $\K({\gr a}/A)$ is not standard. The symbol ${\gr a}\equivKP_A{\gr b}$ is not unusual, but others write ${\rm KP{\jj}stp}({\gr a}/A)={\rm KP{\jj}stp}({\gr b}/A)$ or ${\gr a}\mathrel{E_{_{{\rm KP}/A}}}{\gr b}$.

\begin{proposition}\label{prop_bardotto}
  Fix some ${\gr a}\in\U^{|{\gr z}|}$ and some $A\subseteq\U$. Then there is a type $e({\gr z}\,;{\gr w})\subseteq L(A)$ such that $\K({\gr b}/A)=e(\U\,;{\gr b})$ for all ${\gr b}\in\orbit({\gr a}/A)$ and $e({\gr z}\,;{\gr w})$ defines an equivalence relation on $\orbit({\gr a}/A)$.
\end{proposition}

\begin{proof}
  Notice that $\K({\gr a}/A)$ is type-definable over $A,{\gr a}$. In fact, if $f\in\Aut(\U/A,{\gr a})$ and $\D$ is a set containing ${\gr a}$ that is type-definable and Lascar invariant over $A$, then so is $f[\D]$.  Therefore $\K({\gr a}/A)$ is invariant over $A,{\gr a}$. As $\K({\gr a}/A)$ is type-definable, invariance implies that it is type-definable over $A,{\gr a}$. Let $e({\gr z}\,;{\gr w})\subseteq L(A)$ be such that $\K({\gr a}/A)=e(\U\,;{\gr a})$. 
  
  We prove that $\K({\gr b}/A)=e(\U\,;{\gr b})$ for all ${\gr b}\in\orbit({\gr a}/A)$. Let $f\in\Aut(\U/A)$ be such that $f{\gr a}={\gr b}$. If $\D$ is a type-definable Lascar invariant over $A$, then so is $f[\D]$. Therefore, $f$ is a bijection between type-definable sets that are Lascar invariant over $A$ and contain ${\gr a}$ and analogous sets containing ${\gr b}$. Then $f[\K({\gr a}/A)]=\K({\gr b}/A)$ and $\K({\gr b}/A)=e(\U\,;{\gr b})$ follows.
  
  We prove that $e({\gr b}\,;\U)\cap \orbit({\gr a}/A)$ is Lascar invariant over $A$. Let $f\in\Autf(\U/A)$ and ${\gr c}\in\orbit({\gr a}/A)$. Then $e({\gr b}\,;f{\gr c})$ is equivalent to  $e(f^{-1}{\gr b}\,;{\gr c})$ which in turn is equivalent to $e({\gr b}\,;{\gr c})$, by the invariance of $e(\U\,;{\gr c})$. 
  
  Finally we are ready to prove that $e({\gr z}\,;{\gr w})$ defines a symmetric relation on $\orbit({\gr a}/A)$. From what proved above, $e({\gr b}\,;\U)\cap \orbit({\gr a}/A)$ is a type-definable Lascar invariant set containing ${\gr b}$ and therefore it contains $\K({\gr b}/A)$. We conclude that for all ${\gr b},{\gr c}\in\orbit({\gr a}/A)$
  
  \ceq{\hfill e({\gr c}\,;{\gr b})}{\iff}{{\gr c}\in e(\U\,;{\gr b})}\medrel{\iff}${\gr c}\in\K({\gr b}/A)$\medrel{\imp}$e({\gr b}\,;{\gr c})$
  
  Reflexivity is clear; we prove transitivity. As remarked above, $\K({\gr b}/A)\subseteq\K({\gr c}/A)$, for all ${\gr b}\in\K({\gr c}/A)$ or equivalently $e({\gr b}\,;{\gr c})$. Hence if $e({\gr b}\,;{\gr c})$ then
  
  \ceq{\hfill e({\gr d}\,;{\gr b})}{\imp}{{\gr d}\in\K({\gr b}/A)}\medrel{\iff}${\gr d}\in\K({\gr c}/A)$\medrel{\imp}$e({\gr d}\,;{\gr c})$.
  
  Which completes the proof.
\end{proof}

\begin{corollary}\label{corol_KP_simmetry}
For every ${\gr a},{\gr b}\in\U^{|{\gr z}|}$ and $A\subseteq\U$ the following are equivalent
\begin{itemize}
\item[1.] ${\gr a}\in\K({\gr b}/A)$;
\item[2.] ${\gr b}\in\K({\gr a}/A)$;
\item[3.] $\K({\gr a}/A)=\K({\gr b}/A)$.\QED
\end{itemize}
\end{corollary}

The following useful lemma is the key ingredient in the proof of Theorem~\ref{thm_Krupinski}.

\begin{lemma}\label{lem_beq_global}
Let $p({\gr z})\subseteq L(A)$ and let $e({\gr z}\,;{\gr w})\subseteq L(A)$ define a bounded equivalence relation on $p(\U)$. Then there is a type $e'({\gr z}\,;{\gr w})\subseteq L(A)$ which defines a bounded equivalence relation (on $\U$) and refines $e({\gr z}\,;{\gr w})$ on  $p(\U)$.
\end{lemma}
\begin{proof} 
Let $\C=\<\C_i:i<\lambda\>$ enumerate the partition of $p(\U)$ induced by $e({\gr z}\,;{\gr w})$. Note that each $\C_i$ is type-definable over $A,{\gr a}$ for any ${\gr a}\in\C_i$. If $x=\<{\gr x_i}:i<\lambda\>$, we write $x\in\C$ for the type that is the conjunction of ${\gr x_i}\in\C_i$ for $i<\lambda$. 

We claim that the required type is 

\ceq{\hfill e'({\gr a}\,;{\gr b})}{\deq}{\E x'\in\C\ \E  x''\in\C \quad {\gr a},x'\equiv_A{\gr b},x''}

As the type above is invariant over $A$, we can assume that $e'({\gr a}\,;{\gr b})$ is type-definable over $A$. Moreover, it is clearly a reflexive and symmetric relation, so we only check it is transitive. Suppose ${\gr a},x'\equiv_A{\gr b},x''$ and  ${\gr b},y'\equiv_A{\gr c},y''$ for some $x',x'',y',y''\in \C$. Let $z$ be such that ${\gr a},x',z\equiv_A{\gr b},x'',y'$ then   $z\in\C$ and ${\gr a},z\equiv_A{\gr c},y''$.

The relation $e'({\gr a}\,;{\gr b})$ clearly refines the equivalence defined by $e({\gr z}\,;{\gr w})$ when restricted to  to $p(\U)$. To prove that it is bounded fix some $c\in\C$ and note that $e'({\gr a}\,;{\gr b})$  is refined by ${\gr a}\equiv_{A,c}{\gr b}$, which is bounded. 
\end{proof}

Finally, we have the following.

\begin{theorem}\label{thm_Krupinski}
Denote by $e_A(z\,;w)$ be the finest bounded equivalence relation on $\U^{|{\gr z}|}$ that is type-definable over $A$. Then for every ${\gr a}, {\gr b}\in\U^{|{\gr z}|}$ the following are equivalent
 \begin{itemize}
\item[1.] ${\gr a}\equivKP{\gr b}$
\item[2.] $e_A({\gr a}\,;{\gr b})$.\QED
\end{itemize} 
\end{theorem}
\begin{proof} 
  As  ${\gr a}\equivKP{\gr b}$ is equivalent to ${\gr a}\in\K({\gr b}/A)$, it suffices to prove that $e_A(\U\,;{\gr b})=\K({\gr b}/A)$ for every ${\gr b}\in\U^{|{\gr z}|}$. 
 
  $\subseteq$\quad The orbit of $e_A(\U\,;{\gr b})$ under $\Aut(\U/A)$ has cardinality $<\kappa$. Hence, by Theorem~\ref{thm_Lascar_indiscernibles}, it is  Lascar invariant over $A$. As $\K({\gr b}/A)$ is the least of such sets, $\K({\gr b}/A)\subseteq e_A(\U\,;{\gr b})$.
  
  $\supseteq$\quad Let $e({\gr z}\,;{\gr w})$ be the type-definable equivalence relation given by Proposition~\ref{prop_bardotto}. The orbit of $\K({\gr b}/A)$ under $\Aut(\U/A)$ has cardinality $<\kappa$. Hence the equivalence relation that $e({\gr z}\,;{\gr w})$ defines on $\orbit({\gr b}/A)$ is bounded. By Lemma~\ref{lem_beq_global} there is  be a type-definable bounded equivalence relation $e'({\gr z}\,;{\gr w})\subseteq L(A)$ that refines $e({\gr z}\,;{\gr w})$ on $\orbit({\gr b}/A)$. As $e'({\gr z}\,;{\gr w})$ is refined by $e_A({\gr z}\,;{\gr w})$, we obtain $e_A(\U\,;{\gr b})\subseteq e(\U\,;{\gr b})=\K({\gr b}/A)$.
\end{proof}


The \emph{logic $A$-topology}, or simply the  \emph{logic topology} when $A$ is empty, is the topology on $\U^{|{\gr z}|}$ whose closed sets are the type-definable Lascar $A$-invariant sets. It is clearly a compact topology. Its Kolmogorov quotient, that is $\U^{|{\gr z}|}/\equivKP$, is Hausdorff. In fact, by Corollary~\ref{corol_KP_simmetry}, the open sets $\neg\K({\gr a}/A)$ and $\neg\K({\gr b}/A)$ separate ${\gr b}\not\equivKP{\gr a}$.

\begin{exercise}
Let $\S({\gr a}/A)$ be the intersection of all definable sets that contain $a$ and are Lascar invariant over $A$. Prove that $\S({\gr a}/A)=\big\{{\gr b}\ :\ {\gr b}\;\equivSh_A {\gr a}\big\}$.\QED
\end{exercise}


\begin{exercise}
Prove that the clopen sets in the logic $A\jj$topology are definable over $\acl^\eq A$.\QED
\end{exercise}

\section{Notes}

The original proof of Newelski theorem is rather long and complex. A simplified proof appears in Rodrigo Pel\'aez's thesis (due, reportedly, essentially to Newelski himself). The proof here is a streamlined version the latter.

\begin{comment}


\section{Ziegler's example}

The language $L$ consists of a binary relation symbol $<$ and, for every positive integer $n$, a binary relation denoted by $|x-y|<n$. Consider the structure with domain $\QQ$ and the relation symbols interpreted in the natural way. Let $T$ be the theory of this structure.

\begin{proposition}
The theory $T$ has elimination of quantifiers.
\end{proposition}



$n\le d(x,z)\ \wedge\ m\le d(x,y)\ \imp\ n+m\le d(y,z)$

$x<y<z\ \wedge\ d(x,y)<n\ \wedge\ d(y,z)<m\ \imp\ d(x,z)<m+n$


$n\le d(x,y) \ \imp\ n+1\le d(x,y)$

$x<y\ \wedge\ n+1\le d(x,y) \ \imp\ \E z\ \big[x<z<y\ \wedge\ n\le d(x,z)\ \wedge\ 1\le d(z,y)\big]$







The language contains a ternary relation which we denote by $x<_zy$ and a unary function $f(x)$. 
\begin{itemize}
  \item[1.] $x<_zy$ is a dense liner order with least element $z$;
  \item[2.] $x<_zy<_zw\imp y<_xw$;
  \item[3.] $\displaystyle f^nz=z\wedge\bigwedge^{n-1}_{i=0}f^i(z)<_zf^{i+1}(z)$.
\end{itemize}

 
Write $r(x,y)$ for $x=y\vee y<_xf(x)\vee x<_yf(y)$


\section{Externally definable sets}
The set $\D\cap A^{|{\gr z}|}$ is called the \emph{trace\/} of $\D$ over $A$. For every formula $\psi({\gr z})\in L(\U)$ we define \emph{$\psi(A)$\/} $=$ $\psi({\gr\U})\cap A^{|{\gr z}|}$, that is, the trace on $A$ of the definable set $\psi({\gr\U})=\big\{{\gr a}\in\U^{|{\gr z}|}:\psi({\gr a})\big\}$. 

A set $\D$ is called \emph{externally definable\/} if there are a global type $p({\mr x})\in S(\U)$ and a formula $\phi({\mr x}\,;{\gr z})$ such that $\D=\D_{p,\phi}$. Equivalently, a set $\D$ is externally definable if it is the trace on $\U^{|{\gr z}|}$ of a set which is definable in some elementary extension of $\U$. This explains the terminology.

We prefer to deal with external definability in a different, though equivalent, way. 

\begin{definition}\label{def_epprox}
We say that $\D$ is \emph{approximable\/} by the formula $\phi({\mr x}\,;{\gr z})$ if for all finite $B\subseteq\U^{|{\gr z}|}$ there is a ${\mr b}\in\U^{|{\mr x}|}$ such that $\phi({\mr b}\,;B)=\D\cap B$. We may call the formula $\phi({\mr x}\,;{\gr z})$ the \emph{sort} of $\D$. If in addition we have that $\phi({\mr b}\,;{\gr\U})\subseteq\D$, we say that  $\D$ is \emph{approximable from below}. If  $\D\subseteq\phi({\mr b}\,;{\gr\U})$ we say that  $\D$ is \emph{approximable from above}.\QED
\end{definition} 

The following proposition is clear by compactness.

\begin{proposition}\label{lem_approx=external}
For every $\D$ the following are equivalent:
\begin{itemize}
\item[1.] $\D$ is approximable;
\item[2.] $\D$ is externally definable.\QED 
\end{itemize}
\end{proposition}

\begin{example}
Let $T$ be the theory a dense linear orders without endpoints and let $\D\subseteq\U$ be an interval. Then $\D$ is approximable both from below and from above by the formula \mbox{$x_1<z<x_2$}.  Now let $T$ be the theory of the random graph. Then every $\D\subseteq\U$ is approximable and, when $\D$ has small cardinality, it is approximable from above but not from below.\QED
\end{example}

In Definition~\ref{def_epprox}, the sort $\phi({\mr x}\,;{\gr z})$ is fixed (otherwise any set would be approximable). This requirement of uniformity may be dropped if the sets $B$ are allowed to be large enough.

\begin{proposition}\label{lem_approx_nonunif}
For every $\D$ the following are equivalent:
\begin{itemize}
\item[1.] $\D$ is approximable;
\item[2.] for every $B\subseteq\U^{|{\gr z}|}$ of cardinality $\le|L|$ there is $\psi({\gr z})\in L(\U)$ such that $\psi(B)=\D\cap B^{|{\gr z}|}$.
\end{itemize}
Similarly, the following are equivalent:
\begin{itemize}
\item[3.] $\D$ is approximable from below;
\item[4.]  for every $B\subseteq\D$ of cardinality $\le|L|$ there is $\psi({\gr z})\in L(\U)$ such that $B^{|{\gr z}|}\subseteq \psi({\gr\U})\subseteq\D$.
\end{itemize}
\end{proposition}

\begin{proof}
To prove \ssf{2}$\IMP$\ssf{1}, for a contradiction assume \ssf{2} and $\neg$\ssf{1}. For each formula $\psi({\mr x}\,;{\gr z})\in L$ choose a finite set $B$ such that $\psi({\mr b}\,;B)\neq\D\cap B$ for every ${\mr b}\in\U^{|{\mr x}|}$. Let $C$ be the union of all these finite sets. Clearly $|C|\le|T|$.  By \ssf{2} there are a formula $\phi({\mr x}\,;{\gr z})$ and a tuple ${\mr c}$ such that $\phi({\mr c}\,;C)=\D\cap C$, contradicting the definition of $C$.

The implication \ssf{1}$\IMP$\ssf{2} is obtained by compactness and the equivalence \ssf{3}$\IFF$\ssf{4} is proved similarly. 
\end{proof}

\begin{proposition}\label{prop_approx_el_eq}
If $\D$ is approximable of sort $\phi({\mr x}\,;{\gr z})$ then so is any $\C$ such that $\C\equiv\D$. The same holds for approximability from below and from above.
\end{proposition}

\begin{proof}
If the set $\D$ is approximable by $\phi({\mr x}\,;{\gr z})$ then for every $n$

\hfil$\displaystyle\A {\gr z_1},\dots,{\gr z_n}\;\E x\ \bigwedge^n_{i=1}\big[\phi({\mr x}\,;{\gr z_i})\ \iff\ {\gr z_i}\in\D\big]$. 

So the same holds for any $\C\equiv\D$. As for approximability from below, add the conjunct $\A {\gr z}\,\big[\phi({\mr x}\,;{\gr z})\imp {\gr z}\in\D\big]$ to the formula above, and similarly for approximability from above.
\end{proof}






Let $x$ be a possibly infinite tuple of variables and let $p(x)\subseteq L(\U)$. We can identify $p$ with the following family of sets

\ceq{\hfill\D_{p,\phi}}{=}{\big\{a\in\U^{|z|}\ :\ \phi(x,a)\in p\big\}}

as $\phi(x;z)$ ranges over pure formulas (the tuple $x$ is fixed while $z$ varies with $\phi$).

Given $A\subseteq\U$ and $\D\subseteq\U^{|z|}$ we call $D=\D\cap A^{|z|}$ the \emph{trace\/} of $\D$ on $A$. For $\psi(z)\in L(\U)$ we write \emph{$\psi(A)$\/} for $\psi(\U)\cap A^{|z|}$, the trace of $\psi(\U)$ on $A$.

Let $p(x)\in S(\U)$ be a global type and let $\phi(x;z)$ be a pure formula. Sets of the form $\D_{p,\phi}$ are called \emph{externally definable sets\/} as they may be seen as the trace on $\U$ of a set definable in an elementary extension of $\U$. We now give an equivalent description of externally definable sets.

We say that $\D\subseteq\U^{|z|}$ is an \emph{approximable set\/} if for some formula  $\phi(x;z)$, for every finite set $B\subseteq\U^{|z|}$ there exists a $b\in\U^{|x|}$ such that $\phi(b;B)=\D\cap B$. We may say that $\phi(x;z)$ approximates $\D$. We say that $\D$ is approximable \emph{in\/} $A$ if we can further require that $b\in A^{|x|}$. Terminology in this paragraph is not standard.

The following is immediate by compactness.

\begin{proposition}\label{lem_approx=external}
For every $\D\subseteq\U^{|z|}$ the following are equivalent:
\begin{itemize}
\item[1.] $\D$ is approximable;
\item[2.] $\D$ is externally definable.\QED 
\end{itemize}
\end{proposition}

In the definition of approximable we fixed a sort $\phi(x;z)$ otherwise every set would be trivially approximable. We leave to the reader to check that, if we require $\D$ to be approximable on sufficiently large sets, uniformity follows.

\begin{proposition}\label{lem_approx_nonunif}
For every $\D\subseteq\U^{|z|}$ the following are equivalent
\begin{itemize}
\item[1.] $\D$ is approximable;
\item[2.] for every $B\subseteq\U^{|z|}$ of cardinality $\le(|L|+\omega)^+$ there is a  $\psi(z)\in L(\U)$ such that $\psi(B)=\D\cap B$.
\end{itemize}
\end{proposition}

We say that a type $p(x)\subseteq L(\U)$ is \emph{finitely satisfiable in\/} $A$ if $\psi(A)\neq\0$ for every $\psi(x)\in p$. Notice that by elementarity every type $p(x)\subseteq L(M)$ is finitely satisfiable in $M$, for any model $M$. The following is clear:

\begin{proposition}\label{lem_approx_from=external_fin_sat}
For every $\D\subseteq\U^{|z|}$ the following are equivalent:
\begin{itemize}
\item[1.] $\D$ is approximable in $A$;
\item[2.] $\D$ is externally definable by a type finitely satisfiable in $A$.
\end{itemize}
\end{proposition}

\begin{proposition}\label{prop_coeredi_invarienti}
Let  $\D\subseteq\U^{|z|}$ be approximable in $A$, than it is invariant over $A$.
\end{proposition}

\begin{proof}
Suppose $\D$ is not invariant, say $a\in\D$ and $fa\notin\D$ for some $f\in\Aut(\U/A)$. Let $\phi(x;z)$ be the formula that approximates $\D$ in $A$. Then there is a $b\in A^{|x|}$ such that  $\phi(b;a)\wedge\neg\phi(b;f\!a)$ a contradiction.
\end{proof}

Of course, a similar fact holds for global types.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Il prodotto di tipi}\label{tipi_prodotto}

La seguente proposizione mostra che possiamo ragionevolmente parlare di tipo delle di Morley di $p$. Questo paragrafo \`e dedicato alla descrizione sintattica di questo tipo.

\begin{proposition}\label{prop_tiposequenzaMorley}
Sia $p\in S_x(\U)$ un tipo globale $A\jj$invariante e supponiamo che $a$ e $b$ siano due sequenze di Morley di $p$ su $A$. Allora $a\equiv_A c$. 
\end{proposition}
\begin{proof}
%Possiamo assumere che $a=\<a_i:i<\omega\>$ e $\bar c=\<c_i:i<\omega\>$ abbiano lunghezza $\omega$. 
Per indiscernibilit\`a, \`e sufficiente mostrare che $a_{\restriction i}\equiv_Ac_{\restriction i}$ per ogni $i<\omega$. Ragioniamo per induzione, assumiamo l'equivalenza come ipotesi induttiva, fissiamo una formula $\phi(\bar x_{\restriction i},{\gr x})\in L(A)$ e dimostriamo che 

\ceq{\hfill \phi(a_{\restriction i},{\gr a_i})}{\iff}{\phi(c_{\restriction i},{\gr c_i})} 

Se $\phi(a_{\restriction i},{\gr a_i})$ allora $\phi(a_{\restriction i},{\gr x})\in p$. Per l'ipotesi induttiva e per l'invarianza di $p$ otteniamo che anche  $\phi(c_{\restriction i},{\gr x})\in p$ e di qui $\phi(c_{\restriction i},{\gr c_i})$. L'equivalenza segue per simmetria.
\end{proof}

Per poter semplificare la definizione~\ref{def_prodotto_tipi} abbiamo bisogno del seguente lemma tecnico:

\begin{lemma}\label{lemma_prodotto}
Dati $p(x), q(y)\in S(\U)$, e due insiemi $A_i$, per $i=0,1$ su cui $q(y)$ \`e invariante, fissiamo $\phi(x,y)\in L(A_0\cap A_1)$ e delle tuple $a_i,b_i$ tali che $a_i\models p_{\restriction A_i}$ e $b_i\models q_{\restriction A_i,a_i}$. Allora $\phi(a_0,b_0)\iff\phi(a_1,b_1)$.
\end{lemma}
\begin{proof}
Supponiamo per cominciare che $A_0=A_1$ e denotiamo questo insieme con $A$. Assumiamo $\phi(a_0,b_0)$ e quindi, per la completezza di $q$, che $\phi(a_0,y)\in q$. Per la completezza di $p$  abbiamo che $a_0\equiv_Aa_1$. Quindi, per l'invarianza di $q$ otteniamo $\phi(a_1,y)\in q$ e da questo segue $\phi(a_1,b_1)$.

Per concludere, consideriamo il caso $A_0\neq A_1$. Sia $A=A_0\cup A_1$ e fissiamo $a_2\models  p_{\restriction A}$ e $b_2\models q_{\restriction A,a_2}(y)$. Per quanto sopra dimostrato otteniamo $\phi(a_0,b_0)\iff\phi(a_2,b_2)$ ed anche $\phi(a_2,b_2)\iff\phi(a_1,b_1)$.
\end{proof}

Conviene immaginarsi questa operazione di prodotto come il passo induttivo per la costruzione di una sequenza di Morley.

\begin{definition}\label{def_prodotto_tipi}
Dati $p(x),q(y)\in S(\U)$ dove $q(y)$ \`e un tipo invariante, definiamo il prodotto di $p$ e $q$ come il tipo:

%\ceq{\hfill p(x)\otimes q(y)}{=}{\Big\{\phi(x,y)\ :\ \phi(b,c) \textrm{ per qualche } a\models p_{\restriction A},\ b\models q_{\restriction A,a}(y) ed $A$ t\Big\}}

\ceq{\hfill\mbox{\emph{$p(x)\otimes q(y)$}}}{=}{\Big\{\phi(x,y)\ :\ \textrm{esistono } a,b\ \models\ \phi(x,y)\ \wedge\ p_{\restriction A}(x)\ \wedge\ q_{\restriction A,a}(y)\Big\}}

L'insieme $A$ nella definizione \`e uno qualsiasi che contiene i parametri di $\phi(x,y)$ e su cui $q(y)$ \`e invariante. Il lemma~\ref{lemma_prodotto} assicura che la definizione non dipende dal particolare insieme scelto.\QED
\end{definition}

Il lemma~\ref{lemma_prodotto} ha anche la seguente importante conseguenza:

\begin{corollary}\label{cor_otimes_completo}
Se $p(x),q(y)\in S(\U)$ e $q(y)$ \`e invariante, allora $p(x)\otimes q(y)$ \`e un tipo completo.
\end{corollary}

\begin{proof}
Sia $\phi(x,y)\in L(\U)$. Fissiamo un insieme $A$ contenente i parametri di $\phi(x,y)$ e su cui $q(y)$ sia invariante. Fissiamo $a,b$ arbitrari tali che $a\models p_{\restriction A}(x)$ e $b\models q_{\restriction A,a}(y)$. Dal lemma~\ref{lemma_prodotto} otteniamo che $\phi(x,y)\in p(x)\otimes q(y)$ se e solo se $\phi(a,b)$.
\end{proof}


\begin{corollary}
Se $p(x),q(y)\in S(\U)$ sono tipi globali $A\jj$invarianti, allora anche $p(x)\otimes q(y)$ \`e $A\jj$invariante.
\end{corollary}

\begin{proof}
Sia $\phi(x,y,z)\in L$, sia $c$ arbitrario tale che  $\phi(x,y,c)\in p(x)\otimes q(y)$, e sia $c'\equiv_Ac$. Fissiamo $a\models p_{\restriction A,c,c'}$. Poich\'e $p$ \`e invariante su $A$, otteniamo $a,c\equiv_Aa,c'$. Ora fissiamo un $b$ arbitrario tale che $b\models q_{\restriction A,c,c',a}$. Per l'invarianza di $q$ su $A$ otteniamo  $a,b,c\equiv_Aa,b,c'$ e quindi $\phi(a,b,c')$. Seque che $\phi(x,y,c)\in p(x)\otimes q(y)$.
\end{proof}

\begin{proposition}
Se $p(x),q(y)\in S(\U)$ sono finitamente soddisfacibili su $A$, allora $p(x)\otimes q(y)$ \`e finitamente soddisfacibile su $A$.
\end{proposition}

\begin{proof}
Sia $\phi(x,y)\in p(x)\otimes q(y)$ arbitraria e fissiamo un $B$ contenente $A$ ed i parametri di $\phi(x,y)$. Quindi esistono $a,b\models\phi(x,y)\,\wedge\,p_{\restriction B}(x)\,\wedge\,q_{\restriction B,a}(y)$. Allora $\phi(a,y)\in q$, e quindi $\phi(a,b')$ per un qualche $b'\in A$. Allora $\phi(x,b')\in p$, e quindi $\phi(a',b')$ per qualche $a'\in A$.
\end{proof}


Dato $p(x)\in S(\U)$ un tipo globale invariante. Sia $\<x_i:i<\omega\>$ una sequenza di tuple di variabili con $|x|=|x_i|$. Definiamo induttivamente

\ceq{\hfill p^{(1)}(x_0)}{=}{p(x_0)}; 

\ceq{\hfill p^{(n+1)}(x_0,\dots,x_n)}{=}{p^{(n)}(x_0,\dots,x_{n-1})\otimes p(x_n)};

\ceq{\hfill p^{(\omega)}(x_i:i<\omega)}{=}{\bigcup_{n<\omega}p^{(n+1)}(x_0,\dots, x_n)}.

La seguente proposizione giustifica la definizione di $p^{(\omega)}$, la dimostrazione \`e immediata.

\begin{proposition}\label{prop_p^omega_Morley}
Sia $p(x)\in S(\U)$ un tipo globale $A\jj$invariante. Allora le seguenti affermazioni sono equivalenti
\begin{itemize}
\item[1.]$\<c_i:i<\omega\>$ \`e una sequenze di Morley di $p$ su $A$;
\item[2.] $\<c_i:i<\omega\>\models p^{(\omega)}|_A$
\end{itemize}
\end{proposition}

La seguente proposizione torner\`a utile nei prossimi paragrafi, si osservi che  non \`e una conseguenza della proposizione~\ref{prop_p^omega_Morley} perch\'e qui l'invarianza su $A$ non \`e tra le ipotesi.

\begin{proposition}
Sia $p(x)\in S(\U)$ un tipo globale invariante ed $A$ un insieme arbitrario. Allora ogni $\<c_i:i<\omega\>\models p^{(\omega)}|_A$ \`e una sequenza di indiscernibili su $A$.
\end{proposition}


\begin{proof}
\`E sufficiente verificare che se $\<c_i:i<\omega\>\models p^{(\omega)}|_A$ allora $c_{i_0},\dots,c_{i_n}\models p^{(n+1)}|_A$ per ogni $i_0<\dots<i_n<\omega$. 
\end{proof}


%\ceq{\hfill p(x)\otimes q(y)}{=}{\Bigg\{\phi(x,y)\ :\ \parbox{50ex}{$\phi(x,y)\in L(A)\textrm{ per un } A \textrm{ contenente su cui }q(y)\textrm{ \`e invariante e }\\\phi(b,c) \textrm{ per qualche } a\models p_{\restriction A}(x)\textrm{ e }\ b\models q_{\restriction A,a}(y)$}\Bigg\}}
\end{comment}
\end{document}